<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Restaurants &amp; Menus | In the Wake</title>
  <meta name="version" content="v2.256.019"/>
  <link rel="canonical" href="https://www.cruisinginthewake.com/restaurants.html"/>
  <meta name="description" content="Premium & complimentary dining across the fleet — menus, prices, accessibility notes."/>
  <link rel="stylesheet" href="/assets/styles.css?v=2.245"/>

  <!-- Page patch (scoped) -->
  <style id="restaurants-v2_256_019">
    :root{
      --rope:#D9B382; --ink:#0f2a3a; --foam:#eef7fb; --accent:#0e6e8e;
      /* set the hero safely via CSS var; keeps gradient fallback if 404s */
      --restaurants-hero:url('/assets/img/wake-hero.jpg');
    }

    /* ===== HERO (Radiance look) ===== */
    body.restaurants-page .hero--wake{
      position:relative; isolation:isolate;
      min-height:clamp(220px,30vw,380px);
      background:
        linear-gradient(180deg, rgba(0,18,28,.25), rgba(0,18,28,.65) 78%, rgba(0,18,28,.82)),
        #0b2634;
      background-image:
        linear-gradient(180deg, rgba(0,18,28,.25), rgba(0,18,28,.65) 78%, rgba(0,18,28,.82)),
        var(--restaurants-hero);
      background-size:cover; background-position:center; background-repeat:no-repeat;
      margin-left:calc(50% - 50vw); width:100vw; color:#fff;
      display:flex; align-items:flex-end;
    }
    body.restaurants-page .hero--wake .latlon-grid{ position:absolute; inset:0; z-index:1; pointer-events:none; opacity:.55 }
    body.restaurants-page .hero--wake .latlon-grid svg{ width:100%; height:100% }
    body.restaurants-page .hero--wake .grid-lines{ stroke:rgba(255,255,255,.24); vector-effect:non-scaling-stroke }
    body.restaurants-page .hero-inner{
      position:relative; z-index:2; width:100%;
      max-width:1160px; margin:0 auto; padding:2.4rem 16px 1.6rem;
      text-shadow:0 2px 6px rgba(0,0,0,.55);
    }
    body.restaurants-page .hero--wake h1{
      margin:0; font-weight:800; font-size:clamp(1.8rem,3.5vw,2.9rem); letter-spacing:.01em;
    }
    body.restaurants-page .version-badge{
      display:inline-block; margin-left:.5rem; background:rgba(12,32,44,.7);
      border:1px solid rgba(255,255,255,.35); color:#fff;
      padding:.2rem .55rem; border-radius:8px; font-size:.78rem;
    }
    body.restaurants-page .hero--wake .subtitle{ margin:.35rem 0 0; color:#f7fafc; opacity:.95; font-size:clamp(.95rem,1.5vw,1.2rem) }

    /* ===== LAYOUT ===== */
    body.restaurants-page{ background:linear-gradient(var(--foam),#fff 240px); color:var(--ink); }
    body.restaurants-page .section{ position:relative; margin:0 auto; max-width:1160px; padding:0 16px 1rem; }
    body.restaurants-page .section::before{
      content:""; position:absolute; inset:auto 0 0 0; margin:auto;
      height:420px; max-width:980px; background:url('/assets/watermark.png') no-repeat center bottom/420px auto;
      opacity:.07; pointer-events:none; transform:translateY(60px);
    }
    body.restaurants-page .divider{
      height:12px; background:var(--rope);
      -webkit-mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;
              mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;
      background-repeat:repeat-x; margin:.5rem 0 1.5rem;
    }
    body.restaurants-page .grid{ display:grid; gap:1rem }
    body.restaurants-page .grid-3{ grid-template-columns:repeat(3,minmax(0,1fr)) }
    @media(max-width:960px){ .grid-3{grid-template-columns:1fr 1fr} }
    @media(max-width:640px){ .grid-3{grid-template-columns:1fr} }

    .card{border-radius:18px;box-shadow:0 2px 8px rgba(0,0,0,.06),inset 0 0 0 1px rgba(255,255,255,.7);
      background:#fff;border:2px solid var(--rope);padding:.9rem;}
    .card a{display:block;color:inherit;text-decoration:none}
    .card a strong{color:#0a3d62}
    .is-hidden{display:none!important}
    .section.is-hidden{display:none!important}

    /* SEARCH + CHIPS */
    #search-wrap{max-width:1160px;margin:.75rem auto 0;padding:0 16px}
    #q{width:100%;padding:.65rem .85rem;border-radius:12px;border:1px solid #cfe1ea;font-size:1rem}
    #q:focus{border-color:#0e6e8e;box-shadow:0 0 0 3px rgba(14,110,142,.15)}
    #search-meta{margin:.4rem 0 0;color:#355;font-size:.9rem}
    .filters{margin:.4rem auto 0;max-width:1160px;padding:0 16px}
    .filters .filter-row{display:flex;gap:.4rem;flex-wrap:wrap;align-items:center;margin:.35rem 0}
    .chip{padding:.35rem .6rem;border:1px dashed var(--rope);border-radius:999px;background:#fff;font-size:.9rem;cursor:pointer;user-select:none}
    .chip[aria-pressed="true"]{background:#0e6e8e;color:#fff;border-color:#0e6e8e;box-shadow:0 1px 6px rgba(0,0,0,.12)}
    .pill{background:rgba(230,244,248,.75);border-left:4px solid var(--rope);border:1px solid rgba(13,59,102,.06);
      color:var(--ink);padding:.5rem .75rem;border-radius:.5rem;}

    /* Brand/Class/Ship pills */
    #brandbar{position:relative;z-index:60;max-width:1160px;margin:.35rem auto 0;padding:0 16px}
    #brandbar .row{display:flex;gap:.4rem;flex-wrap:wrap;align-items:center}
    #brandbar .pillbtn{padding:.38rem .65rem;border:1px dashed var(--rope);border-radius:999px;background:#fff;font-size:.9rem;cursor:pointer}
    #brandbar .pillbtn[aria-pressed="true"]{background:#0e6e8e;color:#fff;border-color:#0e6e8e}
    #brandbar .tray{position:absolute;top:100%;left:16px;right:16px;display:none;background:#fff;border:2px solid var(--rope);
      border-radius:14px;padding:.6rem;margin-top:.35rem;box-shadow:0 8px 28px rgba(8,48,65,.18)}
    #brandbar .tray.on{display:block}
    #brandbar .tray .group{display:flex;gap:.4rem;flex-wrap:wrap}
  </style>
</head>

<body class="restaurants-page">
  <header class="site-header">
    <nav class="pill-nav" aria-label="Primary" style="display:flex;gap:.75rem;flex-wrap:wrap;padding:.75rem 1rem">
      <a href="/">Home</a><a href="/ships/">Ships</a>
      <a class="active" href="/restaurants.html">Restaurants &amp; Menus</a>
      <a href="/ports.html">Ports</a><a href="/disability-at-sea.html">Disability at Sea</a>
      <a href="/drink-packages.html">Drink Packages</a><a href="/packing-lists.html">Packing Lists</a>
      <a href="/cruise-lines/">Cruise Lines</a><a href="/solo.html">Solo</a><a href="/travel.html">Travel</a>
    </nav>

    <!-- 100% width hero, Radiance-style -->
    <div class="hero hero--wake" role="img" aria-label="Sunset wake hero image">
      <div class="latlon-grid" aria-hidden="true">
        <svg viewBox="0 0 100 60" preserveAspectRatio="none">
          <g class="grid-lines" stroke-width="0.35">
            <line x1="10" y1="0" x2="10" y2="60"/><line x1="20" y1="0" x2="20" y2="60"/>
            <line x1="30" y1="0" x2="30" y2="60"/><line x1="40" y1="0" x2="40" y2="60"/>
            <line x1="50" y1="0" x2="50" y2="60"/><line x1="60" y1="0" x2="60" y2="60"/>
            <line x1="70" y1="0" x2="70" y2="60"/><line x1="80" y1="0" x2="80" y2="60"/>
            <line x1="90" y1="0" x2="90" y2="60"/>
            <line x1="0" y1="10" x2="100" y2="10"/><line x1="0" y1="20" x2="100" y2="20"/>
            <line x1="0" y1="30" x2="100" y2="30"/><line x1="0" y1="40" x2="100" y2="40"/>
          </g>
        </svg>
      </div>
      <div class="hero-inner">
        <h1>Restaurants &amp; Menus <span class="version-badge">v2.256.019</span></h1>
        <p class="subtitle">Premium &amp; complimentary dining across the fleet — menus, prices, accessibility notes.</p>
      </div>
    </div>
  </header>

  <!-- Search -->
  <div id="search-wrap" role="search">
    <input id="q" type="search" inputmode="search" placeholder="Type to filter… (e.g., chops, sushi, suite, diamond)" aria-label="Filter restaurants by name, type, access, or tag">
    <div id="search-meta" class="tiny" aria-live="polite">Loading venues…</div>
  </div>

  <!-- Category chips -->
  <div id="filters" class="filters" role="group" aria-label="Filter dining">
    <div class="filter-row">
      <span class="label tiny">Categories:</span>
      <button type="button" class="chip" data-kind="cat" data-val="premium" aria-pressed="false">Premium</button>
      <button type="button" class="chip" data-kind="cat" data-val="complimentary" aria-pressed="false">Complimentary</button>
      <button type="button" class="chip" data-kind="cat" data-val="activity" aria-pressed="false">Activities</button>
    </div>
  </div>

  <!-- Brand → Class → Ship pill bar -->
  <nav id="brandbar" aria-label="Filter by brand, class, or ship">
    <div class="row">
      <span class="label tiny">Show only:</span>
      <button class="pillbtn" id="brandBtn" aria-expanded="false" aria-controls="tray-brand">Royal Caribbean</button>
      <button class="pillbtn" id="classBtn" aria-expanded="false" aria-controls="tray-class">Ship Class</button>
      <button class="pillbtn" id="shipBtn"  aria-expanded="false" aria-controls="tray-ship">Ship</button>
      <button class="pillbtn" id="clearBtn" title="Clear brand/class/ship filters">Clear</button>
    </div>
    <div id="tray-brand" class="tray" role="menu"><div class="group" id="brands"></div></div>
    <div id="tray-class" class="tray" role="menu"><div class="group" id="classes"></div></div>
    <div id="tray-ship"  class="tray" role="menu"><div class="group" id="ships"></div></div>
  </nav>

  <main>
    <section class="section">
      <p class="pill"><strong>Note:</strong> Prices change by ship and sailing; some venues unavailable on select itineraries.</p>
    </section>

    <!-- Auto-rendered sections -->
    <section class="section" id="complimentary">
      <h2>Main Dining &amp; Complimentary</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid grid-3" id="grid-complimentary"></div>
    </section>

    <section class="section" id="premium">
      <h2>Specialty Dining</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid grid-3" id="grid-premium"></div>
    </section>

    <section class="section" id="activity">
      <h2>Dining Activities &amp; Classes</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid grid-3" id="grid-activity"></div>
    </section>

    <section class="section" id="by-ship">
      <h2>Quick Links by Ship</h2>
      <div class="divider" aria-hidden="true"></div>
      <div id="ship-links"></div>
    </section>

    <section class="section">
      <p class="pill"><strong>Accessibility:</strong> See each venue page and <a href="/disability-at-sea.html">Disability at Sea</a> for ship notes.</p>
    </section>
  </main>

  <footer class="site-footer" style="text-align:center">
    <p>© 2025 In the Wake — A Cruise Traveler’s Logbook</p>
  </footer>

  <!-- ============ JS: render + fuzzy filter + trays ============ -->
  <script>
  (function(){
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const $q = $('#q');
    const $meta = $('#search-meta');

    /* ---------- helpers ---------- */
    function norm(s){
      return String(s||'')
        .toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[’‘']/g,"'")
        .replace(/[-_/]/g,' ')
        .replace(/\s+/g,' ')
        .trim();
    }
    // small, fast edit-distance<=1
    function near(a,b){
      if (a===b) return true;
      if (!a||!b) return false;
      if (Math.abs(a.length-b.length)>1) return false;
      if (a.length===b.length){
        let d=0; for(let i=0;i<a.length;i++) if(a[i]!==b[i]) d++;
        return d<=1;
      }
      // ensure a is shorter
      if (a.length>b.length) [a,b]=[b,a];
      for(let i=0,j=0;i<a.length && j<b.length;){
        if (a[i]===b[j]){i++;j++;} else { j++; return a.slice(i)===b.slice(j) || a.slice(i+1)===b.slice(j); }
      }
      return true;
    }

    const SYN = {
      diamond: ['diamond','diamond lounge','diamond and above','diamond plus','crown and anchor diamond','crown & anchor diamond'],
      suite:   ['suite','suites','suite lounge','pinnacle','coastal kitchen','the grove'],
      pinnacle:['pinnacle','suite','suite lounge','coastal kitchen','the grove'],
      complimentary:['complimentary','included','free'],
      premium:['premium','specialty','extra fee']
    };

    function tokenMatch(text, tokens){
      if (!tokens.length) return true;
      const words = text.split(/\s+/);
      return tokens.every(tok=>{
        if (!tok) return true;
        if (text.includes(tok)) return true;
        if (SYN[tok]) {
          for (const s of SYN[tok]) if (text.includes(norm(s))) return true;
        }
        for (const w of words){ if (w.startsWith(tok) || near(tok,w)) return true; }
        return false;
      });
    }

    /* ---------- render from JSON ---------- */
    const BLURB = {
      "mdr":"Rotating menus, themed nights; classic cruise dining.",
      "windjammer":"Casual buffet for breakfast, lunch, and dinner.",
      "park-cafe":"Quick salads, paninis, and the Kummelweck roll.",
      "latte-tudes":"Espresso drinks and morning pastries.",
      "sorrentos":"Grab-and-go slices and late-night pizza.",
      "room-service":"Order-in comfort; delivery fee may apply.",
      "chops":"Signature steakhouse; premium cuts and sides.",
      "giovannis":"Rustic Italian favorites; family-style warmth.",
      "izumi":"Sushi, hibachi, and hot rocks (ship dependent).",
      "chefs-table":"Hosted tasting dinner with wine pairings.",
      "samba-grill":"Brazilian churrascaria served rodizio-style.",
      "johnny-rockets":"American diner classics and milkshakes.",
      "cafe-promenade":"24-hour light bites and coffee on many ships.",
      "vintages":"Wine bar flights, small plates on select ships.",
      "playmakers":"Wings, sliders, and big-screen sports.",
      "dog-house":"Gourmet hot dogs with regional toppings.",
      "solarium-bistro":"Lighter Mediterranean-style buffet.",
      "coastal-kitchen":"Suite-guest dining; Mediterranean meets California.",
      "vitality-cafe":"Smoothies and light, health-forward bites.",
      "el-loco-fresh":"Casual tacos, nachos, and burritos.",
      "aquadome-market":"Icon-class food hall with global stalls.",
      "pearl-cafe":"Anytime snacks and views off the Promenade.",
      "surfside-eatery":"Family-friendly buffet in Surfside.",
      "the-grove":"Suite-only alfresco venue on Icon class.",
      "basecamp":"Quick bites steps from the action.",
      "celebration-table":"Private dining experience for your crew.",
      "pier-7":"All-day breakfast and fresh coastal plates.",
      "izumi-in-the-park":"Walk-up sushi & sweets in the open air.",
      "starbucks":"The Starbucks favorites you know, at sea.",
      "wonderland":"A whimsical, multi-sensory dining adventure.",
      "hooked":"New-England-style seafood and raw bar.",
      "jamies-italian":"Jamie Oliver’s rustic pastas and plates.",
      "150-central-park":"Chef-driven fine dining in Central Park.",
      "sugar-beach":"Candy store with hand-scooped ice cream.",
      "lincoln-park-supper-club":"Icon’s live-music supper club experience.",
      "dining-activities":"Hands-on classes and tastings fleetwide.",
      "suite-lounge":"Private lounge with small bites (Suites & Pinnacle).",
      "diamond-lounge":"Member lounge with snacks (Diamond & above)."
    };

    const roots = {
      complimentary: $('#grid-complimentary'),
      premium:       $('#grid-premium'),
      activity:      $('#grid-activity')
    };

    function cardHTML(v, shipList, classList, access){
      const slug = v.slug;
      const name = v.name || slug;
      const href = `/restaurants/${slug}.html`;
      const cat  = (v.category || 'complimentary').toLowerCase();
      const blurb = v.blurb || BLURB[slug] || 'Details vary by ship; see venue page.';

      const tags = norm([name,(v.aliases||[]).join(' '),blurb,(v.access||[]).join(' '),(v.audience||[]).join(' '),slug].join(' '));

      // helper tags so “diamond / suite / pinnacle” match
      const extra = [];
      if (slug==='diamond-lounge'){ extra.push('diamond lounge','diamond and above','diamond plus','crown & anchor diamond'); }
      if (slug==='suite-lounge'){ extra.push('suite lounge','pinnacle','suites'); }
      if (slug==='coastal-kitchen' || slug==='the-grove'){ extra.push('suite','pinnacle','suite restaurant'); }

      return `
        <div class="card">
          <a href="${href}"
             data-cat="${cat}"
             data-brand="rccl"
             ${shipList.length?'data-ships="'+shipList.join(' ')+'"':''}
             ${classList.length?'data-classes="'+classList.join(' ')+'"':''}
             ${access.length?'data-access="'+access.join(', ')+'"':''}
             data-tags="${tags} ${norm(extra.join(' '))}">
            <strong>${name}</strong><br><small>${blurb}</small>
          </a>
        </div>`;
    }

    function hideEmptySections(){
      [['complimentary','grid-complimentary'],['premium','grid-premium'],['activity','grid-activity']].forEach(([sec,grid])=>{
        const $sec = document.getElementById(sec);
        const vis = document.getElementById(grid).querySelectorAll('.card:not(.is-hidden)').length;
        $sec.classList.toggle('is-hidden', vis===0);
      });
    }

    /* ---------- state + filter ---------- */
    let CARDS = []; // {el, cat, brand, text, ships:Set, classes:Set}
    const STATE = { cats:new Set(), query:'', brand:'rccl', klass:'', ship:'' };

    function reindex(){
      CARDS = $$('.grid .card a').map(a=>{
        const cat    = (a.getAttribute('data-cat')||'').toLowerCase();
        const brand  = (a.getAttribute('data-brand')||'rccl').toLowerCase();
        const text   = norm(a.textContent + ' ' + (a.getAttribute('data-tags')||'') + ' ' + (a.getAttribute('data-access')||''));
        const ships  = new Set((a.getAttribute('data-ships')||'').toLowerCase().split(/\s+/).filter(Boolean));
        const klass  = new Set((a.getAttribute('data-classes')||'').toLowerCase().split(/\s+/).filter(Boolean));
        return { el:a.closest('.card'), cat, brand, text, ships, classes:klass };
      });
    }

    function apply(){
      const toks = STATE.query ? norm(STATE.query).split(' ') : [];
      let shown = 0;
      CARDS.forEach(c=>{
        const tHit = tokenMatch(c.text, toks);
        const cHit = !STATE.cats.size || STATE.cats.has(c.cat);
        const bHit = !STATE.brand || c.brand===STATE.brand;
        const kHit = !STATE.klass || c.classes.has(STATE.klass);
        const sHit = !STATE.ship  || c.ships.has(STATE.ship);
        const hit = tHit && cHit && bHit && kHit && sHit;
        c.el.classList.toggle('is-hidden', !hit);
        if (hit) shown++;
      });
      hideEmptySections();
      $meta.textContent = (STATE.query || STATE.cats.size || STATE.klass || STATE.ship)
        ? `Showing ${shown} of ${CARDS.length}`
        : `Showing all ${CARDS.length} venues & activities`;
    }

    function readURL(){
      const sp = new URLSearchParams(location.search);
      STATE.query = sp.get('q') || '';
      const cats = (sp.get('cats')||'').split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
      STATE.cats = new Set(cats);
      STATE.brand = sp.get('brand') || 'rccl';
      STATE.klass = (sp.get('class')||'').toLowerCase();
      STATE.ship  = (sp.get('ship')||'').toLowerCase();
      if ($q && STATE.query) $q.value = STATE.query;
      // reflect chip states
      $$('#filters .chip').forEach(c=>{
        const on = STATE.cats.has((c.getAttribute('data-val')||'').toLowerCase());
        c.setAttribute('aria-pressed', on?'true':'false');
      });
    }
    function writeURL(){
      const sp = new URLSearchParams();
      if (STATE.query) sp.set('q', STATE.query);
      if (STATE.cats.size) sp.set('cats', Array.from(STATE.cats).join(','));
      if (STATE.brand && STATE.brand!=='rccl') sp.set('brand', STATE.brand);
      if (STATE.klass) sp.set('class', STATE.klass);
      if (STATE.ship)  sp.set('ship', STATE.ship);
      history.replaceState(null,'', location.pathname + (sp.toString()?('?'+sp.toString()):''));
    }

    // input + chips
    function wireBasics(){
      if ($q){ $q.addEventListener('input', ()=>{ STATE.query=$q.value||''; writeURL(); apply(); }); }
      $$('#filters .chip').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const val = (btn.getAttribute('data-val')||'').toLowerCase();
          const on  = btn.getAttribute('aria-pressed')==='true';
          if (on) STATE.cats.delete(val); else STATE.cats.add(val);
          btn.setAttribute('aria-pressed', on?'false':'true');
          writeURL(); apply();
        });
      });
      // keyboard quick focus
      window.addEventListener('keydown', e=>{ if(e.key==='/' && document.activeElement!==$q){ e.preventDefault(); $q.focus(); }});
    }

    /* ---------- trays (brand / class / ship) ---------- */
    (function trays(){
      const brandBtn = $('#brandBtn'), classBtn=$('#classBtn'), shipBtn=$('#shipBtn'), clearBtn=$('#clearBtn');
      const tBrand = $('#tray-brand'), tClass=$('#tray-class'), tShip=$('#tray-ship');

      function toggle(btn, tray){
        const on = tray.classList.contains('on');
        [tBrand,tClass,tShip].forEach(x=>x.classList.remove('on'));
        [brandBtn,classBtn,shipBtn].forEach(b=>b.setAttribute('aria-expanded','false'));
        if (!on){ tray.classList.add('on'); btn.setAttribute('aria-expanded','true'); }
      }
      brandBtn.addEventListener('click', ()=>toggle(brandBtn,tBrand));
      classBtn.addEventListener('click', ()=>toggle(classBtn,tClass));
      shipBtn .addEventListener('click', ()=>toggle(shipBtn,tShip));
      [tBrand,tClass,tShip].forEach(tray=>{
        tray.addEventListener('mouseleave', ()=>setTimeout(()=>tray.classList.remove('on'),220));
        tray.addEventListener('focusout', e=>{ if(!tray.contains(e.relatedTarget)) setTimeout(()=>tray.classList.remove('on'),220); });
      });
      clearBtn.addEventListener('click', ()=>{
        STATE.klass=''; STATE.ship=''; writeURL(); apply();
        [tBrand,tClass,tShip].forEach(x=>x.classList.remove('on'));
      });
      // expose for renderer
      window.__brandbar = {
        setClass: k => { STATE.klass=k||''; STATE.ship=''; writeURL(); apply(); },
        setShip:  s => { STATE.ship=s||''; writeURL(); apply(); },
        setBrand: b => { STATE.brand=b||'rccl'; writeURL(); apply(); },
        close: () => [tBrand,tClass,tShip].forEach(x=>x.classList.remove('on'))
      };
    })();

    /* ---------- fetch + build ---------- */
    async function loadDB(){
      try{
        const res = await fetch('/assets/data/venues.json',{cache:'no-store'});
        if(!res.ok) throw new Error(res.status);
        return await res.json();
      }catch(e){
        $meta.textContent = 'Could not load venues data.';
        return null;
      }
    }

    function buildReverseIndexes(db){
      const shipsByVenue = new Map();
      const classByShip  = {};
      Object.entries(db.ships||{}).forEach(([slug, p])=>{
        classByShip[slug] = (p.class||'').toLowerCase();
        (p.venues||[]).forEach(v=>{
          if(!shipsByVenue.has(v)) shipsByVenue.set(v, new Set());
          shipsByVenue.get(v).add(slug);
        });
      });
      return {shipsByVenue, classByShip};
    }

    function paintVenues(db){
      const {shipsByVenue, classByShip} = buildReverseIndexes(db);
      // clear grids
      Object.values(roots).forEach(r=>r.innerHTML='');

      const allVenues = (db.venues||[]).slice().sort((a,b)=> (a.name||a.slug).localeCompare(b.name||b.slug));
      allVenues.forEach(v=>{
        const shipList = Array.from( (shipsByVenue.get(v.slug)||new Set()).values() );
        const classList = Array.from( new Set(shipList.map(s=>classByShip[s]).filter(Boolean)) );
        const access = (Array.isArray(v.access)?v.access:[]).map(s=>String(s).toLowerCase().replace(/\+/g,' plus').replace(/-/g,' '));
        const root = roots[(v.category||'complimentary').toLowerCase()] || roots.complimentary;
        root.insertAdjacentHTML('beforeend', cardHTML(v, shipList, classList, access));
      });
    }

    function buildTrays(db){
      const $brands  = $('#brands');
      const $classes = $('#classes');
      const $ships   = $('#ships');

      // brands: RC only for now
      $brands.innerHTML = `<button class="pillbtn" role="menuitem" data-brand="rccl">Royal Caribbean</button>`;
      $brands.querySelectorAll('button').forEach(b=>{
        b.addEventListener('click',()=>{ window.__brandbar.setBrand(b.getAttribute('data-brand')); window.__brandbar.close(); });
      });

      // classes
      const classes = Array.from(new Set(Object.values(db.ships||{}).map(p=>String(p.class||'').toLowerCase()).filter(Boolean))).sort();
      $classes.innerHTML = classes.map(k=>`<button class="pillbtn" role="menuitem" data-class="${k}">${k.replace(/\b\w/g,m=>m.toUpperCase())} Class</button>`).join('');
      $classes.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const k = btn.getAttribute('data-class');
          window.__brandbar.setClass(k);
          fillShips(k);
          window.__brandbar.close();
        });
      });

      function fillShips(k){
        const list = Object.entries(db.ships||{}).filter(([slug,p])=>!k || String(p.class||'').toLowerCase()===k)
                     .sort((a,b)=>(a[1].name||a[0]).localeCompare(b[1].name||b[0]));
        $ships.innerHTML = list.map(([slug,p])=>`<button class="pillbtn" role="menuitem" data-ship="${slug}">${p.name}</button>`).join('');
        $ships.querySelectorAll('button').forEach(btn=>{
          btn.addEventListener('click',()=>{ window.__brandbar.setShip(btn.getAttribute('data-ship')); window.__brandbar.close(); });
        });
      }
      fillShips('');
    }

    function buildQuickLinks(db){
      const host = $('#ship-links');
      if(!host) return;
      const items = Object.entries(db.ships||{}).sort((a,b)=>(a[1].name||a[0]).localeCompare(b[1].name||b[0]));
      host.innerHTML = items.map(([slug,p])=>`<button class="pillbtn" data-ship="${slug}" title="Show restaurants on ${p.name}">${p.name}</button>`).join('');
      host.querySelectorAll('button').forEach(b=>{
        b.addEventListener('click',()=>{
          window.__brandbar.setShip(b.getAttribute('data-ship'));
          window.scrollTo({top: document.getElementById('search-wrap').offsetTop - 80, behavior:'smooth'});
        });
      });
    }

    /* ---------- boot ---------- */
    (async function(){
      wireBasics();
      readURL();
      const db = await loadDB();
      if (!db || !Array.isArray(db.venues)){ hideEmptySections(); return; }

      // ensure lounges exist in catalog if not already in db.venues (won't change ship mapping)
      const have = new Set((db.venues||[]).map(v=>v.slug));
      if (!have.has('suite-lounge'))   db.venues.push({slug:'suite-lounge',name:'Suite Lounge',category:'complimentary',blurb:BLURB['suite-lounge']});
      if (!have.has('diamond-lounge')) db.venues.push({slug:'diamond-lounge',name:'Diamond Lounge',category:'complimentary',blurb:BLURB['diamond-lounge']});

      paintVenues(db);
      buildTrays(db);
      buildQuickLinks(db);

      reindex();
      apply();

      $meta.textContent = `Showing all ${CARDS.length} venues & activities`;
    })();

  })();
  </script>
</body>
</html>
