<!-- ships/index.html — Royal Caribbean Fleet Hub (v3.006) -->
<!doctype html>
<html lang="en">
<head>
  <!-- Analytics -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>

  <!-- Absolute-URL normalizer (current origin) -->
  <script>
  (function(){
    const ORIGIN=(location.origin||(location.protocol+'//'+location.host)).replace(/\/$/,'');
    window._abs=function(path){ path=String(path||''); if(!path.startsWith('/')) path='/'+path; return ORIGIN+path; };
    document.addEventListener('DOMContentLoaded', function(){
      const sel=['a[href^="https://www.cruisinginthewake.com/"]','img[src^="https://www.cruisinginthewake.com/"]','link[href^="https://www.cruisinginthewake.com/"]','script[src^="https://www.cruisinginthewake.com/"]'].join(',');
      document.querySelectorAll(sel).forEach(el=>{
        const attr=el.hasAttribute('href')?'href':'src';
        try{const u=new URL(el.getAttribute(attr)); el.setAttribute(attr, ORIGIN+u.pathname+u.search+u.hash);}catch(_){}
      });
    },{once:true});
  })();
  </script>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Royal Caribbean Fleet — In the Wake (v3.006)</title>
  <meta name="version" content="3.006"/>
  <meta name="description" content="Browse Royal Caribbean’s “of the Seas” ships with image-verified pages and quick links to each ship’s details."/>
  <meta name="referrer" content="no-referrer"/>
  <meta name="robots" content="index, follow"/>

  <!-- Canonical & Social -->
  <link rel="canonical" href="https://www.cruisinginthewake.com/ships/index.html"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/ships/index.html"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:title" content="Royal Caribbean Fleet — In the Wake"/>
  <meta property="og:description" content="Image-verified Royal Caribbean ship pages, rotating thumbnails, and quick links."/>
  <meta property="og:image" content="https://www.cruisinginthewake.com/assets/index_hero.jpg"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/styles.css?v=3.006"/>

  <!-- Preloads -->
  <link rel="preload" as="image" href="/assets/compass_rose.svg"/>
  <link rel="preload" as="script" href="/assets/js/site-cache.js"/>

  <script src="/assets/js/site-cache.js" defer></script>
  <script>
  if('serviceWorker' in navigator){
    addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));
  }
  </script>
</head>

<body class="page no-hero-filter">
  <a class="skip-link" href="#content">Skip to main content</a>

  <header class="site-header hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="/assets/logo_wake.png" width="256" height="64" alt="In the Wake wordmark"/>
        <span class="version-badge">v3.006</span>
      </div>
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/ships/" aria-current="page">Ships</a>
        <a href="/restaurants.html">Restaurants &amp; Menus</a>
        <a href="/ports.html">Ports</a>
        <a href="/disability-at-sea.html">Disability at Sea</a>
        <a href="/drink-packages.html">Drink Packages</a>
        <a href="/packing-lists.html">Packing Lists</a>
        <a href="/planning.html">Planning</a>
        <a href="/solo.html">Solo</a>
        <a href="/travel.html">Travel</a>
      </nav>
    </div>

    <div class="hero" role="img" aria-label="Fleet hub hero image">
      <div class="latlon-grid" aria-hidden="true"></div>
      <img class="hero-compass" src="/assets/compass_rose.svg" alt="" aria-hidden="true"/>
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake.png" alt="In the Wake"/>
        <div class="tagline">A Cruise Traveler’s Logbook</div>
      </div>
      <div class="hero-credit">
        <a class="pill long" href="https://instagram.com/flickersofmajesty" target="_blank" rel="noopener">Photo © Flickers of Majesty</a>
      </div>
    </div>
  </header>

  <main class="wrap" id="content">
    <section class="card">
      <h1>Royal Caribbean Fleet</h1>
      <p>Explore the completed ship pages for Royal Caribbean International. Each ship below links to its dedicated page. Only pages with verified imagery appear for now; more ships are added as pages are finished.</p>
    </section>

    <section class="card" aria-labelledby="ots-title">
      <h2 id="ots-title">‘…of the Seas’ (image-verified)</h2>
      <div id="fleet-grid" class="grid-3" aria-live="polite"></div>
      <p id="fleet-empty" class="tiny hidden">No completed ship pages found yet.</p>
    </section>

    <section class="card">
      <h2>Data</h2>
      <p class="tiny">Data sources: <code>rc-fleet-index.json</code> / <code>rcl_of_the_seas.json</code></p>
    </section>
  </main>

  <footer class="wrap center">© <span id="yr"></span> In the Wake — A Cruise Traveler’s Logbook</footer>
  <script>document.getElementById('yr').textContent=new Date().getFullYear();</script>

  <!-- Fleet loader -->
  <script>
  (async function(){
    const abs=(p)=> (typeof _abs==='function'? _abs(p): p);

    // JSON primary + fallback (per your instruction: do NOT merge; just fallback)
    const JSON_SOURCES=[
      abs('/ships/assets/data/rc-fleet-index.json'),
      abs('/data/rcl_of_the_seas.json')
    ];

    // Known images per slug (rotate randomly); allure mapping included
    const IMAGES={
      'adventure-of-the-seas':[
        '/ships/rcl/images/Adventure_of_the_Seas1.jpeg',
        '/ships/rcl/images/Adventure_of_the_Seas2.jpg',
        '/ships/rcl/images/Adventure_of_the_Seas3.jpg',
        '/ships/rcl/images/Adventure_of_the_Seas_docked_in_Aruba_2024.jpg',
        '/ships/rcl/images/Adventure_of_the_Seas_pool_area.jpg',
        '/ships/rcl/images/Adventure_of_the_seas_in_Willemstad.jpg'
      ],
      'allure-of-the-seas':[
        '/ships/assets/images/allure-of-the-seas-3.jpg',
        '/ships/assets/images/allure2.jpg',
        '/ships/assets/images/allure3.jpg'
      ],
      'enchantment-of-the-seas':[
        '/ships/assets/enchantment-of-the-seas1.jpg',
        '/ships/assets/images/Enchantment_of_the_Seas.jpeg',
        '/images/enchantment-of-the-seas2.jpeg',
        '/ships/assets/images/Enchantment_of_the_Seas,_San_Juan Medium.jpeg'
      ],
      'grandeur-of-the-seas':[ '/ships/assets/grandeur-of-the-seas1.jpg' ],
      'radiance-of-the-seas':[
        '/ships/assets/images/allure2.jpg' /* temp alt if needed */
      ],
      'rhapsody-of-the-seas':[
        '/ships/assets/rhapsody-of-the-seas1.jpg',
        '/ships/assets/images/Rhapsody_of_the_Seas_2 Medium.jpeg',
        '/ships/assets/images/Rhapsody_of_the_Seas_(2)_(6451158929) Medium.jpeg',
        '/ships/assets/images/Rhapsody_of_the_Seas_(3731959629) Medium.jpeg'
      ],
      'sovereign-of-the-seas':[
        '/ships/assets/sovereign-of-the-seas1.jpg',
        '/ships/assets/sovereign-of-the-seas2.jpg',
        '/ships/assets/sovereign-of-the-seas3.jpg'
      ],
      'vision-of-the-seas':[ '/ships/assets/vision-of-the-seas1.jpg' ]
    };

    // Cache-first image existence check: try caches, then HEAD/network
    async function imageExists(url){
      try{
        if('caches' in window){
          const c = await caches.open('site-static');
          const m = await c.match(url, {ignoreSearch:false});
          if(m) return true;
        }
      }catch(_){}
      try{
        const r = await fetch(url, { method:'HEAD', cache:'no-store' });
        return r.ok;
      }catch(_){ return false; }
    }

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    async function loadFleet(){
      // try site-cache first (nice-to-have)
      const tryJson = async (url) => {
        try{
          if(window.SiteCache && SiteCache.getJSON){
            const j = await SiteCache.getJSON(url, { ttlDays:7, versionPath:['version','meta','generated'] });
            if(j && j.ships) return j;
          }
        }catch(_){}
        const r=await fetch(url,{cache:'no-store'}); if(r.ok) return r.json();
        return null;
      };
      for(const u of JSON_SOURCES){
        const data = await tryJson(u).catch(()=>null);
        if(data && Array.isArray(data.ships)) return data;
      }
      throw new Error('no data');
    }

    function normName(s){ return String(s||'').toLowerCase(); }

    const grid=document.getElementById('fleet-grid');
    const empty=document.getElementById('fleet-empty');

    let data;
    try{
      data=await loadFleet();
    }catch(e){
      empty.classList.remove('hidden');
      empty.textContent='Failed to load fleet data.';
      return;
    }

    // keep only “of the Seas”
    const ships=(data.ships||[]).filter(s=>/ of the seas$/i.test(s.name||''));

    // build cards only for slugs with an image that actually exists
    const cards=[];
    for(const s of ships){
      const slug = s.slug || normName(s.name).replace(/\s+/g,'-');
      const imgs = IMAGES[slug];
      if(!imgs || !imgs.length) continue;

      // validate one image exists (cache-first)
      let chosen=null;
      for(const candidate of imgs.sort(()=>Math.random()-0.5)){
        // spaces in some filenames — make sure we don’t break
        const safe = candidate.replace(/ /g, '%20');
        // eslint-disable-next-line no-await-in-loop
        if(await imageExists(abs(safe))){ chosen = candidate; break; }
      }
      if(!chosen) continue;

      const href = `/ships/rcl/${slug}.html`;
      cards.push(
        `<a class="ship-card" href="${abs(href)}" aria-label="${s.name}">
          <div class="thumb"><img src="${abs(chosen)}" alt="${s.name}"></div>
          <div class="body">
            <h3 style="margin:0">${s.name}</h3>
            <span class="badge">${s.class || '—'}</span>
          </div>
        </a>`
      );
    }

    grid.innerHTML = cards.join('');
    empty.classList.toggle('hidden', cards.length>0);
  })();
  </script>
</body>
</html>
