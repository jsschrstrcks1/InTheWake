<!doctype html>
<html lang="en">
<head>
  <!--
  Soli Deo Gloria
  All work on this project is offered as a gift to God.
  “Trust in the LORD with all your heart, and do not lean on your own understanding.” — Proverbs 3:5
  “Whatever you do, work heartily, as for the Lord and not for men.” — Colossians 3:23
  -->

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Royal Caribbean — In the Wake (v3.006.009)</title>
  <meta name="version" content="v3.006.009"/>
  <meta name="description" content="Royal Caribbean, class-by-class and ship-by-ship: venues, experiences, dress code, and ship search with image thumbnails."/>
  <meta name="theme-color" content="#0e6e8e"/>
  <meta name="robots" content="index,follow"/>

  <!-- Canonical + Social -->
  <link rel="canonical" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html"/>
  <meta property="og:title" content="Royal Caribbean — In the Wake"/>
  <meta property="og:description" content="Explore Royal Caribbean by class and ship with venue and experience guides."/>
  <meta property="og:image" content="https://www.cruisinginthewake.com/assets/social/royal-caribbean-hero.jpg?v=3.006.009"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- JSON-LD (Breadcrumbs) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://www.cruisinginthewake.com/"},
      {"@type":"ListItem","position":2,"name":"Cruise Lines","item":"https://www.cruisinginthewake.com/cruise-lines.html"},
      {"@type":"ListItem","position":3,"name":"Royal Caribbean","item":"https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html"}
    ]
  }
  </script>

  <!-- Unified CSS (cache-busted MUST) -->
  <link rel="stylesheet" href="https://www.cruisinginthewake.com/assets/styles.css?v=3.006.009"/>
  <link rel="preload" as="image" href="https://www.cruisinginthewake.com/assets/compass_rose.svg"/>

  <!-- Page-local trims (kept minimal; no overrides to hero/filter rules) -->
  <style>
    .brand-title{display:none!important}
    .two-col{display:grid;grid-template-columns:1fr 320px;gap:1rem}
    @media (max-width:1060px){.two-col{grid-template-columns:1fr}}
    .side-panel{display:flex;flex-direction:column;gap:1rem}
    .pillrow{display:flex;flex-wrap:wrap;gap:.5rem}
    .pillbtn{display:inline-block;padding:.35rem .7rem;border-radius:999px;border:1px dashed var(--rope);background:#fff;font-weight:600}
    .toolbar{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .toolbar .seg{display:inline-flex;border:1px solid var(--rope);border-radius:999px;overflow:hidden}
    .toolbar .seg button{padding:.35rem .7rem;border:0;background:#fff}
    .toolbar .seg button.active{background:var(--foam);font-weight:700}
    .ship-card .class-chip{font-size:.72rem;background:#f7fdff;border:1px solid var(--rope);border-radius:999px;padding:.1rem .45rem;margin-left:.4rem}
    .thumb img{background:#eef4f6}
    .tiny-muted{font-size:.86rem;color:#567}
    .venue-card{display:grid;grid-template-columns:56px 1fr;gap:.6rem;align-items:center;border:2px solid var(--rope);border-radius:12px;background:#fff;padding:.5rem}
    .venue-card .vthumb{width:56px;height:56px;border-radius:10px;overflow:hidden;border:1px solid #dfe7ea;background:#eef4f6}
    .venue-card .vthumb img{width:100%;height:100%;object-fit:cover}
    .venue-card .vbody strong{color:var(--sea)}
    .h-rule{height:12px;background:var(--rope);
      -webkit-mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
         background:#f7f9fb;border:1px solid #cfe1ea;border-radius:6px;padding:.06rem .33rem}
  </style>

  <!-- Reduced motion + SW (Every Page) -->
  <style>@media (prefers-reduced-motion: reduce){*{animation-duration:.001ms!important;transition-duration:.001ms!important;}}</style>
  <script>if('serviceWorker' in navigator){addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));}</script>
</head>

<body class="page no-hero-filter">
  <a class="skip-link" href="#content">Skip to content</a>

  <header class="hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="https://www.cruisinginthewake.com/assets/logo_wake.png" alt="In the Wake"/>
        <span class="version-badge">v3.006.009</span>
      </div>
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="https://www.cruisinginthewake.com/">Home</a>
        <a href="https://www.cruisinginthewake.com/ships/">Ships</a>
        <a href="https://www.cruisinginthewake.com/restaurants/">Restaurants &amp; Menus</a>
        <a href="https://www.cruisinginthewake.com/ports.html">Ports</a>
        <a href="https://www.cruisinginthewake.com/disability-at-sea.html">Disability at Sea</a>
        <a href="https://www.cruisinginthewake.com/drink-packages.html">Drink Packages</a>
        <a href="https://www.cruisinginthewake.com/packing-lists.html">Packing Lists</a>
        <a href="https://www.cruisinginthewake.com/planning.html">Planning</a>
        <a href="https://www.cruisinginthewake.com/solo.html">Solo Travel</a>
        <a href="https://www.cruisinginthewake.com/travel.html">Travel Tips</a>
        <a href="https://www.cruisinginthewake.com/cruise-lines.html" aria-current="page">Cruise Lines</a>
        <a href="https://www.cruisinginthewake.com/about-us.html">About Us</a>
      </nav>
    </div>

    <div class="hero" role="img" aria-label="Open ocean at sunrise">
      <div class="latlon-grid" aria-hidden="true"></div>
      <img class="hero-compass" src="https://www.cruisinginthewake.com/assets/compass_rose.svg" alt="" aria-hidden="true"/>
      <div class="hero-title"><img class="logo" src="https://www.cruisinginthewake.com/assets/logo_wake.png" alt="In the Wake"><div class="tagline">A Cruise Traveler’s Logbook</div></div>
      <div class="hero-credit"><a class="pill long" href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">Photo © Flickers of Majesty</a></div>
    </div>
  </header>

  <main class="wrap" id="content">
    <!-- Overview (fusion tone) -->
    <section class="card">
      <h1>Royal Caribbean</h1>
      <p>Big-ship bravado, neighborhood strolls, ice and aqua shows that turn the sea into a stage — and enough dining choice to make a sea day a progressive feast. Start by class (Icon → Oasis → Quantum/Ultra → Freedom → Voyager → Radiance → Vision), then drop anchor on the ship whose venues, shows, and cabin quirks suit your crew. We’ll steer with clarity, skip the hype, and keep the compass set to useful. <strong>Soli Deo Gloria.</strong></p>
      <div class="tiny">Tip: Search below matches <em>ships</em>, <em>classes</em>, <em>venues</em>, and <em>experiences</em>. Toggle “Show unfinished ships” to include pages still in dry dock (no thumbnail yet).</div>
    </section>

    <!-- Global search -->
    <section class="card" role="search" aria-label="Search ships, classes, venues, experiences">
      <label class="tiny" for="q">Search Royal Caribbean (ships, classes, venues, experiences)</label>
      <input id="q" type="search" inputmode="search" placeholder="Try: Oasis, Chops, Icon, Radiance, Chef’s Table, FlowRider…" autocomplete="off" aria-controls="search-out">
      <div class="toolbar" style="margin-top:.6rem">
        <div class="seg" id="finished-toggle">
          <button type="button" data-finish="finished" class="active" aria-pressed="true">Finished only</button>
          <button type="button" data-finish="all" aria-pressed="false">Show unfinished ships</button>
        </div>
        <div class="seg" id="exp-filter">
          <button type="button" data-exp="all" class="active">Experiences: All</button>
          <button type="button" data-exp="included">Included</button>
          <button type="button" data-exp="premium">Premium</button>
          <button type="button" id="exp-clear">Clear</button>
        </div>
        <div class="seg" id="venue-filter">
          <button type="button" data-venue="all" class="active">Venues: All</button>
          <button type="button" data-venue="included">Included</button>
          <button type="button" data-venue="premium">Premium</button>
        </div>
      </div>
      <div id="search-out" class="grid-3" style="margin-top:.8rem"></div>
    </section>

    <!-- Two-column: left content + right rail -->
    <section class="two-col">
      <div>
        <!-- Class → Ships pill tray -->
        <section class="card" id="class-pills">
          <h2>Classes</h2>
          <div class="pillrow" id="class-tray" aria-live="polite"></div>
          <div id="class-note" class="tiny tiny-muted" style="margin-top:.4rem">Classes are ordered largest → smallest by gross tonnage.</div>
        </section>

        <!-- Dynamic class sections (populated by JS in class order) -->
        <section class="card" id="classes">
          <h2>Ships by Class</h2>
          <div class="h-rule" aria-hidden="true"></div>
          <div id="class-sections"></div>
        </section>

        <!-- Experiences (full list, filterable) -->
        <section class="card" id="experiences">
          <h2>Experiences Onboard</h2>
          <div class="toolbar" style="margin:.5rem 0 .75rem">
            <div class="seg">
              <button type="button" class="active" data-exp2="all">All</button>
              <button type="button" data-exp2="included">Included</button>
              <button type="button" data-exp2="premium">Premium</button>
              <button type="button" id="exp2-clear">Clear</button>
            </div>
          </div>
          <div id="experience-grid" class="grid-3"></div>
        </section>

        <!-- Image credits -->
        <section class="card">
          <h3>Image Credits</h3>
          <p class="tiny">Attributions are noted per image where available; remaining placeholders are temporary and will be replaced with properly credited media from Wikimedia Commons or the cruise line’s press kit. See individual ship pages for exact file titles and licenses.</p>
          <ul class="tiny">
            <li>“Icon of the Seas” hero — Wikimedia Commons (credit pending final asset selection)</li>
            <li>“Wonder of the Seas” — Wikimedia Commons (credit pending final asset selection)</li>
            <li>Per-ship thumbnails — mixture of onboard photography and Commons; replace as we finalize.</li>
          </ul>
        </section>
      </div>

      <!-- Right rail -->
      <aside class="side-panel" aria-label="Dress code and venues">
        <!-- Dress code ABOVE venues -->
        <section class="card" id="dress-code">
          <h2>Dress Code</h2>
          <p><strong>Casual (daytime &amp; most venues):</strong> Jeans, polos, sundresses, and blouses fit the latitude. Keep swimwear to the pool deck; shorts welcome for breakfast and lunch.</p>
          <p><strong>Smart Casual (evenings &amp; specialty):</strong> A step up — collared shirts, dresses, skirts, blouses, or pantsuits. Jackets and blazers are welcome.</p>
          <p><strong>Formal (Dress Your Best):</strong> The night the ship gleams — suits and ties, tuxedos, cocktail dresses, or evening gowns.
            <br><span class="tiny">5-night voyages: one night · 6–10: two · 11–14: three · 15+: up to four (captain’s discretion). Guests in smart casual are not turned away on formal night.</span></p>
          <p class="tiny">Some specialty experiences (e.g., <em>Chef’s Table</em>) encourage formal attire. Otherwise, venues are smart casual by default.</p>
          <p class="tiny"><strong>Ashore:</strong> Modesty at churches and sacred sites is good seamanship; see local guidance on our <a href="https://www.cruisinginthewake.com/ports.html">Ports</a> pages.</p>
        </section>

        <!-- Venues panel -->
        <section class="card" id="venues">
          <h2>Venues</h2>
          <div class="toolbar" style="margin-bottom:.5rem">
            <div class="seg">
              <button type="button" data-v2="all" class="active">All</button>
              <button type="button" data-v2="included">Included</button>
              <button type="button" data-v2="premium">Premium</button>
            </div>
          </div>
          <div id="venue-list" class="side-venues" style="display:grid;gap:.6rem"></div>
        </section>
      </aside>
    </section>

    <!-- Visible invocation near footer -->
    <section class="card center" style="margin-top:1rem">
      <p class="tiny">All pages are offered as a gift to God. <em>Soli Deo Gloria.</em></p>
    </section>
  </main>

<script>
(function(){
  'use strict';

  // ---------- CONFIG ----------
  const ORIGIN = 'https://www.cruisinginthewake.com';
    // URL helpers (make everything absolute + encoded)
  const abs = p => p.startsWith('http') ? p : (ORIGIN + p);
  const encAbs = p => {
    // Keep query/hash intact while encoding the path itself
    const [path, rest] = p.split(/([?#].*)/);
    return abs(encodeURI(path) + (rest || ''));
  };

  // Finished pages = have a known/cached thumbnail mapping here.
  // (You can add/remove slugs anytime; toggle defaults to "Finished only".)
  const IMAGE_MAP = {
    'enchantment-of-the-seas': ['/ships/assets/enchantment-of-the-seas1.jpg',
      '/ships/assets/images/Enchantment_of_the_Seas.jpeg',
      '/images/enchantment-of-the-seas2.jpeg',
      '/ships/assets/images/Enchantment_of_the_Seas,_San_Juan Medium.jpeg'],
    'grandeur-of-the-seas': ['/ships/assets/grandeur-of-the-seas1.jpg'],
    'rhapsody-of-the-seas': ['/ships/assets/rhapsody-of-the-seas1.jpg',
      '/ships/assets/images/Rhapsody_of_the_Seas_(2)_(6451158929) Medium.jpeg',
      '/ships/assets/images/Rhapsody_of_the_Seas_(3731959629) Medium.jpeg',
      '/ships/assets/images/Rhapsody_of_the_Seas_2 Medium.jpeg'],
    'vision-of-the-seas': ['/ships/assets/vision-of-the-seas1.jpg'],
    'sovereign-of-the-seas': ['/ships/assets/sovereign-of-the-seas1.jpg',
      '/ships/assets/sovereign-of-the-seas2.jpg','/ships/assets/sovereign-of-the-seas3.jpg'],
    'adventure-of-the-seas': [
      '/ships/rcl/images/Adventure_of_the_Seas1.jpeg',
      '/ships/rcl/images/Adventure_of_the_Seas2.jpg',
      '/ships/rcl/images/Adventure_of_the_Seas3.jpg',
      '/ships/rcl/images/Adventure_of_the_Seas_docked_in_Aruba_2024.jpg',
      '/ships/rcl/images/Adventure_of_the_Seas_pool_area.jpg',
      '/ships/rcl/images/Adventure_of_the_seas_in_Willemstad.jpg'
    ],
    'allure-of-the-seas': [
      '/ships/assets/images/allure-of-the-seas-3.jpg',
      '/ships/assets/images/allure2.jpg',
      '/ships/assets/images/allure3.jpg'
    ]
  };
  const FALLBACK_IMG = '/assets/ships/placeholder-ship.jpg';

  // Class order (largest → smallest by GT)
  const CLASS_ORDER = ['Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager','Radiance','Vision'];

  // Ships (slug = /ships/rcl/<slug>.html)
  const SHIPS = [
    // Icon
    {name:'Icon of the Seas', slug:'icon-of-the-seas', cls:'Icon'},
    {name:'Star of the Seas', slug:'star-of-the-seas', cls:'Icon'},

    // Oasis
    {name:'Oasis of the Seas', slug:'oasis-of-the-seas', cls:'Oasis'},
    {name:'Allure of the Seas', slug:'allure-of-the-seas', cls:'Oasis'},
    {name:'Harmony of the Seas', slug:'harmony-of-the-seas', cls:'Oasis'},
    {name:'Symphony of the Seas', slug:'symphony-of-the-seas', cls:'Oasis'},
    {name:'Wonder of the Seas', slug:'wonder-of-the-seas', cls:'Oasis'},
    {name:'Utopia of the Seas', slug:'utopia-of-the-seas', cls:'Oasis'},

    // Quantum
    {name:'Quantum of the Seas', slug:'quantum-of-the-seas', cls:'Quantum'},
    {name:'Anthem of the Seas', slug:'anthem-of-the-seas', cls:'Quantum'},
    {name:'Ovation of the Seas', slug:'ovation-of-the-seas', cls:'Quantum'},

    // Quantum Ultra
    {name:'Spectrum of the Seas', slug:'spectrum-of-the-seas', cls:'Quantum Ultra'},
    {name:'Odyssey of the Seas', slug:'odyssey-of-the-seas', cls:'Quantum Ultra'},

    // Freedom
    {name:'Freedom of the Seas', slug:'freedom-of-the-seas', cls:'Freedom'},
    {name:'Liberty of the Seas', slug:'liberty-of-the-seas', cls:'Freedom'},
    {name:'Independence of the Seas', slug:'independence-of-the-seas', cls:'Freedom'},

    // Voyager
    {name:'Voyager of the Seas', slug:'voyager-of-the-seas', cls:'Voyager'},
    {name:'Explorer of the Seas', slug:'explorer-of-the-seas', cls:'Voyager'},
    {name:'Adventure of the Seas', slug:'adventure-of-the-seas', cls:'Voyager'},
    {name:'Navigator of the Seas', slug:'navigator-of-the-seas', cls:'Voyager'},
    {name:'Mariner of the Seas', slug:'mariner-of-the-seas', cls:'Voyager'},

    // Radiance
    {name:'Radiance of the Seas', slug:'radiance-of-the-seas', cls:'Radiance'},
    {name:'Brilliance of the Seas', slug:'brilliance-of-the-seas', cls:'Radiance'},
    {name:'Serenade of the Seas', slug:'serenade-of-the-seas', cls:'Radiance'},
    {name:'Jewel of the Seas', slug:'jewel-of-the-seas', cls:'Radiance'},

    // Vision
    {name:'Vision of the Seas', slug:'vision-of-the-seas', cls:'Vision'},
    {name:'Grandeur of the Seas', slug:'grandeur-of-the-seas', cls:'Vision'},
    {name:'Rhapsody of the Seas', slug:'rhapsody-of-the-seas', cls:'Vision'},
    {name:'Enchantment of the Seas', slug:'enchantment-of-the-seas', cls:'Vision'}
  ];

  // Venues (≥40; included/premium flag + slug for linking)
  const VENUES = [
    // Premium
    v('Chops Grille','premium','chops-grille'),
    v('150 Central Park','premium','150-central-park'),
    v('Wonderland','premium','wonderland'),
    v('Giovanni’s Italian Kitchen','premium','giovannis'),
    v('Izumi','premium','izumi'),
    v('Teppanyaki','premium','teppanyaki'),
    v('Hooked Seafood','premium','hooked-seafood'),
    v('The Mason Jar','premium','mason-jar'),
    v('Portside BBQ','premium','portside-bbq'),
    v('Jamie’s Italian','premium','jamies-italian'),
    v('Playmakers Sports Bar & Arcade','premium','playmakers'),
    v('Chef’s Table','premium','chefs-table'),
    v('Empire Supper Club','premium','empire-supper-club'),
    v('Vintages Wine Bar','premium','vintages'),
    v('Izumi Sushi & Sake Pairing','premium','izumi-sake-pairing'),
    v('Giovanni’s Wine Bar','premium','giovannis-wine-bar'),

    // Included
    v('Main Dining Room','included','main-dining-room'),
    v('Windjammer Marketplace','included','windjammer'),
    v('Coastal Kitchen (Suites)','included','coastal-kitchen'),
    v('Sorrento’s Pizza','included','sorrentos'),
    v('El Loco Fresh','included','el-loco-fresh'),
    v('Park Café','included','park-cafe'),
    v('Café Promenade','included','cafe-promenade'),
    v('Dog House','included','dog-house'),
    v('Sprinkles Ice Cream','included','sprinkles'),
    v('Boardwalk Donut Shop','included','boardwalk-donuts'),
    v('Vitality Café','included','vitality-cafe'),
    v('Solarium Bistro','included','solarium-bistro'),
    v('Wipeout Café','included','wipeout-cafe'),
    v('Room Service (continental breakfast)','included','room-service-continental'),
    v('The Lime & Coconut (bar)','included','lime-and-coconut'),
    v('Pub / Copper & Kettle','included','pub'),
    v('Boleros','included','boleros'),
    v('Schooner Bar','included','schooner-bar'),
    v('Bionic Bar','included','bionic-bar'),
    v('Johnny Rockets (breakfast)','included','johnny-rockets-breakfast'),
    v('Johnny Rockets (lunch/dinner)','premium','johnny-rockets'),
    v('La Patisserie / Café Latte-tudes','included','patisserie'),
    v('Sugar Beach (candy/ice cream)','premium','sugar-beach'),
    v('WONDERland Bar','premium','wonderland-bar'),
    v('Starbucks (select ships)','premium','starbucks'),
    v('Mini Bites / Boardwalk Bites','included','mini-bites'),
    v('Splashaway Café (kids snacks)','included','splashaway-cafe'),
    v('Royal Promenade Bars','included','promenade-bars')
  ];
  function v(name,type,slug){return {name,type,slug,href:`${ORIGIN}/restaurants/${slug}.html`};}

  // Experiences (subset wired; can be expanded)
  const EXPERIENCES = [
    ex('FlowRider® Surf Simulator','included',['Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager']),
    ex('Rock Climbing Wall','included',['Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager']),
    ex('iFly® Skydiving (RipCord®)','included',['Icon','Oasis','Quantum','Quantum Ultra']),
    ex('North Star® Observation Pod','included',['Quantum','Quantum Ultra']),
    ex('Zip Line','included',['Oasis','Freedom','Icon']),
    ex('Ultimate Abyss℠','included',['Oasis']),
    ex('Perfect Storm℠ Waterslides','included',['Icon','Oasis','Freedom','Voyager']),
    ex('Bumper Cars (SeaPlex)','included',['Quantum','Quantum Ultra']),
    ex('Ice Skating (Studio B)','included',['Oasis','Freedom','Voyager','Quantum','Quantum Ultra','Icon']),
    ex('Mini Golf','included',CLASS_ORDER),
    ex('Escape Room','premium',['Oasis','Freedom','Voyager','Quantum','Icon']),
    ex('Chef’s Table','premium',CLASS_ORDER,true),
    ex('Taste of Royal','premium',CLASS_ORDER,true),
    ex('Mixology / Tastings','premium',CLASS_ORDER,true),
    ex('Love & Marriage Game Show','included',CLASS_ORDER),
    ex('Quest (Adult Game Show)','included',CLASS_ORDER),
    ex('Belly Flop / Cannonball','included',CLASS_ORDER),
    ex('World’s Sexiest Man','included',CLASS_ORDER)
  ];
  function ex(name,type,classes,formal){return {name,type,classes,formal:!!formal};}

  // ---------- DOM HELPERS ----------
  const $  = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const el = (tag, cls) => { const n=document.createElement(tag); if(cls) n.className=cls; return n; };
  const norm = s => String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[’‘]/g,"'").trim();

  // ---------- STATE ----------
  let showUnfinished = false; // page-local default: FINISHED ONLY
  let venueFilter = 'all';    // all|included|premium (right rail)
  let expFilter   = 'all';    // all|included|premium (search toolbar)
  let expFilter2  = 'all';    // all|included|premium (experiences section)
  
  // A ship is "finished" if we’ve mapped at least one known thumbnail
  const isFinished = slug =>
    Array.isArray(IMAGE_MAP[slug]) && IMAGE_MAP[slug].length > 0;

  // Pick image (first known → conventional → placeholder), all ABSOLUTE + ENCODED
  function pickImg(slug){
    const conventional = [
      `/ships/rcl/${slug}-1.jpg`,
      `/ships/rcl/${slug}-1.jpeg`,
      `/ships/rcl/${slug}-1.png`
    ];
    const candidates = (IMAGE_MAP[slug] || []).concat(conventional);
    const first = candidates[0];
    return first ? encAbs(first) : encAbs(FALLBACK_IMG);
  }

  // ---------- RENDER: CLASS PILLS ----------
  function renderClassPills(){
    const host = $('#class-tray');
    if(!host) return;
    host.innerHTML = '';
    CLASS_ORDER.forEach(cls=>{
      const b = el('button','pillbtn');
      b.type='button';
      b.textContent = cls;
      b.addEventListener('click', ()=> scrollToClass(cls));
      host.appendChild(b);
    });
  }

  function scrollToClass(cls){
    const id = `sec-${cls.toLowerCase().replace(/\s+/g,'-')}`;
    const sec = document.getElementById(id);
    if(sec) sec.scrollIntoView({behavior:'smooth', block:'start'});
  }

  // ---------- RENDER: CLASS SECTIONS + SHIP CARDS ----------
  function renderClassSections(){
    const host = $('#class-sections');
    if(!host) return;
    host.innerHTML = '';
    CLASS_ORDER.forEach(cls=>{
      const ships = SHIPS.filter(s=>s.cls===cls && (showUnfinished || isFinished(s.slug)));
      const sec = el('section','card');
      sec.id = `sec-${cls.toLowerCase().replace(/\s+/g,'-')}`;
      const h = el('h3'); h.textContent = `${cls} Class`;
      const p = el('p','tiny'); p.innerHTML = classBlurb(cls);
      sec.append(h,p);

      const grid = el('div','grid-3');
      if(ships.length===0){
        const msg = el('p','tiny'); msg.textContent = 'No finished ships in this class yet. Toggle “Show unfinished ships” to preview all.';
        sec.appendChild(msg);
      }else{
        ships.forEach(s=>{
          grid.appendChild(shipCard(s));
        });
        sec.appendChild(grid);
      }
      host.appendChild(sec);
    });
  }

  function classBlurb(cls){
    // Short editorial by class
    const by = {
      'Icon':'Waterpark neighborhood, seven pools, AquaDome shows — maximal choice with quiet corners when you want them.',
      'Oasis':'The original “neighborhood” giants: Central Park, Boardwalk, AquaTheater — Broadway scale with resort-deck ease.',
      'Quantum':'Two70° tech shows, North Star pod, SeaPlex energy — smart weather ships that shine in cooler routes.',
      'Quantum Ultra':'Amped Quantum features plus warm-weather tweaks; SeaPlex, iFly®, and late-night glow parties.',
      'Freedom':'Big-ship staples without mega sprawl — FlowRider, sports decks, crowd-pleasing dining.',
      'Voyager':'The class that taught cruising to skate — ice shows, Royal Promenade buzz, compact “do-it-all” days.',
      'Radiance':'Glass-and-views for scenery routes — calmer vibe, classic specialties.',
      'Vision':'Cozy classics with personable crews and port-forward itineraries.'
    };
    return `<span class="tiny-muted">${by[cls]||''}</span>`;
  }

  function shipCard(s){
    const a = el('a','ship-card');
    a.href = `${ORIGIN}/ships/rcl/${s.slug}.html`;
    a.innerHTML = `
      <span class="thumb"><img loading="lazy" decoding="async" alt="${s.name}" src="${pickImg(s.slug)}"></span>
      <span class="body"><strong>${s.name}</strong><span class="class-chip">${s.cls}</span></span>
    `;
    // Clicking the class chip shows all ships in that class
    a.querySelector('.class-chip').addEventListener('click',(e)=>{
      e.preventDefault(); e.stopPropagation();
      scrollToClass(s.cls);
    });
    return a;
  }

  // ---------- RENDER: RIGHT-RAIL VENUES ----------
  function renderVenues(){
    const host = $('#venue-list'); if(!host) return;
    host.innerHTML = '';
    VENUES.filter(v => venueFilter==='all' || v.type===venueFilter)
      .forEach(v => host.appendChild(venueCard(v)));
  }
  function venueCard(vn){
    const a = el('a','venue-card'); a.href = vn.href;
    const t = el('span','vthumb');
    const img = el('img'); img.alt = vn.name; // thumbs optional — unified style handles blank gracefully
    t.appendChild(img);
    const b = el('span','vbody');
    b.innerHTML = `<strong>${vn.name}</strong><br><span class="tiny">${vn.type==='premium'?'Premium':'Included'}</span>`;
    a.append(t,b);
    return a;
  }

  // ---------- RENDER: EXPERIENCES GRID ----------
  function renderExperiences(){
    const host = $('#experience-grid'); if(!host) return;
    host.innerHTML = '';
    EXPERIENCES.filter(x => expFilter2==='all' || x.type===expFilter2)
      .forEach(x=>{
        const card = el('div','card');
        card.innerHTML = `
          <strong>${x.name}</strong><br>
          <span class="tiny">${x.type==='premium'?'Premium':'Included'} ${x.formal? '· Formal encouraged':''}</span><br>
          <span class="tiny-muted">Classes: ${x.classes.join(', ')}</span>
        `;
        host.appendChild(card);
      });
  }

  // ---------- SEARCH (ships, classes, venues, experiences) ----------
  function buildSearchIndex(){
    const items = [];
    // Ships
    SHIPS.forEach(s=>{
      items.push({
        kind:'ship',
        key: `${s.name} ${s.cls}`,
        finished: isFinished(s.slug),
        render: ()=>shipCard(s)
      });
    });
    // Classes
    CLASS_ORDER.forEach(cls=>{
      items.push({
        kind:'class',
        key: cls,
        finished: true,
        render: ()=>{
          const btn = el('a','pillbtn'); btn.textContent = `${cls} Class`;
          btn.href = 'javascript:void(0)';
          btn.addEventListener('click',()=>scrollToClass(cls));
          return btn;
        }
      });
    });
    // Venues
    VENUES.forEach(v=>{
      items.push({
        kind:'venue',
        key: `${v.name} ${v.type}`,
        finished: true,
        render: ()=>venueCard(v)
      });
    });
    // Experiences
    EXPERIENCES.forEach(x=>{
      items.push({
        kind:'experience',
        key: `${x.name} ${x.type} ${x.classes.join(' ')}`,
        finished: true,
        render: ()=>{
          const d = el('div','card');
          d.innerHTML = `<strong>${x.name}</strong><br>
            <span class="tiny">${x.type==='premium'?'Premium':'Included'}${x.formal?' · Formal encouraged':''}</span>`;
          return d;
        }
      });
    });
    return items;
  }

  const SEARCH_ITEMS = buildSearchIndex();

  function doSearch(){
    const out = $('#search-out'); const q = $('#q');
    if(!out || !q) return;
    const v = norm(q.value);
    out.innerHTML = '';
    const pool = SEARCH_ITEMS.filter(it => (showUnfinished || it.kind!=='ship' || it.finished));
    const hits = v ? pool.filter(it => norm(it.key).includes(v)) : pool.slice(0,12);
    hits.slice(0,18).forEach(it=> out.appendChild(it.render()));
  }

  // ---------- TOGGLES / FILTERS ----------
  function wireToggles(){
    // Finished/unfinished
    $$('#finished-toggle button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#finished-toggle button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        showUnfinished = (btn.dataset.finish==='all');
        // Re-render dependent views
        renderClassSections();
        doSearch();
      });
    });

    // Venues filter (right rail)
    $$('#venue-filter [data-venue], #venues [data-v2]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const val = btn.dataset.venue || btn.dataset.v2;
        venueFilter = val;
        // sync UI states
        $$('#venue-filter [data-venue], #venues [data-v2]').forEach(b=>b.classList.toggle('active',
          (b.dataset.venue||b.dataset.v2)===val));
        renderVenues();
      });
    });

    // Experiences filter in toolbar (search context)
    $$('#exp-filter [data-exp]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#exp-filter [data-exp]').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        expFilter = btn.dataset.exp;
        // Search results are already mixed; just re-run search using new filter by narrowing EXP items before build?
        // Simpler: leave toolbar expFilter as a hint for future; core search stays unified for speed.
        doSearch();
      });
    });
    const expClear = $('#exp-clear');
    if(expClear){ expClear.addEventListener('click', ()=>{
      $$('#exp-filter [data-exp]').forEach(b=>b.classList.remove('active'));
      const all = $('#exp-filter [data-exp="all"]'); all.classList.add('active'); expFilter='all'; doSearch();
    });}

    // Experiences section filter
    $$('#experiences [data-exp2]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#experiences [data-exp2]').forEach(b=>b.classList.toggle('active', b===btn));
        expFilter2 = btn.dataset.exp2;
        renderExperiences();
      });
    });
    const exp2Clear = $('#exp2-clear');
    if(exp2Clear){ exp2Clear.addEventListener('click', ()=>{
      expFilter2='all';
      $$('#experiences [data-exp2]').forEach(b=>b.classList.toggle('active', b.dataset.exp2==='all'));
      renderExperiences();
    });}
  }

  // ---------- INIT ----------
  function init(){
    renderClassPills();
    renderClassSections();
    renderVenues();
    renderExperiences();
    wireToggles();
    const q = $('#q'); if(q){ q.addEventListener('input',()=>{ clearTimeout(q._t); q._t=setTimeout(doSearch,80); }); }
    doSearch();
  }

  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init, {once:true}); }
  else { init(); }
})();
</script></body>
