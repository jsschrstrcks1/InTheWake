<!doctype html>
<html lang="en">
<head>
<script>
/* Absolute URL helper + origin normalizer (prod-only) */
(function () {
  const ORIGIN = (location.origin || (location.protocol + '//' + location.host)).replace(/\/$/, '');
  const IS_PROD = /\.?cruisinginthewake\.com$/i.test(location.hostname);
  window._abs = function (path) { path = String(path || ''); if (!path.startsWith('/')) path = '/' + path; return ORIGIN + path; };

  if (!IS_PROD) return; // <-- no rewriting on localhost, preview, or offline

  document.addEventListener('DOMContentLoaded', function () {
    const sel = [
      'a[href^="https://www.cruisinginthewake.com/"]',
      'img[src^="https://www.cruisinginthewake.com/"]',
      'link[href^="https://www.cruisinginthewake.com/"]',
      'script[src^="https://www.cruisinginthewake.com/"]'
    ].join(',');
    document.querySelectorAll(sel).forEach(el => {
      const attr = el.hasAttribute('href') ? 'href' : 'src';
      try {
        const u = new URL(el.getAttribute(attr));
        el.setAttribute(attr, ORIGIN + u.pathname + u.search + u.hash);
      } catch (_) {}
    });
  }, { once: true });
})();
</script>
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://cloud.umami.is" crossorigin>
  <link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>
  <link rel="preconnect" href="https://i.ytimg.com" crossorigin>

  <!-- ===== Google tag (gtag.js) ===== -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZP891PZXJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WZP891PZXJ');
  </script>

  <!-- ===== Critical meta (v3.007.012) ===== -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="referrer" content="no-referrer"/>
  <meta name="robots" content="index, follow"/>
  <meta name="version" content="3.007.012"/>

  <title>Grandeur of the Seas — Deck Plans, Live Tracker, Dining & Videos | In the Wake</title>
  <meta name="description" content="Grandeur of the Seas: deck plans, live tracker (auto-refresh), dining venues, stateroom videos, and real guest logbook. Plan your Royal Caribbean cruise with In the Wake."/>

  <!-- Canonical -->
  <link rel="canonical" href="https://www.cruisinginthewake.com/ships/rcl/grandeur-of-the-seas.html"/>

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="article"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/ships/rcl/grandeur-of-the-seas.html"/>
  <meta property="og:title" content="Grandeur of the Seas — Deck Plans, Live Tracker, Dining & Videos"/>
  <meta property="og:description" content="All the essentials for Grandeur of the Seas: live map (auto-refresh), dining, stats, and videos."/>
  <meta property="og:image" content="https://www.cruisinginthewake.com/assets/ships/grandeur/hero.jpg?v=3.007.012"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- Organization -->
  <script type="application/ld+json">{
    "@context":"https://schema.org","@type":"Organization",
    "name":"In the Wake","url":"https://www.cruisinginthewake.com/",
    "logo":"https://www.cruisinginthewake.com/assets/logo_wake.png?v=3.007.012",
    "sameAs":["https://www.instagram.com/flickersofmajesty/","https://www.youtube.com/@cruisinginthewake"]
  }</script>

  <!-- WebSite + SearchAction -->
  <script type="application/ld+json">{
    "@context":"https://schema.org","@type":"WebSite",
    "name":"In the Wake","url":"https://www.cruisinginthewake.com/",
    "potentialAction":{"@type":"SearchAction",
      "target":"https://www.cruisinginthewake.com/search.html?q={query}",
      "query-input":"required name=query"}
  }</script>

  <!-- Breadcrumbs -->
  <script type="application/ld+json">{
    "@context":"https://schema.org","@type":"BreadcrumbList","name":"Site Breadcrumbs",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://www.cruisinginthewake.com/"},
      {"@type":"ListItem","position":2,"name":"Ships","item":"https://www.cruisinginthewake.com/ships/ships.html"},
      {"@type":"ListItem","position":3,"name":"Grandeur of the Seas","item":"https://www.cruisinginthewake.com/ships/rcl/grandeur-of-the-seas.html"}
    ]
  }</script>

  <!-- Review (static overview) -->
  <script type="application/ld+json">{
    "@context":"https://schema.org","@type":"Review",
    "name":"Grandeur of the Seas Overview",
    "author":{"@type":"Person","name":"In the Wake Editorial Team"},
    "reviewBody":"Grandeur of the Seas brings Vision-class intimacy, classic RCI vibes, and ports the mega-ships can’t reach.",
    "reviewRating":{"@type":"Rating","ratingValue":"4.4","bestRating":"5","worstRating":"1"},
    "itemReviewed":{"@type":"Cruise","name":"Grandeur of the Seas",
      "provider":{"@type":"Organization","name":"Royal Caribbean International","url":"https://www.royalcaribbean.com"},
      "url":"https://www.cruisinginthewake.com/ships/rcl/grandeur-of-the-seas.html",
      "image":"https://www.cruisinginthewake.com/assets/ships/grandeur/hero.jpg?v=3.007.012",
      "description":"Vision-class cruise operated by Royal Caribbean International."}}
  }</script>

  <!-- ===== Preload key art ===== -->
  <link rel="preload" as="image" href="https://www.cruisinginthewake.com/assets/ships/grandeur/hero.jpg?v=3.007.012" fetchpriority="high"/>
  <link rel="preload" as="image" href="https://www.cruisinginthewake.com/assets/compass_rose.svg?v=3.007.012"/>

  <!-- ===== Analytics (Umami) ===== -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>

  <!-- ===== Page micro CSS (scoped, v3.007.012 compliance) ===== -->
  <style>
/* =========================================================
   In the Wake — Grandeur page micro CSS (v3.007.012-clean)
   ========================================================= */

/* A11y helpers */
.visually-hidden-focusable{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
.visually-hidden-focusable:focus{position:static;left:auto;width:auto;height:auto;padding:.5rem .75rem;background:#fff;border:2px solid #0e6e8e;border-radius:8px;z-index:1000}
.hidden{display:none!important}

/* Layout + cards */
body::before{content:"";position:fixed;inset:0;background:url("https://www.cruisinginthewake.com/assets/watermark.png?v=3.007.012") center right/420px auto no-repeat;opacity:.06;pointer-events:none;z-index:0}
body>*{position:relative;z-index:1}
.wrap{max-width:1100px;margin:0 auto;padding:20px 14px 36px}
.card{background:#fff;border:2px solid var(--rope,#d9b382);border-radius:14px;padding:1rem;margin:.8rem 0;box-shadow:0 2px 6px rgba(8,48,65,.08);position:relative;overflow:hidden}
.grid-2{display:grid;gap:1rem;align-items:stretch}
.grid-2>.card{display:flex;flex-direction:column}
@media (min-width:980px){.grid-2{grid-template-columns:1fr 1fr}}

/* Pills (nav/buttons) */
.pills,.class-pills,.related-pills,.button-group{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;text-align:center}
.pill-nav.pills a{padding:.35rem .7rem;border-radius:10px;border:1px dashed var(--rope,#d9b382);background:#fff;font-size:.9rem;color:var(--accent,#0e6e8e)}
.pill-nav.pills a:hover{background:#f9fdfd;text-decoration:none}

/* Hero */
html,body{overflow-x:hidden}
.hero-header .hero{width:100%;margin-left:0}
.hero-title h1{margin:0;font-size:clamp(1.4rem,2.5vw,1.9rem);font-weight:700}

/* Ship stats */
.ship-stats.card.mini{margin-top:.8rem}
.stats-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.4rem .8rem;font-size:.95rem}
.stat-line{display:flex;gap:.35rem;justify-content:space-between;border-bottom:1px dashed #e4e9ec;padding:.2rem 0}
.stat-key{color:#355;font-weight:600}.stat-val{color:#024}

/* Media: maps + videos */
.vf-map,iframe.live-map{width:100%;height:300px;max-height:300px;display:block}
.swiper.videos iframe{width:100%;aspect-ratio:16/9;display:block;border:0;border-radius:12px}

/* First Look carousel (stable across Safari/Chrome/Firefox) */
.swiper.firstlook{overflow:hidden}
.swiper.firstlook .swiper-wrapper{align-items:stretch}
.swiper.firstlook .swiper-slide{height:auto}
.swiper.firstlook figure{margin:0;aspect-ratio:16/9;position:relative;overflow:hidden}
.swiper.firstlook img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:10px;display:block}
@media (min-width:720px){.swiper.firstlook{max-height:70vh}}

/* First Look — fallback when Swiper fails (html.swiper-fallback) */
.swiper-fallback .swiper.firstlook{overflow:hidden}
.swiper-fallback .swiper.firstlook .swiper-wrapper{display:flex;align-items:stretch;gap:0}
.swiper-fallback .swiper.firstlook .swiper-slide{flex:0 0 100%;max-width:100%}
.swiper-fallback .swiper.firstlook figure{margin:0}
.swiper-fallback .swiper.firstlook img{display:block;width:100%!important;height:auto!important;object-fit:cover;border-radius:10px}

/* Logbook */
.note-kens-logbook.card{overflow:visible}
.note-kens-logbook .story{margin-bottom:1rem}

/* Editor note pill */
.pill.editor-note{
  display:block;max-width:100%;
  background:var(--foam,#f9fbfc);color:#062b44;
  border:1.5px solid var(--rope,#d9b382);border-radius:999px;
  padding:.75rem 1rem;font-size:.92rem;font-style:italic;line-height:1.5;
  margin:.5rem auto 1rem;box-shadow:0 1px 4px rgba(8,48,65,.08)
}
.pill.editor-note strong{font-style:normal;color:var(--ink,#0a3d62)}

/* Fuel card block */
.voyage-tips.card{overflow:visible}

/* Venues grid: 1col mobile → 2col mid → 3col wide */
#vx-grid{display:grid;gap:1rem}
@media (min-width:720px) and (max-width:979.98px){#vx-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
@media (min-width:980px){#vx-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    /* First Look: force a real height that Swiper can’t zero out */
.swiper.firstlook { aspect-ratio: 16/9; height: auto; }
.swiper.firstlook .swiper-wrapper,
.swiper.firstlook .swiper-slide { height: 100% !important; }
.swiper.firstlook figure { margin:0; height:100%; }
.swiper.firstlook img {
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover; border-radius:10px; display:block;
}
    /* First Look — container sizes itself to the card */
.card .swiper.firstlook{
  display:block;
  width:100%;              /* ← ensures it never exceeds the card */
  aspect-ratio:16/9;
  margin:0;
  border-radius:10px;
  overflow:hidden;         /* keeps rounded corners */
  max-height:70vh;         /* optional clamp */
}

/* Make slides inherit the container height */
.card .swiper.firstlook .swiper-wrapper,
.card .swiper.firstlook .swiper-slide,
.card .swiper.firstlook figure{ height:100%; }

/* Image just covers the slide (no overflow past container) */
.card .swiper.firstlook img{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  max-width:100%; max-height:100%;
}

/* (nice-to-have) when in CSS fallback, hide Swiper chrome */
.swiper-fallback .swiper .swiper-button-prev,
.swiper-fallback .swiper .swiper-button-next,
.swiper-fallback .swiper .swiper-pagination{ display:none !important; }
</style>

  <!-- ===== Site CSS (versioned) ===== -->
  <link rel="preload" as="style" href="https://www.cruisinginthewake.com/assets/styles.css?v=3.007.012"/>
  <link rel="stylesheet" href="https://www.cruisinginthewake.com/assets/styles.css?v=3.007.012"/>
</head>

  <body class="page no-hero-filter">
  <a class="visually-hidden-focusable" href="#content">Skip to content</a>

  <header class="hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="https://www.cruisinginthewake.com/assets/logo_wake.png?v=3.007.012" alt="In the Wake wordmark" width="200" height="40"/>
        <span class="version-badge">v3.007.012</span>
      </div>

      <!-- Primary Navigation (pills) -->
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="https://www.cruisinginthewake.com/index.html">Home</a>
        <a href="https://www.cruisinginthewake.com/ships/ships.html">Ships</a>
        <a href="https://www.cruisinginthewake.com/restaurants.html">Restaurants &amp; Menus</a>
        <a href="https://www.cruisinginthewake.com/ports.html">Ports</a>
        <a href="https://www.cruisinginthewake.com/disability-at-sea.html">Disability at Sea</a>
        <a href="https://www.cruisinginthewake.com/drink-packages.html">Drink Packages</a>
        <a href="https://www.cruisinginthewake.com/packing-lists.html">Packing Lists</a>
        <a href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html">Cruise Lines</a>
        <a href="https://www.cruisinginthewake.com/cruise-lines/about-us.html">About Us</a>
      </nav>
    </div>

    <!-- Hero -->
    <div class="hero" role="img" aria-label="Grandeur of the Seas hero image">
      <div class="latlon-grid" aria-hidden="true">
        <svg viewBox="0 0 100 60" preserveAspectRatio="none">
          <g class="grid-lines" stroke-width="0.35">
            <line x1="10" y1="0" x2="10" y2="60"/><line x1="20" y1="0" x2="20" y2="60"/>
            <line x1="30" y1="0" x2="30" y2="60"/><line x1="40" y1="0" x2="40" y2="60"/>
            <line x1="50" y1="0" x2="50" y2="60"/><line x1="60" y1="0" x2="60" y2="60"/>
            <line x1="70" y1="0" x2="70" y2="60"/><line x1="80" y1="0" x2="80" y2="60"/>
            <line x1="90" y1="0" x2="90" y2="60"/>
            <line x1="0" y1="10" x2="100" y2="10"/><line x1="0" y1="20" x2="100" y2="20"/>
            <line x1="0" y1="30" x2="100" y2="30"/><line x1="0" y1="40" x2="100" y2="40"/>
          </g>
        </svg>
      </div>
      <img class="hero-compass" src="https://www.cruisinginthewake.com/assets/compass_rose.svg?v=3.007.012" alt="" width="256" height="256" aria-hidden="true"/>
      <div class="hero-title">
        <img class="logo" src="https://www.cruisinginthewake.com/assets/logo_wake.png?v=3.007.012" alt="In the Wake" width="220" height="44"/>
        <h1 class="tagline">A Cruise Traveler’s Logbook</h1>
      </div>
      <div class="hero-credit">
        <a class="pill long" href="https://www.instagram.com/flickersofmajesty/" target="_blank" rel="noopener">Photo by Flickers of Majesty — Instagram</a>
        <span class="visually-hidden"> | </span>
        <a class="pill long" href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">flickersofmajesty.com</a>
      </div>
    </div>
  </header>

  <main class="wrap" id="content" tabindex="-1">
    <!-- Row 1: First Look (left) + Dining (right) -->
    <section class="grid-2">
      <!-- First Look + Stats -->
      <section class="card" aria-labelledby="first-look">
        <h2 id="first-look">A First Look</h2>

        <div class="swiper firstlook" aria-labelledby="first-look" aria-roledescription="carousel">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
              <figure>
                <a href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">
                  <img
                    src="https://www.cruisinginthewake.com/assets/ships/grandeur-of-the-seas-3.jpeg?v=3.007.012"
                    alt="Grandeur of the Seas — starboard profile underway"
                    loading="eager" decoding="async" width="1920" height="1280"/>
                </a>
                <figcaption class="tiny">© Flickers of Majesty — all rights reserved.</figcaption>
              </figure>
            </div>

            <div class="swiper-slide">
              <figure>
                <a href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">
                  <img
                    src="https://www.cruisinginthewake.com/assets/ships/grandeur-of-the-seas-2.jpeg?v=3.007.012"
                    alt="Grandeur of the Seas — port side in port"
                    loading="lazy" decoding="async" width="1920" height="1280"/>
                </a>
                <figcaption class="tiny">© Flickers of Majesty — all rights reserved.</figcaption>
              </figure>
            </div>

            <div class="swiper-slide">
              <figure>
                <a href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">
                  <img
                    src="https://www.cruisinginthewake.com/assets/ships/grandeur-of-the-seas-1.jpeg?v=3.007.012"
                    alt="Grandeur of the Seas — alongside"
                    loading="lazy" decoding="async" width="1920" height="1280"/>
                </a>
                <figcaption class="tiny">© Flickers of Majesty — all rights reserved.</figcaption>
              </figure>
            </div>
          </div>
          <div class="swiper-pagination" aria-hidden="true"></div>
          <div class="swiper-button-prev" aria-label="Previous image"></div>
          <div class="swiper-button-next" aria-label="Next image"></div>
        </div>

        <!-- Ship stats -->
        <section class="ship-stats card mini" aria-labelledby="statsHeading">
          <h3 id="statsHeading">Grandeur at a Glance</h3>
          <div id="ship-stats" class="stats-grid" data-slug="grandeur-of-the-seas"></div>
          <script type="application/json" id="ship-stats-fallback">{
            "slug":"grandeur-of-the-seas",
            "name":"Grandeur of the Seas",
            "class":"Vision Class",
            "entered_service":1996,
            "gt":"73,817 GT",
            "guests":"1,996",
            "crew":"760",
            "length":"279 m (915 ft)",
            "beam":"32 m (105 ft)",
            "registry":"Bahamas"
          }</script>
        </section>
      </section>

      <!-- Dining Card -->
      <section id="dining-card" class="card" data-ship="Grandeur of the Seas" aria-labelledby="diningHeading">
        <h2 id="diningHeading">Dining Venues on Grandeur of the Seas</h2>
        <img id="dining-hero" class="card-hero"
             src="https://www.cruisinginthewake.com/ships/assets/img/Cordelia_Empress_Food_Court.jpg?v=3.007.012"
             alt="Grandeur dining venue seating with ocean view"
             loading="lazy" decoding="async" width="1600" height="900"/>
        <ul>
          <li><a class="btn" href="https://www.cruisinginthewake.com/restaurants/rcl/main-dining-room.html" target="_blank" rel="noopener">Main Dining Room</a> — rotating themed menus (Included)</li>
          <li><a class="btn" href="https://www.cruisinginthewake.com/restaurants/rcl/windjammer.html" target="_blank" rel="noopener">Windjammer Café</a> — buffet breakfast, lunch, dinner (Included)</li>
          <li><a class="btn" href="https://www.cruisinginthewake.com/restaurants/rcl/chops-grille.html" target="_blank" rel="noopener">Chops Grille</a> — steakhouse (Specialty)</li>
          <li><a class="btn" href="https://www.cruisinginthewake.com/restaurants/rcl/giovannis-table.html" target="_blank" rel="noopener">Giovanni’s Table</a> — Italian family-style dining (Specialty)</li>
          <li><a class="btn" href="https://www.cruisinginthewake.com/restaurants/rcl/park-cafe.html" target="_blank" rel="noopener">Park Café</a> — soups, salads & sandwiches (Included)</li>
        </ul>
        <p class="tiny">Menu details subject to change. Prices reflect last verified sailing.</p>
        <p class="center"><a class="btn" href="https://www.cruisinginthewake.com/restaurants.html" target="_blank" rel="noopener">Browse Menus →</a></p>
      </section>
    </section>

  <!-- The Logbook (JSON-driven, with Editor pill + 60% Fuel card) -->
<section class="card note-kens-logbook" id="logbook" aria-labelledby="logbookHeading">
  <h2 id="logbookHeading">The Logbook — Tales From the Wake</h2>

  <!-- Editor’s pill is injected here -->
  <div id="editorNoteMount"></div>

  <!-- Persona body -->
  <div id="logbook-stories" class="prose" aria-live="polite"></div>

  <!-- Port/Starboard persona nav -->
  <div id="logbook-nav" class="button-group" role="group" aria-label="Logbook navigation" style="margin-top:.5rem">
    <button type="button" class="pill" id="logbook-prev" aria-label="Previous entry">◀ Port</button>
    <span id="logbook-pos" class="tiny" style="min-width:8ch;text-align:center"></span>
    <button type="button" class="pill" id="logbook-next" aria-label="Next entry">Starboard ▶</button>
  </div>
</section>

<style>
  .pill.editor-note {
    display:block; background:var(--foam,#f9fbfc); color:#062b44;
    border:1.5px solid var(--rope,#d9b382); border-radius:999px;
    padding:.75rem 1rem; font-size:.92rem; font-style:italic; line-height:1.5;
    margin:.5rem auto 1rem; box-shadow:0 1px 4px rgba(8,48,65,.08);
  }
  .pill.editor-note strong { font-style:normal; color:var(--ink,#0a3d62); }

  /* Fuel card (reuses your card visuals) */
  .voyage-tips.card{overflow:visible}
</style>

<script>
(function LogbookV3(){
  const MOUNT = document.getElementById('logbook-stories');
  const NOTE  = document.getElementById('editorNoteMount');
  const POS   = document.getElementById('logbook-pos');
  const PREV  = document.getElementById('logbook-prev');
  const NEXT  = document.getElementById('logbook-next');

  if(!MOUNT) return;

  const slug = 'grandeur-of-the-seas';
  const SRC  = (window._abs? _abs('/ships/rcl/assets/'+slug+'.json') : '/ships/rcl/assets/'+slug+'.json');

  const state = { i:0, personas:[], idIndex:{} };

  const fuelCardHTML =
    '<div class="voyage-tips-wrapper" style="margin:1rem 0 0">'+
      '<div class="card voyage-tips" aria-label="Voyage planning tips" style="margin:0">'+
        '<h2 class="card-title" style="margin-top:.25rem">Fuel Your Voyage</h2>'+
        '<div class="card-content">'+
          '<h3>Drink Packages</h3>'+
          '<ul><li>Deluxe Beverage Package: ~\\$60/day for premium drinks</li>'+
              '<li>Refreshment Package: Non-alcoholic options</li>'+
              '<li>Soda Package: all the Freestyle Machine options</li></ul>'+
          '<h3>Pack Like a Pro</h3>'+
          '<ul><li>Shawl for chilly theater nights</li>'+
              '<li>Swimwear for pool deck</li>'+
              '<li>Comfortable shoes for shore tours</li></ul>'+
          '<div class="button-group" aria-label="Voyage planning links">'+
            '<a href="/drink-packages.html" class="btn" aria-label="View all drink package options">View Drink Options</a>'+
            '<a href="/packing-lists.html" class="btn" aria-label="Access complete packing guide">Packing Guide</a>'+
          '</div>'+
        '</div>'+
      '</div>'+
    '</div>';

  function mdToHtml(md){
    if(!md) return '';
    let h = String(md).trim();
    h = h.replace(/^######\s+(.+)$/gm,'<h6>$1</h6>')
         .replace(/^#####\s+(.+)$/gm,'<h5>$1</h5>')
         .replace(/^####\s+(.+)$/gm,'<h4>$1</h4>')
         .replace(/^###\s+(.+)$/gm,'<h3>$1</h3>')
         .replace(/^##\s+(.+)$/gm,'<h2>$1</h2>')
         .replace(/^#\s+(.+)$/gm,'<h1>$1</h1>')
         .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
         .replace(/\*(.+?)\*/g,'<em>$1</em>')
         .replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>');
    // paragraph wrap
    h = h.replace(/(?:\r?\n){2,}/g,'</p><p>').replace(/(?:\r?\n)/g,'<br/>');
    h = '<p>'+h+'</p>';
    return h.replace(/^<p>\s*<\/p>/,'');
  }

  function renderEditorNote(json){
    const ship = json && (json.ship_name || 'this ship');
    const nights = json && json.nights_stood_watch;
    const fromJson = json && json.editor_note;

    let text = fromJson;
    if(!text){
      const n = (nights!=null? String(nights) : 'several');
      text = 'Editor’s Logbook Note: I have stood watch for '+n+' nights aboard <em>'+ship+'</em>. '+
             'These reflections draw from my own experience and from the voices of fellow travelers — depth soundings taken in our shared wake. '+
             'Each has been carefully trimmed, tested, and edited to the same high standards, offered here to help smooth the waters ahead of your own sailing.';
    }
    NOTE.innerHTML = '<div class="pill editor-note" role="note" aria-label="Editor’s Logbook Note">'+text+'</div>';
  }

  function injectFuelAt60(container){
    try{
      const paras = Array.from(container.querySelectorAll('p'));
      if(paras.length < 3) return; // keep short entries clean
      const idx = Math.max(1, Math.min(paras.length-1, Math.round(paras.length * 0.6)));
      const wrapper = document.createElement('div');
      wrapper.innerHTML = fuelCardHTML;
      paras[idx].parentNode.insertBefore(wrapper, paras[idx].nextSibling);
    }catch(_){}
  }

  function byId(id){ return state.personas[state.idIndex[id]]; }

  function go(idx){
    if(!state.personas.length) return;
    state.i = Math.max(0, Math.min(state.personas.length-1, idx));
    const p = state.personas[state.i];

    const title = (p.title || p.persona_label || 'Guest Perspective').replace(/</g,'&lt;');
    const body  = mdToHtml(p.markdown || '');

    MOUNT.innerHTML = '<article class="story"><h3>'+title+'</h3><div class="story-body">'+body+'</div></article>';

    // Fuel card around 60% of the way through the text
    injectFuelAt60(MOUNT);

    // nav wiring
    const port = p.nav_port && byId(p.nav_port.target_persona_id);
    const stb  = p.nav_starboard && byId(p.nav_starboard.target_persona_id);

    PREV.disabled = !port; NEXT.disabled = !stb;
    PREV.textContent = (p.nav_port && p.nav_port.label) ? p.nav_port.label : '◀ Port';
    NEXT.textContent = (p.nav_starboard && p.nav_starboard.label) ? p.nav_starboard.label : 'Starboard ▶';

    PREV.onclick = port ? ()=>go(state.idIndex[p.nav_port.target_persona_id]) : null;
    NEXT.onclick = stb  ? ()=>go(state.idIndex[p.nav_starboard.target_persona_id]) : null;

    POS.textContent = (state.i+1)+' / '+state.personas.length;

    // arrow keys
    window.onkeydown = (e)=>{
      if(e.key==='ArrowLeft' && port) go(state.idIndex[p.nav_port.target_persona_id]);
      if(e.key==='ArrowRight' && stb) go(state.idIndex[p.nav_starboard.target_persona_id]);
    };
  }

  fetch(SRC,{cache:'no-store'}).then(r=>r.json()).then(json=>{
    renderEditorNote(json);

    const arr = Array.isArray(json.personas) ? json.personas.slice() : [];
    // Build id index
    state.personas = arr;
    state.idIndex = Object.fromEntries(arr.map((p, i)=>[p.id, i]));

    // Default to Ken’s entry if present, else first
    const start = state.idIndex['p0-ken'] != null ? state.idIndex['p0-ken'] : 0;
    go(start);
  }).catch(()=>{
    NOTE.innerHTML = '';
    MOUNT.innerHTML = '<p class="tiny">Stories coming soon.</p>';
  });
})();
</script>

    <!-- Videos -->
    <section class="card" aria-labelledby="video-highlights">
      <h2 id="video-highlights">Watch: Grandeur Highlights</h2>
      <p class="small">Swipe through ship walkthroughs, top-10s, and stateroom tours (including accessible where available).</p>
      <div class="swiper videos" aria-label="Featured video carousel">
        <div class="swiper-wrapper" id="featuredVideos"></div>
        <div class="swiper-pagination" aria-hidden="true"></div>
        <div class="swiper-button-prev" aria-label="Previous slide"></div>
        <div class="swiper-button-next" aria-label="Next slide"></div>
      </div>
      <div id="videoFallback" class="tiny hidden">Videos will appear once our sources sync for this ship.</div>
     <script type="application/json" id="videos-data">{
  "videos": [
    { "youtube_id": "-NS3BhWqzD4", "title": "Grandeur of the Seas — Full Ship Walkthrough (4K)" },
    { "youtube_id": "iIo4HNqNzbs", "title": "Top Things To Do on Grandeur of the Seas" },
    { "youtube_id": "tXQ8hic0O_U", "title": "Accessible Stateroom & Wheelchair Walkthrough" },
    { "youtube_id": "kYAwcRPmH5c", "title": "Interior Room Tour — Grandeur" },
    { "youtube_id": "1PgDMCgw6uI", "title": "Ocean View Stateroom Tour — Grandeur" },
    { "youtube_id": "0YONwODd98c", "title": "Balcony & Interior Quick Tour — Grandeur" },
    { "youtube_id": "HAxiXR-IMmk", "title": "Junior Suite 7650 — Aft Balcony Tour" },
    { "youtube_id": "KXCJePjqEY4", "title": "Grand Suite (1-Bedroom) Tour — 2025" },
    { "youtube_id": "ZEz-jOvRq7c", "title": "Grand Suite (2-Bedroom) 8084 — Tour" },
    { "youtube_id": "GByj5lFpAPU", "title": "Owner’s Suite 8502 — Cabin Tour" },
    { "youtube_id": "Z70a-ViIjTc", "title": "Royal Suite 8500 — Tour & Review" }
  ]
}</script>
    </section>

    <!-- Deck Plans + Live Tracker -->
    <section class="grid-2">
      <section class="card" aria-labelledby="deck-plans">
        <h2 id="deck-plans">Ship Map (Deck Plans)</h2>
        <p class="small">From sea days to disembarkation, let this be your compass to Grandeur—charting decks, waypoints, and sea-day strategy.</p>
        <p><a class="btn" href="https://www.royalcaribbean.com/cruise-ships/grandeur-of-the-seas/deck-plans" target="_blank" rel="noopener">Open Official Deck Plans →</a></p>
        <figure>
          <img src="https://www.cruisinginthewake.com/assets/ship-map.png?v=3.007.012" alt="Grandeur of the Seas simplified deck plan preview" loading="lazy" decoding="async" width="1200" height="675"/>
          <figcaption class="tiny">Preview only — open official deck plans for full details.</figcaption>
        </figure>
      </section>

      <section class="card itinerary" aria-labelledby="liveTrackHeading" data-imo="9102978" data-name="GRANDEUR-OF-THE-SEAS">
        <h2 id="liveTrackHeading">Where Is Grandeur Right Now?</h2>
        <p>See the ship’s current position, speed, and next port on a live tracker.</p>
        <div id="vf-map-grandeur" class="vf-map" role="region" aria-label="Live ship map for Grandeur of the Seas"></div>
        <iframe class="live-map hidden" title="Live ship tracker for Grandeur of the Seas" width="100%" height="300" loading="lazy" allowfullscreen></iframe>
        <p class="tiny">If the live widget stalls, it falls back to an iframe centered on the ship. Auto-refresh runs every 60 seconds.</p>
      </section>
    </section>

    <!-- Related -->
    <section class="related-row">
      <section class="card carousel related-ships" aria-labelledby="related-ships">
        <h2 id="related-ships" class="card-title">Vision Class — Sister Ships</h2>
        <nav class="pill-nav pills related-pills" aria-label="Vision-class ships">
          <a class="pill" href="https://www.cruisinginthewake.com/ships/rcl/vision-of-the-seas.html">Vision of the Seas</a>
          <a class="pill" href="https://www.cruisinginthewake.com/ships/rcl/rhapsody-of-the-seas.html">Rhapsody of the Seas</a>
          <a class="pill" href="https://www.cruisinginthewake.com/ships/rcl/enchantment-of-the-seas.html">Enchantment of the Seas</a>
        </nav>
        <p class="center"><a href="https://www.cruisinginthewake.com/ships/ships.html" class="btn">See All Ships</a></p>
      </section>

      <section class="card carousel related-classes" aria-labelledby="related-classes">
        <h2 id="related-classes" class="card-title">Explore Royal Caribbean Classes</h2>
        <p class="small">Hop between ship classes to compare size, venues, and vibes.</p>
        <nav class="pill-nav pills class-pills" aria-label="Royal Caribbean classes">
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#vision">Vision Class</a>
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#radiance">Radiance Class</a>
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#voyager">Voyager Class</a>
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#freedom">Freedom Class</a>
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#quantum">Quantum Class</a>
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#oasis">Oasis Class</a>
          <a class="pill" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html#icon">Icon Class</a>
        </nav>
        <p class="center"><a href="https://www.cruisinginthewake.com/ships/ships.html" class="btn">Browse All Ships</a></p>
      </section>
    </section>

    <!-- Venues, Experiences & Shows -->
    <section class="card" id="venues-experiences">
      <h2>Venues, Experiences &amp; Shows</h2>
      <div class="filters" style="display:flex;gap:.75rem;flex-wrap:wrap;align-items:center;margin:.5rem 0 1rem">
        <input id="vx-search" type="search" placeholder="Search…" aria-label="Search venues and experiences"
               style="flex:1;min-width:240px;padding:.6rem .8rem;border:1px solid var(--rope);border-radius:999px"/>
        <div class="chips pill-nav pills" role="group" aria-label="Category filters" style="display:flex;gap:.5rem;flex-wrap:wrap">
          <button class="chip is-on" data-filter="all" aria-pressed="true">All</button>
          <button class="chip" data-filter="included">Included</button>
          <button class="chip" data-filter="specialty">Specialty</button>
          <button class="chip" data-filter="coffee">Coffee</button>
          <button class="chip" data-filter="bar">Bar</button>
          <button class="chip" data-filter="shows">Shows</button>
          <button class="chip" data-filter="experience">Experiences & Activities</button>
          <button class="chip" data-filter="music">Live Music</button>
          <button class="chip" data-filter="spa">Spa &amp; Fitness</button>
          <button class="chip" data-filter="kids">Kids &amp; Teens</button>
          <button class="chip" data-filter="adults">Adults-Only</button>
        </div>
      </div>

      <div class="grid-2" id="vx-grid">
        <article class="card vx" data-tags="venue included main-dining">
          <h3><a href="https://www.cruisinginthewake.com/restaurants/rcl/main-dining-room.html" target="_blank" rel="noopener">Main Dining Room</a></h3>
          <p>Rotating themed menus. <em>Status:</em> Included.</p>
        </article>
        <article class="card vx" data-tags="venue included buffet">
          <h3><a href="https://www.cruisinginthewake.com/restaurants/rcl/windjammer.html" target="_blank" rel="noopener">Windjammer Café</a></h3>
          <p>Casual buffet for breakfast, lunch and dinner. <em>Status:</em> Included.</p>
        </article>
        <article class="card vx" data-tags="venue specialty steakhouse">
          <h3><a href="https://www.cruisinginthewake.com/restaurants/rcl/chops-grille.html" target="_blank" rel="noopener">Chops Grille</a></h3>
          <p>Classic steakhouse, à la carte or package.</p>
        </article>
        <article class="card vx" data-tags="venue specialty italian">
          <h3><a href="https://www.cruisinginthewake.com/restaurants/rcl/giovannis-table.html" target="_blank" rel="noopener">Giovanni’s Table</a></h3>
          <p>Family-style Italian classics.</p>
        </article>
        <article class="card vx" data-tags="venue included cafe">
          <h3><a href="https://www.cruisinginthewake.com/restaurants/rcl/park-cafe.html" target="_blank" rel="noopener">Park Café</a></h3>
          <p>Soups, salads, and made-to-order sandwiches.</p> </article>
        <!-- Bars & Lounges -->
<article class="card vx" data-tags="bar">
  <h3>Schooner Bar</h3>
  <p>Nautical-themed piano bar with live music, trivia, sing-alongs, and cocktails like the Schooner Smash.
     <em>Availability:</em> Every ship in the fleet.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>Boleros</h3>
  <p>Latin-inspired lounge with mojitos, salsa dancing, and rum/tequila-forward cocktails with live bands.
     <em>Availability:</em> Most ships (except some older Vision class).</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>English Pub</h3>
  <p>UK-style taproom with pints, whiskeys, gins, pub bites, and live music.
     <em>Availability:</em> Nearly every ship.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>Viking Crown Lounge</h3>
  <p>Sky-high observation lounge with panoramic views, DJs, and sunset cocktails.
     <em>Availability:</em> Voyager, Freedom, Oasis, Quantum; select Radiance/Vision.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>Pool Bar</h3>
  <p>Casual poolside spot for frozen drinks, beers, and sodas.
     <em>Availability:</em> Every ship.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>Solarium Bar</h3>
  <p>Relaxed indoor bar in the adults-only Solarium with lighter cocktails.
     <em>Availability:</em> Most ships with a Solarium.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>Casino Royale Bar</h3>
  <p>Quick-service casino bar for gamers; slotside cocktails and beers.
     <em>Availability:</em> All ships with a casino.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>R Bar</h3>
  <p>Retro 1960s martini bar featuring classic cocktails shaken with flair.
     <em>Availability:</em> Refurbished Freedom/Voyager and newer classes.</p>
</article>

<article class="card vx" data-tags="bar">
  <h3>Vintages</h3>
  <p>Wine bar with tastings and tapas—reds, whites, sparkling.
     <em>Availability:</em> Voyager, Oasis, Quantum; expanding fleet-wide.</p>
</article>
      </div>

      <p class="tiny">Lineups can change by sailing. Check the app’s daily schedule for your dates to make sure your favorite thing will be open, or on the schedule.</p>

      <script type="application/json" id="entertainment-data">{
        "theater":{"name":"Palladium Theater","decks":"Decks 4–5","notes":"Reservations via app when available."},
        "production_shows":[
          {"title":"Broadway Rhythm & Rhyme","description":"Royal Caribbean Singers & Dancers deliver witty, original renditions spanning classic to contemporary Broadway hits."},
          {"title":"All Access","description":"Motown, soul, pop—four decades of chart-toppers with high-energy choreography and dazzling costumes."},
          {"title":"Tango Buenos Aires","description":"A cultural tour of Argentina’s tango styles with live orchestral accompaniment and passionate dance."}
        ],
        "guest_entertainers":[
          "Comedians (clean & adult sets)",
          "Magicians (comedy magic to stage illusions)",
          "Jugglers (high-energy prop acts)"
        ],
        "interactive_events":[
          {"name":"Protect the Egg (Egg Drop Challenge)","description":"Team-build contraptions to save an egg dropped from higher decks. Judged on creativity and success."},
          {"name":"The Quest (or Crazy Quest)","description":"Adults-only, risqué scavenger-hunt game show with silly challenges and huge laughs."},
          {"name":"Karaoke Nights","description":"Schooner Bar or Star Lounge with prizes for crowd favorites."},
          {"name":"Game Shows & Trivia","description":"Name-that-tune, Liars Club, and rotating trivia sessions."}
        ],
        "themed_parties":[
          {"name":"The Greatest '80s Party Ever","venue":"Star Lounge"},
          {"name":"'70s Disco Inferno Street Party","venue":"Pool Deck or Centrum"},
          {"name":"Silent Party","venue":"Various (headphone disco)"},
          {"name":"White Hot Night Party","venue":"Star Lounge"}
        ],
        "other_entertainment":[
          "Live Music & DJ Dance Parties: Schooner Bar, Claddagh Irish Pub, Centrum, Viking Crown Lounge.",
          "Trivia & Lectures: Daytime brain-teasers, port talks in Palladium Theater.",
          "Movies Under the Stars: Outdoor pool-deck screenings, weather permitting."
        ],
        "advice":"Lineups rotate weekly and change with itinerary. Download the Royal Caribbean app ~45 days pre-sailing for reservations and final schedules."
      }</script>
    </section>

    <!-- Image Attributions -->
    <section class="card attributions" aria-labelledby="attribs">
      <h2 id="attribs">Image Attributions</h2>
      <ul>
        <li>Grandeur gallery images: ©
          <a href="https://www.flickersofmajesty.com" target="_blank" rel="noopener noreferrer">Flickers of Majesty</a>
          — <a href="https://www.instagram.com/flickersofmajesty/" target="_blank" rel="noopener noreferrer">Instagram</a>. All rights reserved. Used with permission.
        </li>
        <li>Dining hero (<em>Cordelia&nbsp;Empress&nbsp;Food&nbsp;Court</em>): © Wikimedia Commons, CC BY-SA 4.0.</li>
        <li>Header/Wordmark: © In the Wake.</li>
      </ul>
      <p class="tiny">All rights reserved where applicable.</p>
    </section>
  </main>

  <footer class="wrap">© 2025 In the Wake — A Cruise Traveler’s Logbook</footer>
<script type="text/javascript" src="https://cdn.consentmanager.net/delivery/js/accessibility.min.js" data-acc-accid="774c13e29978" data-acc-host="delivery.consentmanager.net" data-acc-cdn="cdn.consentmanager.net"></script>
<script>
/* Load Swiper (primary self-hosted with CDN fallback) */
(function ensureSwiper(){
  function addCSS(h){ const l=document.createElement('link'); l.rel='stylesheet'; l.href=h; document.head.appendChild(l); }
  function addJS(src, ok, fail){ const s=document.createElement('script'); s.src=src; s.async=true; s.onload=ok; s.onerror=fail||function(){}; document.head.appendChild(s); }
  const primaryCSS="https://www.cruisinginthewake.com/vendor/swiper/swiper-bundle.min.css?v=3.007.012";
  const primaryJS ="https://www.cruisinginthewake.com/vendor/swiper/swiper-bundle.min.js?v=3.007.012";
  const cdnCSS    ="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css";
  const cdnJS     ="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js";
  addCSS(primaryCSS);
  addJS(primaryJS, null, function(){ addCSS(cdnCSS); addJS(cdnJS); });
})();
</script>
   <script>
/* Swiper init with offline fallback — enables CSS fallback after timeout */
(function initSwipers(){
  var FAILOVER_MS = 2500;   // after this, assume Swiper won't load
  var gaveUp = false;
  var failTimer = setTimeout(function(){
    if (!window.Swiper) {
      gaveUp = true;
      document.documentElement.classList.add('swiper-fallback');
    }
  }, FAILOVER_MS);

  function start(){
    try{
      // First Look carousel
      new Swiper('.swiper.firstlook',{
        loop:false, watchOverflow:true, autoHeight:false,
        pagination:{ el:'.swiper.firstlook .swiper-pagination', clickable:true },
        navigation:{ nextEl:'.swiper.firstlook .swiper-button-next', prevEl:'.swiper.firstlook .swiper-button-prev' },
        a11y:{ enabled:true }
      });

      // Videos carousel
      new Swiper('.swiper.videos',{
        loop:false, watchOverflow:true,
        pagination:{ el:'.swiper.videos .swiper-pagination', clickable:true },
        navigation:{ nextEl:'.swiper.videos .swiper-button-next', prevEl:'.swiper.videos .swiper-button-prev' },
        a11y:{ enabled:true }
      });

      // If we got here, Swiper loaded — ensure fallback class is off
      document.documentElement.classList.remove('swiper-fallback');
      clearTimeout(failTimer);
    }catch(_){
      // Swiper constructor threw (partially loaded or broken) → fallback
      document.documentElement.classList.add('swiper-fallback');
    }
  }

  // Poll briefly for Swiper; stop once we give up
  (function whenReady(){
    if (window.Swiper) { start(); }
    else if (!gaveUp)  { setTimeout(whenReady, 100); }
  })();
})();
</script>

  <!-- Ship stats loader (fallback-first) -->
  <script>
  (function loadShipStats(){
    const el=document.getElementById('ship-stats'); if(!el) return;
    function render(a){
      const rows=[
        ['Class', a.class],['Entered Service', a.entered_service],['Gross Tonnage', a.gt],
        ['Guests', a.guests],['Crew', a.crew],['Length', a.length],['Beam', a.beam],['Registry', a.registry]
      ].filter(p=>p[1] && String(p[1]).trim()!=='')
       .map(p=>'<div class="stat-line"><span class="stat-key">'+p[0]+':</span><span class="stat-val">'+p[1]+'</span></div>').join('');
      el.innerHTML = rows || '<p class="tiny">Stats coming soon.</p>';
    }
    try{
      const fb=JSON.parse((document.getElementById('ship-stats-fallback')||{}).textContent||'{}');
      if (fb && (fb.name||fb.slug)) render(fb);
    }catch(_){ el.innerHTML='<p class="tiny">Stats coming soon.</p>'; }
  })();
  </script>

  <!-- Videos loader (embedded JSON) -->
  <script>
  (function initVideos(){
    const WRAP=document.getElementById('featuredVideos'); if(!WRAP) return;
    const CON=document.querySelector('.swiper.videos');
    const FALL=document.getElementById('videoFallback');
    function ytId(v){
      if(!v) return '';
      if(v.youtube_id) return String(v.youtube_id);
      const u=String(v.url||v.embed_url||'');
      const m=u.match(/[?&]v=([A-Za-z0-9_-]{6,})/)||u.match(/youtu\.be\/([A-Za-z0-9_-]{6,})/)||u.match(/\/embed\/([A-Za-z0-9_-]{6,})/);
      return m?m[1]:'';
    }
    function getList(){
      try{
        const j=JSON.parse((document.getElementById('videos-data')||{}).textContent||'{}');
        if(Array.isArray(j)) return j;
        if(Array.isArray(j.videos)) return j.videos;
      }catch(_){}
      return [];
    }
    const items=getList(), seen=Object.create(null), slides=[];
    items.forEach(v=>{
      const id=ytId(v); if(!id||seen[id]) return; seen[id]=1;
      const title=(v.title||'Ship video').replace(/"/g,'&quot;');
      slides.push('<div class="swiper-slide"><iframe title="'+title+'" src="https://www.youtube-nocookie.com/embed/'+id+'" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading="lazy"></iframe></div>');
    });
    if(!slides.length){
      if(FALL) FALL.classList.remove('hidden');
      CON && CON.classList.add('carousel-fallback');
      return;
    }
    WRAP.innerHTML = slides.join('');
  })();
  </script>

  <!-- Hybrid VesselFinder (AISMap → iframe(details/IMO) + 60s refresh) -->
  <script>
  (function initHybridVesselFinder(){
    const wrap=document.querySelector('.card.itinerary[data-imo]'); if(!wrap) return;
    const imo=(wrap.getAttribute('data-imo')||'').trim();
    const mapEl=document.getElementById('vf-map-grandeur');
    const iFr=wrap.querySelector('iframe.live-map');
    const makeURL=()=>`https://www.vesselfinder.com/vessels/details/${imo}`;
    function useIframe(){
      if(!iFr) return;
      const url=new URL(makeURL()); url.searchParams.set('t', Date.now());
      iFr.src=url.toString(); iFr.classList.remove('hidden'); if(mapEl) mapEl.style.display='none';
    }
    const s=document.createElement('script'); s.src="https://www.vesselfinder.com/aismap.js"; s.async=true;
    const stall=setTimeout(useIframe, 4000);
    s.onload=function(){
      try{
        clearTimeout(stall);
        if(window.AISMap && mapEl){
          new AISMap(mapEl,{width:"100%",height:300,zoom:8,names:true,show_track:1,track_days:1,vessel:"IMO:"+imo});
          setTimeout(()=>{ if(!mapEl.querySelector('canvas,svg')) useIframe(); }, 2000);
        }else{ useIframe(); }
      }catch(_){ useIframe(); }
    };
    s.onerror=function(){ clearTimeout(stall); useIframe(); };
    document.head.appendChild(s);
    setInterval(function(){
      if(iFr && !iFr.classList.contains('hidden')){
        try{ const u=new URL(iFr.src); u.searchParams.set('t', Date.now()); iFr.src=u.toString(); }catch(_){}
      }
    }, 60000);
  })();
  </script>

  <!-- Venues/Experiences filters + JSON augmentation -->
 <script>
/* In the Wake — VX (Venues / Experiences) v3.007.012-full
   - Adds "Experiences" chip
   - Canonical experiences seeded (tastings, tours, parties, classes, enrichment)
   - Search understands category words (shows/experiences/bar/coffee/etc.)
   - Works with existing static venue cards and any JSON you also inject
*/
(function initVX(){
  const $  = (sel, ctx=document)=>ctx.querySelector(sel);
  const $$ = (sel, ctx=document)=>Array.from(ctx.querySelectorAll(sel));

  const scope  = $('#venues-experiences') || document;
  const search = $('#vx-search', scope);
  const chipBar= $('.chips', scope);
  const grid   = $('#vx-grid', scope);
  const chips  = () => $$('#venues-experiences .chip');
  const cards  = () => $$('#vx-grid .vx');

  if(!grid) return;

  /* ---------- 1) Ensure we have an "Experiences" chip in the bar ---------- */
  (function ensureExperiencesChip(){
    if (!chipBar) return;
    const showsChip = chipBar.querySelector('[data-filter="shows"]');
    const hasExp = chipBar.querySelector('[data-filter="experience"]');
    if (!hasExp) {
      const btn = document.createElement('button');
      btn.className = 'chip';
      btn.dataset.filter = 'experience';
      btn.textContent = 'Experiences';
      if (showsChip && showsChip.nextSibling) {
        chipBar.insertBefore(btn, showsChip.nextSibling);
      } else {
        chipBar.appendChild(btn);
      }
    }
  })();

  /* ---------- 2) Canonical Experiences seed (ship-agnostic) --------------- */
  const experiencesSeed = [
    // Dining / Tastings
    { t:'Taste of Royal Lunch', d:'Multi-course tasting across marquee venues. Limited dates; book early in the app.', g:'experience dining premium' },
    { t:"Chef’s Table", d:'Intimate multi-course dinner with curated wine pairings; very limited seating.', g:'experience dining premium adults' },
    { t:'Wine & Cheese Tasting', d:'Guided wine flight with cheese pairings; options vary by sailing.', g:'experience tasting wine adults' },
    { t:'Craft Beer Tasting', d:'Sampler of regional and ship-favorite brews; check daily planner.', g:'experience tasting beer adults' },
    { t:'Spirits / Whiskey / Rum Tasting', d:'Guided flight; learn notes, provenance, and pairing basics.', g:'experience tasting spirits adults' },
    { t:'Mixology Class', d:'Hands-on cocktail session with ship bartenders; shake, stir, and sample.', g:'experience class mixology bar adults' },
    { t:'Martini / Margarita Class', d:'Focus class on classic martinis or margs with technique and tasting.', g:'experience class mixology bar adults' },
    { t:'Sushi Making Workshop', d:'Roll basics + plating tips; family-friendly sessions on select sailings.', g:'experience class culinary family' },
    { t:'Cupcake Decorating', d:'Kid-favorite (and adult-approved) decorating class.', g:'experience class dessert kids family' },

    // Tours & Behind-the-Scenes
    { t:'All Access Ship Tour', d:'Behind-the-scenes tour (galley, backstage; bridge wings where permitted). Space limited.', g:'experience tour behind-the-scenes adults' },
    { t:'Galley Tour', d:'Short walkthrough of the ship galley on select sailings.', g:'experience tour behind-the-scenes' },
    { t:'Bridge Meet & Greet / Photo', d:'Occasional captain meet/photo ops depending on itinerary and operations.', g:'experience tour meet-and-greet' },

    // Interactive & Game Shows
    { t:'The Quest', d:'Adults-only, legendary scavenger/game show. It gets wild—come ready.', g:'experience games adults party' },
    { t:'Protect the Egg (Egg Drop)', d:'Build contraptions in teams to save an egg dropped from height. Judged on creativity & success.', g:'experience games family' },
    { t:'Karaoke Nights', d:'Schooner Bar / Star Lounge. Family and adults sessions; prizes for crowd favorites.', g:'experience music karaoke family adults' },
    { t:'Liars Club', d:'Comedy panel game of bluffs and definitions.', g:'experience games adults' },
    { t:'Majority Rules', d:'Hilarious group answer game—most common answer wins.', g:'experience games family adults' },
    { t:'Friendly Feud', d:'Team showdown with survey questions, Family-Feud style.', g:'experience games family' },
    { t:'General Trivia & Name That Tune', d:'Rotating trivia blocks; music decades, movies, theme nights.', g:'experience games trivia family' },
    { t:'Scavenger Hunts', d:'Family & adults variants throughout the sailing.', g:'experience games family adults' },

    // Themed Parties & Social
    { t:"'70s Disco Street Party", d:'Throwback street party in the Centrum or pool deck.', g:'experience party music adults' },
    { t:"'80s Party", d:'Neon nostalgia and big-hair anthems.', g:'experience party music adults' },
    { t:'White Hot Night', d:'Wear white; lights down, vibes up.', g:'experience party music adults' },
    { t:'Silent Party', d:'Headphone disco with multiple DJ channels.', g:'experience party music adults' },
    { t:'Sailaway Party', d:'Kickoff celebration on the pool deck.', g:'experience party music family' },
    { t:'Pub Crawl', d:'Guided crawl with mini-challenges; select sailings.', g:'experience party bar adults' },

    // Wellness & Enrichment
    { t:'Spa Seminars', d:'Informational wellness sessions (sales-adjacent).', g:'experience spa enrichment' },
    { t:'Fitness Workshops', d:'Stretch, abs, spin, and more—schedule varies.', g:'experience fitness enrichment' },
    { t:'Port Lectures & Enrichment Talks', d:'Port highlights, history, and practical tips.', g:'experience enrichment lecture' },
    { t:'Art Gallery Preview & Auction', d:'Preview gallery, live auction, and bubbly.', g:'experience art auction shopping' },

    // Movies & Misc
    { t:'Movies Under the Stars', d:'Outdoor pool-deck screenings, weather permitting.', g:'experience movie family' }
  ];

  /* ---------- 3) Add seed experiences to grid (idempotent) ----------------- */
  (function appendExperiences(){
    // basic guard if developer already added them by hand (avoid duplicates by title)
    const seen = new Set(cards().map(c => (c.querySelector('h3')?.textContent || '').trim().toLowerCase()));
    experiencesSeed.forEach(x=>{
      const key = String(x.t||'').trim().toLowerCase();
      if (!key || seen.has(key)) return;
      const el = document.createElement('article');
      el.className = 'card vx';
      el.setAttribute('data-tags', String(x.g||'').toLowerCase());
      el.innerHTML = '<h3>'+x.t+'</h3><p>'+ (x.d||'') +'</p>';
      grid.appendChild(el);
      seen.add(key);
    });
  })();

  /* ---------- 4) Search: map category words to tags + text match ------------ */
  const CAT = {
    // Shows
    'show':['shows'],'shows':['shows','show'],
    // Bars / Coffee
    'bar':['bar','bars'],'bars':['bar','bars'],
    'coffee':['coffee','cafe'],'cafe':['coffee','cafe'],
    // Fare types
    'specialty':['specialty'],'included':['included'],
    // Experiences
    'experience':['experience'],'experiences':['experience'],
    'xperience':['experience'],'xperiences':['experience'],
    // Music / live
    'music':['music','shows'],'live':['music','shows'],
    // Audiences / areas
    'kids':['kids','teens'],'teens':['kids','teens'],
    'adults':['adults','adult'],'adult':['adults','adult'],
    // Wellness
    'spa':['spa','fitness'],'fitness':['spa','fitness'],
    // Other helpful intents
    'party':['party','music'],'parties':['party','music'],
    'tour':['tour'],'tours':['tour'],
    'tasting':['tasting'],'tastings':['tasting'],
    'class':['class'],'classes':['class'],
    'movie':['movie'],'movies':['movie']
  };

  function tokenize(s){
    return String(s||'')
      .toLowerCase()
      .split(/[^a-z0-9]+/g)
      .filter(Boolean);
  }

  function apply(){
    const q = (search?.value || '').trim();
    const words = tokenize(q);
    const want = new Set();

    // Expand category words → tags
    words.forEach(w => {
      const tags = CAT[w];
      if (tags) tags.forEach(t => want.add(t));
      // Simple plural→singular fallback (bars->bar, shows->show, parties->party)
      if (!tags && /s$/.test(w)) {
        const singular = w.replace(/ies$/, 'y').replace(/s$/, '');
        if (CAT[singular]) CAT[singular].forEach(t => want.add(t));
      }
    });

    // Merge active chip intent (unless user typed any category word—then typed wins)
    const activeChip = chips().find(c => c.classList.contains('is-on') && c.dataset.filter!=='all');
    const chipTag = activeChip ? (activeChip.dataset.filter || '').toLowerCase() : null;
    const typedHasCategory = words.some(w => CAT[w] || CAT[w?.replace(/ies$/,'y')?.replace(/s$/,'')]);
    if (chipTag && !typedHasCategory) want.add(chipTag);

    cards().forEach(card=>{
      const name = (card.querySelector('h3')?.textContent || '').toLowerCase();
      const tags = (card.dataset.tags || '').toLowerCase();

      // plain words that are NOT category intents
      const textWords = words.filter(w=>{
        const base = w.replace(/ies$/,'y').replace(/s$/,'');
        return !(CAT[w] || CAT[base]);
      });

      const catOK  = !want.size || Array.from(want).some(t => tags.includes(t));
      const textOK = !textWords.length || textWords.every(w => name.includes(w) || tags.includes(w));

      card.style.display = (catOK && textOK) ? '' : 'none';
    });
  }

  /* ---------- 5) Wire events ----------------------------------------------- */
  if (search) search.addEventListener('input', apply);

  chips().forEach(ch => ch.addEventListener('click', ()=>{
    chips().forEach(c=>{ c.classList.remove('is-on'); c.setAttribute('aria-pressed','false'); });
    ch.classList.add('is-on');
    ch.setAttribute('aria-pressed','true');
    apply();
  }));

  /* ---------- 6) Optional: augment from existing JSON (kept compatible) ---- */
  (function augmentFromEntertainmentJSON(){
    try{
      const raw = (document.getElementById('entertainment-data') || {}).textContent || '';
      if(!raw) return;
      const data = JSON.parse(raw);

      const seen = new Set(cards().map(c => (c.querySelector('h3')?.textContent || '').trim().toLowerCase()));
      const add = (title,desc,tags)=>{
        const key = String(title||'').trim().toLowerCase();
        if (!key || seen.has(key)) return;
        const el=document.createElement('article');
        el.className='card vx';
        el.setAttribute('data-tags', String(tags||'').toLowerCase());
        el.innerHTML='<h3>'+title+'</h3><p>'+ (desc||'') +'</p>';
        grid.appendChild(el);
        seen.add(key);
      };

      (data.production_shows||[]).forEach(s=> add(s.title, s.description||'Production show', 'experience shows'));
      (data.guest_entertainers||[]).forEach(n=> add(n, 'Rotating headliners; check schedule.', 'experience shows music'));
      (data.interactive_events||[]).forEach(e=> add(e.name, e.description||'Interactive game show', 'experience games'));
      (data.themed_parties||[]).forEach(p=> add(p.name, (p.venue?('Venue: '+p.venue):'Themed party'), 'experience party music'));
      (data.other_entertainment||[]).forEach(line=>{
        const title = String(line).split(':')[0];
        add(title, line, 'experience');
      });
    }catch(err){ console.warn('VX JSON parse failed', err); }
  })();

  /* ---------- 7) Initial paint --------------------------------------------- */
  apply();
})();
</script>

  <!-- Service Worker (versioned) -->
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function(){
      navigator.serviceWorker.register('/sw.js?v=3.007.012')
        .catch(function(err){ console.warn('SW registration failed', err); });
    });
  }
  </script>

  <!-- External links: new tab (defense-in-depth) -->
  <script>
  (function externalLinksNewTab(){
    const here = location.hostname.replace(/^www\./,'');
    function upgrade(){
      document.querySelectorAll('a[href]').forEach(a=>{
        const href=a.getAttribute('href')||'';
        if (/^(#|mailto:|tel:)/i.test(href)) return;
        try{
          const u=new URL(href, location.href);
          const host=u.hostname.replace(/^www\./,'');
          if (host !== here || a.rel==='external'){
            a.target='_blank';
            a.rel=['noopener','noreferrer'].concat((a.rel||'').split(/\s+/)).filter(Boolean).join(' ');
          }
        }catch(_){}
      });
    }
    if (document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', upgrade, {once:true}); } else { upgrade(); }
  })();
  </script>
</body>
</html>
