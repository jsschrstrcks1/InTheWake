<!--
Soli Deo Gloria
All work on this project is offered as a gift to God.
"Trust in the LORD with all your heart, and do not lean on your own understanding." — Proverbs 3:5
"Whatever you do, work heartily, as for the Lord and not for men." — Colossians 3:23

STANDARDS: Every Page v3.010.300 · Production Template · Unified Nav v3.010.300 · A11y/WCAG 2.1 AA Compliant
-->
<!doctype html>
<html lang="en">
<head>
<!-- ai-breadcrumbs
     entity: Stateroom Sanity Check
     type: Information Page
     parent: /
     category: General Information
     updated: 2025-11-15
     expertise: Cruise travel, planning, research
     target-audience: Cruise travelers, vacation planners, research-oriented cruisers
     answer-first: Check your cruise stateroom assignment and get gentle, pastoral guidance about your cabin choice. Know before you sail—with peace of mind.
     -->
  <!-- ======================================================
       In the Wake — Stateroom Sanity Check
       Version: 1.000.alpha  |  Soli Deo Gloria ✝️

       ✅ WCAG 2.1 Level AA Compliant
       ✅ SEO Optimized (JSON-LD, OpenGraph, Twitter Cards)
       ✅ Dropdown Menus with Hover Delay (300ms)
       ✅ AI-First SEO with E-E-A-T Person Schema
       ====================================================== -->

  <!-- Core -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="referrer" content="no-referrer-when-downgrade"/>

  <!-- SEO: Robots & Crawling -->
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1"/>
  <meta name="googlebot" content="index,follow"/>
  <meta name="bingbot" content="index,follow"/>

  <!-- SEO: Theme & Appearance -->
  <meta name="color-scheme" content="light"/>
  <meta name="theme-color" content="#0e6e8e"/>
  <meta name="version" content="1.000.alpha"/>
  <meta name="author" content="In the Wake"/>
  <meta name="publisher" content="In the Wake"/>

  <!-- Title & SEO -->
  <title>Stateroom Sanity Check — Is Your Cabin Choice a Good One? | In the Wake</title>
  <link rel="canonical" href="https://cruisinginthewake.com/stateroom-check.html"/>
  <meta name="description" content="Check your cruise stateroom assignment and get gentle, pastoral guidance about your cabin choice. Know before you sail—with peace of mind."/>

  <!-- OpenGraph -->
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:title" content="Stateroom Sanity Check — Is Your Cabin Choice a Good One?"/>
  <meta property="og:description" content="Get encouraging, helpful feedback about your cruise cabin assignment. We'll help you understand your stateroom choice with gentle, pastoral guidance."/>
  <meta property="og:url" content="https://cruisinginthewake.com/stateroom-check.html"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:image" content="https://cruisinginthewake.com/assets/index_hero.jpg"/>

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Stateroom Sanity Check — Is Your Cabin a Good Choice?"/>
  <meta name="twitter:description" content="Check your cruise stateroom and get gentle guidance. Is your cabin choice a good one? Find out with peace of mind."/>
  <meta name="twitter:image" content="https://cruisinginthewake.com/assets/index_hero.jpg"/>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZP891PZXJ"></script>
  <script>
    window.dataLayer=window.dataLayer||[];
    function gtag(){dataLayer.push(arguments);}
    gtag('js',new Date());
    gtag('config','G-WZP891PZXJ',{anonymize_ip:true});
  </script>

  <!-- Umami (secondary analytics) -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>

  <!-- JSON-LD: Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "In the Wake",
    "url": "https://cruisinginthewake.com",
    "logo": "https://cruisinginthewake.com/assets/logo_wake.png"
  }
  </script>

  <!-- JSON-LD: WebSite + SearchAction -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "In the Wake",
    "url": "https://cruisinginthewake.com/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://cruisinginthewake.com/search.html?q={query}",
      "query-input": "required name=query"
    }
  }
  </script>

  <!-- JSON-LD: BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://cruisinginthewake.com/"},
      {"@type": "ListItem", "position": 2, "name": "Planning", "item": "https://cruisinginthewake.com/planning.html"},
      {"@type": "ListItem", "position": 3, "name": "Stateroom Check", "item": "https://cruisinginthewake.com/stateroom-check.html"}
    ]
  }
  </script>

  <!-- JSON-LD: Person (E-E-A-T) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Ken Baker",
    "url": "https://cruisinginthewake.com/authors/ken-baker.html",
    "jobTitle": "Founder and Editor",
    "description": "Traveler, pastor, and storyteller. Founder of In the Wake, a cruise traveler's logbook offering planning tools, travel tips, and faith-scented reflections for smoother sailings.",
    "image": "https://cruisinginthewake.com/authors/img/ken1.webp",
    "sameAs": ["https://www.flickersofmajesty.com"],
    "worksFor": {"@type": "Organization", "name": "In the Wake"},
    "knowsAbout": ["Cruise Planning", "Royal Caribbean", "Cruise Ships", "Travel Writing"]
  }
  </script>

  <!-- Favicon / PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/in_the_wake_icon_32x32.png"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png"/>
  <link rel="manifest" href="/manifest.webmanifest"/>

  <!-- Global CSS -->
  <link rel="stylesheet" href="/assets/styles.css?v=3.010.300"/>

  <!-- Page-specific CSS -->
  <style>
    /* Stateroom Check specific styles */
    .stateroom-check-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .intro-section {
      background: #fff;
      border: 2px solid var(--rope, #d9b382);
      border-radius: 14px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(8, 48, 65, 0.08);
    }

    .intro-section h1 {
      color: var(--navy, #0a3d62);
      margin-bottom: 0.5rem;
    }

    .intro-section .tagline {
      color: var(--text-secondary, #5a6c7d);
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }

    .check-form {
      background: #fff;
      border: 2px solid var(--rope, #d9b382);
      border-radius: 14px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(8, 48, 65, 0.08);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: var(--navy, #0a3d62);
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .form-group select,
    .form-group input[type="text"] {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border: 2px solid var(--rope, #d9b382);
      border-radius: 8px;
      background: #fff;
      transition: border-color 0.2s;
    }

    .form-group select:focus,
    .form-group input[type="text"]:focus {
      outline: none;
      border-color: var(--accent, #0e6e8e);
      box-shadow: 0 0 0 3px rgba(14, 110, 142, 0.1);
    }

    .form-group .help-text {
      font-size: 0.9rem;
      color: var(--text-secondary, #5a6c7d);
      margin-top: 0.25rem;
    }

    .submit-btn {
      width: 100%;
      padding: 1rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: #fff;
      background: var(--accent, #0e6e8e);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 6px rgba(14, 110, 142, 0.2);
    }

    .submit-btn:hover {
      background: var(--accent-dark, #0a5570);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(14, 110, 142, 0.3);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Results styling */
    .results-container {
      margin-top: 2rem;
      min-height: 100px;
    }

    .stateroom-result {
      background: #fff;
      border: 2px solid var(--rope, #d9b382);
      border-radius: 14px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(8, 48, 65, 0.12);
      animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .verdict-great {
      border-left: 6px solid var(--success, #27ae60);
    }

    .verdict-note {
      border-left: 6px solid var(--info, #3498db);
    }

    .verdict-caution {
      border-left: 6px solid var(--warning, #f39c12);
    }

    .result-header h2 {
      color: var(--navy, #0a3d62);
      margin-bottom: 0.5rem;
      font-size: 1.8rem;
    }

    .cabin-meta {
      color: var(--text-secondary, #5a6c7d);
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .result-summary {
      margin: 1.5rem 0;
      padding: 1rem;
      background: rgba(14, 110, 142, 0.05);
      border-radius: 8px;
    }

    .summary-text {
      font-size: 1.1rem;
      line-height: 1.6;
      color: var(--text-primary, #2c3e50);
    }

    .issues-section {
      margin: 1.5rem 0;
    }

    .issues-section h3 {
      color: var(--navy, #0a3d62);
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }

    .issue-card {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid;
    }

    .issue-info {
      background: rgba(52, 152, 219, 0.1);
      border-left-color: #3498db;
    }

    .issue-minor {
      background: rgba(243, 156, 18, 0.1);
      border-left-color: #f39c12;
    }

    .issue-major {
      background: rgba(231, 76, 60, 0.1);
      border-left-color: #e74c3c;
    }

    .issue-card h4 {
      color: var(--navy, #0a3d62);
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .issue-card p {
      line-height: 1.6;
      color: var(--text-primary, #2c3e50);
    }

    .result-encouragement {
      margin-top: 1.5rem;
      padding: 1rem;
      background: rgba(39, 174, 96, 0.05);
      border-radius: 8px;
      border-left: 4px solid var(--success, #27ae60);
    }

    .result-encouragement p {
      font-style: italic;
      color: var(--text-primary, #2c3e50);
      line-height: 1.6;
    }

    .error-message {
      background: rgba(231, 76, 60, 0.1);
      border: 2px solid #e74c3c;
      border-radius: 8px;
      padding: 1rem;
      color: var(--text-primary, #2c3e50);
    }

    .loading-message {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary, #5a6c7d);
      font-style: italic;
    }
  
  /* Dropdown Navigation (FIXED: 300ms Hover Delay) */
  .nav {
    flex: 1 1 auto;
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: .5rem;
    white-space: nowrap;
    flex-wrap: nowrap;
    overflow: visible;
    padding-inline: .75rem;
  }

  .nav-item {
    position: relative;
    display: inline-block;
  }

  .nav-item > a,
  .nav-item > button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: .35rem;
    padding: .65rem 1rem;
    min-height: 44px;
    border-radius: 10px;
    background: #fff;
    border: 2px solid var(--rope);
    color: var(--accent);
    font: inherit;
    font-size: .95rem;
    line-height: 1.2;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .nav-item > a:hover,
  .nav-item > button:hover {
    background: var(--foam);
    border-color: var(--accent);
    transform: translateY(-1px);
  }

  .nav-item > a[aria-current="page"] {
    background: var(--accent);
    color: #fff;
    font-weight: 600;
    border-color: var(--accent);
  }

  .nav-disclosure .caret {
    display: inline-block;
    margin-left: .25rem;
    transition: transform 0.2s ease;
  }

  .nav-item[data-open="true"] .nav-disclosure .caret {
    transform: rotate(180deg);
  }

  /* Dropdown menu with safe zone */
  .submenu {
    position: absolute !important;
    left: 0;
    top: calc(100% + 4px);
    min-width: 240px;
    background: #fff;
    border: 2px solid var(--rope);
    border-radius: 12px;
    padding: .6rem;
    box-shadow: 0 8px 24px rgba(8,48,65,.15);
    display: none;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    z-index: 2100;
  }

  /* Safe zone bridge */
  .submenu::before {
    content: '';
    position: absolute;
    top: -8px;
    left: 0;
    right: 0;
    height: 8px;
    background: transparent;
  }

  .nav-item[data-open="true"] > .submenu {
    display: block;
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .submenu a {
    display: block;
    width: 100%;
    margin: 0;
    padding: .6rem .75rem;
    border-radius: .65rem;
    border: 0;
    background: transparent;
    color: var(--ink);
    text-decoration: none;
    transition: background 0.15s ease;
  }

  .submenu a:hover,
  .submenu a:focus {
    background: #f2f7fa;
    outline: 2px solid transparent;
  }

  @media (max-width: 768px) {
    .nav {
      justify-content: flex-start;
      overflow-x: auto;
      scrollbar-width: thin;
      -webkit-overflow-scrolling: touch;
    }

    .nav-item > a,
    .nav-item > button {
      flex: 0 0 auto;
    }

    .submenu {
      left: 0;
      right: 0;
      min-width: 100%;
    }
  }
  </style>
</head>

<body class="page">
  <!-- Skip Link -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- ARIA Live Regions -->
  <div id="a11y-status" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>
  <div id="a11y-alerts" role="alert" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

  <!-- HEADER -->
  <header class="hero-header" role="banner">
    <div class="navbar">
      <!-- Navigation with Dropdown Menus -->
      <nav class="nav" aria-label="Main site navigation">
        <div class="nav-item">
          <a href="/">Home</a>
        </div>

        <!-- Planning Dropdown -->
        <div class="nav-item nav-group" id="nav-planning" data-open="false">
          <button class="nav-disclosure" type="button" aria-expanded="false" aria-haspopup="true" aria-controls="menu-planning">
            Planning <span class="caret">▾</span>
          </button>
          <div id="menu-planning" class="submenu" role="menu" aria-label="Planning submenu">
            <a role="menuitem" href="/planning.html">Planning (overview)</a>
            <a role="menuitem" href="/ships.html">Ships</a>
            <a role="menuitem" href="/restaurants.html">Restaurants &amp; Menus</a>
            <a role="menuitem" href="/ports.html">Ports</a>
            <a role="menuitem" href="/drink-calculator.html">Drink Calculator</a>
            <a role="menuitem" href="/cruise-lines.html">Cruise Lines</a>
            <a role="menuitem" href="/packing-lists.html">Packing Lists</a>
            <a role="menuitem" href="/accessibility.html">Accessibility</a>
          </div>
        </div>

        <!-- Travel Dropdown -->
        <div class="nav-item nav-group" id="nav-travel" data-open="false">
          <button class="nav-disclosure" type="button" aria-expanded="false" aria-haspopup="true" aria-controls="menu-travel">
            Travel <span class="caret">▾</span>
          </button>
          <div id="menu-travel" class="submenu" role="menu" aria-label="Travel submenu">
            <a role="menuitem" href="/travel.html">Travel (overview)</a>
            <a role="menuitem" href="/solo.html">Solo</a>
          </div>
        </div>

        <div class="nav-item">
          <a href="/about-us.html">About</a>
        </div>
      </nav>

      <div class="brand">
        <img src="/assets/logo_wake.png?v=3.010.300" width="256" height="64" alt="In the Wake wordmark" decoding="async"/>
        <span class="tiny version-badge" aria-label="Tool version 1.000 alpha">v1.000.α</span>
      </div>

      <!-- Navigation with Dropdown Menus -->
      <nav class="nav pill-nav" aria-label="Primary">
        <a href="/">Home</a>
        <div class="nav-item nav-group" id="nav-planning" data-open="false">
          <button class="nav-disclosure" type="button" aria-expanded="false" aria-haspopup="true" aria-controls="menu-planning">
            Planning <span class="caret">▾</span>
          </button>
          <div id="menu-planning" class="submenu" role="menu" aria-label="Planning submenu">
            <a role="menuitem" href="/planning.html">Planning (overview)</a>
            <a role="menuitem" href="/ships.html">Ships</a>
            <a role="menuitem" href="/restaurants.html">Restaurants &amp; Menus</a>
            <a role="menuitem" href="/ports.html">Ports</a>
            <a role="menuitem" href="/drink-calculator.html">Drink Calculator</a>
            <a role="menuitem" href="/stateroom-check.html" aria-current="page">Stateroom Check</a>
            <a role="menuitem" href="/cruise-lines.html">Cruise Lines</a>
            <a role="menuitem" href="/packing-lists.html">Packing Lists</a>
            <a role="menuitem" href="/accessibility.html">Accessibility</a>
          </div>
        </div>

        <!-- Travel Dropdown -->
        <div class="nav-item nav-group" id="nav-travel" data-open="false">
          <button class="nav-disclosure" type="button" aria-expanded="false" aria-haspopup="true" aria-controls="menu-travel">
            Travel <span class="caret">▾</span>
          </button>
          <div id="menu-travel" class="submenu" role="menu" aria-label="Travel submenu">
            <a role="menuitem" href="/travel.html">Travel (overview)</a>
            <a role="menuitem" href="/solo.html">Solo</a>
          </div>
        </div>
        <a href="/about-us.html">About</a>
      </nav>
    </div>

    <div class="hero" role="img" aria-label="Ship wake at sunrise">
      <div class="latlon-grid" aria-hidden="true">
        <svg viewBox="0 0 100 60" preserveAspectRatio="none">
          <g class="grid-lines" stroke-width="0.35">
            <line x1="10" y1="0" x2="10" y2="60"/><line x1="20" y1="0" x2="20" y2="60"/>
            <line x1="30" y1="0" x2="30" y2="60"/><line x1="40" y1="0" x2="40" y2="60"/>
            <line x1="50" y1="0" x2="50" y2="60"/><line x1="60" y1="0" x2="60" y2="60"/>
            <line x1="70" y1="0" x2="70" y2="60"/><line x1="80" y1="0" x2="80" y2="60"/>
            <line x1="90" y1="0" x2="90" y2="60"/>
            <line x1="0" y1="10" x2="100" y2="10"/><line x1="0" y1="20" x2="100" y2="20"/>
            <line x1="0" y1="30" x2="100" y2="30"/><line x1="0" y1="40" x2="100" y2="40"/>
          </g>
        </svg>
      </div>
      <img class="hero-compass" src="/assets/compass_rose.svg?v=3.010.300" width="180" height="180" alt="" aria-hidden="true" decoding="async"/>
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake.png?v=3.010.300" width="560" height="144" alt="In the Wake" decoding="async"/>
        <div class="tagline">A Cruise Traveler's Logbook</div>
      </div>
      <div class="hero-credit">
        <a class="pill long" href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">Photo © Flickers of Majesty</a>
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="wrap stateroom-check-container" id="main-content" role="main" tabindex="-1">

    <!-- Introduction -->
    <section class="intro-section">
      <h1>Stateroom Sanity Check</h1>
      <p class="tagline">Gentle guidance for your cabin choice—know before you sail.</p>
      <p>Enter your cabin number below and we'll help you understand what makes your stateroom special. Most rooms are wonderful choices—and if there's anything to know, we'll share it gently.</p>
    </section>

    <!-- Check Form -->
    <section class="check-form" aria-labelledby="form-heading">
      <h2 id="form-heading" class="sr-only">Check Your Stateroom</h2>

      <form id="stateroom-form" novalidate>
        <div class="form-group">
          <label for="ship-select">Select Your Ship</label>
          <select id="ship-select" name="ship" required>
            <option value="">Choose a ship...</option>
            <option value="radiance-of-the-seas" selected>Radiance of the Seas</option>
            <!-- More ships will be added as data becomes available -->
          </select>
          <p class="help-text">Currently supporting Radiance of the Seas. More ships coming soon!</p>
        </div>

        <div class="form-group">
          <label for="cabin-input">Your Cabin Number</label>
          <input
            type="text"
            id="cabin-input"
            name="cabin"
            placeholder="e.g., 8234"
            pattern="[0-9]+"
            required
            aria-describedby="cabin-help"
          />
          <p id="cabin-help" class="help-text">Enter your cabin number (numbers only)</p>
        </div>

        <div class="form-group">
          <label for="traveler-select">I'm Traveling As...</label>
          <select id="traveler-select" name="traveler_type" required>
            <option value="couple" selected>Traveling as a Couple</option>
            <option value="solo">Traveling Solo</option>
            <option value="family">Family With Kids</option>
            <option value="light-sleeper">Light Sleeper</option>
            <option value="motion-sensitive">Prone to Motion Sickness</option>
          </select>
          <p class="help-text">This helps us tailor the guidance to your needs</p>
        </div>

        <button type="submit" class="submit-btn" id="submit-btn">
          Check My Stateroom
        </button>
      </form>
    </section>

    <!-- Results Container -->
    <div id="results-container" class="results-container" role="region" aria-label="Stateroom check results">
      <!-- Results will be injected here by JavaScript -->
    </div>

  </main>

  <!-- FOOTER -->
  <footer class="wrap" role="contentinfo">
    <p>© 2025 In the Wake. All rights reserved.</p>

    <nav aria-label="Footer navigation">
      <p class="tiny">
        <a href="/terms.html">Terms</a> |
        <a href="/privacy.html">Privacy</a> |
        <a href="/accessibility.html">Accessibility Statement</a>
      </p>
    </nav>

    <p class="tiny center">
      Soli Deo Gloria — Every pixel and part of this project is offered as worship to God,
      in gratitude for the beautiful things He has created for us to enjoy. ✝️
    </p>
  </footer>

  <!-- JAVASCRIPT -->

  <!-- Stateroom Check Engine -->
  <script src="/assets/js/stateroom-check.js?v=1.000.alpha"></script>

  <!-- Dropdown Navigation -->
  <script>
  (function(){"use strict";
    /* ===== Dropdown Menu with 300ms Hover Delay ===== */
    const dropdownGroups = Array.from(document.querySelectorAll('.nav-group'));
    if (dropdownGroups.length) {
      const hoverTimeouts = new Map();
      const HOVER_DELAY = 300;

      function setOpen(group, isOpen) {
        group.dataset.open = isOpen ? "true" : "false";
        const button = group.querySelector('.nav-disclosure');
        if (button) {
          button.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        }
      }

      function closeAll(except = null) {
        dropdownGroups.forEach(group => {
          if (group !== except) {
            setOpen(group, false);
            if (hoverTimeouts.has(group)) {
              clearTimeout(hoverTimeouts.get(group));
              hoverTimeouts.delete(group);
            }
          }
        });
      }

      dropdownGroups.forEach(group => {
        const button = group.querySelector('.nav-disclosure');
        const menu = group.querySelector('.submenu');
        if (!button || !menu) return;

        button.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          const isOpen = group.dataset.open === "true";
          closeAll(group);
          setOpen(group, !isOpen);
        });

        group.addEventListener('mouseenter', () => {
          if (hoverTimeouts.has(group)) {
            clearTimeout(hoverTimeouts.get(group));
            hoverTimeouts.delete(group);
          }
          closeAll(group);
          setOpen(group, true);
        });

        group.addEventListener('mouseleave', () => {
          const timeoutId = setTimeout(() => {
            setOpen(group, false);
            hoverTimeouts.delete(group);
          }, HOVER_DELAY);
          hoverTimeouts.set(group, timeoutId);
        });

        group.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            setOpen(group, false);
            button && button.focus();
          }
          if ((e.key === 'ArrowDown' || e.key === 'ArrowUp') && document.activeElement === button) {
            e.preventDefault();
            setOpen(group, true);
            const firstLink = menu.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
            firstLink && firstLink.focus();
          }
        });

        menu.addEventListener('focusout', () => {
          setTimeout(() => {
            if (!group.contains(document.activeElement)) {
              setOpen(group, false);
            }
          }, 0);
        });
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.nav-group')) {
          closeAll();
        }
      });

      window.addEventListener('blur', () => {
        closeAll();
      });
    }
  })();
  </script>

  <!-- Form Handler -->
  <script>
  (function() {
    'use strict';

    const form = document.getElementById('stateroom-form');
    const submitBtn = document.getElementById('submit-btn');
    const resultsContainer = document.getElementById('results-container');
    const a11yStatus = document.getElementById('a11y-status');

    if (!form || !window.StateroomCheck) {
      console.error('Stateroom Check: Required elements not found');
      return;
    }

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      // Get form values
      const shipSlug = document.getElementById('ship-select').value;
      const cabinNum = document.getElementById('cabin-input').value.trim();
      const travelerType = document.getElementById('traveler-select').value;

      // Validate
      if (!shipSlug || !cabinNum) {
        resultsContainer.innerHTML = `
          <div class="error-message" role="alert">
            <p>⚠️ Please select a ship and enter a cabin number.</p>
          </div>
        `;
        return;
      }

      // Show loading
      submitBtn.disabled = true;
      submitBtn.textContent = 'Checking...';
      resultsContainer.innerHTML = '<div class="loading-message">Checking your stateroom...</div>';

      // Announce to screen readers
      if (a11yStatus) {
        a11yStatus.textContent = 'Checking stateroom, please wait';
      }

      try {
        // Perform check
        const result = await window.StateroomCheck.check(shipSlug, cabinNum, travelerType);

        // Render result
        window.StateroomCheck.render(result, resultsContainer);

        // Announce result
        if (a11yStatus && result.success) {
          a11yStatus.textContent = `Result ready: ${result.verdict.title}`;
        }

      } catch (error) {
        console.error('Stateroom check error:', error);
        resultsContainer.innerHTML = `
          <div class="error-message" role="alert">
            <p>⚠️ Something went wrong. Please try again.</p>
          </div>
        `;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Check My Stateroom';
      }
    });

    // Auto-focus cabin input on page load
    setTimeout(() => {
      document.getElementById('cabin-input')?.focus();
    }, 100);

  })();
  </script>

</body>
</html>
