<!doctype html>
<html lang="en">
<head>
  <!--
    In the Wake — Invocation Edition v3.006b
    “Soli Deo Gloria.” 1 Cor 10:31 · Prov 3:5–6
    Authorship: abondservant (a bondservant of Christ)
    Timestamp: 2025-10-10T00:00:00Z
  -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Restaurants & Menus | In the Wake (v3.006b)</title>
  <meta name="version" content="v3.006b"/>
  <meta name="description"
        content="Premium and complimentary dining across the fleet — menus, prices, and accessibility notes."/>
  <link rel="canonical" href="https://www.cruisinginthewake.com/restaurants.html"/>
  <meta name="robots" content="index,follow"/>
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Restaurants & Menus | In the Wake"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/restaurants.html"/>
  <meta property="og:image"
        content="https://www.cruisinginthewake.com/assets/social/restaurants-hero.jpg?v=3.006"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <script defer src="https://cloud.umami.is/script.js"
          data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>
  <script src="/assets/js/site-cache.js" defer></script>
  <script>
  if('serviceWorker' in navigator){
    addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));
  }
  </script>
  <link rel="stylesheet" href="/assets/styles.css?v=3.006"/>
  <link rel="preload" as="image" href="/assets/compass_rose.svg"/>
</head>

<body class="restaurants-page">
  <a class="skip-link" href="#content">Skip to main content</a>

  <!-- ====== HEADER + NAV identical to working pages ====== -->
  <header class="hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="/assets/logo_wake.png" alt="In the Wake wordmark" width="256" height="64"/>
        <span class="tiny ver-badge">v3.006b</span>
      </div>
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/ships/">Ships</a>
        <a href="/restaurants.html" aria-current="page">Restaurants & Menus</a>
        <a href="/ports.html">Ports</a>
        <a href="/disability-at-sea.html">Disability at Sea</a>
        <a href="/drink-packages.html">Drink Packages</a>
        <a href="/packing-lists.html">Packing Lists</a>
        <a href="/planning.html">Planning</a>
      </nav>
    </div>
    <div class="hero" role="img" aria-label="Dining venues across the fleet">
      <img class="hero-compass" src="/assets/compass_rose.svg" alt="" aria-hidden="true"/>
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake.png" alt="In the Wake" width="256" height="64"/>
        <div class="tagline">A Cruise Traveler’s Logbook</div>
      </div>
    </div>
  </header>

  <main id="content" class="wrap">
    <div id="search-meta" class="tiny" aria-live="polite">Loading venues…</div>
    <section class="section" id="complimentary"><h2>Main Dining & Complimentary</h2><div class="grid" id="grid-complimentary"></div></section>
    <section class="section" id="premium"><h2>Specialty Dining</h2><div class="grid" id="grid-premium"></div></section>
    <section class="section" id="activity"><h2>Dining Activities & Classes</h2><div class="grid" id="grid-activity"></div></section>
  </main>

  <footer class="wrap" role="contentinfo">
    © 2025 In the Wake — A Cruise Traveler’s Logbook · <a href="/accessibility.html">Accessibility & WCAG 2.1 AA Commitment</a>
  </footer>

  <!-- ====== FIXED RENDERER ====== -->
  <script>
  (async()=>{
    const setStatus=m=>{const e=document.getElementById('search-meta');if(e)e.textContent=m;};
    const abs=p=>typeof window._abs==='function'?_abs(p):p;
    const roots={
      complimentary:document.getElementById('grid-complimentary'),
      premium:document.getElementById('grid-premium'),
      activity:document.getElementById('grid-activity')
    };

    // 1. Guarantee SiteCache loaded
    if(!window.SiteCache||typeof SiteCache.getJSON!=='function'){
      await new Promise(r=>{
        const s=document.createElement('script');
        s.src='/assets/js/site-cache.js';s.defer=true;
        s.onload=r;s.onerror=r;document.head.appendChild(s);
      });
    }

    // 2. Load venues.json
    let db;
    try{
      const url=abs('/assets/data/venues.json');
      db=await SiteCache.getJSON(url,{ttlDays:7,versionPath:['meta','version']});
      if(!db||!Array.isArray(db.venues)||typeof db.ships!=='object')throw new Error('Invalid schema');
    }catch(e){
      console.error('Failed to load venues.json',e);
      setStatus('Could not load venues data.');
      return;
    }

    // 3. Map ships → venues
    const shipsByVenue=new Map();
    for(const [ship,payload] of Object.entries(db.ships)){
      (payload.venues||[]).forEach(v=>{
        if(!shipsByVenue.has(v))shipsByVenue.set(v,new Set());
        shipsByVenue.get(v).add(ship);
      });
    }

    // 4. Render
    const buckets={complimentary:[],premium:[],activity:[]};
    const uniq=a=>Array.from(new Set(a.filter(Boolean)));
    const sortByName=(a,b)=>(a.name||a.slug||'').localeCompare(b.name||b.slug||'');
    db.venues.sort(sortByName).forEach(v=>{
      const cat=(v.category||'complimentary').toLowerCase();
      const slug=v.slug; const ships=uniq(Array.from(shipsByVenue.get(slug)||[]));
      const shipHTML=ships.map(s=>`<span class="chip">${db.ships[s]?.name||s}</span>`).join('');
      buckets[cat]?.push(`<div class="card">
        <a href="/restaurants/${slug}.html"><strong>${v.name}</strong><br><small>${v.category==='premium'?'Specialty Dining':'Complimentary Venue'}</small></a>
        <div class="ship-pills">${shipHTML}</div></div>`);
    });

    for(const [cat,list] of Object.entries(buckets)){
      const root=roots[cat];if(root&&list.length){root.innerHTML=list.join('');}
    }
    setStatus('Showing all venues & activities.');
  })();
  </script>

  <!--
    Invocation Edition Footer Note:
    “Whatever you do, do all to the glory of God.” — 1 Cor 10:31 · 
    “Trust in the LORD with all your heart … He will make straight your paths.” — Prov 3:5–6 
    Signed: abondservant · Soli Deo Gloria.
  -->
</body>
</html>
