<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="version" content="v=.9.001.001"/>
  <title>Royal Caribbean Drink Package Calculator | In the Wake</title>
  <meta name="description" content="Break-even calculator for Royal Caribbean drink packages with gratuity, Crown & Anchor vouchers, sea/port weighting, chart, and printable results."/>
  <link rel="canonical" href="https://cruisinginthewake.com/drink-calculator.html"/>

  <!-- Open Graph -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Royal Caribbean Drink Package Calculator"/>
  <meta property="og:description" content="See if Soda, Refreshment, or Deluxe beats √†-la-carte for your cruise ‚Äî with vouchers & gratuity included."/>
  <meta property="og:url" content="https://cruisinginthewake.com/drink-calculator.html"/>
  <meta property="og:image" content="https://cruisinginthewake.com/assets/social/drink-calculator-2025.jpg"/>

  <!-- Structured data -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://cruisinginthewake.com/"},
    {"@type":"ListItem","position":2,"name":"Drink Package Calculator","item":"https://cruisinginthewake.com/drink-calculator.html"}
  ]}</script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[
    {"@type":"Question","name":"Is the drink package worth it?","acceptedAnswer":{"@type":"Answer","text":"Often if you average ~5‚Äì6 alcoholic drinks per day. Use the calculator to compare with gratuity included."}},
    {"@type":"Question","name":"Does the package include gratuity?","acceptedAnswer":{"@type":"Answer","text":"Yes. Package prices include the 18% service charge; √†-la-carte adds 18% at purchase."}},
    {"@type":"Question","name":"How do I use a sale price?","acceptedAnswer":{"@type":"Answer","text":"Click ‚ÄúEdit price‚Ä¶‚Äù on a package and enter your Cruise Planner rate; results update instantly."}}
  ]}</script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"Royal Caribbean Drink Package Calculator","applicationCategory":"Utilities","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
  </script>

  <!-- PWA (optional but harmless if already present) -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0a3d62">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">

  <!-- Chart.js (visual only; core math is in app.js/worker) -->
  <script src="/assets/js/vendor/chart.umd.min.js?v=.9.001.001" defer></script>

  <!-- Math + worker: preload and expose compute BEFORE app boot so voucher wrapper can decorate -->
  <link rel="modulepreload" href="/assets/js/drink-math.js?v=.9.001.001">
  <link rel="preload" href="/assets/js/drink-worker.js?v=.9.001.001" as="worker"/>

  <style>
    :root{
      /* Site tokens */
      --sea:#0a3d62; --foam:#e6f4f8; --rope:#d9b382; --ink:#083041; --sky:#f7fdff; --accent:#0e6e8e;
      --shadow:0 2px 6px rgba(8,48,65,.08); --shadow-lg:0 10px 28px rgba(8,48,65,.14);
      --rail:320px;
      /* Calc tokens */
      --bg:#f8fbfc; --card:#fff; --bd:#e5e7eb; --muted:#586274; --good:#10b981; --warn:#f59e0b; --bad:#ef4444;
      --radius:12px;
    }
    *{box-sizing:border-box}
    html{scrollbar-gutter:stable both-edges}
    body{margin:0;background:var(--sky);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    img{max-width:100%;height:auto;display:block}
    .sr-only{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}
    .wrap{max-width:1100px;margin:0 auto;padding:20px 14px 36px}
    .card{background:var(--card);border:2px solid var(--rope);border-radius:var(--radius);padding:1rem;margin:.8rem 0;box-shadow:var(--shadow)}
    .tiny{font-size:.88rem;color:#456} .small{font-size:.9rem;color:#475569} .muted{color:var(--muted)}

    /* Header / hero (Planning/Index shell) */
    .hero-header{position:relative;border-bottom:6px double var(--rope);background:#eaf6f6}
    .navbar{max-width:1100px;margin:0 auto;display:flex;gap:.6rem;padding:.35rem .9rem .75rem;align-items:center;min-height:56px;background:#eaf6f6}
    .brand{display:flex;align-items:center;gap:.6rem}
    .brand img{height:40px;width:auto}
    .version-badge{font-size:.72rem;opacity:.8;margin-left:.35rem}
    .itw-nav{display:flex;gap:.5rem;flex:1 1 auto;align-items:center;justify-content:center;white-space:nowrap;padding-inline:.75rem}
    .itw-nav .nav-item{position:relative}
    .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.35rem .7rem;border-radius:10px;background:#fff;border:1px solid var(--rope);font-size:.95rem}
    .itw-nav .chip[aria-current="page"]{outline:3px dashed var(--rope);outline-offset:2px;box-shadow:0 0 0 3px rgba(200,163,106,.15) inset}
    .menu{position:absolute;left:0;top:100%;transform:translateY(.35rem);min-width:240px;max-width:min(90vw,360px);background:#fff;border:1px solid var(--rope);border-radius:12px;box-shadow:var(--shadow-lg);padding:.6rem;display:none;opacity:0;pointer-events:none;z-index:100;transition:opacity .18s ease}
    .nav-item.open>.menu{display:block;opacity:1;pointer-events:auto}
    .menu .label{font-weight:600;color:#234;margin:.15rem .2rem .35rem;font-size:.9rem}
    .menu a{display:block;padding:.45rem .6rem;border-radius:.6rem;color:var(--ink)}
    .menu a:hover{background:#f2f7fa;text-decoration:none}
    .hero{position:relative;width:100%;min-height:clamp(200px,24vw,340px);background:url('/assets/index_hero.jpg?v=.9.001.001') center 38%/cover no-repeat;display:flex;align-items:flex-end;overflow:hidden;margin-top:.15rem}
    .hero-title{position:absolute;left:min(3vw,1rem);bottom:clamp(.6rem,2vw,1.4rem);display:flex;flex-direction:column;gap:.35rem;text-shadow:0 2px 6px rgba(0,0,0,.45)}
    .hero-title .logo{width:clamp(189px,23.1vw,378px);max-width:min(90vw,520px);filter:drop-shadow(0 3px 8px rgba(0,0,0,.45))}
    .tagline{font-weight:700;letter-spacing:.2px;color:#e6f4f8;font-size:clamp(.9rem,1.5vw,1.35rem);white-space:nowrap}
    .hero-compass{position:absolute;right:min(3vw,1rem);top:.5rem;width:86px;opacity:.95;filter:invert(39%) sepia(9%) saturate(1063%) hue-rotate(151deg) brightness(92%) contrast(89%)}
    .hero-credit{position:absolute;right:.85rem;bottom:.85rem}
    .pill{display:inline-block;padding:.25rem .6rem;border:1px solid var(--rope);border-radius:999px;background:#fff;line-height:1.1}

    /* Layout */
    .page-grid{display:grid;grid-template-columns:minmax(0,1.6fr) minmax(260px,var(--rail));gap:2rem;align-items:start}
    @media (max-width:980px){.page-grid{grid-template-columns:1fr}}

    /* Right rail */
    .rail-list{display:grid;gap:1rem}
    .rail-item{display:grid;grid-template-columns:64px 1fr;gap:.75rem;align-items:center;text-decoration:none}
    .rail-item .thumb{width:64px;height:64px;border-radius:10px;overflow:hidden;background:#eef4f6;border:1px solid #dfe7ea}
    .rail-item .thumb img{width:100%;height:100%;object-fit:cover}
    .author-card{display:flex;gap:.75rem;align-items:center}
    .author-avatar{width:48px;height:48px;border-radius:12px;object-fit:cover;object-position:center}

    /* Calculator UI */
    .banner{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap;background:#ecfeff;border:1px solid #bae6fd;border-radius:var(--radius);padding:.6rem .8rem;margin:12px 0}
    .chip.mini{font-size:.8rem;padding:.15rem .5rem;border-radius:999px;border:1px solid var(--rope);background:#fff}
    .inputs .row{display:grid;grid-template-columns:1fr 140px;align-items:center;padding:10px 0;border-bottom:1px dashed var(--bd);gap:10px}
    .inputs .row:last-child{border-bottom:0}
    .inputs input[type="text"], .inputs input[type="number"], .inputs select{width:110px;padding:8px;border:1px solid var(--bd);border-radius:8px;font:inherit;min-height:44px}
    .input-stepper{display:flex;align-items:center;justify-content:flex-end;gap:4px}
    .btn-step{all:unset;cursor:pointer;background:#f1f5f9;border:1px solid var(--bd);color:#111;width:38px;height:38px;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;font-weight:800}
    .controls-inline{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{cursor:pointer;padding:8px 12px;border:1px solid var(--bd);border-radius:8px;background:#0f172a;color:#fff;font-weight:700;min-height:44px;font-size:1rem}
    .btn.ghost{background:#fff;color:#0f172a}
    .qs{background:#fde68a20;border:1px solid #f59e0b50;border-radius:12px;padding:14px 16px;margin:16px 0}
    .qs-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px}
    .qs-pill{all:unset;cursor:pointer;padding:6px 12px;border-radius:8px;border:2px solid var(--bd);font-weight:700;font-size:.9rem;background:var(--card);text-align:center}
    .qs-pill[aria-pressed="true"]{border-color:var(--accent);background:var(--foam)}
    .health{display:none;background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;border-radius:10px;padding:10px 14px;margin:12px 0}
    .health.show{display:block}

    /* Packages section ‚Äî light tiles (keep site scheme) */
    .packages{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-top:18px}
    .pkg.card{border-color:var(--rope);background:#fff;color:var(--ink);position:relative;overflow:hidden}
    .pkg .phd{background:#eef4f6;color:#0a2940;padding:12px 14px;font-weight:800;display:flex;justify-content:space-between;align-items:center}
    .pkg.winner{outline:3px solid #34d399;box-shadow:0 0 0 6px rgba(52,211,153,.15)}
    .pkg.winner .phd{background:linear-gradient(135deg,#059669 0%,#10b981 100%);color:#fff}
    .breakeven-monitor{background:#f8fafc;border:1px dashed var(--bd);border-radius:8px;padding:8px 10px}
    .tooltip{position:relative}
    .tooltip [role="tooltip"]{position:absolute;inset:auto auto 100% 0;transform:translateY(-8px);background:#0f172a;color:#fff;padding:8px 10px;border-radius:8px;min-width:220px;box-shadow:0 6px 18px rgba(0,0,0,.2);font-size:.9rem;display:none;z-index:100}
    .tooltip:focus-within [role="tooltip"], .tooltip:hover [role="tooltip"]{display:block}

    /* Chart wrapper: fixed height guard */
    #breakeven-wrap{margin-top:18px;position:relative;overflow:hidden}
    #breakeven-chart{inline-size:100%;block-size:280px;border:1px dashed var(--bd);border-radius:10px;background:#fff;display:block}

    /* Info drawer mini */
    #info-btn{position:fixed;right:12px;bottom:12px;z-index:20;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#e0f2fe;border:1px solid #38bdf8;color:#075985;font-weight:800}
    #info-drawer{position:fixed;right:12px;bottom:58px;min-width:260px;max-width:min(90vw,320px);background:#fff;border:1px solid var(--rope);border-radius:12px;padding:10px 12px;box-shadow:var(--shadow-lg);display:none}
    #info-drawer.open{display:block}

    /* Email form + Planning Pass */
    #email-signup-form input[type="email"]{flex:1;min-width:0;padding:8px;border-radius:8px;border:1px solid var(--bd);font-size:16px;min-height:44px}
    .gdpr-consent{display:flex;align-items:flex-start;gap:.5rem;font-size:.9rem;line-height:1.5;margin-top:.75rem}

    /* Print */
    @media print{
      body{font-size:12pt;background:#fff}
      header.hero-header,.qs,.banner,.rail,#info-btn,#info-drawer,.controls-inline .btn,footer{display:none}
      main.wrap{max-width:100%;margin:0;padding:0}
      .page-grid,.packages{grid-template-columns:1fr}
      .card{border:none;box-shadow:none;page-break-inside:avoid}
      .pkg.card{background:#fff!important;color:#111!important;border:2px solid #ccc!important}
      .pkg .phd{background:#eee!important;color:#111!important}
    }
    @media (max-width:980px){
      .inputs .row{grid-template-columns:1fr 120px}
    }
  </style>

  <!-- Expose compute early so vouchers can decorate -->
  <script type="module">
    import { compute as baseCompute } from "/assets/js/drink-math.js?v=.9.001.001";
    // Decorate to apply C&A vouchers against √†-la-carte ONLY (non-alc for minors)
    function voucherWrappedCompute(inputs, prices){
      try{
        const res = baseCompute(inputs, prices);
        const v = (window.ITW_VOUCHERS||{});
        if(!v.enabled || !res?.perDay) return res;

        const adults = inputs?.adults|0, minors = inputs?.minors|0;
        const adultCred = (v.adult||0), minorCred = (v.minor||0);
        const days = inputs?.days|0;
        if(!days) return res;

        // credit only reduces ALC (not packages)
        const dailyAdultCred = Math.max(0, adultCred) * Math.max(0, adults);
        const dailyMinorCred = Math.max(0, minorCred) * Math.max(0, minors);
        const totalDailyCred = dailyAdultCred + dailyMinorCred;

        // apply up to ala carte daily spend
        const alc = res.perDay.alc;
        const newAlc = Math.max(0, alc - totalDailyCred);
        res.perDay.alc = newAlc;
        res.total.alc = newAlc * days;

        // show chip
        const chip = document.getElementById('voucher-badge');
        if (chip){
          chip.hidden = false;
          chip.textContent = `C&A vouchers: ‚àí$${(totalDailyCred).toFixed(2)}/day`;
        }
        return res;
      }catch(e){
        console.warn('Voucher wrapper failed; falling back', e);
        return baseCompute(inputs, prices);
      }
    }
    window.ITW_MATH = { compute: voucherWrappedCompute };
  </script>

  <!-- App (keeps original logic and UI bindings) -->
  <script src="/assets/js/drink-calculator.app.js?v=.9.001.001" defer></script>
</head>

<body>
  <a href="#content" class="sr-only">Skip to main content</a>

  <header class="hero-header" role="banner" style="padding-top:.15rem">
    <div class="navbar">
      <div class="brand">
        <img src="/assets/logo_wake.png" width="256" height="64" alt="In the Wake wordmark">
        <span class="tiny version-badge" id="app-version-header">v=.9.001.001</span>
      </div>
      <nav class="itw-nav" aria-label="Primary">
        <div class="nav-item"><a class="chip" href="/">Home</a></div>
        <div class="nav-item" aria-haspopup="menu">
          <button class="chip" type="button" aria-expanded="false" aria-controls="menu-planning">Planning ‚ñæ</button>
          <div id="menu-planning" class="menu" aria-label="Planning">
            <div class="label">Plan your cruise</div>
            <a href="/planning.html">Planning (overview)</a>
            <a href="/ships.html">Ships</a>
            <a href="/restaurants.html">Restaurants &amp; Menus</a>
            <a href="/ports.html">Ports</a>
            <a href="/drink-calculator.html" aria-current="page">Drink Packages</a>
            <a href="/packing-lists.html">Packing Lists</a>
            <a href="/accessibility.html">Accessibility</a>
          </div>
        </div>
        <div class="nav-item" aria-haspopup="menu">
          <button class="chip" type="button" aria-expanded="false" aria-controls="menu-travel">Travel ‚ñæ</button>
          <div id="menu-travel" class="menu" aria-label="Travel">
            <div class="label">Trips & tips</div>
            <a href="/travel.html">Travel (overview)</a>
            <a href="/solo.html">Solo</a>
          </div>
        </div>
        <div class="nav-item"><a class="chip" href="/about-us.html">About</a></div>
      </nav>
    </div>
    <div class="hero" role="img" aria-label="Ship wake at sunrise">
      <img class="hero-compass" src="/assets/compass.svg" alt="" aria-hidden="true">
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake.png" alt="In the Wake">
        <div class="tagline">A Cruise Traveler‚Äôs Logbook</div>
      </div>
      <div class="hero-credit tiny" style="color:#e6f4f8;opacity:.9">Photo ¬© Flickers of Majesty</div>
    </div>
  </header>

  <main class="wrap page-grid" id="content">
    <section aria-label="Calculator">
      <!-- health banners -->
      <p id="fallback-banner" class="health" role="status" hidden>‚ö†Ô∏è We couldn't load live prices; using defaults.</p>
      <p id="stale-data-banner" class="health" role="status" style="display:none;background:#fef3c7;border-color:#fde68a;color:#92400e;"></p>

      <!-- Quick Start Personas -->
      <section class="qs" aria-labelledby="qs-title">
        <h2 id="qs-title" class="qs-hd" style="margin:0 0 4px 0;color:#7c2d12">üöÄ Quick Start: Load a Persona</h2>
        <p class="small" style="margin-bottom:1rem">Tap a preset to preview. ‚ÄúLoad as Average‚Äù fills Simple mode; ‚ÄúLoad Itinerary‚Äù fills Day-by-Day.</p>
        <div class="qs-grid" id="qs-preset-buttons" role="list"></div>
        <div id="qs-details-host" style="margin-top:12px"></div>
      </section>

      <!-- Best value banner -->
      <div class="banner" role="status" aria-live="polite">
        <span id="best-chip" class="chip">Best value: √†-la-carte</span>
        <span id="best-text">Your daily picks are cheapest without a package.</span>
        <button id="jump-winner" class="btn ghost" type="button">Jump to Best Value</button>
      </div>

      <p id="health-note" class="health" role="status" aria-live="assertive"></p>

      <!-- Inputs -->
      <section class="card inputs" aria-labelledby="calc-title">
        <h2 id="calc-title" class="hd" style="margin-top:0">
          <span id="totals">Calculating...</span>
          <small class="small">‚Äì includes 18% gratuity</small>
          <div id="range-note" class="small" style="margin-top:6px;font-weight:700"></div>
        </h2>
        <div class="bd">
          <div class="controls-inline" style="margin-top:8px;align-items:center">
            <label class="small" for="currency-select" style="font-weight:800">Display currency</label>
            <select id="currency-select" aria-label="Display currency" class="small" style="font-weight:700;padding:4px 6px;border:1px solid var(--bd);border-radius:8px">
              <option value="USD">USD $</option><option value="GBP">GBP ¬£</option><option value="EUR">EUR ‚Ç¨</option><option value="CAD">CAD $</option><option value="AUD">AUD $</option>
            </select>
            <span id="offline-chip" class="chip" style="display:none;background:#fde68a;color:#7c2d12;border:1px solid #f59e0b;padding:2px 6px;font-size:.8rem">Offline rates</span>
          </div>
          <span id="currency-note" class="small" style="font-weight:600;display:block;margin-top:6px"></span>
          <hr style="border:0;border-top:1px dashed var(--bd);margin:12px 0">

          <div class="row"><label for="input-days">Cruise days</label><input id="input-days" type="text" inputmode="numeric" value="7" data-input="days" aria-label="Cruise length in days"></div>

          <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:8px" id="sea-port-fieldset">
            <legend style="font-weight:800;padding:0 6px">Sea/Port variability</legend>
            <div class="row"><label for="input-seadays">Number of sea days</label><input id="input-seadays" type="text" inputmode="numeric" value="3" data-input="seadays" aria-label="Number of sea days"></div>
            <div class="row" style="grid-template-columns:1fr 1fr">
              <label><input type="checkbox" id="sea-toggle" checked data-input="seaapply"> Apply weighting</label>
              <div class="controls-inline">
                <label for="sea-weight" class="small">Weight ¬±%</label>
                <input id="sea-weight" type="range" min="0" max="40" value="20" data-input="seaweight" aria-label="Sea day weighting percent">
                <span id="sea-weight-val" class="small">20%</span>
              </div>
            </div>
          </fieldset>

          <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:12px">
            <legend style="font-weight:800;padding:0 6px">Group in stateroom</legend>
            <div class="row"><label for="input-adults">Adults (21+)</label><input id="input-adults" type="text" inputmode="numeric" value="1" data-input="adults" aria-label="Number of adults"></div>
            <div class="row"><label for="input-minors">Minors (under 21)</label><input id="input-minors" type="text" inputmode="numeric" value="0" data-input="minors" aria-label="Number of minors"></div>
          </fieldset>

          <!-- C&A Vouchers -->
          <details id="vouchers" class="small" style="margin-top:12px;border:2px solid var(--rope);border-radius:8px;background:var(--foam)">
            <summary id="cna-title" style="cursor:pointer;font-weight:700;padding:1rem 1.25rem;list-style:none">
              üéñÔ∏è <strong>Diamond or higher?</strong> Click here to apply your daily free-drink vouchers
              <div class="tiny muted" style="font-weight:400;margin-top:4px">For Crown & Anchor members. Minors‚Äô vouchers apply to non-alcoholic drinks only.</div>
            </summary>
            <div class="cna-content" style="padding:0 1.25rem 1.25rem">
              <div class="small" style="margin:10px 0;background:#fff3cd;border-left:4px solid #f59e0b;padding:.75rem 1rem;border-radius:4px">
                <p><strong>Eligibility guide:</strong> Diamond ‚âà <strong>80 nights</strong>, Diamond Plus ‚âà <strong>175</strong>, Pinnacle ‚âà <strong>700</strong>.</p>
                <p>Per person per day ¬∑ Diamond 4 ¬∑ Diamond+ 5 ¬∑ Pinnacle 5.</p>
              </div>
              <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px">
                <legend style="font-weight:800;padding:0 6px">Adult Vouchers</legend>
                <div class="row"><label for="v-adult-d">Adults with Diamond (4)</label><input id="v-adult-d" type="text" inputmode="numeric" value="0" data-voucher="adult-d"></div>
                <div class="row"><label for="v-adult-dp">Adults with Diamond+ (5)</label><input id="v-adult-dp" type="text" inputmode="numeric" value="0" data-voucher="adult-dp"></div>
                <div class="row"><label for="v-adult-p">Adults with Pinnacle (5)</label><input id="v-adult-p" type="text" inputmode="numeric" value="0" data-voucher="adult-p"></div>
              </fieldset>
              <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:12px">
                <legend style="font-weight:800;padding:0 6px">Minor Vouchers (Non-Alc Only)</legend>
                <div class="row"><label for="v-minor-d">Minors with Diamond (4)</label><input id="v-minor-d" type="text" inputmode="numeric" value="0" data-voucher="minor-d"></div>
                <div class="row"><label for="v-minor-dp">Minors with Diamond+ (5)</label><input id="v-minor-dp" type="text" inputmode="numeric" value="0" data-voucher="minor-dp"></div>
                <div class="row"><label for="v-minor-p">Minors with Pinnacle (5)</label><input id="v-minor-p" type="text" inputmode="numeric" value="0" data-voucher="minor-p"></div>
              </fieldset>
            </div>
          </details>
          <div id="cna-nudge" class="health" style="display:none;background:#e0f2fe;border-color:#0ea5e9;color:#0c4a6e;cursor:pointer">
            üéñÔ∏è Are you Diamond or higher? Click to apply your free daily drinks.
          </div>

          <!-- Modes -->
          <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:12px">
            <legend style="font-weight:800;padding:0 6px">Calculation Mode</legend>
            <div class="controls-inline">
              <label class="small"><input type="radio" name="calc-mode" id="mode-simple" value="simple" checked> Use Daily Averages</label>
              <label class="small"><input type="radio" name="calc-mode" id="mode-itinerary" value="itinerary"> Plan Day-by-Day</label>
            </div>
          </fieldset>

          <!-- Simple inputs (steppers) -->
          <div id="simple-inputs">
            <!-- non-alc -->
            <div class="inputs row row--stepper" data-simple-input><label for="input-soda">Avg. Soda/day <small class="pill" data-price-pill="soda"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('soda',-1)">‚àí</button><input id="input-soda" type="text" inputmode="decimal" value="0" data-input="soda" aria-label="Soda per day"><button class="btn-step" type="button" onclick="stepInput('soda',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-coffee">Premium coffee/day <small class="pill" data-price-pill="coffee"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('coffee',-1)">‚àí</button><input id="input-coffee" type="text" inputmode="decimal" value="0" data-input="coffee"><button class="btn-step" type="button" onclick="stepInput('coffee',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-teaprem">Specialty tea/day <small class="pill" data-price-pill="teaprem"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('teaprem',-1)">‚àí</button><input id="input-teaprem" type="text" inputmode="decimal" value="0" data-input="teaprem"><button class="btn-step" type="button" onclick="stepInput('teaprem',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-freshjuice">Fresh juice/smoothie/day <small class="pill" data-price-pill="freshjuice"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('freshjuice',-1)">‚àí</button><input id="input-freshjuice" type="text" inputmode="decimal" value="0" data-input="freshjuice"><button class="btn-step" type="button" onclick="stepInput('freshjuice',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-mocktail">Mocktail/day <small class="pill" data-price-pill="mocktail"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('mocktail',-1)">‚àí</button><input id="input-mocktail" type="text" inputmode="decimal" value="0" data-input="mocktail"><button class="btn-step" type="button" onclick="stepInput('mocktail',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-energy">Energy drink/day <small class="pill" data-price-pill="energy"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('energy',-1)">‚àí</button><input id="input-energy" type="text" inputmode="decimal" value="0" data-input="energy"><button class="btn-step" type="button" onclick="stepInput('energy',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-milkshake">Milkshake/day <small class="pill" data-price-pill="milkshake"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('milkshake',-1)">‚àí</button><input id="input-milkshake" type="text" inputmode="decimal" value="0" data-input="milkshake"><button class="btn-step" type="button" onclick="stepInput('milkshake',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-bottledwater">Bottled water/day <small class="pill" data-price-pill="bottledwater"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('bottledwater',-1)">‚àí</button><input id="input-bottledwater" type="text" inputmode="decimal" value="0" data-input="bottledwater"><button class="btn-step" type="button" onclick="stepInput('bottledwater',1)">+</button></div></div>
            <!-- alc -->
            <div class="inputs row row--stepper" data-simple-input><label for="input-beer">Beer/day <small class="pill" data-price-pill="beer"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('beer',-1)">‚àí</button><input id="input-beer" type="text" inputmode="decimal" value="0" data-input="beer"><button class="btn-step" type="button" onclick="stepInput('beer',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-wine">Wine/day <small class="pill" data-price-pill="wine"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('wine',-1)">‚àí</button><input id="input-wine" type="text" inputmode="decimal" value="0" data-input="wine"><button class="btn-step" type="button" onclick="stepInput('wine',1)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-cocktail">Cocktail/day <small class="pill" data-price-pill="cocktail"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('cocktail',-0.5)">‚àí</button><input id="input-cocktail" type="text" inputmode="decimal" value="0" data-input="cocktail"><button class="btn-step" type="button" onclick="stepInput('cocktail',0.5)">+</button></div></div>
            <div class="inputs row row--stepper" data-simple-input><label for="input-spirits">Spirits/shot/day <small class="pill" data-price-pill="spirits"></small></label><div class="input-stepper"><button class="btn-step" type="button" onclick="stepInput('spirits',-1)">‚àí</button><input id="input-spirits" type="text" inputmode="decimal" value="0" data-input="spirits"><button class="btn-step" type="button" onclick="stepInput('spirits',1)">+</button></div></div>
          </div>

          <!-- Itinerary mount -->
          <div id="itinerary-inputs" style="display:none;margin-top:12px"></div>

          <!-- Chart/a11y -->
          <div id="breakeven-wrap">
            <span id="voucher-badge" class="chip mini" aria-live="polite" hidden></span>
            <table id="chart-desc" class="sr-only">
              <caption>Daily cost comparison</caption>
              <thead><tr><th>Package</th><th>Cost per day</th></tr></thead>
              <tbody>
                <tr><td>√Ä-la-carte</td><td id="sr-alc">$0.00</td></tr>
                <tr><td>Soda</td><td id="sr-soda">$0.00</td></tr>
                <tr><td>Refreshment</td><td id="sr-refresh">$0.00</td></tr>
                <tr><td>Deluxe</td><td id="sr-deluxe">$0.00</td></tr>
              </tbody>
            </table>
            <canvas id="breakeven-chart" width="900" height="280" aria-label="Break-even comparison chart" aria-describedby="chart-desc"></canvas>
          </div>

          <!-- Actions -->
          <div class="controls-inline" style="margin-top:12px">
            <button class="btn" type="button" onclick="printResults()">Print / Save Results</button>
            <button class="btn ghost" type="button" onclick="shareScenario()">Share Scenario</button>
            <button class="btn" type="button" onclick="resetInputs()" style="background:var(--bad)">Reset All</button>
          </div>
        </div>
      </section>

      <!-- Packages -->
      <section class="card" id="packages-card">
        <div class="hd" style="position:static">Packages</div>
        <div class="bd">
          <section class="packages" id="packages">
            <!-- tiles populated/updated by app.js on renderAll() -->
            <article class="pkg card" data-card="soda" id="pkg-soda">
              <header class="phd"><span>Classic Soda</span><span class="tooltip"><button class="help btn ghost tiny" aria-describedby="tt-soda" type="button">?</button><span id="tt-soda" role="tooltip">Unlimited fountain soda + Coca-Cola Freestyle. One drink at a time.</span></span></header>
              <div class="pbd">
                <p class="muted"><strong data-pkg-price="soda">$10.99/day</strong> <span class="small" data-pkg-range="soda">range $8.99‚Äì$15</span></p>
                <p class="small">Included value (your picks): <strong data-inc="soda">$0.00/day</strong></p>
                <div class="breakeven-monitor" id="soda-breakeven" aria-live="polite" style="margin-top:10px"></div>
                <div class="controls-inline" style="margin-top:6px">
                  <button class="btn ghost" type="button" onclick="togglePriceEdit('soda')">üìù Edit price‚Ä¶</button>
                  <form class="controls-inline small" id="edit-soda" hidden onsubmit="return false;">
                    <label>$/day</label><input type="number" step="0.01" min="0" value="10.99" id="edit-soda-val" style="width:90px">
                    <button class="btn" type="button" onclick="savePackagePrice('soda')">Save</button>
                    <button class="btn ghost" type="button" onclick="togglePriceEdit('soda',true)">Cancel</button>
                  </form>
                </div>
              </div>
            </article>

            <article class="pkg card" data-card="refresh" id="pkg-refresh">
              <header class="phd"><span>Refreshment</span><span class="tooltip"><button class="help btn ghost tiny" aria-describedby="tt-refresh" type="button">?</button><span id="tt-refresh" role="tooltip">Covers premium coffee/tea, fresh juice, mocktails, energy, milkshakes, bottled water, soda.</span></span></header>
              <div class="pbd">
                <p class="muted"><strong data-pkg-price="refresh">$34.50/day</strong> <span class="small" data-pkg-range="refresh">range $28‚Äì$48</span></p>
                <p class="small">Included value: <strong data-inc="refresh">$0.00/day</strong></p>
                <div class="breakeven-monitor" id="refresh-breakeven" aria-live="polite" style="margin-top:10px"></div>
                <div class="controls-inline" style="margin-top:6px">
                  <button class="btn ghost" type="button" onclick="togglePriceEdit('refresh')">üìù Edit price‚Ä¶</button>
                  <form class="controls-inline small" id="edit-refresh" hidden onsubmit="return false;">
                    <label>$/day</label><input type="number" step="0.01" min="0" value="34.50" id="edit-refresh-val" style="width:90px">
                    <button class="btn" type="button" onclick="savePackagePrice('refresh')">Save</button>
                    <button class="btn ghost" type="button" onclick="togglePriceEdit('refresh',true)">Cancel</button>
                  </form>
                </div>
              </div>
            </article>

            <article class="pkg card" data-card="deluxe" id="pkg-deluxe">
              <header class="phd"><span>Deluxe (Alcoholic)</span><span class="tooltip"><button class="help btn ghost tiny" aria-describedby="tt-deluxe" type="button">?</button><span id="tt-deluxe" role="tooltip">Covers alcoholic drinks up to the price cap + all non-alcoholic items. Over-cap drinks pay the difference.</span></span></header>
              <div class="pbd">
                <p class="muted"><strong data-pkg-price="deluxe">$85.00/day</strong> <span class="small" data-pkg-range="deluxe">range $56‚Äì$115</span></p>
                <div class="breakeven-monitor" id="deluxe-breakeven" aria-live="polite" style="margin-bottom:10px"></div>
                <p class="small">Price cap: <strong id="cap-badge">$14.00</strong> <button class="btn ghost" type="button" onclick="toggleCapEdit()">Edit cap‚Ä¶</button></p>
                <form class="controls-inline small" id="edit-cap" hidden onsubmit="return false;">
                  <label>Cap $</label><input type="number" step="0.01" min="0" value="14.00" id="edit-cap-val" style="width:90px">
                  <button class="btn" type="button" onclick="saveCap()">Save</button>
                  <button class="btn ghost" type="button" onclick="toggleCapEdit(true)">Cancel</button>
                </form>
                <p class="small">Included value: <strong data-inc="deluxe">$0.00/day</strong></p>
                <p class="small">Over-cap add-on (est.): <strong id="overcap-est">$0.00/day</strong></p>
                <p class="save small" data-saves="deluxe" hidden></p>
                <div class="controls-inline" style="margin-top:6px">
                  <button class="btn ghost" type="button" onclick="togglePriceEdit('deluxe')">üìù Edit price‚Ä¶</button>
                  <form class="controls-inline small" id="edit-deluxe" hidden onsubmit="return false;">
                    <label>$/day</label><input type="number" step="0.01" min="0" value="85.00" id="edit-deluxe-val" style="width:90px">
                    <button class="btn" type="button" onclick="savePackagePrice('deluxe')">Save</button>
                    <button class="btn ghost" type="button" onclick="togglePriceEdit('deluxe',true)">Cancel</button>
                  </form>
                </div>
              </div>
            </article>
          </section>
        </div>
      </section>

      <!-- Disclaimer -->
      <section class="card small" role="note" aria-label="Disclaimers" style="background:var(--foam);border-color:var(--rope)">
        <p><strong>Stewardship & Responsible Use:</strong> This tool is for planning wisely ‚Äî not indulging carelessly. Packages include water, coffee, juice, and more. <em>Moderation honors your wallet and your health.</em></p>
        <p class="tiny" style="margin-top:1rem"><strong>Pricing Disclaimer:</strong> Prices/caps vary by ship, itinerary, and sale; gratuities/taxes may change. <strong>Purchase packages only in Cruise Planner</strong> (My Account ‚Üí Plan My Cruise ‚Üí Beverages). Always verify in Cruise Planner before purchasing.</p>
      </section>
    </section>

    <!-- Right rail -->
    <aside class="rail" aria-label="Author & articles">
      <section id="author-rail" class="card" aria-label="Author information">
        <div class="author-card">
          <picture>
            <source type="image/webp" srcset="/assets/authors/ken.webp">
            <img class="author-avatar" src="/assets/authors/ken.jpg" width="48" height="48" alt="Author ‚Äî Ken Baker" onerror="this.onerror=null;this.src='/assets/logo_wake.png';">
          </picture>
          <div>
            <strong style="color:var(--ink)"><a href="/authors/ken-baker.html">Ken Baker</a></strong><br/>
            <span class="tiny">Founder of In the Wake; calculator builder and data steward.</span>
          </div>
        </div>

        <!-- Planning Pass CTA -->
        <div class="pass-cta" style="text-align:left;margin-top:1.5rem;padding-top:1rem;border-top:2px solid var(--rope)">
          <strong style="color:var(--sea);font-size:1rem;display:block;margin-bottom:.5rem">Get your free Cruise Planning Pass:</strong>
          <ul class="pass-links" style="list-style:none;padding:0;margin:.5rem 0 0 0;font-size:.9rem;line-height:1.8">
            <li><a href="https://flickersofmajesty.com" target="_blank" rel="noopener">‚úì Cruise Photo Tips &amp; Galleries</a></li>
            <li><a href="https://ken-baker.com" target="_blank" rel="noopener">‚úì Planning Checklists &amp; Resources</a></li>
          </ul>
        </div>
      </section>

      <section class="card" aria-labelledby="email-title" style="background:var(--foam);border-color:var(--rope)">
        <h3 id="email-title" style="margin-top:0">Get Our Free Cruise Checklist!</h3>
        <p class="small" style="line-height:1.3">Join our list for exclusive tips and get your downloadable PDF instantly.</p>
        <form id="email-form" action="[YOUR_ESP_URL_HERE]" method="POST" style="margin-top:10px">
          <label for="honeypot" class="sr-only">Leave blank</label>
          <input type="text" id="honeypot" name="b_email" tabindex="-1" value="" style="position:absolute;left:-9999px" aria-hidden="true">
          <div class="form-group" style="display:flex;gap:6px">
            <label for="email" class="sr-only">Email</label>
            <input type="email" id="email" name="EMAIL" placeholder="your@email.com" required>
            <button type="submit" id="signup-button" class="btn" style="min-height:44px">Get List</button>
          </div>

          <!-- telemetry fields -->
          <input type="hidden" name="SAVINGS" id="email-savings">
          <input type="hidden" name="RECOMMENDATION" id="email-rec">
          <input type="hidden" name="CRUISE_DAYS" id="email-days">
          <input type="hidden" name="CALC_URL" id="email-url">
          <input type="hidden" name="tags[]" value="calculator-user">

          <label class="gdpr-consent">
            <input type="checkbox" name="OPT_IN" value="1" required>
            <span>I agree to receive emails from In the Wake. <a href="/privacy.html" target="_blank">Privacy Policy</a> | <a href="/gdpr-rights.html" target="_blank">Your Rights</a></span>
          </label>

          <!-- Planning Pass opt-in -->
          <label class="gdpr-consent" style="margin-top:.75rem">
            <input type="checkbox" name="PLANNING_PASS_OPT_IN" value="1">
            <span style="color:var(--sea)"><strong>Bonus:</strong> Get the free <strong>Cruise Planning Pass</strong> (photo tips from <i>Flickers of Majesty</i> + resources from <i>Ken-Baker.com</i>).</span>
          </label>

          <div id="signup-message" role="status" class="small" style="margin-top:6px;font-weight:700"></div>
        </form>
      </section>

      <section class="card" aria-labelledby="recent-rail-title">
        <h2 id="recent-rail-title" class="tiny" style="margin:.25rem 0 .5rem;color:#0a3d62">Recent Articles</h2>
        <div id="recent-rail" class="rail-list" aria-live="polite">
          <p class="tiny muted">Loading articles...</p>
        </div>
      </section>

      <section class="card">
        <div class="hd" style="position:static">FAQ (quick)</div>
        <div class="bd small">
          <p><strong>Why must all adults buy the same package?</strong><br/>Royal Caribbean requires it to prevent sharing.</p>
          <p><strong>Can I buy onboard?</strong><br/>Yes, but Cruise Planner sales are usually cheaper. This calculator uses pre-cruise estimates.</p>
        </div>
      </section>
    </aside>
  </main>

  <footer class="wrap" role="contentinfo" style="border-top:2px solid var(--bd);padding-top:1.5rem;margin-top:1rem;text-align:center">
    <p>¬© <span id="footer-year">2025</span> In the Wake ‚Äî A Cruise Traveler‚Äôs Logbook. <strong>All rights reserved.</strong><br>
    Reproduction, scraping, or derivative reuse of this calculator, math, or design without explicit written permission is prohibited.</p>
    <p class="tiny" style="margin-top:1rem"><a href="/terms.html">Terms of Service</a> | <a href="/privacy.html">Privacy Policy</a> | <a href="/gdpr-rights.html">GDPR Rights</a></p>
  </footer>

  <!-- Itinerary day template -->
  <template id="template-day-row">
    <fieldset class="day-row" style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:12px;background:var(--card)">
      <legend style="font-weight:800;padding:0 6px">
        <span class="day-label">Day 1</span>
        <select class="day-type-select small" aria-label="Day type" style="margin-left:8px;border-radius:8px;border:1px solid var(--bd)">
          <option value="sea">Sea Day</option><option value="port">Port Day</option><option value="embark">Embark/Debark</option>
        </select>
      </legend>
      <div class="controls-inline" style="padding:0 12px 10px;border-bottom:1px dashed var(--bd)">
        <button type="button" class="btn ghost small day-copy" data-copy-type="sea">Copy to all Sea Days</button>
        <button type="button" class="btn ghost small day-copy" data-copy-type="port">Copy to all Port Days</button>
      </div>
      <div class="day-stepper-grid" style="display:grid;grid-template-columns:1fr;gap:8px;margin-top:10px"></div>
    </fieldset>
  </template>

  <!-- Info drawer button -->
  <button id="info-btn" type="button" title="Data freshness">i</button>
  <div id="info-drawer" class="">
    <strong>Data & FX freshness</strong>
    <ul class="tiny" style="margin:.5rem 0 .75rem 1rem">
      <li>Pricing buckets: live / cached / fallback</li>
      <li>FX drift slider affects display only</li>
    </ul>
    <div class="controls-inline">
      <label class="small" for="fx-drift">FX drift</label>
      <input id="fx-drift" type="range" min="-10" max="10" step="1" value="0" aria-label="FX drift percent (display only)">
      <span id="fx-drift-val" class="small">0%</span>
      <button class="btn ghost" type="button" id="refresh-data">Refresh</button>
    </div>
  </div>

  <!-- Accessibility-friendly nav logic (prevents premature close while traversing) -->
  <script>
    (function(){
      const root = document.querySelector('.itw-nav'); if(!root) return;
      const items = [...root.querySelectorAll('.nav-item[aria-haspopup]')];
      const setOpen = (g,on)=>{ g.classList.toggle('open',!!on); const b=g.querySelector('button[aria-controls]'); if(b) b.setAttribute('aria-expanded',on?'true':'false'); };
      const closeAll = (ex=null)=>items.forEach(g=>{ if(g!==ex) setOpen(g,false); });
      const firstFocusable = el=>el && el.querySelector('a,button,[tabindex]:not([tabindex="-1"])');

      items.forEach(group=>{
        const btn=group.querySelector('button[aria-controls]'); const menu=group.querySelector('.menu'); if(!btn||!menu) return;
        let hoverTimer=null;
        group.addEventListener('mouseenter',()=>{ hoverTimer=setTimeout(()=>setOpen(group,true),120); });
        group.addEventListener('mouseleave',()=>{ clearTimeout(hoverTimer); hoverTimer=null; setTimeout(()=>{ if(!group.contains(document.activeElement)) setOpen(group,false); },80); });
        btn.addEventListener('click',e=>{ e.preventDefault(); e.stopPropagation(); const open=group.classList.contains('open'); closeAll(group); setOpen(group,!open); if(!open){ (firstFocusable(menu)||btn).focus({preventScroll:true}); }});
        btn.addEventListener('keydown',e=>{
          if(e.key==='ArrowDown'||e.key==='ArrowUp'){ e.preventDefault(); setOpen(group,true); (firstFocusable(menu)||btn).focus({preventScroll:true}); }
          else if(e.key==='Escape'){ setOpen(group,false); btn.focus({preventScroll:true}); }
        });
        group.addEventListener('keydown',e=>{ if(e.key==='Escape'){ setOpen(group,false); btn.focus({preventScroll:true}); }});
        menu.addEventListener('focusout',()=>{ setTimeout(()=>{ if(!group.contains(document.activeElement)) setOpen(group,false); },0); });
      });
      document.addEventListener('click',e=>{ if(!e.target.closest('.itw-nav')) closeAll(); });
      window.addEventListener('blur',()=>closeAll());
    })();
  </script>

  <!-- Recent Articles rail with Top-20 override -->
  <script>
    (async function(){
      const rail = document.getElementById('recent-rail'); if(!rail) return;
      const V = document.head.querySelector('meta[name="version"]')?.content || '.9.001.001';
      const esc = s=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
      const pick = (o,ks,f=null)=>{ for(const k of ks){ if(o&&o[k]!=null) return o[k]; } return f; };

      function chooseThumb(p){
        const title = (p.title||p.name||'').toLowerCase();
        const path  = (p.url||p.path||'').toLowerCase();
        // Top-20 override
        if (title.includes('top 20 first') || path.includes('/articles/top-20-questions/')){
          return "/assets/articles/top-20-questions/cover.jpg";
        }
        return p.image || "/assets/placeholders/article-thumb.jpg";
      }
      function render(items){
        rail.innerHTML = items.map(p=>{
          const href = pick(p,['url','path'],'#');
          const img  = chooseThumb(p) + `?v=${V}`;
          return `
            <a class="rail-item" href="${href}">
              <div class="thumb"><img src="${img}" alt="" loading="lazy" decoding="async"
                   onerror="this.onerror=null;this.src='/assets/placeholders/article-thumb.jpg?v=${V}';"></div>
              <div class="meta" style="line-height:1.3">
                <h4 style="color:var(--ink);font-size:.95rem;margin:0">${esc(p.title||p.name||'Article')}</h4>
              </div>
            </a>`;
        }).join('');
      }
      async function fetchJSON(u){ try{ const r=await fetch(u,{credentials:'omit',cache:'no-cache'}); if(r.ok) return await r.json(); }catch(_){ } return null; }
      const fallback = [
        {title:'Planning Your First Cruise', url:'/planning.html'},
        {title:'Why I Started Solo Cruising', url:'/solo/why-i-started-solo-cruising.html'},
        {title:'Top 20 First-Cruise Questions', url:'/articles/top-20-questions/'}
      ];
      try{
        const api = (window.CONFIG && CONFIG.ARTICLES_API);
        if (!api) throw 0;
        const raw = await fetchJSON(`${api}?v=${V}`); if(!raw) throw 0;
        const items = Array.isArray(raw?.articles)? raw.articles : (Array.isArray(raw)? raw: []);
        const here = location.pathname.replace(/\/+$/,'');
        const view = items.filter(p=>{ const href=(p.url||p.path||'#').replace(/\/+$/,''); return href && href!==here && !href.includes('drink-packages'); }).slice(0,3);
        render(view.length? view : fallback);
      }catch(_){ render(fallback); }
    })();
  </script>

  <!-- Footer year -->
  <script>document.getElementById('footer-year').textContent = new Date().getFullYear();</script>

  <!-- Info drawer + FX drift (display only) -->
  <script>
    (function(){
      const btn = document.getElementById('info-btn');
      const drawer = document.getElementById('info-drawer');
      const drift = document.getElementById('fx-drift');
      const driftVal = document.getElementById('fx-drift-val');
      const refresh = document.getElementById('refresh-data');

      btn?.addEventListener('click',()=>drawer.classList.toggle('open'));
      drift?.addEventListener('input',()=>{ window.fxDriftPct = Number(drift.value)||0; driftVal.textContent = (window.fxDriftPct>0?'+':'')+window.fxDriftPct+'%'; if(window.renderAll) window.renderAll(); });
      refresh?.addEventListener('click',()=>{ try{ navigator.serviceWorker?.controller?.postMessage({type:'REFRESH_DATA'});}catch(_){ } });
    })();
  </script>

  <!-- SW seeding for offline -->
  <script>
    (function(){
      try{
        navigator.serviceWorker?.controller?.postMessage({
          type:'SEED_URLS',
          urls:[
            location.pathname,
            '/assets/js/drink-math.js?v=.9.001.001',
            '/assets/js/drink-worker.js?v=.9.001.001',
            '/assets/js/drink-calculator.app.js?v=.9.001.001',
            '/assets/js/vendor/chart.umd.min.js?v=.9.001.001'
          ]
        });
      }catch(_){}
    })();
  </script>

  <!-- Email telemetry + Planning Pass dynamic tag -->
  <script>
    (function(){
      function itwPopulateEmailTelemetry(){
        try{
          const byId = id => document.getElementById(id);
          const form = byId('email-form') || byId('email-signup-form'); if(!form) return;

          // Read live values if available
          const rec = (window.ITW && ITW.best && ITW.best.name) || (window.ITW_BEST && ITW_BEST.name) || '';
          const savings = (window.ITW && ITW.best && typeof ITW.best.delta === 'number') ? ITW.best.delta :
                          ((window.ITW_BEST && ITW_BEST.delta) || '');
          const days = (window.ITW && ITW.inputs && ITW.inputs.days) ||
                       (document.querySelector('[data-input="days"]')?.value) || '';

          byId('email-rec') && (byId('email-rec').value = String(rec));
          byId('email-savings') && (byId('email-savings').value = String(savings));
          byId('email-days') && (byId('email-days').value = String(days));
          byId('email-url') && (byId('email-url').value = location.href);

          // dynamic Planning Pass tag
          const passCheckbox = form.querySelector('input[name="PLANNING_PASS_OPT_IN"]');
          const existingTag = form.querySelector('input[name="tags[]"][value="planning-pass"]');
          if (existingTag) existingTag.remove();
          if (passCheckbox && passCheckbox.checked){
            const passTag = document.createElement('input');
            passTag.type='hidden'; passTag.name='tags[]'; passTag.value='planning-pass';
            form.appendChild(passTag);
          }
        }catch(e){ console.error('Email telemetry failed:', e); }
      }
      const form = document.getElementById('email-form') || document.getElementById('email-signup-form');
      if (form){
        // Set ESP action from CONFIG if present
        const action = window.CONFIG?.BREVO_FORM_ACTION;
        if (action && !/YOUR_ESP_URL_HERE/.test(action)) form.action = action;

        form.addEventListener('submit', function(ev){
          // honeypot bot trap
          const hp = form.querySelector('#honeypot'); if(hp?.value) { ev.preventDefault(); return; }
          itwPopulateEmailTelemetry();
          const msg = document.getElementById('signup-message');
          const btn = document.getElementById('signup-button');
          if (msg){ msg.textContent='Subscribing...'; msg.style.color='var(--muted)'; }
          btn && (btn.disabled = true);
          // graceful no-cors fire-and-forget
          setTimeout(()=>{ if(msg){ msg.textContent='Success! Check your email to confirm.'; msg.style.color='var(--good)'; } }, 400);
        }, {capture:true});
      }
      window.itwPopulateEmailTelemetry = itwPopulateEmailTelemetry;
    })();
  </script>
</body>
</html>
