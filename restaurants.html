<!doctype html>
<html lang="en">
<head>
  <!--
    In the Wake — Restaurants & Menus
    Standards v3.006c — full upgrade drop-in
    Soli Deo Gloria.
  -->

  <!-- Analytics -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>

  <!-- Standards: absolute URL + origin normalizer -->
  <script>
  (function(){
    const ORIGIN=(location.origin||(location.protocol+"//"+location.host)).replace(/\/$/,'');
    window._abs=p=>{p=String(p||'');if(!p.startsWith('/'))p='/'+p;return ORIGIN+p};
    document.addEventListener('DOMContentLoaded',()=>{
      const sel=[
        'a[href^="https://www.cruisinginthewake.com/"]',
        'img[src^="https://www.cruisinginthewake.com/"]',
        'link[href^="https://www.cruisinginthewake.com/"]',
        'script[src^="https://www.cruisinginthewake.com/"]'
      ].join(',');
      document.querySelectorAll(sel).forEach(el=>{
        const attr=el.hasAttribute('href')?'href':'src';
        try{const u=new URL(el.getAttribute(attr)); el.setAttribute(attr, ORIGIN+u.pathname+u.search+u.hash);}catch(_){}
      });
    },{once:true});
  })();
  </script>

  <!-- External link hardening -->
  <script>
  document.addEventListener('click',e=>{
    const a=e.target.closest&&e.target.closest('a[href]'); if(!a) return;
    try{ const u=new URL(a.href,location.href); if(u.origin!==location.origin){ a.target='_blank'; a.rel='noopener'; } }catch(_){}
  },{capture:true});
  </script>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Restaurants &amp; Menus | In the Wake (v3.006c)</title>
  <meta name="version" content="v3.006c"/>
  <meta name="description" content="Premium & complimentary dining across the fleet — menus, prices, accessibility notes."/>
  <meta name="robots" content="index,follow"/>

  <!-- Canonical / OG / Twitter -->
  <link rel="canonical" href="https://www.cruisinginthewake.com/restaurants.html"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/restaurants.html"/>
  <meta property="og:title" content="Restaurants &amp; Menus | In the Wake"/>
  <meta property="og:description" content="Premium & complimentary dining across the fleet — menus, prices, accessibility notes."/>
  <meta property="og:image" content="https://www.cruisinginthewake.com/assets/social/restaurants-hero.jpg?v=3.006c"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://www.cruisinginthewake.com/"},
    {"@type":"ListItem","position":2,"name":"Restaurants & Menus","item":"https://www.cruisinginthewake.com/restaurants.html"}
  ]}
  </script>

  <!-- SiteCache + SW -->
  <script src="/assets/js/site-cache.js" defer></script>
  <script>
  if('serviceWorker' in navigator){
    addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));
  }
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/styles.css?v=3.006c"/>
  <link rel="preload" as="image" href="/assets/compass_rose.svg"/>

  <!-- Page styles (hero + watermark + cards grid) -->
  <style>
    :root{ --rope:#D9B382; --ink:#0f2a3a; --foam:#eef7fb; --accent:#0e6e8e; }
    body.restaurants-page{ background:linear-gradient(var(--foam),#fff 240px); color:var(--ink); }
    .hero{ background:url('/assets/index_hero.jpg') center/cover no-repeat!important;
           filter:saturate(1.28) contrast(1.08) brightness(1.05) }
    .hero::before,.hero::after{ content:none!important }
    body::before{ content:""; position:fixed; inset:0;
      background:url("/assets/watermark.png") no-repeat center right/420px auto;
      opacity:.06; pointer-events:none; z-index:0; }
    body>*{ position:relative; z-index:1; }

    .section{ position:relative; margin:0 auto; max-width:1160px; padding:0 16px 1rem; }
    .divider{ height:12px; background:var(--rope);
      -webkit-mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;
              mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;
      background-repeat:repeat-x; margin:.5rem 0 1.25rem; }

    .grid{ display:grid; gap:1rem; }
    #grid-complimentary,#grid-premium,#grid-activity{ grid-template-columns:1fr; }
    @media (min-width:680px){ #grid-complimentary,#grid-premium,#grid-activity{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media (min-width:1024px){ #grid-complimentary,#grid-premium,#grid-activity{ grid-template-columns:repeat(3,minmax(0,1fr)); } }

    .card{ border-radius:18px; box-shadow:0 2px 8px rgba(0,0,0,.06), inset 0 0 0 1px rgba(255,255,255,.7);
           background:#fff; border:2px solid var(--rope); padding:.9rem; display:flex; flex-direction:column; height:100%; }
    .card a{ display:block; color:inherit; text-decoration:none; }
    .card a strong{ color:#0a3d62; }
    .ship-pills{ margin-top:.55rem; display:flex; flex-wrap:wrap; gap:.35rem; }
    .ship-pills .chip{ font-size:.75rem; padding:.25rem .5rem; border:1px solid var(--rope); border-radius:999px; background:#fff; }
    .is-hidden{ display:none !important; }

    /* Header bits */
    .topbar{display:flex;align-items:center;gap:.6rem;padding:.35rem .75rem}
    .topbar .logo-sm img{height:24px;width:auto;display:block}
    .topbar .ver{color:#355;opacity:.7;font-weight:600;font-size:.95rem}
    .pill-nav.pills{margin-left:auto;display:flex;gap:.5rem;flex-wrap:wrap}

    /* Skip link */
    .skip-link{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skip-link:focus{ position:fixed; left:12px; top:12px; width:auto; height:auto; padding:.45rem .7rem;
      background:#fff; border:2px solid var(--accent); border-radius:10px; z-index:9999; }

    /* Focus ring for custom UI */
    .pill,.chip,.pillbtn,#clearBtn{ outline:none; }
    .pill:focus-visible,.chip:focus-visible,.pillbtn:focus-visible,#clearBtn:focus-visible{
      outline:3px solid var(--accent); outline-offset:2px; box-shadow:0 0 0 3px rgba(14,110,142,.2); border-radius:8px;
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation-duration:0.001ms !important; animation-iteration-count:1 !important; transition-duration:0.001ms !important; }
    }
    @media (forced-colors: active){
      .pill:focus-visible,.chip:focus-visible,.pillbtn:focus-visible,#clearBtn:focus-visible{ outline:2px solid CanvasText; box-shadow:none; }
    }
  </style>

  <!-- Canon UI styles -->
  <style id="restaurants-canon-ui">
    #search-wrap{ max-width:1160px; margin:.75rem auto 0; padding:0 16px; }
    #q{ width:100%; padding:.65rem .85rem; border-radius:12px; border:1px solid #cfe1ea; font-size:1rem; }
    #q:focus{ border-color:#0e6e8e; box-shadow:0 0 0 3px rgba(14,110,142,.15); }
    #search-meta{ margin:.45rem 16px 0; color:#355; font-size:.9rem; }

    .filters{ max-width:1160px; margin:.4rem auto 0; padding:0 16px; }
    .filters .filter-row{ display:flex; gap:.4rem; flex-wrap:wrap; align-items:center; }
    .chip{ padding:.35rem .6rem; border:1px dashed var(--rope,#D9B382); border-radius:999px; background:#fff; font-size:.85rem; cursor:pointer; user-select:none; }
    .chip[aria-pressed="true"]{ background:#0e6e8e; color:#fff; border-color:#0e6e8e; box-shadow:0 1px 6px rgba(0,0,0,.12); }

    #brandbar{ position:relative; z-index:60; max-width:1160px; margin:.4rem auto 0; padding:0 16px; }
    #brandbar .row{ display:flex; gap:.4rem; flex-wrap:wrap; align-items:center; }
    #brandbar .pillbtn{ padding:.38rem .65rem; border:1px dashed var(--rope,#D9B382); border-radius:999px; background:#fff; font-size:.9rem; cursor:pointer; }
    #brandbar .pillbtn[aria-pressed="true"]{ background:#0e6e8e; color:#fff; border-color:#0e6e8e; }
    #brandbar .tray{ position:absolute; top:100%; left:16px; right:16px; display:none; background:#fff; border:2px solid var(--rope,#D9B382);
                     border-radius:14px; padding:.6rem; margin-top:.35rem; box-shadow:0 8px 28px rgba(8,48,65,.18); }
    #brandbar .tray.on{ display:block; }
    #brandbar .tray .group{ display:flex; gap:.4rem; flex-wrap:wrap; }
  </style>
</head>

<body class="restaurants-page">
  <a class="skip-link" href="#content">Skip to main content</a>

  <header class="site-header hero-header">
    <div class="topbar">
      <a class="logo-sm" href="/"><img src="/assets/logo_wake.png" alt="In the Wake"/></a>
      <span class="ver">v3.006c</span>
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/ships/">Ships</a>
        <a href="/restaurants.html" aria-current="page">Restaurants &amp; Menus</a>
        <a href="/ports.html">Ports</a>
        <a href="/disability-at-sea.html">Disability at Sea</a>
        <a href="/drink-packages.html">Drink Packages</a>
        <a href="/packing-lists.html">Packing Lists</a>
        <a href="/cruise-lines/">Cruise Lines</a>
        <a href="/solo.html">Solo</a>
        <a href="/planning.html">Planning</a>
        <a href="/travel.html">Travel</a>
      </nav>
    </div>

    <div class="hero" role="img" aria-label="Sunset wake hero image">
      <div class="latlon-grid" aria-hidden="true"></div>
      <img class="hero-compass" src="/assets/compass_rose.svg" alt="" aria-hidden="true"/>
      <div class="hero-title"><img class="logo" src="/assets/logo_wake.png" alt="In the Wake"></div>
      <p class="tagline">A Cruise Traveler’s Logbook</p>
      <div class="hero-credit">
        <a class="pill long" href="https://www.instagram.com/flickersofmajesty/" target="_blank" rel="noopener">Photo by Flickers of Majesty — Instagram</a>
      </div>
    </div>

    <!-- Filters canon (markup) -->
    <div id="search-wrap" role="search">
      <input id="q" type="search" inputmode="search"
             placeholder="Type to filter… (e.g., chops, sushi, suite, diamond)"
             aria-label="Filter restaurants by name, type, access, or tag">
    </div>
    <div id="search-meta" class="tiny" aria-live="polite">Loading venues…</div>

    <div id="filters" class="filters" role="group" aria-label="Filter by category">
      <div class="filter-row">
        <span class="label tiny">Categories:</span>
        <button type="button" class="chip" data-kind="cat" data-val="premium" aria-pressed="false">Premium</button>
        <button type="button" class="chip" data-kind="cat" data-val="complimentary" aria-pressed="false">Complimentary</button>
        <button type="button" class="chip" data-kind="cat" data-val="activity" aria-pressed="false">Activities</button>
      </div>
    </div>

    <nav id="brandbar" aria-label="Filter by brand, class, ship, or venue">
      <div class="row">
        <span class="label tiny">Show only:</span>
        <button class="pillbtn" id="brandBtn" aria-expanded="false" aria-controls="tray-brand">Cruise Line</button>
        <button class="pillbtn" id="classBtn" aria-expanded="false" aria-controls="tray-class">Ship Class</button>
        <button class="pillbtn" id="shipBtn"  aria-expanded="false" aria-controls="tray-ship">Ship</button>
        <button class="pillbtn" id="venueBtn" aria-expanded="false" aria-controls="tray-venue">Venue</button>
        <button class="pillbtn" id="clearBtn" type="button" aria-label="Clear all filters" title="Clear filters">Clear</button>
      </div>
      <div id="tray-brand" class="tray" role="menu"><div class="group" id="brands"></div></div>
      <div id="tray-class" class="tray" role="menu"><div class="group" id="classes"></div></div>
      <div id="tray-ship"  class="tray" role="menu"><div class="group" id="ships"></div></div>
      <div id="tray-venue" class="tray" role="menu"><div class="group" id="venues"></div></div>
    </nav>
  </header>

  <main id="content">
    <section class="section"><p class="pill"><strong>Note:</strong> Prices change by ship and sailing; some venues unavailable on select itineraries.</p></section>

    <section class="section" id="complimentary">
      <h2>Main Dining &amp; Complimentary</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid" id="grid-complimentary"></div>
    </section>

    <section class="section" id="premium">
      <h2>Specialty Dining</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid" id="grid-premium"></div>
    </section>

    <section class="section" id="activity">
      <h2>Dining Activities &amp; Classes</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid" id="grid-activity"></div>
    </section>

    <section class="section" id="by-ship">
      <h2>Quick Links by Ship</h2>
      <div class="divider" aria-hidden="true"></div>
      <div id="ship-links"></div>
    </section>

    <section class="section">
      <p class="pill"><strong>Accessibility:</strong> See each venue page and <a href="/disability-at-sea.html">Disability at Sea</a> for ship notes.</p>
    </section>
  </main>

  <footer class="wrap" role="contentinfo" style="text-align:center">
    © 2025 In the Wake — A Cruise Traveler’s Logbook · <a href="/accessibility.html">Accessibility &amp; WCAG 2.1 AA Commitment</a>
  </footer>

<!-- ===== ITW Restaurants Renderer — Option A JSON (v3.006c) ===== -->
<script>
(function(){
  const $ = s => document.querySelector(s);
  const roots = {
    complimentary: $('#grid-complimentary'),
    premium:       $('#grid-premium'),
    activity:      $('#grid-activity')
  };
  const meta = $('#search-meta');
  const abs  = p => (typeof window._abs==='function' ? _abs(p) : p);

  function setStatus(msg){
    if (meta) meta.textContent = msg;
  }
  function ensureRetry(onClick){
    if (!meta || meta._retry) return;
    const b = document.createElement('button');
    b.type='button'; b.textContent='Retry'; b.className='chip'; b.style.marginLeft='.5rem';
    b.addEventListener('click', onClick);
    meta.appendChild(b);
    meta._retry = true;
  }
  function isDB(x){
    return !!(x && Array.isArray(x.venues) && x.ships && typeof x.ships === 'object');
  }
  async function ensureSiteCache(){
    if (window.SiteCache && typeof SiteCache.getJSON==='function') return;
    await new Promise(res=>{
      const s=document.createElement('script');
      s.src=abs('/assets/js/site-cache.js'); s.defer=true;
      s.onload=res; s.onerror=res;
      document.head.appendChild(s);
    });
  }
  async function fetchWithTimeout(url, ms=8000){
    const ctl = new AbortController();
    const t = setTimeout(()=>ctl.abort(), ms);
    try{
      const r = await fetch(url, {cache:'no-store', signal:ctl.signal});
      if(!r.ok) throw new Error('HTTP '+r.status);
      return await r.json();
    }finally{ clearTimeout(t); }
  }
  async function loadDB(){
    const URL = abs('/assets/data/venues.json');
    // 1) SiteCache
    try{
      if (window.SiteCache && typeof SiteCache.getJSON==='function'){
        const db = await SiteCache.getJSON(URL, {ttlDays:7, versionPath:['meta','version']});
        if (isDB(db)) return {db, source:'sitecache'};
      }
    }catch(_){}
    // 2) Network
    try{
      const db = await fetchWithTimeout(URL, 8000);
      if (isDB(db)) return {db, source:'network'};
    }catch(_){}
    // 3) Stale local record (SiteCache’s raw bucket, if present)
    try{
      const raw = localStorage.getItem('sc::'+URL);
      if (raw){
        const rec = JSON.parse(raw);
        if (rec && isDB(rec.data)) return {db:rec.data, source:'stale-cache'};
      }
    }catch(_){}
    throw new Error('venues.json unavailable');
  }

  function norm(s){
    return String(s||'').toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
      .replace(/[’‘]/g,"'")
      .replace(/[-_/]/g,' ')
      .replace(/\s+/g,' ')
      .trim();
  }

  function cardHTML(v, shipList, classList, access, shipsDict){
    const slug = v.slug;
    const name = v.name || slug;
    const href = `/restaurants/${slug}.html`;
    const cat  = (v.category || 'complimentary').toLowerCase();
    const blurb= (v.category === 'premium') ? 'Specialty Dining' : (cat==='activity'?'Activity / Class':'Complimentary Venue');
    const join = arr => (Array.isArray(arr)?arr:[]).join(' ');
    const tags = norm([name, join(v.aliases), join(v.access)].join(' '));

    // ship pills with data-ship + data-class for the canon filters
    const chips = shipList.map(s=>{
      const nm = shipsDict[s]?.name || s;
      const cls= norm(shipsDict[s]?.class || '');
      return `<span class="chip" data-ship="${s}" data-class="${cls}" title="${nm}">${nm}</span>`;
    }).join('');

    return `
      <div class="card">
        <a href="${href}"
           data-slug="${slug}"
           data-cat="${cat}"
           data-brand="rccl"
           ${shipList.length ? `data-ships="${shipList.join(' ')}"` : ''}
           ${classList.length ? `data-classes="${classList.join(' ')}"` : ''}
           ${access.length ? `data-access="${access.join(', ')}"` : ''}
           data-tags="${tags}">
          <strong>${name}</strong><br><small>${blurb}</small>
        </a>
        <div class="ship-pills">${chips}</div>
      </div>`;
  }

  function paint(db){
    // Reverse maps: venue -> ships, venue -> classes
    const shipsByVenue = new Map();
    const classesByShip = {};
    Object.entries(db.ships||{}).forEach(([ship, payload])=>{
      classesByShip[ship] = norm(payload.class);
      (payload.venues||[]).forEach(slug=>{
        if(!shipsByVenue.has(slug)) shipsByVenue.set(slug, new Set());
        shipsByVenue.get(slug).add(ship);
      });
    });
    const classesByVenue = new Map();
    shipsByVenue.forEach((set, slug)=>{
      const ks = new Set();
      set.forEach(ship=>{ const k = classesByShip[ship]; if(k) ks.add(k); });
      classesByVenue.set(slug, ks);
    });

    const buckets = { complimentary:[], premium:[], activity:[] };
    const venues = (db.venues||[]).slice().sort((a,b)=> (a.name||a.slug).localeCompare(b.name||b.slug));

    const uniq = arr => Array.from(new Set((arr||[]).filter(Boolean)));

    venues.forEach(v=>{
      try{
        const slug = String(v.slug||'').trim();
        if(!slug) return;
        const cat  = String(v.category||'complimentary').toLowerCase();
        const shipArr  = uniq(Array.from((shipsByVenue.get(slug)||new Set()).values()))
                          .sort((a,b)=> (db.ships?.[a]?.name||a).localeCompare(db.ships?.[b]?.name||b));
        const classArr = uniq(Array.from((classesByVenue.get(slug)||new Set()).values())).sort();
        const access   = uniq((Array.isArray(v.access)?v.access:[]).map(x=>norm(x)));

        (buckets[cat] || buckets.complimentary).push(
          cardHTML(v, shipArr, classArr, access, db.ships||{})
        );
      }catch(_){}
    });

    // Append once per grid
    Object.entries(buckets).forEach(([cat, htmlList])=>{
      const root = roots[cat] || roots.complimentary;
      if(!root || !htmlList.length) return;
      const tpl = document.createElement('template');
      tpl.innerHTML = htmlList.join('').trim();
      root.appendChild(tpl.content);
    });
  }

  async function boot(){
    setStatus('Loading venues…');
    await ensureSiteCache();
    try{
      const {db, source} = await loadDB();
      paint(db);
      setStatus(source==='stale-cache' ? 'Showing saved data (offline).' : 'Showing all venues & activities');
    }catch(e){
      console.error('[itw] venues load error:', e);
      setStatus('Could not load venues.');
      ensureRetry(()=>location.reload());
    }
  }

  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', boot, {once:true});
  } else {
    boot();
  }
})();
</script>

  <!-- ================= Filters & Search Canon (hooks into the cards) ================= -->
  <script>
