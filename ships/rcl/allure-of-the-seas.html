<script>
/* Logbook: primary source = /ships/rcl/assets/logbook/<shipname>.json
   Example: enchantment → https://www.cruisinginthewake.com/ships/rcl/assets/logbook/enchantment.json
   Fallbacks remain in case a file hasn’t been published yet. */
(async function loadLogbook(){
  const el = document.getElementById('logbook-stories'); if(!el) return;

  // Page slug (how your ship pages are named)
  const pageSlug = 'allure-of-the-seas'; // <- set per page

  // Turn a page slug like "allure-of-the-seas" into a canonical shipname "allure"
  function shipKeyFromSlug(slug){
    if(!slug) return '';
    // strip common “of-the-…” tails
    const m = slug.match(/^([a-z0-9-]+?)-of-the-(sea|seas)$/i);
    if(m) return m[1].replace(/-/g,'');
    // otherwise, take the first token (e.g., "enchantment-of-the-seas" → "enchantment")
    const first = slug.split('-')[0];
    return first.replace(/-/g,'');
  }

  const shipKey = shipKeyFromSlug(pageSlug); // e.g., "allure", "enchantment", "harmony"

  // Try your canonical location first, then older/alt fallbacks
  const TRY = [
    `https://www.cruisinginthewake.com/ships/rcl/assets/logbook/${shipKey}.json`,
    // Fallbacks (keep searching until NON-EMPTY)
    'https://www.cruisinginthewake.com/ships/rcl/assets/allure.json', // legacy example
    'https://www.cruisinginthewake.com/assets/data/ships/rcl/allure.json',
    'https://www.cruisinginthewake.com/assets/data/logbook/rcl/allure-of-the-seas.json'
  ];

  let stories = [];
  for(const u of TRY){
    try{
      const r = await fetch(u, { cache:'no-store' });
      if(!r.ok) continue;
      const j = await r.json();
      const arr = Array.isArray(j.personas) ? j.personas
                : Array.isArray(j.stories)  ? j.stories
                : Array.isArray(j)          ? j : [];
      if(arr.length){ stories = arr; break; } // stop ONLY on non-empty
    }catch{}
  }

  if(!stories.length){
    el.innerHTML = `<article class="story"><h3>From the Wake</h3>
      <p class="small">Our crew is compiling first-hand notes and tips for this ship. Check back shortly for fresh entries.</p>
    </article>`;
    return;
  }

  el.innerHTML = stories.map(p => `
    <article class="story">
      <h3>${(p.title||p.persona_label||'Guest Perspective')}</h3>
      ${(p.markdown||p.html||'').trim()}
    </article>`).join('');
})();
</script>
