<!doctype html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8"/>
  <script>document.documentElement.classList.remove('no-js');</script>

<!-- ai-breadcrumbs
     entity: Multi-Line Ship Selection Quiz
     type: Interactive Tool
     parent: /ships.html
     category: Planning Tool
     updated: 2026-01-02
     expertise: Cruise planning, ship selection, personalized recommendations
     target-audience: Cruise travelers seeking ship recommendations across multiple lines
     answer-first: Take this quick quiz to find your perfect cruise ship across Royal Caribbean, Carnival, NCL, and MSC based on your travel style.
     -->
  <!-- ======================================================
       In the Wake ‚Äî All Ship Quiz V2
       Version: 2.0.0  |  Soli Deo Gloria
       ====================================================== -->

  <!-- Consent (autoblocking) -->
  <script type="text/javascript" data-cmp-ab="1"
    src="https://cdn.consentmanager.net/delivery/autoblocking/e11a25480244a.js"
    data-cmp-host="a.delivery.consentmanager.net"
    data-cmp-cdn="cdn.consentmanager.net"
    data-cmp-codesrc="16"></script>

  <!-- Analytics -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZP891PZXJ"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-WZP891PZXJ',{anonymize_ip:true});</script>

  <!-- ICP-Lite v1.4 Meta Tags -->
  <meta name="ai-summary" content="Interactive quiz to help cruise travelers find their perfect ship across Royal Caribbean, Carnival, Norwegian, and MSC. Answer 8 simple questions about your travel party, pace, budget, and preferences to get personalized ship recommendations." />
  <meta name="last-reviewed" content="2026-01-02" />
  <meta name="content-protocol" content="ICP-Lite v1.4" />

  <!-- Core -->
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="referrer" content="no-referrer-when-downgrade"/>

  <!-- SEO -->
  <meta name="robots" content="index,follow,max-image-preview:large"/>
  <meta name="color-scheme" content="light"/>
  <meta name="theme-color" content="#0e6e8e"/>
  <meta name="author" content="In the Wake"/>

  <!-- Title & Description -->
  <title>Find Your Perfect Cruise Ship ‚Äî Quiz | In the Wake</title>
  <meta name="description" content="Not sure which cruise ship is right for you? Take our quick quiz to get personalized recommendations from Royal Caribbean, Carnival, Norwegian, and MSC." />
  <link rel="canonical" href="https://cruisinginthewake.com/ships/allshipquiz.html"/>

  <!-- OpenGraph -->
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:url" content="https://cruisinginthewake.com/ships/allshipquiz.html"/>
  <meta property="og:title" content="Find Your Perfect Cruise Ship ‚Äî Quiz"/>
  <meta property="og:description" content="Answer a few quick questions and we'll recommend the best ships for your cruise style across 4 major cruise lines."/>
  <meta property="og:image" content="https://cruisinginthewake.com/assets/social/ships-hero.jpg"/>

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Find Your Perfect Cruise Ship ‚Äî Quiz"/>
  <meta name="twitter:description" content="Answer a few quick questions and we'll recommend the best ships for your cruise style."/>

  <!-- JSON-LD: BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://cruisinginthewake.com/" },
      { "@type": "ListItem", "position": 2, "name": "Ships", "item": "https://cruisinginthewake.com/ships.html" },
      { "@type": "ListItem", "position": 3, "name": "Ship Quiz", "item": "https://cruisinginthewake.com/ships/allshipquiz.html" }
    ]
  }
  </script>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/in_the_wake_icon_32x32.png"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png"/>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/styles.css?v=3.010.300">
  <link rel="stylesheet" href="/assets/css/item-cards.css?v=1.0.0">

  <style>
    /* Quiz-specific styles */
    .quiz-container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* Cruise line pill selector */
    .cruise-line-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--sky);
      border-radius: 14px;
    }
    .line-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.6rem 1.2rem;
      border: 2px solid var(--rope);
      border-radius: 999px;
      background: #fff;
      color: var(--ink);
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
    }
    .line-pill:hover {
      border-color: var(--accent);
      background: var(--foam);
    }
    .line-pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .line-pill .line-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
    }
    .line-pill[data-line="all"] .line-dot { background: linear-gradient(135deg, #1a3d7c, #e31837, #00205b, #003366); }
    .line-pill[data-line="rcl"] .line-dot { background: #1a3d7c; }
    .line-pill[data-line="carnival"] .line-dot { background: #e31837; }
    .line-pill[data-line="ncl"] .line-dot { background: #00205b; }
    .line-pill[data-line="msc"] .line-dot { background: #003366; }

    /* Mobile hamburger for pills */
    .line-selector-mobile {
      display: none;
    }
    @media (max-width: 600px) {
      .cruise-line-selector {
        display: none;
      }
      .line-selector-mobile {
        display: block;
        margin-bottom: 1.5rem;
      }
      .line-selector-trigger {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        padding: 1rem;
        background: var(--sky);
        border: 2px solid var(--rope);
        border-radius: 14px;
        font-weight: 600;
        cursor: pointer;
      }
      .line-selector-trigger .current-line {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .line-selector-dropdown {
        display: none;
        position: absolute;
        left: 0;
        right: 0;
        background: #fff;
        border: 2px solid var(--rope);
        border-radius: 14px;
        margin-top: 0.5rem;
        padding: 0.5rem;
        z-index: 100;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      }
      .line-selector-dropdown.open {
        display: block;
      }
      .line-selector-dropdown .line-option {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .line-selector-dropdown .line-option:hover {
        background: var(--foam);
      }
      .line-selector-dropdown .line-option.active {
        background: var(--foam);
        font-weight: 600;
      }
      .line-selector-dropdown .escape-rope {
        border-top: 1px solid var(--rope);
        margin-top: 0.5rem;
        padding-top: 0.5rem;
      }
    }

    /* Progress indicator */
    .quiz-progress {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, rgba(14, 110, 142, 0.95) 0%, rgba(10, 61, 98, 0.95) 100%);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(8, 48, 65, 0.2);
      z-index: 1000;
      backdrop-filter: blur(8px);
      display: none;
    }
    .quiz-progress.visible {
      display: block;
    }

    /* Quiz intro */
    .quiz-intro {
      text-align: center;
      padding: 2rem 1rem;
    }
    .quiz-intro h1 {
      font-size: 2rem;
      color: var(--sea);
      margin-bottom: 1rem;
    }
    .quiz-intro p {
      font-size: 1.1rem;
      color: var(--ink-mid);
      max-width: 600px;
      margin: 0 auto 1.5rem;
    }
    .btn-start {
      display: inline-block;
      padding: 1rem 2.5rem;
      background: linear-gradient(135deg, #0e6e8e 0%, #0a3d62 100%);
      color: #fff;
      font-size: 1.2rem;
      font-weight: 600;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(14, 110, 142, 0.3);
    }
    .btn-start:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(14, 110, 142, 0.4);
    }

    /* Question screen */
    .quiz-question {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .quiz-question.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .question-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .question-header h2 {
      font-size: 1.6rem;
      color: var(--sea);
      margin-bottom: 0.5rem;
    }
    .question-subtitle {
      color: var(--ink-mid);
      font-size: 1rem;
    }

    /* Option cards */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .options-grid.two-col {
      grid-template-columns: repeat(2, 1fr);
    }
    .options-grid.three-col {
      grid-template-columns: repeat(3, 1fr);
    }
    @media (max-width: 600px) {
      .options-grid.two-col,
      .options-grid.three-col {
        grid-template-columns: 1fr;
      }
    }

    .option-card {
      background: #fff;
      border: 2px solid var(--rope);
      border-radius: 14px;
      padding: 1.25rem;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
    }
    .option-card:hover {
      border-color: var(--accent);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(14, 110, 142, 0.15);
    }
    .option-card.selected {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(14, 110, 142, 0.08) 0%, rgba(14, 110, 142, 0.04) 100%);
      box-shadow: 0 4px 16px rgba(14, 110, 142, 0.2);
    }
    .option-card.selected .option-icon {
      transform: scale(1.1);
    }

    .option-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
      transition: transform 0.2s;
    }
    .option-label {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--sea);
      margin-bottom: 0.25rem;
    }
    .option-desc {
      font-size: 0.85rem;
      color: var(--ink-mid);
    }

    /* Navigation */
    .quiz-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e0f0f5;
    }
    .btn-back {
      padding: 0.75rem 1.5rem;
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-back:hover {
      background: var(--foam);
    }
    .btn-back:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .btn-next {
      padding: 0.75rem 2rem;
      background: linear-gradient(135deg, #0e6e8e 0%, #0a3d62 100%);
      color: #fff;
      border: none;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(14, 110, 142, 0.25);
    }
    .btn-next:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(14, 110, 142, 0.35);
    }
    .btn-next:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Results screen */
    .quiz-results {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    .quiz-results.active {
      display: block;
    }

    .results-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .results-header h2 {
      font-size: 1.8rem;
      color: var(--sea);
      margin-bottom: 0.5rem;
    }
    .results-header p {
      color: var(--ink-mid);
    }

    /* Ship result cards with brand colors */
    .result-card {
      background: #fff;
      border: 2px solid var(--rope);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 1.5rem;
      transition: all 0.25s;
    }
    .result-card:hover {
      box-shadow: 0 8px 24px rgba(14, 110, 142, 0.12);
    }
    .result-card.top-pick {
      border-color: var(--accent);
      box-shadow: 0 6px 20px rgba(14, 110, 142, 0.15);
    }
    .result-card.top-pick .result-badge {
      display: block;
    }

    /* Brand color bar */
    .result-brand-bar {
      height: 6px;
      width: 100%;
    }
    .result-brand-bar.rcl { background: linear-gradient(90deg, #1a3d7c, #ffd700); }
    .result-brand-bar.carnival { background: linear-gradient(90deg, #e31837, #0033a0); }
    .result-brand-bar.ncl { background: linear-gradient(90deg, #00205b, #ffffff); }
    .result-brand-bar.msc { background: linear-gradient(90deg, #003366, #b8860b); }

    .result-image {
      position: relative;
      aspect-ratio: 16 / 9;
      overflow: hidden;
      background: linear-gradient(135deg, #eaf6f6 0%, #d4eeee 100%);
    }
    .result-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .result-card:hover .result-image img {
      transform: scale(1.05);
    }
    .result-badge {
      display: none;
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
      color: #fff;
      padding: 0.4rem 0.85rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .result-match {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      background: rgba(14, 110, 142, 0.9);
      color: #fff;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      backdrop-filter: blur(4px);
    }

    .result-content {
      padding: 1.25rem;
    }
    .result-title {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .result-title h3 {
      font-size: 1.3rem;
      color: var(--sea);
      margin: 0;
    }
    .result-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .result-class {
      background: var(--foam);
      color: var(--accent);
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .result-line {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #fff;
    }
    .result-line.rcl { background: #1a3d7c; }
    .result-line.carnival { background: #e31837; }
    .result-line.ncl { background: #00205b; }
    .result-line.msc { background: #003366; }

    .result-narrative {
      color: var(--ink-mid);
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .result-specs {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: var(--sky);
      border-radius: 8px;
    }
    .spec-item {
      display: flex;
      flex-direction: column;
    }
    .spec-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .spec-value {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--sea);
    }

    .result-highlights {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .highlight-tag {
      background: linear-gradient(135deg, rgba(14, 110, 142, 0.1) 0%, rgba(14, 110, 142, 0.05) 100%);
      color: var(--accent);
      padding: 0.3rem 0.6rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    /* Why this ship section */
    .result-why {
      margin-top: 0.75rem;
      padding: 0.75rem;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%);
      border-radius: 8px;
      border-left: 3px solid #fbbf24;
    }
    .result-why-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .result-why-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: #b45309;
      margin-bottom: 0;
    }
    .result-why-toggle {
      font-size: 0.75rem;
      color: #b45309;
      text-decoration: underline;
    }
    .result-why-text {
      font-size: 0.85rem;
      color: var(--ink-mid);
      margin: 0.5rem 0 0;
    }
    .result-why-details {
      display: none;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(251, 191, 36, 0.3);
    }
    .result-why-details.open {
      display: block;
    }
    .score-breakdown {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .score-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
    }
    .score-row .label {
      color: var(--ink-mid);
    }
    .score-row .points {
      font-weight: 600;
      color: #b45309;
    }

    .result-cta {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: linear-gradient(135deg, #0e6e8e 0%, #0a3d62 100%);
      color: #fff;
      text-decoration: none;
      border-radius: 999px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .result-cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(14, 110, 142, 0.3);
    }

    /* You Might Also Like section */
    .also-like-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(14, 110, 142, 0.04) 0%, rgba(14, 110, 142, 0.02) 100%);
      border-radius: 14px;
      border: 1px solid rgba(14, 110, 142, 0.1);
    }
    .also-like-section h3 {
      font-size: 1.1rem;
      color: var(--sea);
      margin-bottom: 0.5rem;
    }
    .also-like-section p {
      color: var(--ink-mid);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    .also-like-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }
    .also-like-card {
      background: #fff;
      border: 2px solid var(--rope);
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      transition: all 0.2s;
      text-decoration: none;
    }
    .also-like-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }
    .also-like-card .ship-name {
      font-weight: 600;
      color: var(--sea);
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
    }
    .also-like-card .ship-line {
      font-size: 0.75rem;
      color: var(--ink-mid);
      margin-bottom: 0.5rem;
    }
    .also-like-card .ship-match {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent);
    }

    /* Color guide */
    .color-guide {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
      padding: 0.75rem;
      background: #fff;
      border-radius: 8px;
      font-size: 0.8rem;
    }
    .color-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .color-item .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* Restart button */
    .quiz-restart {
      text-align: center;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid #e0f0f5;
    }
    .btn-restart {
      padding: 0.75rem 2rem;
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-restart:hover {
      background: var(--foam);
    }

    /* Loading state */
    .quiz-loading {
      text-align: center;
      padding: 3rem;
      color: var(--ink-mid);
    }

    /* Hide elements */
    .hidden {
      display: none !important;
    }

    /* Share section */
    .share-section {
      margin-top: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(14, 110, 142, 0.06) 0%, rgba(14, 110, 142, 0.02) 100%);
      border-radius: 14px;
      border: 2px solid rgba(14, 110, 142, 0.15);
    }
    .share-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .share-header h3 {
      font-size: 1.1rem;
      color: var(--sea);
      margin: 0;
    }
    .share-preview {
      background: #fff;
      border: 1px solid #e0f0f5;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: var(--ink-mid);
      line-height: 1.5;
    }
    .share-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    .share-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1rem;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      text-decoration: none;
    }
    .share-btn:hover {
      transform: translateY(-2px);
    }
    .share-btn-primary {
      background: linear-gradient(135deg, #0e6e8e 0%, #0a3d62 100%);
      color: #fff;
      box-shadow: 0 4px 12px rgba(14, 110, 142, 0.25);
    }
    .share-btn-primary:hover {
      box-shadow: 0 6px 16px rgba(14, 110, 142, 0.35);
    }
    .share-btn-outline {
      background: #fff;
      color: var(--accent);
      border: 2px solid var(--accent);
    }
    .share-btn-outline:hover {
      background: var(--foam);
    }
    .share-btn-download {
      background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
      color: #fff;
    }
    .share-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }
    .share-copied {
      display: none;
      color: #10b981;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }
    .share-copied.show {
      display: inline;
    }

    /* Canvas for share image (hidden) */
    #shareCanvas {
      display: none;
    }
  </style>
</head>

<body class="page">
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- ARIA Live Regions -->
  <div id="a11y-status" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>

  <header class="site-header" role="banner">
    <div class="navbar">
      <div class="brand">
        <a href="/">
          <img src="/assets/logo_wake_256.png" srcset="/assets/logo_wake_256.png 1x, /assets/logo_wake_512.png 2x" width="256" height="259" alt="In the Wake - Home" decoding="async"/>
        </a>
        <span class="tiny version-badge" aria-label="Site version V1.Beta">V1.Beta</span>
      </div>
      <!-- Mobile hamburger button -->
      <button class="nav-toggle" type="button" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="site-nav">
        <span class="nav-toggle-icon">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
      <nav class="site-nav" id="site-nav" aria-label="Main site navigation">
        <a class="nav-pill" href="/">Home</a>
        <div class="nav-dropdown" id="nav-planning">
          <button class="nav-pill" type="button" aria-expanded="false" aria-haspopup="true">
            Planning <span class="caret">&#9662;</span>
          </button>
          <div class="dropdown-menu" role="menu">
            <a href="/planning.html">Planning (overview)</a>
            <a href="/ships.html">Ships</a>
            <a href="/ships/quiz.html">Ship Quiz</a>
            <a href="/restaurants.html">Restaurants &amp; Menus</a>
            <a href="/ports.html">Ports</a>
            <a href="/drink-packages.html">Drink Packages</a>
            <a href="/drink-calculator.html">Drink Calculator</a>
            <a href="/stateroom-check.html">Stateroom Check</a>
            <a href="/cruise-lines.html">Cruise Lines</a>
            <a href="/packing-lists.html">Packing Lists</a>
            <a href="/accessibility.html">Accessibility</a>
          </div>
        </div>
        <div class="nav-dropdown" id="nav-travel">
          <button class="nav-pill" type="button" aria-expanded="false" aria-haspopup="true">
            Travel <span class="caret">&#9662;</span>
          </button>
          <div class="dropdown-menu" role="menu">
            <a href="/travel.html">Travel (overview)</a>
            <a href="/solo.html">Solo</a>
          </div>
        </div>
        <a class="nav-pill" href="/tools/port-tracker.html">Port Logbook</a>
        <a class="nav-pill" href="/tools/ship-tracker.html">Ship Logbook</a>
        <a class="nav-pill" href="/search.html">Search</a>
        <a class="nav-pill" href="/about-us.html">About</a>
      </nav>
    </div>
  </header>

  <!-- Progress indicator -->
  <div class="quiz-progress" id="quizProgress" aria-live="polite">
    <span id="progressText">1 of 8</span>
  </div>

  <main id="main-content" class="wrap" role="main">
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <ol>
        <li><a href="/">Home</a></li>
        <li><a href="/ships.html">Ships</a></li>
        <li aria-current="page">Ship Quiz</li>
      </ol>
    </nav>

    <div class="quiz-container">
      <!-- Intro Screen -->
      <div class="quiz-intro card" id="quizIntro">
        <h1>Find Your Perfect Ship</h1>
        <p>Not sure which cruise ship is right for you? Answer a few quick questions and we'll recommend the best matches from Royal Caribbean, Carnival, Norwegian, and MSC.</p>

        <!-- Desktop pill selector -->
        <div class="cruise-line-selector" role="group" aria-label="Select cruise line">
          <button class="line-pill active" data-line="all" type="button">
            <span class="line-dot"></span> All Lines
          </button>
          <button class="line-pill" data-line="rcl" type="button">
            <span class="line-dot"></span> Royal Caribbean
          </button>
          <button class="line-pill" data-line="carnival" type="button">
            <span class="line-dot"></span> Carnival
          </button>
          <button class="line-pill" data-line="ncl" type="button">
            <span class="line-dot"></span> NCL
          </button>
          <button class="line-pill" data-line="msc" type="button">
            <span class="line-dot"></span> MSC
          </button>
        </div>

        <!-- Mobile dropdown selector -->
        <div class="line-selector-mobile" style="position: relative;">
          <button class="line-selector-trigger" type="button" id="mobileSelectorTrigger">
            <span class="current-line">
              <span class="line-dot" style="width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg, #1a3d7c, #e31837, #00205b, #003366);"></span>
              <span id="currentLineName">All Cruise Lines</span>
            </span>
            <span>&#9662;</span>
          </button>
          <div class="line-selector-dropdown" id="mobileDropdown">
            <div class="line-option active" data-line="all">
              <span class="line-dot" style="width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg, #1a3d7c, #e31837, #00205b, #003366);"></span>
              All Cruise Lines
            </div>
            <div class="line-option" data-line="rcl">
              <span class="line-dot" style="width:10px;height:10px;border-radius:50%;background:#1a3d7c;"></span>
              Royal Caribbean
            </div>
            <div class="line-option" data-line="carnival">
              <span class="line-dot" style="width:10px;height:10px;border-radius:50%;background:#e31837;"></span>
              Carnival
            </div>
            <div class="line-option" data-line="ncl">
              <span class="line-dot" style="width:10px;height:10px;border-radius:50%;background:#00205b;"></span>
              Norwegian Cruise Line
            </div>
            <div class="line-option" data-line="msc">
              <span class="line-dot" style="width:10px;height:10px;border-radius:50%;background:#003366;"></span>
              MSC Cruises
            </div>
            <div class="line-option escape-rope" data-action="close">
              ‚Üê Back to Quiz
            </div>
          </div>
        </div>

        <p class="tiny muted" style="margin-bottom: 1.5rem;">Takes about 2 minutes. No signup required.</p>
        <button class="btn-start" id="btnStart" type="button">Let's Go</button>
      </div>

      <!-- Questions Container -->
      <div id="questionsContainer" class="hidden">
        <!-- Questions will be injected here -->
      </div>

      <!-- Results Screen -->
      <div class="quiz-results card" id="quizResults">
        <div class="results-header">
          <h2>Your Perfect Ships</h2>
          <p>Based on your answers, here are our top recommendations:</p>
        </div>
        <div id="resultsContainer">
          <!-- Results will be injected here -->
        </div>

        <!-- You Might Also Like Section -->
        <div class="also-like-section hidden" id="alsoLikeSection">
          <h3>You Might Also Like</h3>
          <p>Ships from other cruise lines that match your preferences:</p>
          <div class="also-like-grid" id="alsoLikeGrid">
            <!-- Injected dynamically -->
          </div>
          <div class="color-guide">
            <div class="color-item"><span class="dot" style="background:#1a3d7c;"></span> Royal Caribbean</div>
            <div class="color-item"><span class="dot" style="background:#e31837;"></span> Carnival</div>
            <div class="color-item"><span class="dot" style="background:#00205b;"></span> NCL</div>
            <div class="color-item"><span class="dot" style="background:#003366;"></span> MSC</div>
          </div>
        </div>

        <!-- Share Section -->
        <div class="share-section" id="shareSection">
          <div class="share-header">
            <span style="font-size: 1.3rem;">üì§</span>
            <h3>Share Your Results</h3>
          </div>
          <div class="share-preview" id="sharePreview">
            <!-- Dynamic share text -->
          </div>
          <div class="share-buttons">
            <button class="share-btn share-btn-primary" id="btnNativeShare" type="button">
              <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>
              Share
            </button>
            <button class="share-btn share-btn-outline" id="btnCopyLink" type="button">
              <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
              Copy Link
              <span class="share-copied" id="copiedMsg">Copied!</span>
            </button>
            <button class="share-btn share-btn-download" id="btnDownloadImage" type="button">
              <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
              Save Image
            </button>
          </div>
        </div>

        <!-- Hidden canvas for image generation -->
        <canvas id="shareCanvas" width="1200" height="630"></canvas>

        <div class="quiz-restart">
          <button class="btn-restart" id="btnRestart" type="button">Take Quiz Again</button>
        </div>
      </div>

      <!-- Loading State -->
      <div class="quiz-loading hidden" id="quizLoading">
        <p>Calculating your perfect ships...</p>
      </div>
    </div>
  </main>

  <footer class="site-footer" role="contentinfo">
    <p class="tiny muted" style="text-align:center; padding: 2rem;">
      &copy; 2026 In the Wake. Quiz recommendations are suggestions based on general ship characteristics.
      <br>Always verify current ship features and itineraries before booking.
    </p>
    <p class="trust-badge">‚úì No ads. No tracking. No affiliate links.</p>
  </footer>

  <!-- Dropdown nav script -->
  <script>
  (function(){
    document.querySelectorAll('.nav-dropdown').forEach(dd=>{
      const btn=dd.querySelector('button');
      const menu=dd.querySelector('.dropdown-menu');
      if(!btn||!menu)return;
      let timeout;
      const show=()=>{clearTimeout(timeout);btn.setAttribute('aria-expanded','true');menu.style.display='block';};
      const hide=()=>{timeout=setTimeout(()=>{btn.setAttribute('aria-expanded','false');menu.style.display='none';},300);};
      dd.addEventListener('mouseenter',show);
      dd.addEventListener('mouseleave',hide);
      btn.addEventListener('click',()=>{
        const open=btn.getAttribute('aria-expanded')==='true';
        open?hide():show();
      });
      btn.addEventListener('keydown',e=>{if(e.key==='Escape')hide();});
    });
  })();
  </script>

  <!-- Quiz Logic -->
  <script>
  (function() {
    'use strict';

    // State
    let quizData = null;
    let currentQuestion = 0;
    let answers = {};
    let selectedLine = 'all';

    // Line display names
    const lineNames = {
      'all': 'All Cruise Lines',
      'rcl': 'Royal Caribbean',
      'carnival': 'Carnival',
      'ncl': 'NCL',
      'msc': 'MSC'
    };

    // Questions definition
    const questions = [
      {
        id: 'group_type',
        question: "Who's sailing with you?",
        subtitle: "This helps us match the right vibe",
        options: [
          { value: 'solo', label: 'Just Me', icon: 'üß≠', desc: 'Solo adventure' },
          { value: 'couple', label: 'Me + 1', icon: 'üíë', desc: 'Couples getaway' },
          { value: 'friends', label: 'Friend Group', icon: 'üëØ', desc: 'Squad goals' },
          { value: 'family_young', label: 'Family (Kids 12 & Under)', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', desc: 'Young explorers' },
          { value: 'family_teens', label: 'Family (Teens)', icon: 'üéÆ', desc: 'Teen-approved fun' },
          { value: 'multigen', label: 'Multi-Generational', icon: 'üë¥üë∂', desc: 'Grandparents to grandkids' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'cruise_experience',
        question: "How much have you cruised?",
        subtitle: "No wrong answer here!",
        options: [
          { value: 'first_time', label: 'First Time!', icon: 'üåü', desc: 'Excited to discover cruising' },
          { value: 'a_few', label: 'A Few Cruises', icon: '‚öì', desc: "I've got the basics down" },
          { value: 'seasoned', label: 'Seasoned Sailor', icon: 'üß≠', desc: 'Lost count of my sailings' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'energy_level',
        question: "What's your ideal vacation pace?",
        subtitle: "How do you like to spend your days?",
        options: [
          { value: 'relax', label: 'Relaxation Mode', icon: 'üßò', desc: 'Pool, spa, quiet corners' },
          { value: 'balanced', label: 'Best of Both', icon: '‚öñÔ∏è', desc: 'Mix of chill and adventure' },
          { value: 'go_go_go', label: 'Go Go Go!', icon: 'üé¢', desc: 'Every activity, every show' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'crowd_tolerance',
        question: "How do you feel about crowds?",
        subtitle: "Be honest‚Äîit matters for ship selection",
        options: [
          { value: 'low', label: 'Keep It Intimate', icon: 'ü§´', desc: 'Smaller, quieter spaces' },
          { value: 'medium', label: 'Moderate Is Fine', icon: 'üë•', desc: 'Some bustle is okay' },
          { value: 'high', label: 'Bring the Energy!', icon: 'üéâ', desc: 'Love a lively atmosphere' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'ship_vs_ports',
        question: "Ship or destinations‚Äîwhat matters more?",
        subtitle: "Where's your focus?",
        options: [
          { value: 'ship', label: 'The Ship IS the Destination', icon: 'üö¢', desc: 'Onboard experience is everything' },
          { value: 'balanced', label: 'Equal Mix', icon: 'üîÑ', desc: 'Love both ship and ports' },
          { value: 'ports', label: 'All About the Ports', icon: 'üèùÔ∏è', desc: 'Ship is just transport' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'sailing_length',
        question: "How long do you want to sail?",
        subtitle: "Trip duration preference",
        options: [
          { value: 'short', label: '3-4 Nights', icon: '‚ö°', desc: 'Quick getaway' },
          { value: 'standard', label: '5-7 Nights', icon: 'üìÖ', desc: 'Classic cruise length' },
          { value: 'long', label: '8+ Nights', icon: 'üåé', desc: 'Extended voyage' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'budget_mindset',
        question: "What's your budget philosophy?",
        subtitle: "All cruises have value‚Äîthis is about priorities",
        options: [
          { value: 'value', label: 'Smart Value', icon: 'üí∞', desc: 'Best bang for the buck' },
          { value: 'balanced', label: 'Balanced Approach', icon: '‚öñÔ∏è', desc: 'Worth paying for quality' },
          { value: 'premium', label: 'Go Premium', icon: '‚ú®', desc: 'The best experience matters most' }
        ],
        gridClass: 'three-col'
      },
      {
        id: 'must_have',
        question: "What's a must-have for you?",
        subtitle: "Pick the one that matters most",
        options: [
          { value: 'waterpark', label: 'Water Slides & Pools', icon: 'üåä', desc: 'Splash-tastic fun' },
          { value: 'dining', label: 'Specialty Dining', icon: 'üçΩÔ∏è', desc: 'Foodie experiences' },
          { value: 'shows', label: 'Live Shows', icon: 'üé≠', desc: 'Entertainment first' },
          { value: 'tech', label: 'Unique Thrills', icon: 'üé¢', desc: 'Go-karts, coasters, iFly' },
          { value: 'scenic', label: 'Scenic & Relaxation', icon: 'üåÖ', desc: 'Glass, vistas, nature' },
          { value: 'family', label: 'Kids & Family Zones', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', desc: 'Family-focused areas' },
          { value: 'none', label: 'No Dealbreaker', icon: 'ü§∑', desc: 'Open to anything' }
        ],
        gridClass: 'three-col'
      }
    ];

    // DOM elements
    const quizIntro = document.getElementById('quizIntro');
    const questionsContainer = document.getElementById('questionsContainer');
    const quizResults = document.getElementById('quizResults');
    const quizProgress = document.getElementById('quizProgress');
    const progressText = document.getElementById('progressText');
    const resultsContainer = document.getElementById('resultsContainer');
    const btnStart = document.getElementById('btnStart');
    const btnRestart = document.getElementById('btnRestart');
    const alsoLikeSection = document.getElementById('alsoLikeSection');
    const alsoLikeGrid = document.getElementById('alsoLikeGrid');

    // Load quiz data
    async function loadQuizData() {
      try {
        const response = await fetch('/assets/data/ship-quiz-data-v2.json');
        quizData = await response.json();
      } catch (error) {
        console.error('Failed to load quiz data:', error);
      }
    }

    // Setup cruise line selector
    function setupLineSelector() {
      // Desktop pills
      document.querySelectorAll('.cruise-line-selector .line-pill').forEach(pill => {
        pill.addEventListener('click', () => {
          document.querySelectorAll('.cruise-line-selector .line-pill').forEach(p => p.classList.remove('active'));
          pill.classList.add('active');
          selectedLine = pill.dataset.line;
          updateMobileSelector();
        });
      });

      // Mobile dropdown
      const trigger = document.getElementById('mobileSelectorTrigger');
      const dropdown = document.getElementById('mobileDropdown');

      trigger.addEventListener('click', () => {
        dropdown.classList.toggle('open');
      });

      document.querySelectorAll('#mobileDropdown .line-option').forEach(opt => {
        opt.addEventListener('click', () => {
          if (opt.dataset.action === 'close') {
            dropdown.classList.remove('open');
            return;
          }
          document.querySelectorAll('#mobileDropdown .line-option').forEach(o => o.classList.remove('active'));
          opt.classList.add('active');
          selectedLine = opt.dataset.line;
          updateMobileSelector();
          dropdown.classList.remove('open');

          // Sync desktop pills
          document.querySelectorAll('.cruise-line-selector .line-pill').forEach(p => {
            p.classList.toggle('active', p.dataset.line === selectedLine);
          });
        });
      });

      // Close dropdown on outside click
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.line-selector-mobile')) {
          dropdown.classList.remove('open');
        }
      });
    }

    function updateMobileSelector() {
      document.getElementById('currentLineName').textContent = lineNames[selectedLine];
    }

    // Render a question
    function renderQuestion(index) {
      const q = questions[index];
      const isLast = index === questions.length - 1;

      const html = `
        <div class="quiz-question active" data-question="${q.id}">
          <div class="question-header">
            <h2>${q.question}</h2>
            <p class="question-subtitle">${q.subtitle}</p>
          </div>
          <div class="options-grid ${q.gridClass || ''}">
            ${q.options.map(opt => `
              <div class="option-card" data-value="${opt.value}" role="button" tabindex="0" aria-pressed="false">
                <div class="option-icon">${opt.icon}</div>
                <div class="option-label">${opt.label}</div>
                <div class="option-desc">${opt.desc}</div>
              </div>
            `).join('')}
          </div>
          <div class="quiz-nav">
            <button class="btn-back" type="button" ${index === 0 ? 'disabled' : ''}>Back</button>
            <button class="btn-next" type="button" disabled>${isLast ? 'See Results' : 'Next'}</button>
          </div>
        </div>
      `;

      questionsContainer.innerHTML = html;

      // Add event listeners
      const optionCards = questionsContainer.querySelectorAll('.option-card');
      const btnNext = questionsContainer.querySelector('.btn-next');
      const btnBack = questionsContainer.querySelector('.btn-back');

      optionCards.forEach(card => {
        card.addEventListener('click', () => selectOption(card, q.id, btnNext));
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectOption(card, q.id, btnNext);
          }
        });
      });

      btnNext.addEventListener('click', () => {
        if (isLast) {
          showResults();
        } else {
          currentQuestion++;
          renderQuestion(currentQuestion);
          updateProgress();
        }
      });

      btnBack.addEventListener('click', () => {
        if (currentQuestion > 0) {
          currentQuestion--;
          renderQuestion(currentQuestion);
          updateProgress();
        }
      });

      // Restore previous selection if exists
      if (answers[q.id]) {
        const prevSelected = questionsContainer.querySelector(`[data-value="${answers[q.id]}"]`);
        if (prevSelected) {
          prevSelected.classList.add('selected');
          prevSelected.setAttribute('aria-pressed', 'true');
          btnNext.disabled = false;
        }
      }
    }

    // Select an option
    function selectOption(card, questionId, btnNext) {
      const allCards = card.parentElement.querySelectorAll('.option-card');
      allCards.forEach(c => {
        c.classList.remove('selected');
        c.setAttribute('aria-pressed', 'false');
      });
      card.classList.add('selected');
      card.setAttribute('aria-pressed', 'true');
      answers[questionId] = card.dataset.value;
      btnNext.disabled = false;
    }

    // Update progress indicator
    function updateProgress() {
      progressText.textContent = `${currentQuestion + 1} of ${questions.length}`;
    }

    // Calculate scores for a cruise line
    function calculateScoresForLine(line) {
      const classScores = {};
      const classes = quizData.classes[line];
      const weights = quizData.scoring_weights[line];

      // Initialize scores
      for (const className of Object.keys(classes)) {
        classScores[className] = 0;
      }

      // Apply weights for each answer
      for (const [questionId, answer] of Object.entries(answers)) {
        if (weights[questionId] && weights[questionId][answer]) {
          const scoreAdjustments = weights[questionId][answer];
          for (const [className, points] of Object.entries(scoreAdjustments)) {
            if (classScores.hasOwnProperty(className)) {
              classScores[className] += points;
            }
          }
        }
      }

      // Apply must_have bonuses
      const mustHave = answers.must_have;
      if (mustHave && mustHave !== 'none' && quizData.must_have_bonuses[mustHave]) {
        const bonuses = quizData.must_have_bonuses[mustHave][line];
        if (bonuses) {
          for (const [className, bonus] of Object.entries(bonuses)) {
            if (classScores.hasOwnProperty(className)) {
              classScores[className] += bonus;
            }
          }
        }
      }

      return classScores;
    }

    // Get top ships for a class
    function getTopShipsForClass(line, className, count = 2) {
      const ships = Object.entries(quizData.ships[line])
        .filter(([_, ship]) => ship.class === className && ship.status === 'active')
        .sort((a, b) => b[1].year - a[1].year)
        .slice(0, count);

      return ships.map(([slug, ship]) => ({ slug, ...ship, line }));
    }

    // Generate narrative for a ship
    function generateNarrative(ship, classData, line) {
      const parts = [classData.description];

      if (answers.group_type === 'family_young' && classData.intensity >= 7) {
        parts.push(`With kids in tow, you'll love the dedicated family areas.`);
      }
      if (answers.energy_level === 'relax' && classData.intensity <= 5) {
        parts.push(`The more relaxed atmosphere is perfect for your laid-back vacation style.`);
      }
      if (ship.amplified) {
        parts.push(`Recently refreshed with modern amenities.`);
      }

      return parts.join(' ');
    }

    // Generate why explanation with score breakdown
    function generateWhy(ship, classData, line, scoreBreakdown, rank) {
      const reasons = [];

      if (rank === 1) {
        reasons.push('Top match for your preferences');
      }

      const groupMatches = {
        'solo': { intensity: [3, 6], reason: 'solo travelers' },
        'couple': { intensity: [4, 8], reason: 'couples' },
        'family_young': { intensity: [7, 10], reason: 'families with kids' },
        'family_teens': { intensity: [7, 10], reason: 'families with teens' }
      };

      if (groupMatches[answers.group_type]) {
        const match = groupMatches[answers.group_type];
        if (classData.intensity >= match.intensity[0] && classData.intensity <= match.intensity[1]) {
          reasons.push(`Great for ${match.reason}`);
        }
      }

      if (answers.energy_level === 'relax' && classData.intensity <= 5) {
        reasons.push('Matches your relaxed pace');
      }
      if (answers.energy_level === 'go_go_go' && classData.intensity >= 8) {
        reasons.push('Endless activities for your go-go-go style');
      }

      return {
        summary: reasons.slice(0, 2).join('. ') + (reasons.length > 0 ? '.' : 'A great match based on your preferences.'),
        breakdown: scoreBreakdown
      };
    }

    // Show results
    function showResults() {
      questionsContainer.classList.add('hidden');
      quizProgress.classList.remove('visible');

      const linesToScore = selectedLine === 'all'
        ? ['rcl', 'carnival', 'ncl', 'msc']
        : [selectedLine];

      // Calculate scores for all selected lines
      const allResults = [];
      const scoresByLine = {};

      for (const line of linesToScore) {
        const scores = calculateScoresForLine(line);
        scoresByLine[line] = scores;

        const sortedClasses = Object.entries(scores)
          .sort((a, b) => b[1] - a[1]);

        for (const [className, score] of sortedClasses) {
          const ships = getTopShipsForClass(line, className, 2);
          for (const ship of ships) {
            allResults.push({
              ship,
              classData: quizData.classes[line][className],
              className,
              line,
              score,
              lineData: quizData.cruise_lines[line]
            });
          }
        }
      }

      // Sort all results by score and take top 3
      allResults.sort((a, b) => b.score - a.score);
      const topResults = allResults.slice(0, 3);

      // Render results
      resultsContainer.innerHTML = topResults.map((rec, idx) => {
        const { ship, classData, className, line, score, lineData } = rec;
        const narrative = generateNarrative(ship, classData, line);
        const matchPercent = Math.min(99, Math.round(50 + score));

        const scoreBreakdown = [];
        const weights = quizData.scoring_weights[line];
        for (const [qId, answer] of Object.entries(answers)) {
          if (weights[qId] && weights[qId][answer] && weights[qId][answer][className]) {
            const pts = weights[qId][answer][className];
            const qLabel = questions.find(q => q.id === qId)?.question || qId;
            scoreBreakdown.push({ label: qLabel.replace("?", ""), points: pts });
          }
        }

        const why = generateWhy(ship, classData, line, scoreBreakdown, idx + 1);

        return `
          <article class="result-card ${idx === 0 ? 'top-pick' : ''}">
            <div class="result-brand-bar ${line}"></div>
            <div class="result-image">
              <img src="${ship.image}"
                   alt="${ship.name}"
                   loading="${idx === 0 ? 'eager' : 'lazy'}"
                   onerror="this.src='/assets/social/ships-hero.jpg'">
              <span class="result-badge">Top Pick</span>
              <span class="result-match">${matchPercent}% Match</span>
            </div>
            <div class="result-content">
              <div class="result-title">
                <h3>${ship.name}</h3>
                <div class="result-badges">
                  <span class="result-line ${line}">${lineData.short_name}</span>
                  <span class="result-class">${classData.name}</span>
                </div>
              </div>
              <p class="result-narrative">${narrative}</p>
              <div class="result-specs">
                <div class="spec-item">
                  <span class="spec-label">Year</span>
                  <span class="spec-value">${ship.year}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Size</span>
                  <span class="spec-value">${(ship.gt / 1000).toFixed(0)}K GT</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Guests</span>
                  <span class="spec-value">${ship.capacity.toLocaleString()}</span>
                </div>
              </div>
              <div class="result-highlights">
                ${ship.highlights.slice(0, 3).map(h => `<span class="highlight-tag">${h}</span>`).join('')}
              </div>
              <div class="result-why">
                <div class="result-why-header" onclick="this.nextElementSibling.nextElementSibling.classList.toggle('open'); this.querySelector('.result-why-toggle').textContent = this.nextElementSibling.nextElementSibling.classList.contains('open') ? 'Hide details' : 'Show details';">
                  <span class="result-why-title">Why this ship?</span>
                  <span class="result-why-toggle">Show details</span>
                </div>
                <p class="result-why-text">${why.summary}</p>
                <div class="result-why-details">
                  <div class="score-breakdown">
                    ${why.breakdown.slice(0, 5).map(b => `
                      <div class="score-row">
                        <span class="label">${b.label}</span>
                        <span class="points">${b.points > 0 ? '+' : ''}${b.points} pts</span>
                      </div>
                    `).join('')}
                  </div>
                </div>
              </div>
              <a href="${ship.page}" class="result-cta">
                Explore ${ship.name.split(' of ')[0]} ‚Üí
              </a>
            </div>
          </article>
        `;
      }).join('');

      // Show "You Might Also Like" if filtered to single line
      if (selectedLine !== 'all') {
        const otherLines = ['rcl', 'carnival', 'ncl', 'msc'].filter(l => l !== selectedLine);
        const otherResults = [];

        for (const line of otherLines) {
          const scores = calculateScoresForLine(line);
          const sortedClasses = Object.entries(scores).sort((a, b) => b[1] - a[1]);

          if (sortedClasses.length > 0) {
            const [topClass, topScore] = sortedClasses[0];
            const ships = getTopShipsForClass(line, topClass, 1);
            if (ships.length > 0) {
              otherResults.push({
                ship: ships[0],
                line,
                score: topScore,
                lineData: quizData.cruise_lines[line]
              });
            }
          }
        }

        if (otherResults.length > 0) {
          otherResults.sort((a, b) => b.score - a.score);

          alsoLikeGrid.innerHTML = otherResults.map(r => {
            const matchPercent = Math.min(99, Math.round(50 + r.score));
            return `
              <a href="${r.ship.page}" class="also-like-card">
                <div class="ship-name">${r.ship.name}</div>
                <div class="ship-line" style="color:${r.lineData.colors.primary}">${r.lineData.short_name}</div>
                <div class="ship-match">${matchPercent}% match</div>
              </a>
            `;
          }).join('');

          alsoLikeSection.classList.remove('hidden');
        }
      } else {
        alsoLikeSection.classList.add('hidden');
      }

      // Update share section
      const topRec = topResults[0];
      const topMatchPercent = Math.min(99, Math.round(50 + topRec.score));
      updateShareSection(topRec.ship, topMatchPercent, topRec.lineData, topRec.classData);

      quizResults.classList.add('active');
      quizResults.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Start quiz
    function startQuiz() {
      quizIntro.classList.add('hidden');
      questionsContainer.classList.remove('hidden');
      quizProgress.classList.add('visible');
      currentQuestion = 0;
      answers = {};
      renderQuestion(currentQuestion);
      updateProgress();
    }

    // Restart quiz
    function restartQuiz() {
      quizResults.classList.remove('active');
      quizIntro.classList.remove('hidden');
      questionsContainer.classList.add('hidden');
      quizProgress.classList.remove('visible');
      alsoLikeSection.classList.add('hidden');
      currentQuestion = 0;
      answers = {};
      history.replaceState({}, '', window.location.pathname);
    }

    // ==========================================
    // SHARING FUNCTIONALITY
    // ==========================================

    let currentTopShip = null;
    let currentMatchPercent = 0;
    let currentLineName = '';
    let currentClassName = '';

    function generateShareURL() {
      const data = { answers, line: selectedLine };
      const encoded = btoa(JSON.stringify(data));
      return `${window.location.origin}${window.location.pathname}?r=${encoded}`;
    }

    function parseShareURL() {
      const params = new URLSearchParams(window.location.search);
      const encoded = params.get('r');
      const lineParam = params.get('line');

      if (lineParam && ['all', 'rcl', 'carnival', 'ncl', 'msc'].includes(lineParam)) {
        selectedLine = lineParam;
        document.querySelectorAll('.cruise-line-selector .line-pill').forEach(p => {
          p.classList.toggle('active', p.dataset.line === selectedLine);
        });
        updateMobileSelector();
      }

      if (encoded) {
        try {
          const data = JSON.parse(atob(encoded));
          answers = data.answers || {};
          if (data.line) {
            selectedLine = data.line;
            document.querySelectorAll('.cruise-line-selector .line-pill').forEach(p => {
              p.classList.toggle('active', p.dataset.line === selectedLine);
            });
            updateMobileSelector();
          }
          return true;
        } catch (e) {
          console.error('Invalid share URL');
        }
      }
      return false;
    }

    function generateShareText(ship, matchPercent, lineName) {
      return `My perfect cruise ship is ${ship.name}! üö¢\n\n${matchPercent}% match for my travel style (${lineName}).\n\nFind your perfect ship:`;
    }

    function updateShareSection(ship, matchPercent, lineData, classData) {
      currentTopShip = ship;
      currentMatchPercent = matchPercent;
      currentLineName = lineData.name;
      currentClassName = classData.name;

      const sharePreview = document.getElementById('sharePreview');
      sharePreview.innerHTML = `
        <strong>"My perfect ship is ${ship.name}!"</strong><br>
        ${matchPercent}% match ‚Ä¢ ${lineData.short_name} ‚Ä¢ ${classData.name}
      `;
    }

    async function copyShareLink() {
      const url = generateShareURL();
      try {
        await navigator.clipboard.writeText(url);
        const copiedMsg = document.getElementById('copiedMsg');
        copiedMsg.classList.add('show');
        setTimeout(() => copiedMsg.classList.remove('show'), 2000);
      } catch (err) {
        const textarea = document.createElement('textarea');
        textarea.value = url;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        const copiedMsg = document.getElementById('copiedMsg');
        copiedMsg.classList.add('show');
        setTimeout(() => copiedMsg.classList.remove('show'), 2000);
      }
    }

    async function nativeShare() {
      const shareURL = generateShareURL();
      const shareText = generateShareText(currentTopShip, currentMatchPercent, currentLineName);

      if (navigator.share) {
        try {
          await navigator.share({
            title: `My Perfect Ship: ${currentTopShip.name}`,
            text: shareText,
            url: shareURL
          });
        } catch (err) {
          console.error('Share failed:', err);
        }
      } else {
        copyShareLink();
      }
    }

    async function downloadShareImage() {
      const canvas = document.getElementById('shareCanvas');
      const ctx = canvas.getContext('2d');

      // Draw background
      const bgGrad = ctx.createLinearGradient(0, 0, 1200, 630);
      bgGrad.addColorStop(0, '#0a3d62');
      bgGrad.addColorStop(1, '#083041');
      ctx.fillStyle = bgGrad;
      ctx.fillRect(0, 0, 1200, 630);

      // Content
      ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.font = '24px system-ui, sans-serif';
      ctx.fillText('My Perfect Cruise Ship Is', 80, 150);

      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 48px system-ui, sans-serif';
      ctx.fillText(currentTopShip.name, 80, 220);

      ctx.fillStyle = '#d9b382';
      ctx.font = '600 24px system-ui, sans-serif';
      ctx.fillText(`${currentMatchPercent}% Match ‚Ä¢ ${currentLineName}`, 80, 280);

      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      ctx.font = '20px system-ui, sans-serif';
      ctx.fillText('Find your perfect ship at', 80, 400);

      ctx.fillStyle = '#d9b382';
      ctx.font = 'bold 24px system-ui, sans-serif';
      ctx.fillText('cruisinginthewake.com/ships/allshipquiz.html', 80, 440);

      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.font = '600 16px system-ui, sans-serif';
      ctx.textAlign = 'right';
      ctx.fillText('In the Wake', 1120, 560);
      ctx.textAlign = 'left';

      const link = document.createElement('a');
      link.download = `my-perfect-ship-${currentTopShip.slug || 'result'}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    function setupShareListeners() {
      document.getElementById('btnNativeShare').addEventListener('click', nativeShare);
      document.getElementById('btnCopyLink').addEventListener('click', copyShareLink);
      document.getElementById('btnDownloadImage').addEventListener('click', downloadShareImage);

      if (!navigator.share) {
        document.getElementById('btnNativeShare').style.display = 'none';
      }
    }

    // Initialize
    async function init() {
      await loadQuizData();
      setupLineSelector();
      btnStart.addEventListener('click', startQuiz);
      btnRestart.addEventListener('click', restartQuiz);
      setupShareListeners();

      if (parseShareURL()) {
        quizIntro.classList.add('hidden');
        showResults();
      }
    }

    init();
  })();
  </script>

  <!-- Navigation dropdown/mobile menu -->
  <script src="/assets/js/dropdown.js"></script>
</body>
</html>
