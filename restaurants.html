<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Restaurants &amp; Menus | In the Wake</title>
  <meta name="version" content="v2.256.022"/>
  <link rel="canonical" href="https://www.cruisinginthewake.com/restaurants.html"/>
  <meta name="description" content="Premium &amp; complimentary dining across the fleet — menus, prices, accessibility notes."/>
  <!-- Standards v3.001: absolute URL + origin normalizer -->
<script>
(function(){
  var ORIGIN=(location.origin||(location.protocol+'//'+location.host)).replace(/\/$/,'');
  window._abs=function(path){ path=String(path||''); if(!path.startsWith('/')) path='/'+path; return ORIGIN+path; };
  document.addEventListener('DOMContentLoaded',function(){
    var sel=[
      'a[href^="https://www.cruisinginthewake.com/"]',
      'img[src^="https://www.cruisinginthewake.com/"]',
      'link[href^="https://www.cruisinginthewake.com/"]',
      'script[src^="https://www.cruisinginthewake.com/"]'
    ].join(',');
    document.querySelectorAll(sel).forEach(function(el){
      var attr=el.hasAttribute('href')?'href':'src';
      try{
        var u=new URL(el.getAttribute(attr));
        el.setAttribute(attr, ORIGIN+u.pathname+u.search+u.hash);
      }catch(e){}
    });
  },{once:true});
})();
</script>

<!-- Standards v3.001: Site cache utility (defer safe) -->
<script src="/assets/js/site-cache.js" defer></script>

<!-- Standards v3.001: register service worker for image cache -->
<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('/sw.js').catch(function(){});
  });
}
</script>
  <!-- bump query to bust cache -->
  <link rel="stylesheet" href="https://www.cruisinginthewake.com/assets/styles.css?v=2.246.001"/>

  <!-- ===== Page patch (scoped to Restaurants page) — NO hero overrides here ===== -->
  <style id="restaurants-v2_256_022">
    :root{
      --rope:#D9B382; --ink:#0f2a3a; --foam:#eef7fb; --accent:#0e6e8e;
    }

    /* Topbar */
    .topbar{display:flex;align-items:center;gap:.6rem;padding:.35rem .75rem}
    .topbar .logo-sm img{height:24px;width:auto;display:block}
    .topbar .ver{color:#355;opacity:.65;font-weight:600;font-size:.95rem}
    .site-header .pill-nav{margin-left:auto;display:flex;gap:.5rem;flex-wrap:wrap;position:relative;z-index:15}

    /* ===== Layout & content (no hero rules) ===== */
    body.restaurants-page{ background:linear-gradient(var(--foam),#fff 240px); color:var(--ink); }
    body.restaurants-page .section{ position:relative; margin:0 auto; max-width:1160px; padding:0 16px 1rem; }
    body.restaurants-page .section::before{
      content:""; position:absolute; inset:auto 0 0 0; margin:auto; height:420px; max-width:980px;
      background:url("https://www.cruisinginthewake.com/assets/watermark.png") no-repeat center bottom/420px auto;
      opacity:.07; pointer-events:none; transform:translateY(60px);
    }
    body.restaurants-page .divider{
      height:12px; background:var(--rope);
      -webkit-mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;
              mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;
      background-repeat:repeat-x; margin:.5rem 0 1.5rem;
    }

    /* Cards */
    .card{ border-radius:18px; box-shadow:0 2px 8px rgba(0,0,0,.06), inset 0 0 0 1px rgba(255,255,255,.7);
           background:#fff; border:2px solid var(--rope); padding:.9rem; }
    .card a{ display:block; color:inherit; text-decoration:none; }
    .card a strong{ color:#0a3d62; }
    .is-hidden{ display:none!important; }
    .section.is-hidden{ display:none!important; }

    /* Search + chips */
    #search-wrap{ max-width:1160px; margin:.75rem auto 0; padding:0 16px; }
    #q{ width:100%; padding:.65rem .85rem; border-radius:12px; border:1px solid #cfe1ea; font-size:1rem; }
    #q:focus{ border-color:#0e6e8e; box-shadow:0 0 0 3px rgba(14,110,142,.15); }
    #search-meta{ margin:.4rem 0 0; color:#355; font-size:.9rem; }
    .filters{ margin:.4rem auto 0; max-width:1160px; padding:0 16px; }
    .filters .filter-row{ display:flex; gap:.4rem; flex-wrap:wrap; align-items:center; margin:.35rem 0; }
    .chip{ padding:.35rem .6rem; border:1px dashed var(--rope); border-radius:999px; background:#fff; font-size:.85rem; cursor:pointer; user-select:none; }
    .chip[aria-pressed="true"]{ background:#0e6e8e; color:#fff; border-color:#0e6e8e; box-shadow:0 1px 6px rgba(0,0,0,.12); }
    .pill{ background:rgba(230,244,248,.75); border-left:4px solid var(--rope); border:1px solid rgba(13,59,102,.06);
           color:var(--ink); padding:.5rem .75rem; border-radius:.5rem; }

    /* Brand/Class/Ship/Venue pills + trays */
    #brandbar{ position:relative; z-index:60; max-width:1160px; margin:.35rem auto 0; padding:0 16px; }
    #brandbar .row{ display:flex; gap:.4rem; flex-wrap:wrap; align-items:center; }
    #brandbar .pillbtn{ padding:.38rem .65rem; border:1px dashed var(--rope); border-radius:999px; background:#fff; font-size:.9rem; cursor:pointer; }
    #brandbar .pillbtn[aria-pressed="true"]{ background:#0e6e8e; color:#fff; border-color:#0e6e8e; }
    #brandbar .tray{ position:absolute; top:100%; left:16px; right:16px; display:none; background:#fff; border:2px solid var(--rope);
                     border-radius:14px; padding:.6rem; margin-top:.35rem; box-shadow:0 8px 28px rgba(8,48,65,.18); }
    #brandbar .tray.on{ display:block; }
    #brandbar .tray .group{ display:flex; gap:.4rem; flex-wrap:wrap; }

    /* Ship pills inside cards */
    .ship-pills{ margin-top:.5rem; display:flex; flex-wrap:wrap; gap:.35rem; }
    .ship-pills .chip{ font-size:.75rem; padding:.25rem .5rem; border-style:solid; }

    /* Page header just below hero */
    .page-header .section{ padding-top:1rem; }
    .page-header h1{ margin:.2rem 0 .35rem; color:#083041 }
    .page-header .page-sub{ margin:0 0 1rem; color:#345 }

    /* ——— Instructions card ——— */
    .tip-card{
      background:#fff; border:2px solid var(--rope); border-radius:14px;
      box-shadow:0 2px 6px rgba(8,48,65,.08); padding:1rem; margin:.5rem 0 1rem;
    }
    .tip-head{ display:flex; align-items:center; justify-content:space-between; gap:.5rem; }
    .tip-head strong{ font-size:1.05rem; color:#083041 }
    .tip-dismiss{
      appearance:none; border:1px solid #cfe1ea; background:#f7fdff; color:#0e6e8e;
      padding:.3rem .6rem; border-radius:999px; cursor:pointer; font-size:.85rem;
    }
    .tip-dismiss:hover{ background:#eef7fb }
    .tip-list{ margin:.6rem 0 0 1.1rem; color:#163042; }
    .tip-list li{ margin:.25rem 0; }
    kbd{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:.85em; padding:.05em .35em; border:1px solid #cfe1ea; border-bottom-width:2px; border-radius:4px; background:#f7fdff;
    }
  </style>

  <!-- PATCH: 3-up responsive grid for venue cards (generic helper) -->
  <style id="restaurants-grid-patch">
    .section .grid{ display:grid; gap:1rem; }
    .section .grid-3{ grid-template-columns: 1fr; }

    @media (min-width:680px){
      .section .grid-3{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (min-width:1024px){
      .section .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    .section .grid > .card{
      display:flex; flex-direction:column; height:100%;
    }
  </style>

  <!-- Force 3-up grid on the restaurant sections (wins against old primitives) -->
  <style id="restaurants-grid-force">
    #grid-complimentary,
    #grid-premium,
    #grid-activity{
      display:grid !important;
      gap:1rem;
      grid-template-columns: 1fr;
      align-items: stretch;
    }
    @media (min-width:680px){
      #grid-complimentary,
      #grid-premium,
      #grid-activity{
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
    }
    @media (min-width:1024px){
      #grid-complimentary,
      #grid-premium,
      #grid-activity{
        grid-template-columns: repeat(3, minmax(0,1fr));
      }
    }
    #grid-complimentary > .card,
    #grid-premium > .card,
    #grid-activity > .card{
      display:flex; flex-direction:column; height:100%;
    }
  </style>
</head>

<body class="restaurants-page">
 <header class="site-header">
  <!-- Top bar: tiny logo + version + pills aligned right -->
  <div class="topbar">
    <a class="logo-sm" href="https://www.cruisinginthewake.com/">
      <img src="https://www.cruisinginthewake.com/assets/logo_wake.png" alt="In the Wake" />
    </a>
    <span class="ver">v2.256.022</span>

    <nav class="pill-nav" aria-label="Primary">
      <a class="chip" href="https://www.cruisinginthewake.com/">Home</a>
      <a class="chip" href="https://www.cruisinginthewake.com/ships/">Ships</a>
      <a class="chip" href="https://www.cruisinginthewake.com/restaurants.html" aria-current="page">Restaurants &amp; Menus</a>
      <a class="chip" href="https://www.cruisinginthewake.com/ports.html">Ports</a>
      <a class="chip" href="https://www.cruisinginthewake.com/disability-at-sea.html">Disability at Sea</a>
      <a class="chip" href="https://www.cruisinginthewake.com/drink-packages.html">Drink Packages</a>
      <a class="chip" href="https://www.cruisinginthewake.com/packing-lists.html">Packing Lists</a>
      <a class="chip" href="https://www.cruisinginthewake.com/cruise-lines/">Cruise Lines</a>
      <a class="chip" href="https://www.cruisinginthewake.com/solo.html">Solo</a>
      <a class="chip" href="https://www.cruisinginthewake.com/travel.html">Travel</a>
    </nav>
  </div>

  <!-- Full-bleed GLOBAL hero (matches ships pages) -->
  <div class="hero" role="img" aria-label="Sunset wake hero image">
    <div class="latlon-grid" aria-hidden="true">
      <svg viewBox="0 0 100 60" preserveAspectRatio="none">
        <g class="grid-lines" stroke-width="0.35">
          <line x1="10" y1="0" x2="10" y2="60"/><line x1="20" y1="0" x2="20" y2="60"/>
          <line x1="30" y1="0" x2="30" y2="60"/><line x1="40" y1="0" x2="40" y2="60"/>
          <line x1="50" y1="0" x2="50" y2="60"/><line x1="60" y1="0" x2="60" y2="60"/>
          <line x1="70" y1="0" x2="70" y2="60"/><line x1="80" y1="0" x2="80" y2="60"/>
          <line x1="90" y1="0" x2="90" y2="60"/>
          <line x1="0" y1="10" x2="100" y2="10"/><line x1="0" y1="20" x2="100" y2="20"/>
          <line x1="0" y1="30" x2="100" y2="30"/><line x1="0" y1="40" x2="100" y2="40"/>
        </g>
      </svg>
    </div>

    <img class="hero-compass" src="https://www.cruisinginthewake.com/assets/compass_rose.svg" alt="" aria-hidden="true"/>

    <div class="hero-title">
      <img class="logo" src="https://www.cruisinginthewake.com/assets/logo_wake.png" alt="In the Wake">
    </div>

    <p class="tagline">A Cruise Traveler’s Logbook</p>

    <div class="hero-credit">
      <a class="pill long" href="https://www.instagram.com/flickersofmajesty/" target="_blank" rel="noopener">
        Photo by Flickers of Majesty — Instagram
      </a>
    </div>
  </div>

  <!-- Brand/Class/Ship/Venue pill bar -->
  <nav id="brandbar" aria-label="Filter by brand, class, ship, or venue">
    <div class="row">
      <span class="label tiny">Show only:</span>
      <button class="pillbtn" id="brandBtn" aria-expanded="false" aria-controls="tray-brand">Cruise Line</button>
      <button class="pillbtn" id="classBtn" aria-expanded="false" aria-controls="tray-class">Ship Class</button>
      <button class="pillbtn" id="shipBtn"  aria-expanded="false" aria-controls="tray-ship">Ship</button>
      <button class="pillbtn" id="venueBtn" aria-expanded="false" aria-controls="tray-venue">Venue</button>
      <button class="pillbtn" id="clearBtn" title="Clear filters">Clear</button>
    </div>
    <div id="tray-brand" class="tray" role="menu"><div class="group" id="brands"></div></div>
    <div id="tray-class" class="tray" role="menu"><div class="group" id="classes"></div></div>
    <div id="tray-ship"  class="tray" role="menu"><div class="group" id="ships"></div></div>
    <div id="tray-venue" class="tray" role="menu"><div class="group" id="venues"></div></div>
  </nav>
</header><section class="page-header">
  <section class="section" id="how-to-card">
  <div class="tip-card" role="region" aria-label="How to use these filters">
    <div class="tip-head">
      <strong>How to use this page</strong>
      <button class="tip-dismiss" type="button" aria-label="Hide tips" onclick="(function(){
        localStorage.setItem('iw_rest_tips','off');
        var el=document.getElementById('how-to-card'); if(el) el.style.display='none';
      })()">Hide tips</button>
    </div>
    <ul class="tip-list">
      <li><strong>Search</strong> for venues, food types, or perks (try “sushi”, “suite”, “diamond”).</li>
      <li>Use <strong>Categories</strong> to toggle Premium / Complimentary / Activities.</li>
      <li>Open <strong>More filters</strong> to pick a Cruise Line, Class, Ship, or a specific Venue.</li>
      <li>On each result, ship <strong>button</strong> show where it’s available—those buttons respect your filters.</li>
      <li><strong>Clear</strong> resets everything. Press <kbd>/</kbd> to jump to search.</li>
    </ul>
  </div>
</section>
  <div class="section">
    <h1>Restaurants &amp; Menus <span class="version-badge">v2.256.022</span></h1>
    <p class="page-sub">Premium &amp; complimentary dining across the fleet — menus, prices, accessibility notes.</p>
  </div>
</section>
  <!-- Search -->
  <div id="search-wrap" role="search">
    <input id="q" type="search" inputmode="search" placeholder="Type to filter… (e.g., chops, sushi, suite, diamond)" aria-label="Filter restaurants by name, type, access, or tag">
    <div id="search-meta" class="tiny" aria-live="polite">Loading venues…</div>
  </div>

  <!-- Category chips -->
  <div id="filters" class="filters" role="group" aria-label="Filter dining">
    <div class="filter-row">
      <span class="label tiny">Categories:</span>
      <button type="button" class="chip" data-kind="cat" data-val="premium" aria-pressed="false">Premium</button>
      <button type="button" class="chip" data-kind="cat" data-val="complimentary" aria-pressed="false">Complimentary</button>
      <button type="button" class="chip" data-kind="cat" data-val="activity" aria-pressed="false">Activities</button>
    </div>
  </div>

  <main>
    <section class="section"><p class="pill"><strong>Note:</strong> Prices change by ship and sailing; some venues unavailable on select itineraries.</p></section>

    <!-- Auto-rendered sections -->
    <section class="section" id="complimentary">
      <h2>Main Dining &amp; Complimentary</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid grid-3" id="grid-complimentary"></div>
    </section>

    <section class="section" id="premium">
      <h2>Specialty Dining</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid grid-3" id="grid-premium"></div>
    </section>

    <section class="section" id="activity">
      <h2>Dining Activities &amp; Classes</h2>
      <div class="divider" aria-hidden="true"></div>
      <div class="grid grid-3" id="grid-activity"></div>
    </section>

    <section class="section" id="by-ship">
      <h2>Quick Links by Ship</h2>
      <div class="divider" aria-hidden="true"></div>
      <div id="ship-links"></div>
    </section>

    <section class="section">
      <p class="pill"><strong>Accessibility:</strong> See each venue page and <a href="https://www.cruisinginthewake.com/disability-at-sea.html">Disability at Sea</a> for ship notes.</p>
    </section>
  </main>

  <footer class="site-footer" style="text-align:center">
    <p>© 2025 In the Wake — A Cruise Traveler’s Logbook</p>
  </footer>

  <!-- ============ JS: render + fuzzy filter + trays + ship pills ============ -->
  <script>
(function(){
  const $  = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const $q = $('#q');
  const $meta = $('#search-meta');

  // ---------- Tips card: honor "hidden" preference ----------
  (function(){
    try {
      if (localStorage.getItem('iw_rest_tips') === 'off') {
        const hc = document.getElementById('how-to-card');
        if (hc) hc.style.display = 'none';
      }
    } catch(e) {}
  })();

  /* ---------- helpers ---------- */
  function norm(s){
    return String(s||'').toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
      .replace(/[’‘’]/g,"'")
      .replace(/[-_/]/g,' ')
      .replace(/\s+/g,' ')
      .trim();
  }
  // tiny edit-distance<=1
  function near(a,b){
    if (a===b) return true;
    if (!a||!b) return false;
    if (Math.abs(a.length-b.length)>1) return false;
    if (a.length===b.length){ let d=0; for(let i=0;i<a.length;i++) if(a[i]!==b[i]) d++; return d<=1; }
    if (a.length>b.length) [a,b]=[b,a];
    for(let i=0,j=0;i<a.length && j<b.length;){
      if (a[i]===b[j]){i++;j++;} else { j++; return a.slice(i)===b.slice(j) || a.slice(i+1)===b.slice(j); }
    }
    return true;
  }

  const SYN = {
    diamond:['diamond','diamond lounge','diamond and above','diamond plus','crown and anchor diamond','crown & anchor diamond'],
    suite:['suite','suites','suite lounge','pinnacle','coastal kitchen','the grove'],
    pinnacle:['pinnacle','suite','suite lounge','coastal kitchen','the grove'],
    complimentary:['complimentary','included','free'],
    premium:['premium','specialty','extra fee']
  };
  function tokenMatch(text, tokens){
    if (!tokens.length) return true;
    const words = text.split(/\s+/);
    return tokens.every(tok=>{
      if (!tok) return true;
      if (text.includes(tok)) return true;
      if (SYN[tok]) for (const s of SYN[tok]) if (text.includes(norm(s))) return true;
      for (const w of words){ if (w.startsWith(tok) || near(tok,w)) return true; }
      return false;
    });
  }

  /* ---------- blurbs fallback ---------- */
  const BLURB = {
    "mdr":"Rotating menus, themed nights; classic cruise dining.",
    "windjammer":"Casual buffet for breakfast, lunch, and dinner.",
    "park-cafe":"Quick salads, paninis, and the Kummelweck roll.",
    "latte-tudes":"Espresso drinks and morning pastries.",
    "sorrentos":"Grab-and-go slices and late-night pizza.",
    "room-service":"Order-in comfort; delivery fee may apply.",
    "chops":"Signature steakhouse; premium cuts and sides.",
    "giovannis":"Rustic Italian favorites; family-style warmth.",
    "izumi":"Sushi, hibachi, and hot rocks (ship dependent).",
    "chefs-table":"Hosted tasting dinner with wine pairings.",
    "samba-grill":"Brazilian churrascaria served rodizio-style.",
    "johnny-rockets":"American diner classics and milkshakes.",
    "cafe-promenade":"Light bites and coffee many hours a day.",
    "vintages":"Wine bar flights; small plates on select ships.",
    "playmakers":"Wings, sliders, and big-screen sports.",
    "dog-house":"Gourmet hot dogs with regional toppings.",
    "solarium-bistro":"Lighter Mediterranean-style buffet.",
    "coastal-kitchen":"Suite-guest dining; Mediterranean meets California.",
    "vitality-cafe":"Smoothies and light, health-forward bites.",
    "el-loco-fresh":"Casual tacos, nachos, and burritos.",
    "aquadome-market":"Icon-class food hall with global stalls.",
    "pearl-cafe":"Anytime snacks off the Promenade.",
    "surfside-eatery":"Family-friendly buffet in Surfside.",
    "the-grove":"Suite-only alfresco venue on Icon class.",
    "basecamp":"Quick bites steps from the action.",
    "celebration-table":"Private dining for your crew.",
    "pier-7":"All-day breakfast and fresh coastal plates.",
    "izumi-in-the-park":"Walk-up sushi & sweets in the open air.",
    "starbucks":"Espresso drinks and pastries.",
    "wonderland":"A whimsical, multi-sensory dining adventure.",
    "hooked":"New-England-style seafood and raw bar.",
    "jamies-italian":"Jamie Oliver’s rustic pastas and plates.",
    "150-central-park":"Chef-driven fine dining in Central Park.",
    "sugar-beach":"Candy store with hand-scooped ice cream.",
    "lincoln-park-supper-club":"Icon’s live-music supper club experience.",
    "dining-activities":"Hands-on classes and tastings fleetwide.",
    "suite-lounge":"Private lounge with small bites (Suites & Pinnacle).",
    "diamond-lounge":"Member lounge with snacks (Diamond & above)."
  };

  const roots = {
    complimentary: $('#grid-complimentary'),
    premium:       $('#grid-premium'),
    activity:      $('#grid-activity')
  };

  /* ---------- state ---------- */
  let CARDS = []; // {el, slug, cat, brand, text, ships:Set, classes:Set}
  const STATE = { cats:new Set(), query:'', brand:'rccl', klass:'', ship:'', venue:'' };

  /* ---------- ship chips update per filter (normalized) ---------- */
  function updateShipChips(card){
    const box = card.el.querySelector('.ship-pills');
    if (!box) return;
    const spans = box.querySelectorAll('[data-ship]');
    spans.forEach(sp=>{
      const ship = (sp.getAttribute('data-ship') || '').toLowerCase();
      const cls  = (sp.getAttribute('data-class')||'').toLowerCase();
      const showByShip  = !STATE.ship  || STATE.ship===ship;
      const showByClass = !STATE.klass || STATE.klass===cls;
      sp.classList.toggle('is-hidden', !(showByShip && showByClass));
    });
    const anyVisible = box.querySelectorAll('.chip:not(.is-hidden)').length>0;
    box.classList.toggle('is-hidden', !anyVisible);
  }

  /* ---------- render ---------- */
  function cardHTML(v, shipList, classList, access, shipsDict){
    const slug = v.slug;
    const name = v.name || slug;
    const href = `https://www.cruisinginthewake.com/restaurants/${slug}.html`;
    const cat  = (v.category || 'complimentary').toLowerCase();
    const blurb = v.blurb || BLURB[slug] || 'Details vary by ship; see venue page.';
    const join = arr => (Array.isArray(arr)?arr:[]).join(' ');
    const tags = norm([name, join(v.aliases), blurb, join(v.access), join(v.audience), slug].join(' '));

    const extra = [];
    if (slug==='diamond-lounge'){ extra.push('diamond lounge','diamond and above','diamond plus','crown & anchor diamond'); }
    if (slug==='suite-lounge'){ extra.push('suite lounge','pinnacle','suites'); }
    if (slug==='coastal-kitchen' || slug==='the-grove'){ extra.push('suite','pinnacle','suite restaurant'); }

    const chips = shipList.map(s=>{
      const nm = shipsDict[s]?.name || s;
      const cls= (shipsDict[s]?.class||'').toLowerCase();
      return `<span class="chip" data-ship="${s}" data-class="${norm(cls)}" title="${nm}">${nm}</span>`;
    }).join('');

    return `
      <div class="card">
        <a href="${href}"
           data-slug="${slug}"
           data-cat="${cat}"
           data-brand="rccl"
           ${shipList.length?'data-ships="'+shipList.join(' ')+'"':''}
           ${classList.length?'data-classes="'+classList.join(' ')+'"':''}
           ${access.length?'data-access="'+access.join(', ')+'"':''}
           data-tags="${tags} ${norm(extra.join(' '))}">
          <strong>${name}</strong><br><small>${blurb}</small>
        </a>
        <div class="ship-pills">${chips}</div>
      </div>`;
  }

  function hideEmptySections(){
    [['complimentary','grid-complimentary'],['premium','grid-premium'],['activity','grid-activity']].forEach(([sec,grid])=>{
      const $sec = document.getElementById(sec);
      const vis = document.getElementById(grid).querySelectorAll('.card:not(.is-hidden)').length;
      $sec.classList.toggle('is-hidden', vis===0);
    });
  }

  function reindex(){
    CARDS = $$('.grid .card a').map(a=>{
      const slug = a.getAttribute('data-slug')||'';
      const cat  = (a.getAttribute('data-cat')||'').toLowerCase();
      const brand = (a.getAttribute('data-brand')||'rccl').toLowerCase();
      const ships = new Set((a.getAttribute('data-ships')||'').toLowerCase().split(/\s+/).filter(Boolean));
      const klass = new Set((a.getAttribute('data-classes')||'').toLowerCase().split(/\s+/).filter(Boolean));
      const text = norm(a.textContent + ' ' + (a.getAttribute('data-tags')||'') + ' ' + (a.getAttribute('data-access')||''));
      return { el:a.closest('.card'), slug, cat, brand, ships, classes:klass, text };
    });
  }

  function apply(){
    const q = norm(STATE.query);
    const toks = q ? q.split(' ') : [];
    let shown = 0;

    CARDS.forEach(c=>{
      const tHit = tokenMatch(c.text, toks);
      const cHit = !STATE.cats.size || STATE.cats.has(c.cat);
      const bHit = !STATE.brand || c.brand===STATE.brand;
      const kHit = !STATE.klass || c.classes.has(STATE.klass);
      const sHit = !STATE.ship  || c.ships.has(STATE.ship);
      const vHit = !STATE.venue || c.slug===STATE.venue;
      const hit  = tHit && cHit && bHit && kHit && sHit && vHit;

      c.el.classList.toggle('is-hidden', !hit);
      if (hit) shown++;

      updateShipChips(c);
    });

    hideEmptySections();
    const total = CARDS.length;
    $meta.textContent = (q || STATE.cats.size || STATE.klass || STATE.ship || STATE.venue)
      ? `Showing ${shown} of ${total}`
      : `Showing all venues & activities`;
  }

  function wireChips(){
    $$('#filters .chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const val = (btn.getAttribute('data-val')||'').toLowerCase();
        const on  = btn.getAttribute('aria-pressed')==='true';
        if (on) STATE.cats.delete(val); else STATE.cats.add(val);
        btn.setAttribute('aria-pressed', on?'false':'true');
        apply();
      });
    });
  }

  function wireBrandBar(db){
    const bBtn=$('#brandBtn'), cBtn=$('#classBtn'), sBtn=$('#shipBtn'), vBtn=$('#venueBtn'), clr=$('#clearBtn');
    const tB=$('#tray-brand'), tC=$('#tray-class'), tS=$('#tray-ship'), tV=$('#tray-venue');
    const $brands=$('#brands'), $classes=$('#classes'), $ships=$('#ships'), $venues=$('#venues');

    function closeAll(){
      [tB,tC,tS,tV].forEach(x=>x.classList.remove('on'));
      [bBtn,cBtn,sBtn,vBtn].forEach(b=>b.setAttribute('aria-expanded','false'));
    }
    function toggle(btn,tray){
      const open = tray.classList.contains('on');
      closeAll();
      if (!open){ tray.classList.add('on'); btn.setAttribute('aria-expanded','true'); }
    }
    bBtn.addEventListener('click', ()=>toggle(bBtn,tB));
    cBtn.addEventListener('click', ()=>toggle(cBtn,tC));
    sBtn.addEventListener('click', ()=>toggle(sBtn,tS));
    vBtn.addEventListener('click', ()=>toggle(vBtn,tV));
    [tB,tC,tS,tV].forEach(tr=>{
      tr.addEventListener('mouseleave', ()=>setTimeout(closeAll,220));
      tr.addEventListener('focusout', e=>{ if(!tr.contains(e.relatedTarget)) setTimeout(closeAll,220); });
    });
    clr.addEventListener('click', ()=>{
      STATE.klass=''; STATE.ship=''; STATE.venue=''; STATE.query=''; $q.value=''; STATE.cats.clear();
      $$('#filters .chip[aria-pressed="true"]').forEach(x=>x.setAttribute('aria-pressed','false'));
      apply(); closeAll();
    });

    // brand(s)
    $brands.innerHTML = `<button class="pillbtn" data-brand="rccl" role="menuitem">Royal Caribbean</button>`;
    $brands.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click', ()=>{ STATE.brand = (b.getAttribute('data-brand')||'').toLowerCase(); apply(); closeAll(); });
    });

    // classes (largest ➜ smallest)
    const CLASS_ORDER = [
      'icon','oasis','quantum ultra','quantum','freedom','voyager',
      'radiance','vision','sovereign','empress'
    ];
    const cleanClass = s => String(s||'').toLowerCase().replace(/\s*class\s*$/,'').trim();
    const classes = Array.from(new Set(
      Object.values(db.ships || {}).map(s => cleanClass(s.class)).filter(Boolean)
    )).sort((a,b)=>{
      const ai = CLASS_ORDER.indexOf(a), bi = CLASS_ORDER.indexOf(b);
      if (ai === -1 && bi === -1) return a.localeCompare(b);
      if (ai === -1) return 1;
      if (bi === -1) return -1;
      return ai - bi;
    });

    $classes.innerHTML = classes.map(k=>{
      const label = k.replace(/\b\w/g,m=>m.toUpperCase()) + ' Class';
      return `<button class="pillbtn" data-class="${k}" role="menuitem">${label}</button>`;
    }).join('');

    $classes.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        STATE.klass = (btn.getAttribute('data-class') || '').toLowerCase();
        STATE.ship  = '';
        apply(); closeAll();
        fillShips(STATE.klass);
        toggle(sBtn, tS);
      });
    });

    // ships
    function fillShips(klass){
      const k = cleanClass(klass);
      const items = Object.entries(db.ships || {})
        .filter(([slug,p])=> !k || cleanClass(p.class) === k)
        .sort((a,b)=> (a[1].name||a[0]).localeCompare(b[1].name||b[0]));
      $ships.innerHTML = items.map(([slug,p]) =>
        `<button class="pillbtn" data-ship="${slug}" role="menuitem" title="Filter to ${p.name}">${p.name}</button>`
      ).join('');
      $ships.querySelectorAll('button').forEach(b=>{
        b.addEventListener('click', ()=>{
          STATE.ship = (b.getAttribute('data-ship')||'').toLowerCase();
          apply(); closeAll();
          window.scrollTo({top: $('#q').offsetTop - 80, behavior:'smooth'});
        });
      });
    }
    fillShips('');

    // venues (by name)
    const venues = (db.venues||[]).slice().sort((a,b)=> (a.name||a.slug).localeCompare(b.name||b.slug));
    $venues.innerHTML = venues.map(v=>`<button class="pillbtn" data-venue="${v.slug}" role="menuitem">${v.name}</button>`).join('');
    $venues.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click', ()=>{
        STATE.venue = (b.getAttribute('data-venue')||'').toLowerCase();
        apply(); closeAll();
        window.scrollTo({top: $('#q').offsetTop - 80, behavior:'smooth'});
      });
    });
  }

  // input + keyboard focus
  $q && $q.addEventListener('input', ()=>{ STATE.query = $q.value || ''; apply(); });
  window.addEventListener('keydown', e=>{ if(e.key==='/' && document.activeElement!==$q){ e.preventDefault(); $q.focus(); }});

  // fail-safe meta text
  if ($meta) $meta.textContent = 'Loading venues…';

  /* ---------- load JSON and render ---------- */
  (async function boot(){
    let db=null;
    try{
      const DATA_URL = location.origin.replace(/\/$/,'') + '/assets/data/venues.json';
      const res = await fetch(DATA_URL, {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      db = await res.json();
    }catch(e){
      $meta && ($meta.textContent = 'Could not load venues.'); return;
    }

    // reverse maps
    const shipsByVenue = new Map();     // slug -> Set(ship)
    const classesByShip = {};           // ship -> class(lower)
    Object.entries(db.ships||{}).forEach(([ship, payload])=>{
      classesByShip[ship] = String(payload.class||'').toLowerCase();
      (payload.venues||[]).forEach(slug=>{
        if(!shipsByVenue.has(slug)) shipsByVenue.set(slug, new Set());
        shipsByVenue.get(slug).add(ship);
      });
    });
    const classesByVenue = new Map();   // slug -> Set(class)
    shipsByVenue.forEach((set, slug)=>{
      const ks = new Set();
      set.forEach(ship=>{ const k = classesByShip[ship]; if(k) ks.add(k); });
      classesByVenue.set(slug, ks);
    });

    // paint all cards
    (db.venues||[]).forEach(v=>{
      const slug = v.slug;
      const shipList  = Array.from((shipsByVenue.get(slug)||new Set()).values());
      const classList = Array.from((classesByVenue.get(slug)||new Set()).values());
      const access    = (Array.isArray(v.access)?v.access:[]).map(x=>norm(x));
      const root = roots[(v.category||'complimentary').toLowerCase()] || roots.complimentary;
      root.insertAdjacentHTML('beforeend', cardHTML(v, shipList, classList, access, db.ships||{}));
    });

    // quick ship links (filter pills under "Quick Links by Ship")
    const host = $('#ship-links');
    if (host){
      const items = Object.entries(db.ships||{}).sort((a,b)=> (a[1].name||a[0]).localeCompare(b[1].name||b[0]));
      host.innerHTML = items.map(([slug,p])=>`<button class="chip" data-ship="${slug}" title="Show ${p.name} venues">${p.name}</button>`).join('');
      host.querySelectorAll('button').forEach(b=>{
        b.addEventListener('click', ()=>{
          STATE.ship = (b.getAttribute('data-ship')||'').toLowerCase();
          apply();
          window.scrollTo({top: $('#q').offsetTop - 80, behavior:'smooth'});
        });
      });
    }

    // index & wire UI
    reindex();
    wireChips();
    wireBrandBar(db);
    apply();
    $meta && ($meta.textContent = 'Showing all venues & activities');
  })();
})();
  </script>
</body>
</html>
