<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Versioning / Standards -->
  <meta name="page:version" content="v3.010.102">
  <meta name="version" content="v3.010.102">
  <meta name="standards:baseline" content="3.009">
  <meta name="referrer" content="no-referrer">
  <meta name="theme-color" content="#083041">

  <!-- Analytics (placeholder – drop in your Umami snippet here) -->
  <!-- <script defer src="...umami.js" data-website-id="..."></script> -->

  <!-- _abs() helper (must appear before we build absolute asset/canonical URLs) -->
  <script>
    (function(){
      window._abs = function(path){
        try { return new URL(path, location.origin + '/').href; }
        catch(_) { return path; }
      };
      // Canonicalize apex -> www (session-guarded if you need)
      var h = location.hostname;
      if (h === 'cruisinginthewake.com') {
        location.replace(location.href.replace('://cruisinginthewake.com','://www.cruisinginthewake.com'));
      }
    })();
  </script>

  <title>Drink Packages Calculator — In the Wake (v3.010.102)</title>
  <link rel="canonical" id="canon" href="">
  <script>
    // set canonical to absolute on DOM-ready-ish
    (function(){
      var el = document.getElementById('canon');
      if (el) el.href = _abs(location.pathname);
    })();
  </script>

  <!-- SEO -->
  <meta name="description" content="Figure out whether a cruise drink package is worth it. Enter your daily drinks and compare à-la-carte vs. packages.">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Drink Packages Calculator — In the Wake">
  <meta property="og:description" content="Enter your daily drinks; we’ll compare à-la-carte vs. packages.">
  <meta property="og:url" content="">
  <meta property="og:image" content="/assets/index_hero.jpg?v=3.010.102">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Drink Packages Calculator — In the Wake">
  <meta name="twitter:description" content="A quick way to check if a cruise drink package pays off for you.">
  <meta name="twitter:image" content="/assets/index_hero.jpg?v=3.010.102">
  <script>document.querySelector('meta[property="og:url"]').setAttribute('content', location.href);</script>

  <!-- Site CSS (version-coupled) -->
  <link rel="stylesheet" href="/assets/styles.css?v=3.010.102">

  <style>
    /* Page-scoped add-ons (kept lean; global lives in /assets/styles.css?v=...) */
    :root{
      --ink:#0a3d62; --muted:#5f6b72; --bg:#f7f9fa; --card:#ffffff; --line:#dfe7ea; --accent:#0e6e8e; --good:#0b7a43;
    }
    html, body { overflow-x:hidden; background:var(--bg); color:var(--ink); }
    .wrap{ max-width: 1140px; margin:0 auto; padding:0 1rem; }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid var(--line); background:#fff;
    }
    .skip{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skip:focus{ position:static; width:auto; height:auto; padding:.4rem .6rem; background:#083041; color:#fff; border-radius:8px; margin:.5rem; }
    .brand{ display:flex; align-items:center; gap:.5rem; padding:.75rem 0; }
    .brand a{ color:inherit; text-decoration:none; font-weight:700; }
    nav[aria-label="Primary"] a{ text-decoration:none; color:var(--ink); padding:.5rem .65rem; border-radius:8px; }
    nav[aria-label="Primary"] a:hover, nav[aria-label="Primary"] a:focus { background:rgba(14,110,142,.08); }
    header.page{
      padding:1.25rem 0 1rem;
    }

    /* 12-col grid with sticky right rail */
    .grid{ display:grid; grid-template-columns:repeat(12, 1fr); gap:1rem; align-items:start; }
    .col-7{ grid-column: span 7; }
    .col-5{ grid-column: span 5; position: sticky; top: 1rem; align-self:start; }
    @media (max-width: 980px){
      .col-7, .col-5 { grid-column: 1 / -1; position: static; }
    }

    .muted{ color:var(--muted) }
    .tiny{ font-size:.88rem }
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:12px;
      padding:1rem; box-shadow:0 1px 2px rgba(10,61,98,0.04);
    }
    .pill-row{ display:flex; gap:.5rem; flex-wrap:wrap; margin:.35rem 0 .75rem }
    .pill{
      border:1px solid var(--line); background:#fff; color:var(--ink);
      padding:.35rem .6rem; border-radius:999px; cursor:pointer; font-weight:600;
    }
    .pill[aria-current="true"]{ background:var(--accent); color:#fff; border-color:var(--accent) }

    /* Calculator */
    .calc-row{ display:grid; grid-template-columns:1fr auto; gap:.5rem; align-items:center; }
    input[type="number"]{
      width:6rem; font:inherit; padding:.4rem .5rem; border-radius:8px;
      border:1px solid var(--line); background:#fff;
    }
    #beverage-inputs .card{ margin-bottom:.6rem }
    #package-cards{ display:grid; gap:.75rem }
    @media (min-width:720px){ #package-cards{ grid-template-columns:repeat(3, 1fr) } }
    article.pkg{ position:relative; overflow:hidden }
    .pkg .ribbon{
      position:absolute; top:.75rem; right:-.5rem; transform:rotate(12deg);
      background:var(--good); color:#fff; padding:.25rem .65rem; border-radius:6px;
      font-size:.8rem; box-shadow:0 2px 6px rgba(0,0,0,.12);
    }
    .pkg.highlight{ outline:2px solid var(--good); outline-offset:2px; }
    .pkg header{ display:flex; align-items:flex-start; justify-content:space-between; gap:.65rem; margin-bottom:.35rem }
    .pkg header .price{ white-space:nowrap }
    button{
      background:#fff; border:1px solid var(--line); border-radius:999px; padding:.4rem .65rem;
      color:var(--ink); font-weight:600; cursor:pointer;
    }
    button.override{ border-color:var(--accent); color:var(--accent); }
    button.override:hover{ background:rgba(14,110,142,.06) }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }

    /* Rails */
    .rail-block + .rail-block{ margin-top:1rem }
    .rail-block h3{ margin:.25rem 0 .5rem; font-size:1rem }
    .rail-list{ list-style:none; margin:0; padding:0 }
    .rail-list li + li{ margin-top:.5rem }
    .rail-list a{ color:var(--ink); text-decoration:none; }
    .rail-list a:hover{ text-decoration:underline; }
  </style>

  <!-- JSON-LD (WebPage) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebPage",
    "name":"Drink Packages Calculator",
    "url": "",
    "description":"Compare à-la-carte drink costs vs package prices on your cruise.",
    "isPartOf": { "@type":"WebSite", "name":"In the Wake", "url":"https://www.cruisinginthewake.com/" }
  }
  </script>
  <script>document.currentScript.previousElementSibling.textContent = document.currentScript.previousElementSibling.textContent.replace(/"url": ""/,'"url": "'+location.href.replace(/"/g,'\\"')+'"');</script>
</head>

<body>
  <!-- Hidden Invocation / Dedication -->
  <!--
  Soli Deo Gloria — Every pixel and paragraph for His glory.
  This site is dedicated as a 'blank check' — wherever He would send us.
  (c) In the Wake Project
  -->

  <!-- Topbar / Unified Nav hooks -->
  <div class="topbar wrap" role="navigation" aria-label="Site">
    <a class="skip" href="#main">Skip to main content</a>
    <div class="brand">
      <a href="/" data-portal-nav="home">In the Wake</a>
    </div>
    <nav aria-label="Primary">
      <!-- These anchors are placeholders; your unified_nav script can hydrate -->
      <a href="/planning.html" data-portal-nav="planning">Planning</a>
      <a href="/ports.html" data-portal-nav="ports">Ports</a>
      <a href="/restaurants.html" data-portal-nav="dining">Dining</a>
      <a href="/drink-packages.html" aria-current="page">Drinks</a>
    </nav>
  </div>

  <header class="page wrap" role="banner">
    <h1 style="margin:0 0 .35rem">Beverage Calculator</h1>
    <p class="muted tiny">Pick your daily drinks and we’ll compare à-la-carte vs. packages.</p>

    <div class="pill-row" role="tablist" aria-label="Cruise line">
      <button id="pill-rccl" class="pill" data-src="/assets/data/lines/royal-caribbean.json" aria-current="true" role="tab">
        Royal Caribbean
      </button>
      <!-- Future lines -->
      <!-- <button class="pill" data-src="/assets/data/lines/carnival.json" role="tab">Carnival</button> -->
    </div>

    <div class="calc-row" style="max-width:420px">
      <label for="days"><strong>Trip length</strong></label>
      <input id="days" type="number" inputmode="numeric" min="1" step="1" value="7" aria-describedby="days-help" />
    </div>
    <div id="days-help" class="tiny muted" style="margin-top:.25rem">People often book 5–7 nights. Adjust as needed.</div>
    <div id="totals" class="tiny" aria-live="polite" style="margin-top:.35rem"></div>
    <div id="totals-line" class="tiny muted" aria-live="polite" style="margin-top:.15rem"></div>
  </header>

  <main id="main" class="wrap" role="main">
    <div class="grid">
      <!-- Main column (calculator) -->
      <section class="col-7" aria-labelledby="calc-heading">
        <h2 id="calc-heading" class="sr-only">Your picks</h2>
        <div id="beverage-inputs"></div>

        <h2 id="packages-title" style="margin-top:.6rem">Beverage Packages</h2>
        <div class="tiny muted" id="packages-expl" style="margin:-.35rem 0 .5rem"></div>
        <div id="package-cards"></div>
      </section>

      <!-- Right rail (articles & author rails) -->
      <aside class="col-5" aria-labelledby="rail-heading">
        <h2 id="rail-heading" class="sr-only">Related</h2>

        <!-- Article Rail -->
        <div class="rail-block card" id="rail-articles" data-rail="articles">
          <h3>Recommended Reading</h3>
          <ul class="rail-list">
            <li><a href="/articles/should-you-buy-the-deluxe-package.html" data-prefetch="hover">Should you buy the Deluxe package?</a></li>
            <li><a href="/articles/how-gratuities-work-on-drink-packages.html" data-prefetch="hover">How drink gratuities really work</a></li>
            <li><a href="/articles/mocktails-and-kids-soda-plans.html" data-prefetch="hover">Mocktails & kids’ soda plans</a></li>
          </ul>
        </div>

        <!-- Author Rail -->
        <div class="rail-block card" id="rail-author" data-rail="author">
          <h3>About the Author</h3>
          <p class="tiny muted">Pastor, coder, cruiser. I test these tools so you don’t waste money onboard.</p>
          <p class="tiny"><a href="/about-us.html" data-prefetch="hover">About us</a></p>
        </div>
      </aside>
    </div>
  </main>

  <footer class="wrap muted tiny" role="contentinfo" style="padding:1.25rem 0 2rem">
    © In the Wake — <a href="/accessibility.html">Accessibility</a>
  </footer>

  <script>
  (function(){
    "use strict";
    // Version coupling guard if needed elsewhere
    const PAGE_VERSION = document.querySelector('meta[name="page:version"]').content || 'v0';

    // Prefetch on-hover (articles, author links) via SW if available
    (function hoverPrefetch(){
      const seed = (urls) => { try{ window.itwSeedSW && window.itwSeedSW(urls, 'low'); }catch(_){ } };
      const linkHrefs = new Set();
      function onOver(e){
        const a = e.currentTarget;
        const href = a.getAttribute('href');
        if (!href || linkHrefs.has(href)) return;
        linkHrefs.add(href);
        seed([href]);
      }
      document.querySelectorAll('[data-prefetch="hover"]').forEach(a=>{
        a.addEventListener('mouseenter', onOver, { once:true, passive:true });
        a.addEventListener('focus', onOver, { once:true, passive:true });
      });
    })();

    // ---------------- Calculator ----------------
    const state = {
      days: 7,
      epsilon: 0.02,
      items: new Map(),
      order: [],
      sets: { soda: new Set(), refresh: new Set(), alcohol: new Set() },
      packages: new Map(),
      lineId: '',
      lineTitle: ''
    };

    const els = {
      inputsHost:  document.getElementById('beverage-inputs'),
      packageHost: document.getElementById('package-cards'),
      packagesTitle: document.getElementById('packages-title'),
      packagesExpl: document.getElementById('packages-expl'),
      totals:      document.getElementById('totals'),
      totalsLine:  document.getElementById('totals-line'),
      days:        document.getElementById('days'),
      pillRccl:    document.getElementById('pill-rccl')
    };

    const fmt = n => '$' + (Math.round(n * 100) / 100).toFixed(2);
    const getLS = (k,d)=>{ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):d; }catch(_){ return d; } };
    const setLS = (k,v)=>{ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(_){ } };
    const seedSW = (urls, priority='normal')=>{ try{ if (window.itwSeedSW) window.itwSeedSW(urls, priority); }catch(_){} };

    function sanitizedHTML(str=''){
      const div = document.createElement('div'); div.innerHTML = str;
      div.querySelectorAll('script,style').forEach(n=>n.remove());
      return div.innerHTML;
    }

    function renderInputs(){
      els.inputsHost.innerHTML = state.order.map(id=>{
        const it = state.items.get(id);
        const priceNote = it.meta.free
          ? '<span class="muted">(included · $0)</span>'
          : `<span class="price tiny">avg ${fmt(it.meta.avgPrice)}</span>`;
        return `
          <div class="card" style="padding:.7rem .8rem">
            <div class="calc-row">
              <label for="qty-${id}">${it.meta.name}</label>
              <input id="qty-${id}" type="number" inputmode="numeric" min="0" step="1" value="${it.qtyPerDay||0}" data-item="${id}" aria-describedby="help-${id}" />
              <div class="tiny muted" id="help-${id}">${priceNote}</div>
            </div>
            ${it.meta.notes ? `<div class="tiny muted" style="margin-top:.35rem">${it.meta.notes}</div>` : ``}
          </div>`;
      }).join('');

      els.inputsHost.querySelectorAll('input[type="number"]').forEach(inp=>{
        inp.addEventListener('input', ()=>{
          const id = inp.dataset.item;
          const ent = state.items.get(id);
          ent.qtyPerDay = Math.max(0, parseInt(inp.value || '0', 10));
          computeAndRender();
        });
      });
    }

    function pkgPriceDisplay(pmeta){
      const key = 'pkgOverride:'+state.lineId+':'+pmeta.id;
      const ov = getLS(key, null);
      const value = ov!=null ? Number(ov) : (Number(pmeta.avg) || (pmeta.priceRange?.[0] ?? 0));
      return { value, overridden: ov!=null };
    }

    function renderPackages(view){
      const frag = document.createDocumentFragment();

      state.packages.forEach(p=>{
        const { value, overridden } = pkgPriceDisplay(p.meta);
        const range = p.meta.priceRange ? ` (${fmt(p.meta.priceRange[0])}–${fmt(p.meta.priceRange[1])})` : '';
        const strategyCost = view[p.meta.id+'Daily'] ?? null;
        const includeVal = view.includedDaily[p.meta.id] ?? 0;

        const el = document.createElement('article');
        el.className = `pkg card ${view.bestIds.has(p.meta.id)?'highlight':''}`;
        el.id = `pkg-${p.meta.id}`;
        el.setAttribute('aria-live','polite');

        const descList = Array.isArray(p.meta.description)&&p.meta.description.length
          ? `<ul class="tiny" style="margin:.5rem 0 0 1.25rem">${p.meta.description.map(d=>`<li>${d}</li>`).join('')}</ul>`
          : '';

        el.innerHTML = `
          <span class="ribbon" role="status" style="display:${view.bestIds.has(p.meta.id)?'inline-block':'none'}">Best value</span>
          <header>
            <div><strong>${p.meta.name}</strong> <span class="tiny muted">${range}</span></div>
            <div class="price" data-price="${p.meta.id}">${fmt(value)}</div>
          </header>
          <div class="body">
            <div class="tiny" style="margin:.1rem 0 .4rem">
              Included value (your picks): <strong>${fmt(includeVal)}</strong> /day
              ${strategyCost!=null ? `<span class="muted">· With this package you’d pay <strong>${fmt(strategyCost)}</strong> /day</span>` : ``}
            </div>
            <button class="pill override" data-ov="${p.meta.id}" type="button">${overridden?'Edit Price (overridden)':'Edit Price'}</button>
            ${descList}
          </div>`;

        frag.appendChild(el);
      });

      els.packageHost.innerHTML = '';
      els.packageHost.appendChild(frag);

      els.packageHost.querySelectorAll('button[data-ov]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.dataset.ov;
          const key = 'pkgOverride:'+state.lineId+':'+id;
          const pmeta = state.packages.get(id).meta;
          const suggested = getLS(key, null) ?? (Number(pmeta.avg) || (pmeta.priceRange?.[0] ?? 0));
          const v = prompt('Enter your package price per person per day (USD).', String(suggested));
          if (v==null) return;
          const num = Number(v);
          if (!Number.isFinite(num) || num<0) { alert('Please enter a valid non-negative number.'); return; }
          setLS(key, num);
          computeAndRender();
        });
      });
    }

    function computeAndRender(){
      let dailyTotal = 0;
      let sodaSpend = 0, refreshNonAlcoholSpend = 0, alcoholSpend = 0;

      state.items.forEach((it,id)=>{
        const spend = (it.meta.avgPrice||0) * (it.qtyPerDay||0);
        dailyTotal += spend;
        if (state.sets.soda.has(id))     sodaSpend += spend;
        if (state.sets.refresh.has(id))  refreshNonAlcoholSpend += spend;
        if (state.sets.alcohol.has(id))  alcoholSpend += spend;
      });

      const days = Math.max(1, parseInt(els.days.value||'1',10));
      state.days = days;
      const tripTotal = dailyTotal * days;
      els.totals.textContent = `Daily total (à la carte): ${fmt(dailyTotal)} · Trip total: ${fmt(tripTotal)}`;
      els.totalsLine.textContent = `Tip: You can override package prices to match the sale you see in your planner.`;

      const pkg = {};
      ['soda','refreshment','deluxe'].forEach(pid=>{
        const meta = state.packages.get(pid)?.meta;
        if (meta) pkg[pid] = pkgPriceDisplay(meta).value;
      });

      const noneDaily    = dailyTotal;
      const sodaDaily    = (pkg.soda ?? Infinity) + (dailyTotal - sodaSpend);
      const refreshDaily = (pkg.refreshment ?? Infinity) + alcoholSpend;
      const deluxeDaily  = (pkg.deluxe ?? Infinity);

      const includedDaily = {
        soda: sodaSpend,
        refreshment: refreshNonAlcoholSpend,
        deluxe: dailyTotal
      };

      const entries = [
        {id:'none',        cost:noneDaily,       rank:0},
        {id:'soda',        cost:sodaDaily,       rank:1},
        {id:'refreshment', cost:refreshDaily,    rank:2},
        {id:'deluxe',      cost:deluxeDaily,     rank:3}
      ];

      entries.sort((a,b)=>{
        if (Math.abs(a.cost-b.cost) <= state.epsilon) return b.rank - a.rank; // prefer more inclusive on tie
        return a.cost - b.cost;
      });
      const bestCost = entries[0].cost;
      const bestIds = new Set(entries.filter(e=>Math.abs(e.cost-bestCost) <= state.epsilon).map(e=>e.id));

      renderPackages({ noneDaily, sodaDaily, refreshDaily, deluxeDaily, includedDaily, bestIds });
    }

    async function loadDataset(src){
      try{
        let data = null;
        if (src && src.startsWith('#')){
          const tag = document.querySelector(src);
          if (!tag) throw new Error('missing inline JSON');
          data = JSON.parse(tag.textContent);
        }else{
          const r = await fetch(src + (src.includes('?') ? '&' : '?') + 'v=' + PAGE_VERSION, { cache:'no-store', credentials:'omit' });
          if(!r.ok) throw new Error('Bad response');
          data = await r.json();
        }

        state.lineId   = data.lineId || data.line || 'unknown-line';
        state.lineTitle= data.text?.lineTitle || data.text?.line || 'Cruise Line';
        els.packagesTitle.textContent = data.text?.packagesTitle || (state.lineTitle + ' Beverage Packages');
        els.packagesExpl.innerHTML = sanitizedHTML(data.text?.packagesExplHtml || '');

        if (typeof data.rules?.epsilon === 'number') state.epsilon = data.rules.epsilon;

        state.items = new Map();
        (data.items || []).forEach(it=>{
          state.items.set(it.id, {
            meta: {
              id: it.id,
              name: it.label || it.name || it.id,
              avgPrice: Number(it.price || it.avgPrice || 0),
              free: !!it.free,
              notes: it.notes || ''
            },
            qtyPerDay: 0
          });
        });

        const paid = [], free = [];
        state.items.forEach((v,k)=> (v.meta.free?free:paid).push([k,v]));
        paid.sort((a,b)=> (b[1].meta.avgPrice - a[1].meta.avgPrice));
        free.sort((a,b)=> a[1].meta.name.localeCompare(b[1].meta.name));
        state.order = [...paid.map(x=>x[0]), ...free.map(x=>x[0])];

        state.sets = {
          soda:    new Set(data.sets?.soda    || ['soda']),
          refresh: new Set(data.sets?.refresh || []),
          alcohol: new Set(data.sets?.alcohol || [])
        };

        state.packages = new Map();
        const pkgObj = data.packages || {};
        Object.keys(pkgObj).forEach(k=>{
          const p = pkgObj[k];
          const pr = parseRange(p.range);
          state.packages.set(k, {
            meta: {
              id: k,
              name: p.name || k,
              avg: Number(p.price || p.avg || 0),
              priceRange: pr,
              description: Array.isArray(p.includes) ? p.includes.slice() : []
            }
          });
        });

        // seed SW softly with dataset + this page
        seedSW([typeof src==='string' ? src : (location.pathname + src), location.pathname], 'low');

        renderInputs();
        computeAndRender();
      }catch(err){
        console.warn('Dataset load failed:', err?.message||err);
        els.packagesExpl.textContent = 'Could not load data. Try refreshing the page.';
      }
    }

    function parseRange(s){
      if (!s || typeof s!=='string') return null;
      const m = s.match(/(\d+(\.\d+)?)\s*[–-]\s*(\d+(\.\d+)?)/);
      if (!m) return null;
      const a = Number(m[1]), b = Number(m[3]);
      if (!Number.isFinite(a) || !Number.isFinite(b)) return null;
      return [Math.min(a,b), Math.max(a,b)];
    }

    // events
    els.days.addEventListener('input', computeAndRender);

    document.getElementById('pill-rccl').addEventListener('click', (e)=>{
      document.querySelectorAll('.pill-row .pill').forEach(p=>p.setAttribute('aria-current','false'));
      e.currentTarget.setAttribute('aria-current','true');
      const src = e.currentTarget.getAttribute('data-src');
      // pre-warm dataset
      seedSW([src], 'high');
      loadDataset(src);
    });

    // boot
    loadDataset(els.pillRccl.getAttribute('data-src'));
  })();
  </script>
</body>
</html>
