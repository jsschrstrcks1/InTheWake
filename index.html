<!--
Soli Deo Gloria — Diagnostic build to isolate dropdown failure.
Page: /index.html · v3.009.017-diagnostic (nav debug + overlay detection) · Built: 2025-10-21T00:00:00Z
-->
<!doctype html>
<html lang="en">
<head>
  <!-- Consent (kept to test interference). If this blocks, logs will show it. -->
  <script type="text/javascript" data-cmp-ab="1"
          src="https://cdn.consentmanager.net/delivery/autoblocking/e11a25480244a.js"
          data-cmp-host="a.delivery.consentmanager.net"
          data-cmp-cdn="cdn.consentmanager.net"
          data-cmp-codesrc="16"></script>

  <!-- Analytics (left as-is) -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WZP891PZXJ"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);} gtag('js',new Date()); gtag('config','G-WZP891PZXJ',{anonymize_ip:true});</script>

  <!-- Core meta -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="referrer" content="no-referrer">
  <meta name="robots" content="index,follow,max-image-preview:large">
  <meta name="page:version" content="3.009.017-diagnostic">
  <meta name="standards:baseline" content="3.009">
  <title>In the Wake | Diagnostic Nav Build</title>
  <meta name="description" content="Diagnostic build to troubleshoot dropdown nav behavior.">
  <link rel="canonical" href="https://www.cruisinginthewake.com/"/>

  <!-- Preload hero (kept) -->
  <link rel="preload" as="image" href="/assets/index_hero.jpg?v=3.009.017" fetchpriority="high">

  <!-- Inline CSS (self-contained) -->
  <style>
    :root{--sea:#0a3d62;--foam:#e6f4f8;--rope:#d9b382;--ink:#083041;--sky:#f7fdff;--accent:#0e6e8e;}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--ink);background:var(--sky);line-height:1.55}
    .skip-link{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip-link:focus{left:.75rem;top:.5rem;width:auto;height:auto;background:#0e6e8e;color:#fff;border-radius:10px;padding:.35rem .6rem;z-index:1000;outline:0}

    /* Header + hero */
    .hero-header{position:relative;border-bottom:6px double var(--rope);background:#eaf6f6}
    .navbar{max-width:1100px;margin:0 auto;display:flex;align-items:flex-end;gap:.6rem;padding:.5rem .9rem .35rem;position:relative;z-index:1000;overflow:visible}
    .brand{display:flex;align-items:flex-end;gap:.6rem}
    .brand img{height:28px;width:auto;display:block}
    .version-badge{font-size:.72rem;opacity:.8;margin-left:.35rem}

    .pill-nav{flex:1 1 auto;min-width:0;display:flex;align-items:center;justify-content:center;gap:.45rem;white-space:nowrap;flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;padding-inline:.75rem}
    .pill-nav a,.pill-nav button.nav-disclosure{display:inline-flex;align-items:center;gap:.35rem;padding:.35rem .7rem;border-radius:10px;background:#fff;border:1px solid var(--rope);color:var(--accent);font:inherit;font-size:.9rem;line-height:1.2;cursor:pointer;text-decoration:none}
    .pill-nav a:hover,.pill-nav button.nav-disclosure:hover{background:#f9fdfd}
    .pill-nav a[aria-current="page"]{outline:3px dashed var(--rope);outline-offset:2px;box-shadow:0 0 0 3px rgba(200,163,106,.15) inset}

    /* Dropdowns */
    .nav-group{position:relative}
    .submenu{
      position:absolute;left:0;top:calc(100% + 6px);min-width:220px;background:#fff;border:1px solid var(--rope);border-radius:12px;
      padding:.35rem;box-shadow:0 8px 24px rgba(8,48,65,.12);display:none;visibility:hidden;opacity:0;pointer-events:none;z-index:10000
    }
    /* Open states: JS data attribute, focus, or hover */
    .nav-group[data-open="true"]>.submenu,
    .nav-group:focus-within>.submenu,
    .nav-group:hover>.submenu{
      display:block !important; visibility:visible !important; opacity:1 !important; pointer-events:auto !important;
    }

    /* Hero */
    .hero{position:relative;width:100%;min-height:clamp(200px,24vw,340px);background:url('/assets/index_hero.jpg?v=3.009.017') 50% 50%/cover no-repeat;display:flex;align-items:flex-end;overflow:hidden}
    .hero-credit{position:absolute;right:.85rem;bottom:.85rem;z-index:4}
    .hero-credit .pill{display:inline-block;padding:.45rem .7rem;border-radius:999px;background:#fff;border:1px solid var(--rope);font-weight:600;color:#0a3d62;text-decoration:none}
    .hero-title{position:absolute;left:min(3vw,1rem);bottom:clamp(.6rem,2vw,1.4rem);z-index:3;display:flex;align-items:flex-end;gap:.6rem;text-shadow:0 2px 6px rgba(0,0,0,.45)}
    .hero-title .logo{width:clamp(189px,23.1vw,378px);max-width:min(45vw,520px)}

    /* Content */
    .wrap{max-width:1100px;margin:0 auto;padding:20px 14px 36px}
    .card{background:#fff;border:2px solid var(--rope);border-radius:14px;padding:1rem;margin:.8rem 0;box-shadow:0 2px 6px rgba(8,48,65,.08);position:relative;overflow:hidden}
    h1,h2,h3{color:var(--sea)}
    .tiny{font-size:.88rem;color:#456}
    .layout{display:grid;gap:1rem;grid-template-columns:1fr}
    @media (min-width:980px){.layout{grid-template-columns:minmax(0,2fr) minmax(320px,1fr)}}
    #journal-rail,#authors-rail{display:grid;gap:1rem}
    .post-card{display:flex;flex-direction:column;gap:.5rem}
    .post-card .thumb{aspect-ratio:16/9;overflow:hidden;border-radius:12px;background:#eef4f7}
    .post-card .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .post-card h3{font-size:1.05rem;line-height:1.25;margin:.25rem 0}
    .post-card .meta{font-size:.85rem;opacity:.8}
    .grid-3{display:grid;gap:1rem;margin-top:1rem}
    @media (min-width:760px){.grid-3{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (min-width:1100px){.grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}}

    /* DIAGNOSTIC: outline open groups so you can *see* state change */
    .nav-group[data-open="true"]{ outline:2px solid #e60026; outline-offset:2px; }

    /* DIAGNOSTIC: floating logger */
    #nav-debug{
      position:fixed;right:.5rem;bottom:.5rem;z-index:999999;background:#011627;color:#e6f4f8;
      font:12px/1.35 ui-monospace,SFMono-Regular,Menlo,monospace;border:1px solid #334; border-radius:8px; padding:.5rem .6rem; max-width:44ch
    }
    #nav-debug b{color:#ffdd57}
    #nav-debug .bad{color:#ff6b6b}
    #nav-debug .ok{color:#7ef7a1}
  </style>
</head>

<body class="page">
  <a href="#content" class="skip-link">Skip to main content</a>

  <header class="site-header hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="/assets/logo_wake.png?v=3.009.017" width="256" height="64" alt="In the Wake wordmark">
        <span class="tiny version-badge">v3.009.017-diagnostic</span>
      </div>

      <nav class="pill-nav" aria-label="Primary">
        <a href="/" aria-current="page">Home</a>
        <a href="/packing-lists.html">Packing Lists</a>

        <div class="nav-item nav-group" id="nav-planning">
          <button class="nav-disclosure" type="button" aria-expanded="false" aria-haspopup="true" aria-controls="menu-planning">
            Planning ▾
          </button>
          <div id="menu-planning" class="submenu" role="menu" aria-label="Planning">
            <a role="menuitem" href="/planning.html">Planning (overview)</a>
            <a role="menuitem" href="/ports.html">Ports</a>
            <a role="menuitem" href="/restaurants.html">Restaurants &amp; Menus</a>
            <a role="menuitem" href="/ships/">Ships</a>
            <a role="menuitem" href="/drink-packages.html">Drink Packages</a>
            <a role="menuitem" href="/cruise-lines/">Cruise Lines</a>
            <a role="menuitem" href="/packing-lists.html">Packing Lists</a>
            <a role="menuitem" href="/accessibility.html">Accessibility</a>
          </div>
        </div>

        <div class="nav-item nav-group" id="nav-travel">
          <button class="nav-disclosure" type="button" aria-expanded="false" aria-haspopup="true" aria-controls="menu-travel">
            Travel ▾
          </button>
          <div id="menu-travel" class="submenu" role="menu" aria-label="Travel">
            <a role="menuitem" href="/travel.html">Travel (overview)</a>
            <a role="menuitem" href="/solo.html">Solo</a>
          </div>
        </div>

        <a href="/about-us.html">About</a>
      </nav>
    </div>

    <div class="hero" role="img" aria-label="Ship wake at sunrise">
      <img class="hero-compass" src="/assets/compass_rose.svg" width="180" height="180" alt="" aria-hidden="true"
           style="position:absolute;right:min(3vw,1rem);top:.5rem;width:86px;opacity:.95;filter:invert(39%) sepia(9%) saturate(1063%) hue-rotate(151deg) brightness(92%) contrast(89%);z-index:2;pointer-events:none">
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake.png?v=3.009.017" width="256" height="64" alt="In the Wake">
        <div class="tagline" style="color:#e6f4f8;font-weight:700;letter-spacing:.2px;font-size:clamp(.9rem,1.5vw,1.35rem)">A Cruise Traveler’s Logbook</div>
      </div>
      <div class="hero-credit">
        <a class="pill" href="https://instagram.com/flickersofmajesty" rel="noopener noreferrer" target="_blank">Photo © Flickers of Majesty</a>
      </div>
    </div>
  </header>

  <!-- DIAGNOSTIC LOGGER UI -->
  <div id="nav-debug" role="status" aria-live="polite">
    <b>NavDiag v3.009.017</b><br>
    Waiting for script…
  </div>

  <!-- Diagnostic dropdown behavior -->
  <script>
  (function(){
    'use strict';
    var dbg = document.getElementById('nav-debug');
    var log = function(msg){ if(dbg){ dbg.innerHTML = dbg.innerHTML.split('\n').slice(-20).join('\n'); dbg.innerHTML += '<br>'+msg; } console.log('[NavDiag]', msg); };
    var on  = function(el,evt,fn,opt){ if(el) el.addEventListener(evt,fn,opt||false); };
    var qs  = function(s,r){ return (r||document).querySelector(s); };
    var qsa = function(s,r){ return Array.prototype.slice.call((r||document).querySelectorAll(s)); };
    var ready=function(fn){ if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',fn,{once:true});} else { fn(); } };

    function topElementAt(el){
      try{
        var rect = el.getBoundingClientRect();
        var x = Math.floor(rect.left + Math.min(10, Math.max(2, rect.width/2)));
        var y = Math.floor(rect.top  + Math.min(10, Math.max(2, rect.height/2)));
        return document.elementFromPoint(x,y);
      }catch(_){ return null; }
    }

    function setOpen(group,on){
      if(!group) return;
      var btn  = qs('.nav-disclosure', group);
      var menu = qs('.submenu', group);
      group.dataset.open = on ? 'true' : 'false';
      if(btn) btn.setAttribute('aria-expanded', on ? 'true' : 'false');
      if(on && menu){
        // force over everything during debug
        menu.style.zIndex = '999999';
      }
      log('setOpen('+group.id+','+on+') → data-open='+group.dataset.open);
    }

    function wireGroup(group, ix){
      var btn  = qs('.nav-disclosure', group) || qs('button, a', group);
      var menu = qs('.submenu', group);
      if(!btn || !menu){ log('<span class="bad">Group '+(group.id||ix)+' missing btn/menu</span>'); return; }
      if(!menu.id){ menu.id = 'menu-'+(ix+1); }
      btn.setAttribute('aria-controls', menu.id);
      btn.setAttribute('type','button');
      btn.setAttribute('aria-haspopup','true');
      setOpen(group,false);

      on(btn,'click',function(e){
        var top = topElementAt(btn);
        if(top && top!==btn && !btn.contains(top)){
          log('<span class="bad">Click intercepted by '+(top.id?('#'+top.id):('<'+top.tagName.toLowerCase()+'>'))+'</span>');
        }
        e.preventDefault(); e.stopPropagation();
        setOpen(group, group.dataset.open!=='true');
      });

      on(btn,'keydown',function(e){
        if(e.key==='ArrowDown'){ e.preventDefault(); setOpen(group,true); var first = menu.querySelector('a,button,[tabindex]:not([tabindex="-1"])'); if(first) first.focus(); }
        if(e.key==='Escape'){ e.preventDefault(); setOpen(group,false); btn.focus(); }
      });
      on(menu,'keydown',function(e){ if(e.key==='Escape'){ e.preventDefault(); setOpen(group,false); btn.focus(); } });
      on(menu,'focusout',function(){ setTimeout(function(){ if(!group.contains(document.activeElement)) setOpen(group,false); },0); });

      // Close when clicking outside
      on(document,'click',function(e){ if(!group.contains(e.target)) setOpen(group,false); });

      // Touch open
      on(group,'touchstart',function(e){ if(e.target===btn || btn.contains(e.target)){ e.preventDefault(); setOpen(group, group.dataset.open!=='true'); } },{passive:false});

      // Initial overlay test
      var atop = topElementAt(btn);
      if(atop && atop!==btn && !btn.contains(atop)){
        log('<span class="bad">Overlay above '+(group.id||('group#'+(ix+1)))+': '+(atop.id?('#'+atop.id):('<'+atop.tagName.toLowerCase()+'>'))+'</span>');
      } else {
        log('<span class="ok">Clickable: '+(group.id||('group#'+(ix+1)))+'</span>');
      }
    }

    function detectConsent(){
      var suspects = [
        '#cmp_overlay','#cmpbox','#cmplz-cookiebanner',
        '[id*="consent"]','[class*="consent"]','[id*="cmp"]','[class*="cmp"]'
      ].map(function(s){ return Array.prototype.slice.call(document.querySelectorAll(s)); })
       .flat().filter(Boolean);
      if(suspects.length){
        log('<span class="bad">Consent/overlay nodes present: '+suspects.map(function(n){return n.id?('#'+n.id):n.tagName;}).join(', ')+'</span>');
      } else {
        log('<span class="ok">No obvious consent overlay</span>');
      }
    }

    function wireNav(){
      log('<b>Boot</b> DOM ready. Wiring nav…');
      qsa('.navbar').forEach(function(n){ n.style.overflow='visible'; n.style.zIndex='1000'; });
      var groups = qsa('.nav-group');
      log('Found '+groups.length+' .nav-group element(s).');
      groups.forEach(wireGroup);
      window.NavDiag = {
        openAll: function(){ groups.forEach(function(g){ setOpen(g,true); }); },
        closeAll:function(){ groups.forEach(function(g){ setOpen(g,false); }); },
        clickAll:function(){ groups.forEach(function(g){ var b=qs('.nav-disclosure',g); if(b){ b.click(); } }); }
      };
      detectConsent();
      log('<b>Ready</b>. Try clicking “Planning ▾” or run NavDiag.openAll() in console.');
    }
    ready(wireNav);
  })();
  </script>

  <main id="content" class="wrap" role="main" aria-label="Main content">
    <div class="layout">
      <section>
        <section class="card" aria-labelledby="page-title">
          <h1 id="page-title">Welcome Aboard</h1>
          <p class="motto"><em>The calmest seas are found in another’s wake.</em></p>
          <p>Diagnostic build: if the dropdown still won’t appear, the console + yellow panel at bottom-right will tell us whether clicks are intercepted or the menu is behind another layer.</p>
        </section>

        <section class="grid-3" aria-label="Primary sections">
          <section class="card"><h3><a href="/ships/">Ships →</a></h3><p>Class overviews, per-ship pages, and cross-links to restaurants.</p></section>
          <section class="card"><h3><a href="/restaurants.html">Restaurants &amp; Menus →</a></h3><p>Flagship venues, menus, price bands, and allergen notes.</p></section>
          <section class="card"><h3><a href="/ports.html">Ports →</a></h3><p>Quick snapshots, local tips, and map context.</p></section>
        </section>
      </section>

      <aside aria-label="Right rail">
        <section class="card" aria-labelledby="journal-title">
          <h2 id="journal-title">From the Journal</h2>
          <div id="journal-rail" class="tiny">Intentionally minimized for diagnostics.</div>
        </section>
      </aside>
    </div>
  </main>

  <footer class="wrap" role="contentinfo">
    © 2025 In the Wake — A Cruise Traveler’s Logbook · <a href="/accessibility.html">Accessibility &amp; WCAG 2.1 AA Commitment</a>
    <p class="tiny center" style="margin-top:.5rem">Soli Deo Gloria.</p>
  </footer>
</body>
</html>
