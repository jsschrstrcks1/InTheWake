<!doctype html>
<html lang="en">
<head>
  <!-- ===== CONFIG (keep at top) ===== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Drink Packages â€” Break-Even Calculator â€¢ In the Wake</title>
  <meta name="theme-color" content="#0b5">

  <!-- ===== Inline â€œsiteâ€ tokens + layout (trimmed to what this page needs) ===== -->
  <style>
    /* ---------- tokens ---------- */
    :root{
      --bg: #f6fafc;
      --panel: #ffffff;
      --ink: #0f172a;
      --muted: #334155;
      --bd: rgba(15,23,42,.12);
      --ring: #3b82f6;
      --pill-bg: rgba(255,255,255,.75);
      --pill-bd: rgba(15,23,42,.18);
      --shadow: 0 8px 24px rgba(2,6,23,.12);
      --radius: 14px;
    }

    /* ---------- globals ---------- */
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); background:var(--bg);
      font: 16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    img{max-width:100%;display:block}
    .sr-only{position:absolute!important;clip:rect(0 0 0 0)!important;clip-path:inset(50%)!important;width:1px!important;height:1px!important;overflow:hidden!important;margin:-1px!important;padding:0!important;border:0!important}

    /* ---------- header + hero ---------- */
    .topbar{position:sticky;top:0;z-index:20;backdrop-filter:saturate(1.2) blur(8px); background:rgba(255,255,255,.7); border-bottom:1px solid var(--bd)}
    .container{max-width:1128px;margin-inline:auto;padding:10px 16px}
    .row{display:flex;gap:.75rem}
    .between{justify-content:space-between}.center{align-items:center}
    .pillnav .pill, .pillnav .dropdown>button{
      appearance:none;border:1px solid var(--pill-bd); background:var(--pill-bg); color:var(--ink);
      border-radius:999px; padding:.45rem .9rem; font-weight:600; cursor:pointer; text-decoration:none;
      box-shadow:0 2px 8px rgba(2,6,23,.06);
    }
    .pillnav a.active{outline:2px solid var(--ring)}
    .dropdown .menu{
      position:fixed; min-width:220px; background:#fff; border:1px solid var(--bd); border-radius:12px;
      box-shadow:var(--shadow); padding:.4rem; display:block;
    }
    .dropdown .menu a{display:block;padding:.45rem .6rem;border-radius:8px;color:inherit;text-decoration:none}
    .dropdown .menu a:hover{background:#f1f5f9}
    .dropdown .menu[hidden]{display:none}

    .hero-viewport{position:relative; height:40vh; min-height:320px; overflow:hidden; border-bottom:1px solid var(--bd)}
    .hero-img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:saturate(1.05) contrast(1.02)}
    .hero-overlay{position:relative; z-index:1; height:100%; display:flex; align-items:flex-end; padding-bottom:18px}
    .hero-logo img{height:112px; filter: drop-shadow(0 12px 30px rgba(0,0,0,.2))}
    .tagline{color:#fff; text-shadow:0 2px 12px rgba(0,0,0,.45); font-size:1.1rem; font-weight:700; margin:8px 0 0}
    .hero-credit{position:absolute;right:18px;bottom:14px;z-index:1;background:rgba(255,255,255,.85);
      border:1px solid var(--bd); border-radius:999px; padding:.35rem .7rem; font-weight:700}
    .build-pill{border:1px solid var(--pill-bd); background:var(--pill-bg); padding:.2rem .5rem; border-radius:999px; font-size:.85rem;font-weight:700}

    /* ---------- page grid ---------- */
    main{margin:28px 0 56px}
    .shell{display:grid; grid-template-columns:minmax(0,1fr) 320px; gap:24px}
    @media (max-width:1060px){ .shell{grid-template-columns:1fr} }

    /* ---------- panels/cards ---------- */
    .card{background:var(--panel); border:1px solid var(--bd); border-radius:var(--radius); box-shadow:0 2px 12px rgba(2,6,23,.04)}
    .pad{padding:16px}
    .banner{font-weight:800; color:var(--ink); font-size:1.25rem}
    .small{font-size:.92rem; color:var(--muted)}
    .tiny{font-size:.82rem; color:var(--muted)}
    .badge{border:1px solid var(--bd);background:#f8fafc;border-radius:999px;padding:.2rem .55rem;font-weight:700}

    /* ---------- calculator bits ---------- */
    .pkg{border:1px solid var(--bd); border-radius:12px; padding:12px 14px; background:#fff}
    .pkg.winner{box-shadow:0 0 0 2px var(--ring) inset}
    .stack-3{display:grid; gap:12px}
    #breakeven-chart{width:100%; height:280px}
    .pill-input{display:grid; gap:4px}
    .pill-input input[type="number"], .pill-input input[type="text"]{
      appearance:textfield; border:1px solid var(--bd); background:#fff; border-radius:10px; padding:.45rem .6rem; width:80px
    }
    input[type="range"]{width:180px}
    .chip{appearance:none;border:1px solid var(--bd);background:#fff;border-radius:10px;padding:.25rem .55rem;cursor:pointer}

    /* ---------- rails ---------- */
    .rail-list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
    .rail-card{display:grid; grid-template-columns:112px 1fr; gap:10px; align-items:center;
      border:1px solid var(--bd); border-radius:12px; padding:8px; text-decoration:none; color:inherit; background:#fff}
    .rail-card:hover{box-shadow:0 2px 10px rgba(2,6,23,.08)}
    .rail-card img{border-radius:8px; border:1px solid var(--bd)}

    /* ---------- footer ---------- */
    .site-footer{border-top:1px solid var(--bd); padding:16px 0; color:var(--muted)}
    .center{text-align:center}
  </style>

  <!-- Chart.js (for the bar/line combo) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

  <!-- ===== Header / Nav ===== -->
  <div class="topbar">
    <div class="container row between center">
      <div class="row center">
        <a href="/" class="brand-lockup" aria-label="In the Wake">
          <img src="/assets/brand/in-the-wake-lockup.svg" alt="" height="32">
        </a>
        <span class="build-pill">v.9.000.005</span>
      </div>
      <nav class="pillnav" aria-label="Main">
        <a class="pill" href="/">Home</a>
        <div class="pill dropdown" data-portal="menu">
          <button type="button" class="pill">Planning â–¾</button>
          <div class="menu" hidden>
            <a href="/overview.html">Overview</a>
            <a href="/ships/">Ships</a>
            <a href="/restaurants.html">Restaurants</a>
            <a href="/ports.html">Ports</a>
            <a href="/drink-calculator.html" class="active">Drink Packages</a>
          </div>
        </div>
        <div class="pill dropdown" data-portal="menu">
          <button type="button" class="pill">Travel â–¾</button>
          <div class="menu" hidden>
            <a href="/solo.html">Solo</a>
            <a href="/packing-lists.html">Packing Lists</a>
            <a href="/travel.html">All Travel</a>
          </div>
        </div>
        <a class="pill" href="/about.html">About</a>
      </nav>
    </div>
  </div>

  <section class="hero-viewport">
    <img class="hero-img" src="/assets/hero/ocean-sunrise-2560.jpg" alt="" decoding="async">
    <div class="hero-overlay container">
      <div>
        <div class="hero-logo"><img src="/assets/brand/in-the-wake-shipmark.svg" alt=""></div>
        <p class="tagline">A Cruise Travelerâ€™s Logbook</p>
      </div>
    </div>
    <div class="hero-credit">Photo Â© <a href="https://instagram.com/flickersofmajesty" rel="noopener">Flickers of Majesty</a></div>
  </section>

  <!-- ===== Body ===== -->
  <main class="container">
    <div class="shell">
      <!-- LEFT: Calculator -->
      <section class="card pad" id="calc">
        <h1 class="banner">Drink Packages â€” Break-Even Calculator</h1>
        <p class="small">
          Compare Ã -la-carte vs Soda, Refreshment, and Deluxe. Add minors (50% off),
          sea/port weighting, and currency display. Works offline.
        </p>
        <p id="currency-note" class="small">Rates loadingâ€¦</p>

        <div class="stack-3" style="margin-top:12px">
          <div class="pkg" data-card="soda" id="pkg-soda">
            <div class="row between center phd">
              <strong>Soda</strong>
              <span data-pkg-price="soda" class="badge">â€”</span>
            </div>
            <div class="small">Included value: <span data-inc="soda">â€”</span></div>
            <div id="soda-breakeven" class="small" style="margin-top:8px"></div>
          </div>

          <div class="pkg" data-card="refresh" id="pkg-refresh">
            <div class="row between center phd">
              <strong>Refreshment</strong>
              <span data-pkg-price="refresh" class="badge">â€”</span>
            </div>
            <div class="small">Included value: <span data-inc="refresh">â€”</span></div>
            <div id="refresh-breakeven" class="small" style="margin-top:8px"></div>
          </div>

          <div class="pkg" data-card="deluxe" id="pkg-deluxe">
            <div class="row between center phd">
              <strong>Deluxe <span id="cap-badge" class="tiny badge">$14.00 cap</span></strong>
              <span data-pkg-price="deluxe" class="badge">â€”</span>
            </div>
            <div class="small">Included value: <span data-inc="deluxe">â€”</span> â€¢ Over-cap est: <span id="overcap-est">â€”</span></div>
            <div id="deluxe-breakeven" class="small" style="margin-top:8px"></div>
          </div>
        </div>

        <canvas id="breakeven-chart" aria-label="Break-even chart" role="img"></canvas>
        <div id="range-note" class="tiny" style="margin:6px 0 12px"></div>

        <fieldset class="card pad" style="margin-top:12px">
          <div class="row wrap gap-3 center">
            <label class="pill-input">Days
              <input id="input-days" data-input="days" type="number" min="1" max="365" value="7" />
            </label>
            <label class="pill-input">Sea days
              <input id="input-seadays" data-input="seadays" type="number" min="0" max="365" value="3" />
            </label>
            <label class="pill-input">
              <input id="sea-toggle" data-input="seaapply" type="checkbox" checked />
              <span class="tiny">Weight sea/port â€¢ Sea bias <span id="sea-weight-val">20%</span></span>
              <input data-input="seaweight" type="range" min="0" max="40" step="1" value="20" />
            </label>
          </div>

          <div class="row wrap gap-3" style="margin-top:10px">
            <label class="pill-input">Adults
              <input id="input-adults" data-input="adults" type="number" min="1" max="20" value="1" />
            </label>
            <label class="pill-input">Minors
              <input id="input-minors" data-input="minors" type="number" min="0" max="20" value="0" />
            </label>
          </div>

          <div class="row wrap gap-3" style="margin-top:10px">
            <label><input type="radio" id="mode-simple" name="mode" checked> Simple</label>
            <label><input type="radio" id="mode-itinerary" name="mode"> Itinerary (per-day)</label>
            <button id="jump-winner" type="button" class="pill">Jump to Best Value</button>
          </div>
        </fieldset>

        <div class="card pad" style="margin-top:12px">
          <div class="row between center">
            <div>Soda avg <span class="tiny" data-price-pill="soda">avg â€”</span></div>
            <div class="row center" style="gap:.5rem">
              <button type="button" class="chip" onclick="stepInput('soda',-1)">âˆ’</button>
              <input data-input="soda" type="text" inputmode="decimal" value="2" style="width:56px;text-align:center">
              <button type="button" class="chip" onclick="stepInput('soda',+1)">+</button>
            </div>
          </div>

          <div class="row between center" style="margin-top:8px">
            <div>Cocktail avg <span class="tiny" data-price-pill="cocktail">avg â€”</span></div>
            <div class="row center" style="gap:.5rem">
              <button type="button" class="chip" onclick="stepInput('cocktail',-1)">âˆ’</button>
              <input data-input="cocktail" type="text" inputmode="decimal" value="0" style="width:56px;text-align:center">
              <button type="button" class="chip" onclick="stepInput('cocktail',+1)">+</button>
            </div>
          </div>

          <div class="row wrap" style="gap:.5rem; margin-top:12px">
            <button type="button" class="pill" onclick="resetInputs()">Reset</button>
            <button type="button" class="pill" onclick="shareScenario()">Share Scenario</button>
            <button type="button" class="pill" onclick="printResults()">Print</button>
          </div>
        </div>

        <div id="a11y-status" class="sr-only" role="status" aria-live="polite"></div>
      </section>

      <!-- RIGHT: Rails -->
      <aside class="stack-3">
        <section class="card pad">
          <h2 style="margin:0 0 8px">Recent Articles</h2>
          <ul class="rail-list" id="recent-articles"></ul>
        </section>

        <section class="card pad">
          <h2 style="margin:0 0 8px">About the Author</h2>
          <div class="row" style="gap:12px">
            <img src="/assets/authors/ken-baker-128.jpg" width="64" height="64" alt="Ken Baker"
                 style="border-radius:12px;border:1px solid var(--bd)">
            <div>
              <strong>Ken Baker</strong>
              <p class="small" style="margin:.25rem 0 .35rem">
                Founder of <em>In the Wake</em>; writer and editor of the logbook.
              </p>
              <a href="https://instagram.com/flickersofmajesty">@flickersofmajesty</a>
            </div>
          </div>
        </section>
      </aside>
    </div>
  </main>

  <footer class="site-footer center tiny">Â© <span id="year"></span> In the Wake.</footer>

  <!-- ===== Calculator bundles (yours) ===== -->
  <script>
    // if you want to simulate FX drift visually
    window.fxDriftPct = 0;
  </script>
  <script type="module" src="/assets/js/drink-worker.js?v=.9.000.005"></script>
  <script defer src="/assets/js/drink-math.js?v=.9.000.005"></script>
  <script defer src="/assets/js/drink-calculator.app.js?v=.9.000.005"></script>

  <!-- ===== Portal menus (dropdowns render â€œaboveâ€ everything) ===== -->
  <script>
    (function portalMenus(){
      const root = document.body;
      function closeAll(){ document.querySelectorAll('.dropdown .menu:not([hidden])').forEach(m => m.hidden = true); }
      document.addEventListener('click', (e)=>{
        const dd = e.target.closest('.dropdown');
        if(!dd){ closeAll(); return; }
        const btn = dd.querySelector('button'); const menu = dd.querySelector('.menu'); if(!menu) return;
        if(menu.parentElement !== root) root.appendChild(menu);
        const r = btn.getBoundingClientRect();
        menu.style.top = (r.bottom + 6) + 'px';
        menu.style.left = r.left + 'px';
        menu.style.zIndex = 9999;
        menu.hidden = !menu.hidden;
        e.stopPropagation();
      });
      window.addEventListener('resize', closeAll);
    })();
  </script>

  <!-- ===== Recent rail + Top-20 image fix (hard override) ===== -->
  <script>
    (function rails(){
      const items = [
        { href:"/freedom-of-your-own-wake.html", title:"Freedom of Your Own Wake", img:"/assets/articles/freedom-of-your-own-wake-360.jpg" },
        { href:"/why-i-started-solo-cruising.html", title:"Why I Started Solo Cruising", img:"/assets/articles/why-i-started-solo-cruising-360.jpg" },
        // ðŸ”§ Special case: this articleâ€™s usual logic is flaky; force the known-good thumbnail:
        { href:"/top-20-first-cruise-questions.html", title:"Top 20 First-Cruise Questions", img:"/assets/articles/top-20-first-cruise-questions-360.jpg" }
      ];
      const ul = document.getElementById('recent-articles');
      items.forEach(it=>{
        const li = document.createElement('li');
        li.innerHTML = `
          <a class="rail-card" href="${it.href}">
            <img loading="lazy" decoding="async" src="${it.img}" alt="" width="112" height="64">
            <span>${it.title}</span>
          </a>`;
        ul.appendChild(li);
      });
    })();
  </script>

  <!-- ===== Small helpers / expose some globals the app expects ===== -->
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    window.printResults ||= (()=> window.print());
    window.shareScenario ||= (async()=>{ try{ await navigator.clipboard.writeText(location.href); }catch{} });
    window.renderAll ||= (()=>{});
  </script>
</body>
</html>
