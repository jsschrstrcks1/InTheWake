<!doctype html>
<html lang="en">
<head>
  <!--
  Soli Deo Gloria
  All work on this project is offered as a gift to God.
  “Trust in the LORD with all your heart, and do not lean on your own understanding.” — Proverbs 3:5
  “Whatever you do, work heartily, as for the Lord and not for men.” — Colossians 3:23
  -->

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Royal Caribbean — In the Wake (v3.006.011)</title>
  <meta name="version" content="v3.006.011"/>
  <meta name="description" content="Royal Caribbean, class-by-class and ship-by-ship: venues, experiences, dress code, and ship search with image thumbnails."/>
  <meta name="theme-color" content="#0e6e8e"/>
  <meta name="robots" content="index,follow"/>

  <!-- Canonical + Social -->
  <link rel="canonical" href="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html"/>
  <meta property="og:title" content="Royal Caribbean — In the Wake"/>
  <meta property="og:description" content="Explore Royal Caribbean by class and ship with venue and experience guides."/>
  <meta property="og:image" content="https://www.cruisinginthewake.com/assets/social/royal-caribbean-hero.jpg?v=3.006.011"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- JSON-LD (Breadcrumbs) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Home","item":"https://www.cruisinginthewake.com/"},
      {"@type":"ListItem","position":2,"name":"Cruise Lines","item":"https://www.cruisinginthewake.com/cruise-lines.html"},
      {"@type":"ListItem","position":3,"name":"Royal Caribbean","item":"https://www.cruisinginthewake.com/cruise-lines/royal-caribbean.html"}
    ]
  }
  </script>

  <!-- Unified CSS (cache-busted MUST) -->
  <link rel="stylesheet" href="https://www.cruisinginthewake.com/assets/styles.css?v=3.006.011"/>
  <link rel="preload" as="image" href="https://www.cruisinginthewake.com/assets/compass_rose.svg"/>

  <!-- Page-local trims (kept minimal; no overrides to hero/filter rules) -->
  <style>
    .brand-title{display:none!important}
    .two-col{display:grid;grid-template-columns:1fr 320px;gap:1rem}
    @media (max-width:1060px){.two-col{grid-template-columns:1fr}}
    .side-panel{display:flex;flex-direction:column;gap:1rem}
    .pillrow{display:flex;flex-wrap:wrap;gap:.5rem}
    .pillbtn{display:inline-block;padding:.35rem .7rem;border-radius:999px;border:1px dashed var(--rope);background:#fff;font-weight:600}
    .toolbar{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .toolbar .seg{display:inline-flex;border:1px solid var(--rope);border-radius:999px;overflow:hidden}
    .toolbar .seg button{padding:.35rem .7rem;border:0;background:#fff}
    .toolbar .seg button.active{background:var(--foam);font-weight:700}
    .ship-card .class-chip{font-size:.72rem;background:#f7fdff;border:1px solid var(--rope);border-radius:999px;padding:.1rem .45rem;margin-left:.4rem}
    .thumb img{background:#eef4f6}
    .tiny-muted{font-size:.86rem;color:#567}
    .venue-card{display:grid;grid-template-columns:56px 1fr;gap:.6rem;align-items:center;border:2px solid var(--rope);border-radius:12px;background:#fff;padding:.5rem}
    .venue-card .vthumb{width:56px;height:56px;border-radius:10px;overflow:hidden;border:1px solid #dfe7ea;background:#eef4f6}
    .venue-card .vthumb img{width:100%;height:100%;object-fit:cover}
    .venue-card .vbody strong{color:var(--sea)}
    .h-rule{height:12px;background:var(--rope);
      -webkit-mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x;mask:linear-gradient(90deg,#000 60%,transparent 60%) repeat-x}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
         background:#f7f9fb;border:1px solid #cfe1ea;border-radius:6px;padding:.06rem .33rem}

 /* Search board: compact grid + rows */
.sb-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem}
@media (max-width:1100px){.sb-grid{grid-template-columns:1fr 1fr}}
@media (max-width:700px){.sb-grid{grid-template-columns:1fr}}

.list-row{display:grid;grid-template-columns:96px 1fr;gap:.75rem;align-items:center;
  border:2px solid var(--rope);border-radius:14px;background:#fff;padding:.6rem}
.list-row .thumb{width:96px;height:64px;border-radius:10px;overflow:hidden;border:1px solid #dfe7ea;background:#eef4f6}
.list-row .thumb img{width:100%;height:100%;object-fit:cover}
.list-row .title{font-weight:800;color:var(--sea);font-size:1.15rem}
.list-row .meta{font-size:.86rem;color:#567}
.sb-hidden{display:none!important}

.sb-qwrap{position:relative;display:inline-flex;align-items:center}
#sb-q{width:min(44ch,60vw);padding:.55rem .9rem;border:1px solid #cfe1ea;border-radius:14px}
#sb-clear{position:absolute;right:.3rem;top:50%;transform:translateY(-50%);border:0;background:transparent;
  font-size:1.2rem;line-height:1;padding:.2rem .4rem;cursor:pointer} 
  </style>

  <!-- Reduced motion + SW (Every Page) -->
  <style>@media (prefers-reduced-motion: reduce){*{animation-duration:.001ms!important;transition-duration:.001ms!important;}}</style>
  <script>if('serviceWorker' in navigator){addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));}</script>
</head>

<body class="page no-hero-filter">
  <a class="skip-link" href="#content">Skip to content</a>

  <header class="hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="https://www.cruisinginthewake.com/assets/logo_wake.png" alt="In the Wake"/>
        <span class="version-badge">v3.006.011</span>
      </div>
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="https://www.cruisinginthewake.com/">Home</a>
        <a href="https://www.cruisinginthewake.com/ships/">Ships</a>
        <a href="https://www.cruisinginthewake.com/restaurants/">Restaurants &amp; Menus</a>
        <a href="https://www.cruisinginthewake.com/ports.html">Ports</a>
        <a href="https://www.cruisinginthewake.com/disability-at-sea.html">Disability at Sea</a>
        <a href="https://www.cruisinginthewake.com/drink-packages.html">Drink Packages</a>
        <a href="https://www.cruisinginthewake.com/packing-lists.html">Packing Lists</a>
        <a href="https://www.cruisinginthewake.com/planning.html">Planning</a>
        <a href="https://www.cruisinginthewake.com/solo.html">Solo Travel</a>
        <a href="https://www.cruisinginthewake.com/travel.html">Travel Tips</a>
        <a href="https://www.cruisinginthewake.com/cruise-lines.html" aria-current="page">Cruise Lines</a>
        <a href="https://www.cruisinginthewake.com/about-us.html">About Us</a>
      </nav>
    </div>

    <div class="hero" role="img" aria-label="Open ocean at sunrise">
      <div class="latlon-grid" aria-hidden="true"></div>
      <img class="hero-compass" src="https://www.cruisinginthewake.com/assets/compass_rose.svg" alt="" aria-hidden="true"/>
      <div class="hero-title"><img class="logo" src="https://www.cruisinginthewake.com/assets/logo_wake.png" alt="In the Wake"><div class="tagline">A Cruise Traveler’s Logbook</div></div>
      <div class="hero-credit"><a class="pill long" href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">Photo © Flickers of Majesty</a></div>
    </div>
  </header>

  <main class="wrap" id="content">
    <!-- Overview (fusion tone) -->
    <section class="card">
      <h1>Royal Caribbean</h1>
      <p>Big-ship bravado, neighborhood strolls, ice and aqua shows that turn the sea into a stage — and enough dining choice to make a sea day a progressive feast. Start by class (Icon → Oasis → Quantum/Ultra → Freedom → Voyager → Radiance → Vision), then drop anchor on the ship whose venues, shows, and cabin quirks suit your crew. We’ll steer with clarity, skip the hype, and keep the compass set to useful. <strong>Soli Deo Gloria.</strong></p>
      <div class="tiny">Tip: Search below matches <em>ships</em>, <em>classes</em>, <em>venues</em>, and <em>experiences</em>. Toggle “Show unfinished ships” to include pages still in dry dock (no thumbnail yet).</div>
    </section>

    <!-- Search Board (ships / venues / experiences) -->
<section class="card" id="sb" role="region" aria-label="Search Royal Caribbean">
  <div class="toolbar" id="sb-view" aria-label="Choose content">
    <div class="seg">
      <button type="button" class="active" data-view="ships" aria-pressed="true">Ships</button>
      <button type="button" data-view="venues" aria-pressed="false">Venues</button>
      <button type="button" data-view="experiences" aria-pressed="false">Experiences</button>
    </div>
    <div class="seg" id="sb-finish" aria-label="Ship completion">
      <button type="button" class="active" data-finish="finished" aria-pressed="true">Finished only</button>
      <button type="button" data-finish="all" aria-pressed="false">Show unfinished ships</button>
    </div>
    <label class="visually-hidden" for="sb-q">Search</label>
    <div class="sb-qwrap">
      <input id="sb-q" type="search" inputmode="search" placeholder="Try: Oasis, Chops, Icon, Chef’s Table…" autocomplete="off" aria-controls="sb-out">
      <button type="button" id="sb-clear" class="sb-clear" aria-label="Clear search">×</button>
    </div>
  </div>

  <!-- Blurb that disappears on first interaction -->
  <div id="sb-welcome" class="tiny-muted" style="margin:.4rem 0 0">
    <p><strong>Choose your chart:</strong> tap <em>Ships</em>, <em>Venues</em>, or <em>Experiences</em>. Type to narrow, use the chips to filter, and <em>Load more</em> to see the rest. “Finished only” shows ships with thumbnails (live pages); flip the toggle to preview everything in dry dock.</p>
  </div>

  <!-- Context filters (change based on active view) -->
  <div class="toolbar" id="sb-filters" style="margin:.5rem 0 .5rem">
    <!-- Classes (always visible for Ships, optional for others) -->
    <div id="sb-classes" class="pillrow" aria-label="Filter by class"></div>

    <!-- Venue filter -->
    <div class="seg" id="sb-vfilter" aria-label="Venues filter">
      <button type="button" class="active" data-v="all">Venues: All</button>
      <button type="button" data-v="included">Included</button>
      <button type="button" data-v="premium">Premium</button>
    </div>

    <!-- Experiences filter -->
    <div class="seg" id="sb-xpfilter" aria-label="Experiences filter">
      <button type="button" class="active" data-xp="all">Experiences: All</button>
      <button type="button" data-xp="included">Included</button>
      <button type="button" data-xp="premium">Premium</button>
    </div>
  </div>

  <!-- Results -->
  <div id="sb-out" class="sb-grid" aria-live="polite"></div>
  <div class="center" style="margin-top:.6rem">
    <button type="button" id="sb-more" class="pillbtn">Load more</button>
  </div>
</section>

    <!-- Two-column: left content + right rail -->
    <section class="two-col">
      <div>
        <!-- Class → Ships pill tray -->
        <section class="card" id="class-pills">
          <h2>Classes</h2>
          <div class="pillrow" id="class-tray" aria-live="polite"></div>
          <div id="class-note" class="tiny tiny-muted" style="margin-top:.4rem">Classes are ordered largest → smallest by gross tonnage.</div>
        </section>

        <!-- Dynamic class sections (populated by JS in class order) -->
        <section class="card" id="classes">
          <h2>Ships by Class</h2>
          <div class="h-rule" aria-hidden="true"></div>
          <div id="class-sections"></div>
        </section>

        <!-- Experiences (full list, filterable) -->
        <section class="card" id="experiences">
          <h2>Experiences Onboard</h2>
          <div class="toolbar" style="margin:.5rem 0 .75rem">
            <div class="seg">
              <button type="button" class="active" data-exp2="all">All</button>
              <button type="button" data-exp2="included">Included</button>
              <button type="button" data-exp2="premium">Premium</button>
              <button type="button" id="exp2-clear">Clear</button>
            </div>
          </div>
          <div id="experience-grid" class="grid-3"></div>
        </section>

        <!-- Image credits -->
        <section class="card">
          <h3>Image Credits</h3>
          <p class="tiny">Attributions are noted per image where available; remaining placeholders are temporary and will be replaced with properly credited media from Wikimedia Commons or the cruise line’s press kit. See individual ship pages for exact file titles and licenses.</p>
          <ul class="tiny">
            <li>“Icon of the Seas” hero — Wikimedia Commons (credit pending final asset selection)</li>
            <li>“Wonder of the Seas” — Wikimedia Commons (credit pending final asset selection)</li>
            <li>Per-ship thumbnails — mixture of onboard photography and Commons; replace as we finalize.</li>
          </ul>
        </section>
      </div>

      <!-- Right rail -->
      <aside class="side-panel" aria-label="Dress code and venues">
        <!-- Dress code ABOVE venues -->
        <section class="card" id="dress-code">
          <h2>Dress Code</h2>
          <p><strong>Casual (daytime &amp; most venues):</strong> Jeans, polos, sundresses, and blouses fit the latitude. Keep swimwear to the pool deck; shorts welcome for breakfast and lunch.</p>
          <p><strong>Smart Casual (evenings &amp; specialty):</strong> A step up — collared shirts, dresses, skirts, blouses, or pantsuits. Jackets and blazers are welcome.</p>
          <p><strong>Formal (Dress Your Best):</strong> The night the ship gleams — suits and ties, tuxedos, cocktail dresses, or evening gowns.
            <br><span class="tiny">5-night voyages: one night · 6–10: two · 11–14: three · 15+: up to four (captain’s discretion). Guests in smart casual are not turned away on formal night.</span></p>
          <p class="tiny">Some specialty experiences (e.g., <em>Chef’s Table</em>) encourage formal attire. Otherwise, venues are smart casual by default.</p>
          <p class="tiny"><strong>Ashore:</strong> Modesty at churches and sacred sites is good seamanship; see local guidance on our <a href="https://www.cruisinginthewake.com/ports.html">Ports</a> pages.</p>
        </section>

        <!-- Venues panel -->
        <section class="card" id="venues">
          <h2>Venues</h2>
          <div class="toolbar" style="margin-bottom:.5rem">
            <div class="seg">
              <button type="button" data-v2="all" class="active">All</button>
              <button type="button" data-v2="included">Included</button>
              <button type="button" data-v2="premium">Premium</button>
            </div>
          </div>
          <div id="venue-list" class="side-venues" style="display:grid;gap:.6rem"></div>
        </section>
      </aside>
    </section>

    <!-- Visible invocation near footer -->
    <section class="card center" style="margin-top:1rem">
      <p class="tiny">All pages are offered as a gift to God. <em>Soli Deo Gloria.</em></p>
    </section>
  </main>
<!-- === Royal Caribbean Data Arrays (for Search + Rendering) === -->
<script>
/* ====== DATA FEEDS FOR SEARCH BOARD ====== */

// 1️⃣  Base constants
window.ORIGIN = 'https://www.cruisinginthewake.com';
window.FALLBACK_IMG = '/assets/ships/placeholder-ship.jpg';

// 2️⃣  Image map (ships with thumbnails already finished)
window.IMAGE_MAP = {
  'enchantment-of-the-seas': ['/ships/assets/enchantment-of-the-seas1.jpg'],
  'grandeur-of-the-seas': ['/ships/assets/grandeur-of-the-seas1.jpg'],
  'rhapsody-of-the-seas': ['/ships/assets/rhapsody-of-the-seas1.jpg'],
  'vision-of-the-seas': ['/ships/assets/vision-of-the-seas1.jpg'],
  'adventure-of-the-seas': ['/ships/rcl/images/Adventure_of_the_Seas1.jpeg'],
  'allure-of-the-seas': ['/ships/assets/images/allure-of-the-seas-3.jpg'],
  'wonder-of-the-seas': ['/ships/assets/images/wonder-of-the-seas-1.jpg']
};

// 3️⃣  Classes (largest → smallest by GT)
window.CLASS_ORDER = [
  'Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager','Radiance','Vision'
];

// 4️⃣  Ships
window.SHIPS = [
  // Icon
  {name:'Icon of the Seas',slug:'icon-of-the-seas',cls:'Icon'},
  {name:'Star of the Seas',slug:'star-of-the-seas',cls:'Icon'},
  // Oasis
  {name:'Oasis of the Seas',slug:'oasis-of-the-seas',cls:'Oasis'},
  {name:'Allure of the Seas',slug:'allure-of-the-seas',cls:'Oasis'},
  {name:'Harmony of the Seas',slug:'harmony-of-the-seas',cls:'Oasis'},
  {name:'Symphony of the Seas',slug:'symphony-of-the-seas',cls:'Oasis'},
  {name:'Wonder of the Seas',slug:'wonder-of-the-seas',cls:'Oasis'},
  {name:'Utopia of the Seas',slug:'utopia-of-the-seas',cls:'Oasis'},
  // Quantum
  {name:'Quantum of the Seas',slug:'quantum-of-the-seas',cls:'Quantum'},
  {name:'Anthem of the Seas',slug:'anthem-of-the-seas',cls:'Quantum'},
  {name:'Ovation of the Seas',slug:'ovation-of-the-seas',cls:'Quantum'},
  // Quantum Ultra
  {name:'Spectrum of the Seas',slug:'spectrum-of-the-seas',cls:'Quantum Ultra'},
  {name:'Odyssey of the Seas',slug:'odyssey-of-the-seas',cls:'Quantum Ultra'},
  // Freedom
  {name:'Freedom of the Seas',slug:'freedom-of-the-seas',cls:'Freedom'},
  {name:'Liberty of the Seas',slug:'liberty-of-the-seas',cls:'Freedom'},
  {name:'Independence of the Seas',slug:'independence-of-the-seas',cls:'Freedom'},
  // Voyager
  {name:'Voyager of the Seas',slug:'voyager-of-the-seas',cls:'Voyager'},
  {name:'Explorer of the Seas',slug:'explorer-of-the-seas',cls:'Voyager'},
  {name:'Adventure of the Seas',slug:'adventure-of-the-seas',cls:'Voyager'},
  {name:'Navigator of the Seas',slug:'navigator-of-the-seas',cls:'Voyager'},
  {name:'Mariner of the Seas',slug:'mariner-of-the-seas',cls:'Voyager'},
  // Radiance
  {name:'Radiance of the Seas',slug:'radiance-of-the-seas',cls:'Radiance'},
  {name:'Brilliance of the Seas',slug:'brilliance-of-the-seas',cls:'Radiance'},
  {name:'Serenade of the Seas',slug:'serenade-of-the-seas',cls:'Radiance'},
  {name:'Jewel of the Seas',slug:'jewel-of-the-seas',cls:'Radiance'},
  // Vision
  {name:'Vision of the Seas',slug:'vision-of-the-seas',cls:'Vision'},
  {name:'Grandeur of the Seas',slug:'grandeur-of-the-seas',cls:'Vision'},
  {name:'Rhapsody of the Seas',slug:'rhapsody-of-the-seas',cls:'Vision'},
  {name:'Enchantment of the Seas',slug:'enchantment-of-the-seas',cls:'Vision'}
];

// 5️⃣  Venues (included vs premium)
window.VENUES = [
  // Premium
  v('Chops Grille','premium','chops-grille'),
  v('150 Central Park','premium','150-central-park'),
  v('Wonderland','premium','wonderland'),
  v('Giovanni’s Italian Kitchen','premium','giovannis'),
  v('Izumi','premium','izumi'),
  v('Teppanyaki','premium','teppanyaki'),
  v('Hooked Seafood','premium','hooked-seafood'),
  v('The Mason Jar','premium','mason-jar'),
  v('Portside BBQ','premium','portside-bbq'),
  v('Jamie’s Italian','premium','jamies-italian'),
  v('Playmakers Sports Bar & Arcade','premium','playmakers'),
  v('Chef’s Table','premium','chefs-table'),
  v('Empire Supper Club','premium','empire-supper-club'),
  v('Vintages Wine Bar','premium','vintages'),
  v('Izumi Sushi & Sake Pairing','premium','izumi-sake-pairing'),
  v('Giovanni’s Wine Bar','premium','giovannis-wine-bar'),
  v('Starbucks (select ships)','premium','starbucks'),
  v('Johnny Rockets (lunch/dinner)','premium','johnny-rockets'),
  v('Sugar Beach','premium','sugar-beach'),
  // Included
  v('Main Dining Room','included','main-dining-room'),
  v('Windjammer Marketplace','included','windjammer'),
  v('Coastal Kitchen (Suites)','included','coastal-kitchen'),
  v('Sorrento’s Pizza','included','sorrentos'),
  v('El Loco Fresh','included','el-loco-fresh'),
  v('Park Café','included','park-cafe'),
  v('Café Promenade','included','cafe-promenade'),
  v('Dog House','included','dog-house'),
  v('Sprinkles Ice Cream','included','sprinkles'),
  v('Boardwalk Donut Shop','included','boardwalk-donuts'),
  v('Vitality Café','included','vitality-cafe'),
  v('Solarium Bistro','included','solarium-bistro'),
  v('Wipeout Café','included','wipeout-cafe'),
  v('Room Service (continental breakfast)','included','room-service-continental'),
  v('The Lime & Coconut (bar)','included','lime-and-coconut'),
  v('Pub / Copper & Kettle','included','pub'),
  v('Boleros','included','boleros'),
  v('Schooner Bar','included','schooner-bar'),
  v('Bionic Bar','included','bionic-bar'),
  v('Johnny Rockets (breakfast)','included','johnny-rockets-breakfast'),
  v('La Patisserie / Café Latte-tudes','included','patisserie'),
  v('Mini Bites / Boardwalk Bites','included','mini-bites'),
  v('Splashaway Café','included','splashaway-cafe'),
  v('Royal Promenade Bars','included','promenade-bars')
];
function v(name,type,slug){return {name,type,slug,href:`${ORIGIN}/restaurants/${slug}.html`};}

// 6️⃣  Experiences
window.EXPERIENCES = [
  ex('FlowRider® Surf Simulator','included',['Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager']),
  ex('Rock Climbing Wall','included',['Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager']),
  ex('iFly® Skydiving (RipCord®)','included',['Icon','Oasis','Quantum','Quantum Ultra']),
  ex('North Star® Observation Pod','included',['Quantum','Quantum Ultra']),
  ex('Zip Line','included',['Oasis','Freedom','Icon']),
  ex('Ultimate Abyss℠','included',['Oasis']),
  ex('Perfect Storm℠ Waterslides','included',['Icon','Oasis','Freedom','Voyager']),
  ex('Bumper Cars (SeaPlex)','included',['Quantum','Quantum Ultra']),
  ex('Ice Skating (Studio B)','included',['Oasis','Freedom','Voyager','Quantum','Quantum Ultra','Icon']),
  ex('Mini Golf','included',CLASS_ORDER),
  ex('Escape Room','premium',['Oasis','Freedom','Voyager','Quantum','Icon']),
  ex('Chef’s Table','premium',CLASS_ORDER,true),
  ex('Taste of Royal','premium',CLASS_ORDER,true),
  ex('Mixology / Tastings','premium',CLASS_ORDER,true),
  ex('Love & Marriage Game Show','included',CLASS_ORDER),
  ex('Quest (Adult Game Show)','included',CLASS_ORDER),
  ex('Belly Flop / Cannonball','included',CLASS_ORDER),
  ex('World’s Sexiest Man','included',CLASS_ORDER)
];
function ex(name,type,classes,formal){return {name,type,classes,formal:!!formal};}
</script>
<!-- === END Royal Caribbean Data Arrays === -->
<script>
(function(){
  'use strict';

  // ---- helper shims (will not clobber if you already defined) ----
  const $  = window.$  || (s=>document.querySelector(s));
  const $$ = window.$$ || (s=>Array.from(document.querySelectorAll(s)));
  const el = window.el || ((t,c)=>{const n=document.createElement(t); if(c) n.className=c; return n;});
  const norm = window.norm || (s=>String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[’‘]/g,"'").trim());

  // ---- local config/state ----
  const ORIGIN = (window.ORIGIN) || 'https://www.cruisinginthewake.com';
  const FALLBACK_IMG = (window.FALLBACK_IMG) || '/assets/ships/placeholder-ship.jpg';
  const CLASS_ORDER = (window.CLASS_ORDER) || ['Icon','Oasis','Quantum','Quantum Ultra','Freedom','Voyager','Radiance','Vision'];
  const IMAGE_MAP = (window.IMAGE_MAP)||{};
  const SHIPS     = (window.SHIPS)||[];
  const VENUES    = (window.VENUES)||[];
  const EXPERIENCES = (window.EXPERIENCES)||[];

  let view = 'ships';             // ships | venues | experiences
  let finishedOnly = true;        // ships: finished pages only
  let classFilter = new Set();    // empty = all classes
  let vFilter = 'all';            // venues: all|included|premium
  let xFilter = 'all';            // experiences: all|included|premium
  let interacted = false;
  let page = 0;                   // pagination page
  const pageSize = 9;             // 9 rows per page

  // Dress policy note per venue; default is smart casual
  const VENUE_DRESS = Object.assign({
    'chefs-table': 'Formal encouraged',
    // 'empire-supper-club': 'Formal encouraged',
  }, window.VENUE_DRESS||{});

  // abs + encoded
  const abs = p => p.startsWith('http') ? p : (ORIGIN + p);
  const encAbs = p => { const [path, rest] = p.split(/([?#].*)/); return abs(encodeURI(path) + (rest||'')); };

  const isFinished = slug => Array.isArray(IMAGE_MAP[slug]) && IMAGE_MAP[slug].length>0;
  function pickImg(slug){
    const conventional = [`/ships/rcl/${slug}-1.jpg`,`/ships/rcl/${slug}-1.jpeg`,`/ships/rcl/${slug}-1.png`];
    const list = (IMAGE_MAP[slug]||[]).concat(conventional);
    return list[0] ? encAbs(list[0]) : encAbs(FALLBACK_IMG);
  }

  // ---- DOM refs ----
  const WRAP = $('#sb'); if(!WRAP) return;       // nothing to do if section missing
  const OUT  = $('#sb-out');
  const MORE = $('#sb-more');
  const Q    = $('#sb-q');

  // welcome blurb removal
  const markInteracted = ()=>{ if(!interacted){ interacted = true; const w=$('#sb-welcome'); if(w) w.remove(); } };

  // ---- build class chips ----
  function renderClassChips(){
    const host = $('#sb-classes'); if(!host) return;
    host.innerHTML = '';
    CLASS_ORDER.forEach(cls=>{
      const b = el('button','pillbtn');
      b.type='button'; b.textContent = `${cls} Class`;
      b.addEventListener('click', ()=>{
        if(classFilter.has(cls)) classFilter.delete(cls); else classFilter.add(cls);
        b.classList.toggle('active', classFilter.has(cls));
        resetAndRender();
      });
      host.appendChild(b);
    });
  }

  // ---- renderers ----
  function shipRow(s){
    const a = el('a','list-row'); a.href = `${ORIGIN}/ships/rcl/${s.slug}.html`;
    const t = el('span','thumb'); const img = el('img'); img.alt = s.name; img.src = pickImg(s.slug); t.appendChild(img);
    const b = el('span'); b.innerHTML = `<div class="title">${s.name}</div><div class="meta">${s.cls} Class</div>`;
    a.append(t,b); return a;
  }
  function venueRow(v){
    const a = el('a','list-row'); a.href = v.href || `${ORIGIN}/restaurants/${v.slug}.html`;
    const t = el('span','thumb'); const img = el('img'); img.alt = v.name; t.appendChild(img);
    const dress = VENUE_DRESS[v.slug] || 'Smart casual by default';
    const b = el('span'); b.innerHTML = `<div class="title">${v.name}</div><div class="meta">${v.type==='premium'?'Premium':'Included'} · ${dress}</div>`;
    a.append(t,b); return a;
  }
  function xpRow(x){
    const a = el('div','list-row'); const t = el('span','thumb'); t.innerHTML=''; // no img
    const formal = x.formal ? ' · Formal encouraged' : '';
    const b = el('span'); b.innerHTML = `<div class="title">${x.name}</div><div class="meta">${x.type==='premium'?'Premium':'Included'}${formal} · Classes: ${x.classes.join(', ')}</div>`;
    a.append(t,b); return a;
  }

  // ---- filtering + search ----
  function buildPool(){
    const q = norm(Q.value);
    let items = [];
    if(view==='ships'){
      items = SHIPS
        .filter(s => finishedOnly ? isFinished(s.slug) : true)
        .filter(s => classFilter.size ? classFilter.has(s.cls) : true)
        .filter(s => !q || norm(`${s.name} ${s.cls}`).includes(q))
        .map(s => shipRow(s));
    }else if(view==='venues'){
      items = VENUES
        .filter(v => vFilter==='all' || v.type===vFilter)
        .filter(v => !q || norm(`${v.name} ${v.type}`).includes(q))
        .map(v => venueRow(v));
    }else{
      items = EXPERIENCES
        .filter(x => xFilter==='all' || x.type===xFilter)
        .filter(x => !q || norm(`${x.name} ${x.type} ${x.classes.join(' ')}`).includes(q))
        .map(x => xpRow(x));
    }
    return items;
  }

  function renderPage(){
    const all = buildPool();
    const start = page*pageSize;
    const slice = all.slice(start, start+pageSize);
    slice.forEach(n=>OUT.appendChild(n));
    // more?
    if(start + pageSize >= all.length) MORE.classList.add('sb-hidden');
    else MORE.classList.remove('sb-hidden');
  }

  function resetAndRender(){
    OUT.innerHTML=''; page=0; renderPage();
  }

  // ---- wire controls ----
  function wire(){
    // view tabs
    $$('#sb-view [data-view]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#sb-view [data-view]').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        view = btn.dataset.view;
        document.getElementById('sb-finish').classList.toggle('sb-hidden', view!=='ships');
        document.getElementById('sb-vfilter').classList.toggle('sb-hidden', view!=='venues');
        document.getElementById('sb-xpfilter').classList.toggle('sb-hidden', view!=='experiences');
        resetAndRender(); markInteracted();
      });
    });

    // finished toggle
    $$('#sb-finish [data-finish]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#sb-finish [data-finish]').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        finishedOnly = (btn.dataset.finish==='finished');
        resetAndRender(); markInteracted();
      });
    });

    // venue / experience filters
    $$('#sb-vfilter [data-v]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#sb-vfilter [data-v]').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        vFilter = btn.dataset.v; resetAndRender(); markInteracted();
      });
    });
    $$('#sb-xpfilter [data-xp]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('#sb-xpfilter [data-xp]').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        xFilter = btn.dataset.xp; resetAndRender(); markInteracted();
      });
    });

    // query
    Q.addEventListener('input', ()=>{ markInteracted(); clearTimeout(Q._t); Q._t=setTimeout(resetAndRender, 80); });
    $('#sb-clear').addEventListener('click', ()=>{ Q.value=''; resetAndRender(); markInteracted(); });

    // load more
    MORE.addEventListener('click', ()=>{ page++; renderPage(); });

    // first visibility state
    document.getElementById('sb-vfilter').classList.add('sb-hidden');
    document.getElementById('sb-xpfilter').classList.add('sb-hidden');
  }

  // init
  renderClassChips();
  wire();
  // start empty (show blurb) until input/interaction
  OUT.innerHTML=''; MORE.classList.add('sb-hidden');

})();
</script><link rel="preconnect" href="https://www.cruisinginthewake.com" crossorigin></body>
