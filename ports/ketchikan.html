<!--
Soli Deo Gloria
-->
<!-- ai-breadcrumbs
     entity: Ketchikan
     type: Port Information Page
     parent: /ports.html
     category: Alaska Ports
     cruise-line: Multiple
     updated: 2025-12-12
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="ai-summary" content="First-person logbook guide to Ketchikan with tips for totem poles, Creek Street, and Misty Fjords."/>
  <meta name="last-reviewed" content="2025-12-12"/>
  <meta name="content-protocol" content="ICP-Lite v1.0"/>
  <title>Ketchikan Port Guide — Totem Poles & Misty Fjords | In the Wake</title>
  <meta name="description" content="First-person logbook guide to Ketchikan, Alaska — world-class totem poles, Creek Street boardwalks, Misty Fjords flightseeing, and salmon capital charm."/>
  <link rel="canonical" href="https://cruisinginthewake.com/ports/ketchikan.html"/>
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/in_the_wake_icon_32x32.png"/>
  <!-- Service Worker Registration -->
  <script>
  if('serviceWorker' in navigator){
    window.addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));
  }
  </script>

  <link rel="stylesheet" href="/assets/styles.css"/>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <!-- Port Map Styles (mobile-responsive) -->
  <link rel="stylesheet" href="/assets/css/components/port-map.css?v=2.0.0"/>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://cruisinginthewake.com/"},
      {"@type": "ListItem", "position": 2, "name": "Ports", "item": "https://cruisinginthewake.com/ports.html"},
      {"@type": "ListItem", "position": 3, "name": "Ketchikan", "item": "https://cruisinginthewake.com/ports/ketchikan.html"}
    ]
  }
  </script>
  <!-- LCP Optimization: Preload critical hero images -->
  <link rel="preload" as="image" href="/assets/logo_wake_560.png" fetchpriority="high"/>
  <link rel="preload" as="image" href="/assets/compass_rose.svg?v=3.010.400" fetchpriority="high"/>

  <!-- Swiper CSS/JS (primary + CDN fallback) -->
  <script>
  (function ensureSwiper(){
    function addCSS(h){ const l=document.createElement('link'); l.rel='stylesheet'; l.href=h; document.head.appendChild(l); }
    function addJS(src, ok, fail){
      const s=document.createElement('script'); s.src=src; s.async=true; s.onload=ok; s.onerror=fail||function(){}; document.head.appendChild(s);
    }
    const primaryCSS="https://cruisinginthewake.com/vendor/swiper/swiper-bundle.min.css";
    const primaryJS ="https://cruisinginthewake.com/vendor/swiper/swiper-bundle.min.js";
    const cdnCSS    ="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css";
    const cdnJS     ="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js";
    addCSS(primaryCSS);
    addJS(primaryJS, function(){ window.__swiperReady=true; }, function(){ addCSS(cdnCSS); addJS(cdnJS, function(){ window.__swiperReady=true; }); });
  })();
  </script>
</head>
<body class="page">
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <!-- ARIA Live Regions -->
  <div id="a11y-status" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>
  <div id="a11y-alerts" role="alert" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

  <header class="hero-header" role="banner">
    <div class="navbar">
      <div class="brand">
        <img src="/assets/logo_wake_256.png" srcset="/assets/logo_wake_256.png 1x, /assets/logo_wake_512.png 2x" width="256" height="259" alt="In the Wake wordmark" decoding="async"/>
        <span class="tiny version-badge" aria-label="Site version V1.Beta">V1.Beta</span>
      </div>
            <nav class="site-nav" aria-label="Main site navigation">
        <a class="nav-pill" href="/">Home</a>

        <!-- Planning Dropdown -->
        <div class="nav-dropdown" id="nav-planning">
          <button class="nav-pill" type="button" aria-expanded="false" aria-haspopup="true">
            Planning <span class="caret">&#9662;</span>
          </button>
          <div class="dropdown-menu" role="menu">
            <a href="/planning.html">Planning (overview)</a>
            <a href="/ships.html">Ships</a>
            <a href="/restaurants.html">Restaurants &amp; Menus</a>
            <a href="/ports.html">Ports</a>
            <a href="/drink-packages.html">Drink Packages</a>
            <a href="/drink-calculator.html">Drink Calculator</a>
            <a href="/stateroom-check.html">Stateroom Check</a>
            <a href="/cruise-lines.html">Cruise Lines</a>
            <a href="/packing-lists.html">Packing Lists</a>
            <a href="/accessibility.html">Accessibility</a>
          </div>
        </div>

        <!-- Travel Dropdown -->
        <div class="nav-dropdown" id="nav-travel">
          <button class="nav-pill" type="button" aria-expanded="false" aria-haspopup="true">
            Travel <span class="caret">&#9662;</span>
          </button>
          <div class="dropdown-menu" role="menu">
            <a href="/travel.html">Travel (overview)</a>
            <a href="/solo.html">Solo</a>
          </div>
        </div>

        <a class="nav-pill" href="/tools/port-tracker.html">Port Logbook</a>
        <a class="nav-pill" href="/tools/ship-tracker.html">Ship Logbook</a>
        <a class="nav-pill" href="/search.html">Search</a>
        <a class="nav-pill" href="/about-us.html">About</a>
      </nav></div>

    <!-- Hero -->
    <div class="hero">
      <img class="hero-compass" src="/assets/compass_rose.svg?v=3.010.400" width="180" height="180" alt="" aria-hidden="true" decoding="async"/>
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake_560.png" srcset="/assets/logo_wake_560.png 1x, /assets/logo_wake_1120.png 2x" alt="In the Wake" decoding="async" fetchpriority="high" width="560" height="567"/>
      </div>
      <div class="tagline" aria-hidden="true">A Cruise Traveler's Logbook</div>
      <div class="hero-credit">
        <a class="pill" href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">Photo © Flickers of Majesty</a>
      </div>
    </div>
  </header>

  <main class="wrap page-grid" id="main-content" role="main">
    <nav aria-label="Breadcrumb" style="margin-bottom: 1rem;"><ol style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: #666;"><li style="display: inline;"><a href="/">Home</a> &rsaquo; </li><li style="display: inline;"><a href="/ports.html">Ports</a> &rsaquo; </li><li style="display: inline;" aria-current="page">Ketchikan</li></ol></nav>
    <div style="grid-column: 1; grid-row: 1;">
    <article class="card">
      <!-- Port Hero with gradient background -->
      <div class="port-hero-container" style="position: relative; margin-bottom: 1.5rem; background: linear-gradient(135deg, #2d6a4f 0%, #40916c 30%, #74c69d 60%, #b7e4c7 100%); border-radius: 12px; height: 280px; display: flex; align-items: center; justify-content: center;">
        <div class="port-name-overlay" style="font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, Georgia, serif; font-size: clamp(2.5rem, 10vw, 5rem); font-weight: 700; color: #fff; text-shadow: 2px 2px 8px rgba(0,0,0,0.5), 0 0 40px rgba(0,0,0,0.3); letter-spacing: 0.08em; text-transform: uppercase; text-align: center;">Ketchikan</div>
      </div>

      <h1>Ketchikan: My Salmon & Totem Capital</h1>
      <div class="logbook-entry">
        <p>We sailed in through thick morning mist and suddenly houses on stilts appeared like something from a fairy tale. The smell hit first — low tide, smoked salmon, and wet cedar. Ketchikan gets 162 inches of rain a year and wears it proudly; everything is green, mossy, dripping.</p>

      <figure class="logbook-image float-right">
        <img src="img/ketchikan/ketchikan-1.webp" alt="Ketchikan harbor view" loading="lazy">
        <figcaption>Ketchikan — <a href="https://commons.wikimedia.org/w/index.php?search=Ketchikan&title=Special:MediaSearch&type=image" target="_blank" rel="noopener">WikiMedia Commons</a> (CC BY-SA)</figcaption>
      </figure>

        <p>We started at Totem Bight State Historical Park. The totems are massive — some 50 ft tall, carved from single cedar logs, colors faded to that perfect weathered red-black-teal that only decades of rain can paint. The clan house smelled of cedar smoke and salt; the ranger sang a Tlingit song inside and the acoustics raised every hair on my arms. Then we walked Saxman Native Village — the carving shed was active, cedar chips flying, master carvers working on new poles while ravens watched from the rafters.</p>

        <p>The absolute highlight was the Misty Fjords floatplane. The takeoff from the harbor was exhilarating, then we flew low over endless forest and waterfalls before landing on a mountain lake so remote the silence rang in my ears. The pilot cut the engine and we just drifted between 3,000-ft granite walls while a lone harbor seal watched us. Saw mountain goats like white specks on cliffs and a black bear fishing far below.</p>

      <figure class="logbook-image float-left">
        <img src="img/ketchikan/ketchikan-2.webp" alt="Ketchikan waterfront" loading="lazy">
        <figcaption>Ketchikan scenery — <a href="https://commons.wikimedia.org/w/index.php?search=Ketchikan&title=Special:MediaSearch&type=image" target="_blank" rel="noopener">WikiMedia Commons</a> (CC BY-SA)</figcaption>
      </figure>

        <p>Back in town we wandered Creek Street at high tide (the water literally laps under the boardwalks), visited Dolly's House (yes, it was exactly what you think), and had the best king salmon of the trip at Alaska Fish House — grilled simply with lemon and eaten on the dock while sea lions barked for scraps underneath us.</p>

        <p>The pros: most colorful, character-filled town in Alaska with world-class totems.</p>
        <p>The cons: it rains constantly (but that's the charm), and it gets very crowded when multiple ships are in port.</p>

        <p>Practical tips: Book flightseeing early — weather cancellations happen. Bring quick-dry everything.</p>

        <div class="poignant-highlight">
          <strong>The Moment That Stays With Me:</strong> Floating dead silent on that alpine lake in Misty Fjords, engine off, surrounded by sheer cliffs and waterfalls, with only the sound of a distant raven and my own heartbeat.
        </div>
      </div>

      <section class="port-section">
        <h3>Docking & Getting Around Ketchikan</h3>
        <p><strong>Docking:</strong> Four panamax cruise ship berths along downtown waterfront (numbered south to north). When full, passengers tender directly into downtown. Free downtown shuttle every 15 minutes passing all berths.</p>

        <p><strong>Walking:</strong> Downtown core entirely walkable. Creek Street is 10 minutes from the cruise terminal. The Lumberjack Show is steps from the pier.</p>

        <p><strong>Public bus:</strong> Excellent system, all fares only $1, entire fleet wheelchair accessible. Two free downtown shuttles operate May-September.</p>

        <p><strong>Airport:</strong> Located on Gravina Island, accessible via 5-minute ferry ride.</p>

        <p><strong>Totem parks:</strong> Saxman Village is 2 miles south. Totem Bight State Park is 10 miles north.</p>

        <p><strong>Flightseeing:</strong> Floatplanes for Misty Fjords depart directly from the downtown harbor — no transfer needed.</p>

        <p><strong>Funicular:</strong> Free ride up to Cape Fox Lodge if you eat at the restaurant. Great views even without dining.</p>
      </section>

      <section class="port-section">
        <h3>Depth Soundings Ashore</h3>
        <p class="tiny" style="margin-bottom: 0.5rem; font-style: italic; color: #678;">Practical tips before you step off the ship.</p>

        <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Key Attractions</h4>
        <ul style="margin: 0.75rem 0; padding-left: 1.25rem;">
          <li><strong>Creek Street:</strong> Historic boardwalk with galleries and shops (former red-light district). More than a photo op — explore Dolly's House Museum, take the funicular up for views, and watch salmon run underneath the boardwalks (July-September).</li>
          <li><strong>Dolly's House Museum:</strong> Frontier-era history in the heart of Creek Street.</li>
          <li><strong>Totem poles:</strong> World's largest collection of Northwest totems. Totem Bight State Park (10 miles north) and Saxman Native Village (2 miles south).</li>
          <li><strong>Misty Fjords National Monument:</strong> Premier kayaking destination and flightseeing experience.</li>
          <li><strong>Deer Mountain Trail:</strong> Hiking with scenic views.</li>
          <li><strong>Fish Hatchery & Fish Ladder:</strong> Watch spawning salmon (summer).</li>
        </ul>

        <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Top Excursions</h4>
        <ul style="margin: 0.75rem 0; padding-left: 1.25rem;">
          <li><strong>Great Alaskan Lumberjack Show:</strong> Log rolling, axe throwing, covered bleachers. #1 rated for first-timers.</li>
          <li><strong>Bear viewing at Neets Bay:</strong> Via floatplane (late July-September).</li>
          <li><strong>Ketchikan Duck Tour:</strong> Combination land and water tour.</li>
          <li><strong>Bering Sea Crab Fisherman's Tour:</strong> Hands-on crabbing experience.</li>
          <li><strong>Kayaking, floatplane rides, bicycling tours:</strong> Multiple operators available.</li>
          <li><strong>Canopy ropes and zipline parks:</strong> Rainforest adventure activities.</li>
          <li><strong>Misty Fjords:</strong> Weather-dependent. Book early, have a backup plan. The floatplane landing on a remote alpine lake is transformational.</li>
        </ul>

        <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Shopping & Dining</h4>
        <ul style="margin: 0.75rem 0; padding-left: 1.25rem;">
          <li><strong>Best shopping:</strong> Creek Street for best galleries and shops. Hand-carved totem poles are signature souvenirs.</li>
          <li><strong>Best dining:</strong> Alaska Fish House at Thomas Basin for fish & chips that rival anything in the Pacific Northwest. Sea lions beg for scraps beneath the dock.</li>
        </ul>

        <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Practical Information</h4>
        <ul style="margin: 0.75rem 0; padding-left: 1.25rem;">
          <li><strong>Currency:</strong> US dollars. ATMs widely available.</li>
          <li><strong>Credit cards:</strong> Visa and MasterCard accepted everywhere.</li>
          <li><strong>Sales tax:</strong> 4-6%.</li>
          <li><strong>Tipping:</strong> Restaurants 15-20%, taxi 10-15%, tour guides $5-20.</li>
          <li><strong>Free WiFi:</strong> Cape Fox Lodge bar/restaurant.</li>
          <li><strong>Weather:</strong> "It rains 300 days a year" — book outdoor excursions on arrival when weather permits. Bring quick-dry everything.</li>
          <li><strong>Visitor centers:</strong> Opposite berths 2 and 3 with free walking tour maps.</li>
          <li><strong>Emergency:</strong> 911.</li>
        </ul>
      </section>

      <!-- Interactive Map Section -->
      <section class="port-section" id="port-map-section">
        <h3>Ketchikan Port Map</h3>
        <p class="tiny" style="margin-bottom: 0.75rem; color: #678;">Interactive map showing totem parks, Creek Street, dining, and popular excursion departure points.</p>
        <div id="port-map" class="port-map-container" role="application" aria-label="Interactive map of Ketchikan port area"></div>
        <p class="tiny" style="margin-top: 0.5rem; color: #999;">Click markers for details. Misty Fjords location is approximate — accessed by floatplane from downtown harbor.</p>
      </section>

      <section class="port-section">
        <h3>Frequently Asked Questions</h3>
        <p><strong>Q: Is Ketchikan worth it?</strong><br/>A: 100% — most "Alaskan" feeling town. Walk off ship into a world of totem poles, boardwalks on stilts, and the best collection of Indigenous art anywhere.</p>
        <p><strong>Q: Best excursion?</strong><br/>A: Misty Fjords by floatplane for bucket-list experience. Great Alaskan Lumberjack Show for first-timers wanting local fun without venturing far.</p>
        <p><strong>Q: How long is Misty Fjords flightseeing?</strong><br/>A: 2–2.5 hours including floatplane flight and water landing on a remote alpine lake.</p>
        <p><strong>Q: Can you walk from the cruise port?</strong><br/>A: Yes — step directly off ship into downtown. Creek Street is 10 minutes, Heritage Center is 15 minutes, Lumberjack Show is at the harbor.</p>
        <p><strong>Q: Which totem park is best?</strong><br/>A: Saxman Village for active carving demonstrations and cultural programs. Totem Bight State Park for free admission and atmospheric rainforest setting. Both worth visiting if time allows.</p>
        <p><strong>Q: What if Misty Fjords is cancelled?</strong><br/>A: Weather cancellations happen. Have a backup — the Lumberjack Show, totem tours, or rainforest zipline operate rain or shine.</p>
        <p><strong>Q: Best food in Ketchikan?</strong><br/>A: Alaska Fish House for best fish & chips in Southeast Alaska. Bar Harbor for upscale dining with harbor views.</p>
      </section>
    
    <!-- Photo Gallery Section -->
    <section class="port-section photo-gallery">
      <h2>Photo Gallery</h2>
      <div class="gallery-grid">
        <figure class="gallery-item">
          <img src="img/ketchikan/ketchikan-1.webp" alt="Scenic harbor view of Ketchikan, Alaska" loading="lazy">
          <figcaption>
            Scenic harbor view of Ketchikan, Alaska
            <div class="photo-credit">Photo: WikiMedia Commons</div>
          </figcaption>
        </figure>
        <figure class="gallery-item">
          <img src="img/ketchikan/ketchikan-2.webp" alt="Waterfront scenery of Ketchikan, Alaska" loading="lazy">
          <figcaption>
            Waterfront scenery of Ketchikan, Alaska
            <div class="photo-credit">Photo: WikiMedia Commons</div>
          </figcaption>
        </figure>
        <figure class="gallery-item">
          <img src="img/ketchikan/ketchikan-3.webp" alt="Port panorama of Ketchikan, Alaska" loading="lazy">
          <figcaption>
            Port panorama of Ketchikan, Alaska
            <div class="photo-credit">Photo: WikiMedia Commons</div>
          </figcaption>
        </figure>
        <figure class="gallery-item">
          <img src="img/ketchikan/ketchikan-4.webp" alt="Coastal landscape of Ketchikan, Alaska" loading="lazy">
          <figcaption>
            Coastal landscape of Ketchikan, Alaska
            <div class="photo-credit">Photo: WikiMedia Commons</div>
          </figcaption>
        </figure>
      </div>
    </section>

    <!-- Image Credits Section -->
    <section class="port-section image-credits">
      <h2>Image Credits</h2>
      <ul>
        <li><strong>ketchikan-1.webp</strong>: WikiMedia Commons (CC BY-SA)</li><li><strong>ketchikan-2.webp</strong>: WikiMedia Commons (CC BY-SA)</li><li><strong>ketchikan-3.webp</strong>: WikiMedia Commons (CC BY-SA)</li><li><strong>ketchikan-4.webp</strong>: WikiMedia Commons (CC BY-SA)</li>
      </ul>
      <p><em>Images sourced from WikiMedia Commons under Creative Commons licenses.</em></p>
    </section>

  </article>
  </div>
  <aside class="rail" style="grid-column: 2; grid-row: 1; align-self: start;">
    <section class="page-intro" style="margin: 0 0 1rem 0;">
      <p class="answer-line" style="margin: 0.75rem 0; padding: 0.5rem 0.75rem; border-left: 3px solid var(--rope, #d9b382); background: #f7fdff; border-radius: 8px;">
        <strong>Quick Answer:</strong> Ketchikan drips with rain, character, and color — Creek Street's crooked boardwalks, world-class totem poles, lumberjack shows, and Misty Fjords flightseeing that makes you believe in God.
      </p>
    </section>
        <section class="card author-card-vertical" aria-labelledby="author-heading">
      <h3 id="author-heading">About the Author</h3>
      <a href="/authors/ken-baker.html" aria-label="View Ken Baker's profile">
        <picture>
          <source srcset="/authors/img/ken1.webp?v=3.010.400" type="image/webp"/>
          <img class="author-avatar" src="/authors/img/ken1_96.webp" srcset="/authors/img/ken1_96.webp 1x, /authors/img/ken1_192.webp 2x" width="96" height="96" alt="Author photo" decoding="async" loading="lazy"/>
        </picture>
      </a>
      <h4><a href="/authors/ken-baker.html">Ken Baker</a></h4>
      <p class="tiny">Founder of In the Wake; writer and editor of the logbook.</p>
      <p class="tiny">
        <a href="https://www.flickersofmajesty.com" target="_blank" rel="noopener">Flickers of Majesty</a>
      </p>
    </section>

    <!-- Nearby Ports Rail -->
    <section class="card" aria-labelledby="nearby-ports-title">
        <h3 id="nearby-ports-title">Nearby Ports</h3>
        <p class="tiny" style="margin-bottom: 0.75rem; color: var(--ink-mid, #3d5a6a); line-height: 1.5;">
          Other ports in this region:
        </p>
        <div id="nearby-ports" class="rail-list" aria-live="polite">
          <p class="tiny" style="color:#999;">Loading nearby ports...</p>
        </div>
      </section>

      <!-- Recent Articles rail -->
      <section style="grid-column: 1;" class="card" aria-labelledby="recent-rail-title">
        <h3 id="recent-rail-title">Recent Stories</h3>
        <p class="tiny" style="margin-bottom: 1rem; color: var(--ink-mid, #3d5a6a); line-height: 1.5;">
          Real cruising experiences, practical guides, and heartfelt reflections from our community. Explore stories that inform, inspire, and connect.
        </p>
        <div id="recent-rail" class="rail-list" aria-live="polite"></div>
        <p id="recent-rail-fallback" class="tiny" style="display:none">Loading articles…</p>
      </section>
    
  
    <!-- Whimsical Distance Units -->
    <section class="card" id="whimsical-units-container" style="background:#f7fdff;border:1px solid #e0f0f5;border-radius:12px;padding:1.25rem;">
    </section>

  </aside>

    <p style="margin-top: 2rem;"><a href="/ports.html">&larr; Back to Ports Guide</a></p>
  </main>
    <footer class="wrap" role="contentinfo">
    <p>© 2025 In the Wake · A Cruise Traveler's Logbook · All rights reserved.</p>
    <p class="tiny" style="margin-top: 0.5rem;">
      <a href="/privacy.html">Privacy</a> ·
      <a href="/terms.html">Terms</a> ·
      <a href="/about-us.html">About</a> ·
      <a href="/accessibility.html">Accessibility &amp; WCAG 2.1 AA Commitment</a>
    </p>
    <p class="tiny center" style="opacity:0;position:absolute;pointer-events:none;" aria-hidden="true">Soli Deo Gloria — Every pixel and part of this project is offered as worship to God, in gratitude for the beautiful things He has created for us to enjoy. ✝️</p>
  </footer>

  <script>
    // Load recent articles
    (async function() {
      try {
        const response = await fetch('/assets/data/articles/index.json');
        const articles = await response.json();
        const rail = document.getElementById('recent-rail');

        if (rail && articles && articles.length > 0) {
          rail.innerHTML = articles.slice(0, 5).map(article => `
            <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e8f0;">
              <h4 style="margin: 0 0 0.25rem; font-size: 0.95rem;">
                <a href="${article.url}">${article.title}</a>
              </h4>
              <p style="margin: 0; font-size: 0.8rem; color: #666;">${article.date}</p>
            </div>
          `).join('');
        }
      } catch (err) {
        console.log('Could not load articles:', err);
      }
    })();
  </script>

  <script>
  (function(){
    "use strict";

    /* ===== Recent Articles Rail ===== */
    (async function recentRail(){
      const rail = document.getElementById('recent-rail');
      if(!rail) return;

      const fallback = document.getElementById('recent-rail-fallback');
      if(fallback) fallback.style.display = '';

      async function fetchJSONWithFallback(urls){
        for (const u of urls){
          try{
            const res = await fetch(u, { credentials: 'omit', cache: 'no-cache' });
            if (res.ok) return await res.json();
          }catch(err){

          }
        }
        return null;
      }

      const pick = (obj, keys, fallback=null)=>{ for(const k of keys){ if(obj && obj[k] != null) return obj[k]; } return fallback; };

      function setImageWithFallback(imgEl, primary, altPaths=[]){
        if(!imgEl) return;
        const stamp='v=3.010.400';
        const tried=new Set();
        const queue=[primary,...altPaths].filter(Boolean).map(p => p.includes('?')?p+'&'+stamp:p+'?'+stamp);
        function tryNext(){
          const next=queue.shift();
          if(!next){ imgEl.removeAttribute && imgEl.removeAttribute('onerror'); return; }
          if(tried.has(next)) return tryNext();
          tried.add(next);
          imgEl.src=next;
        }
        imgEl.onerror=tryNext;
        tryNext();
      }

      const raw = await fetchJSONWithFallback(['/assets/data/articles/index.json','/assets/data/articles.json']);
      if(!raw) {
        if(fallback) {
          fallback.textContent = 'Unable to load articles';
          fallback.style.display = '';
        }
        return;
      }

      const items = Array.isArray(raw?.articles) ? raw.articles : (Array.isArray(raw) ? raw : []);
      if(!items.length) return;

      const here = location.pathname.replace(/\/+$/,'');
      const view = items.filter(p=>{
        const href = pick(p,['url','path'],'#');
        const norm = (href||'').replace(/\/+$/,'');
        return norm && norm !== here;
      }).slice(0,6);

      rail.innerHTML = view.map(p=>{
        const title = pick(p,['title','name'],'Article');
        const href  = pick(p,['url','path'],'#');
        const excerpt = pick(p,['excerpt','description'],'');
        return `
          <article class="card article-card">
            <div class="article-card-grid">
              <div class="article-thumb-wrap">
                <img class="article-thumb" alt="" decoding="async" loading="lazy">
              </div>
              <div class="article-card-body">
                <h4><a href="${href}">${title}</a></h4>
                ${excerpt ? `<p class="tiny excerpt">${excerpt}</p>` : ''}
              </div>
            </div>
            <a href="${href}" class="pill read-more">Read Article →</a></article>`;
      }).join('');

      const cards = [...rail.querySelectorAll('article.card')];
      cards.forEach((card,i)=>{
        const p = view[i] || {};
        const el = card.querySelector('img.article-thumb');
        const href  = (pick(p,['url','path'],'')||'').toLowerCase();
        const title = (pick(p,['title','name'],'')||'').toLowerCase();

        let primary = pick(p, ['thumb','thumbnail','image','cover','img'], null);

        // FORCE override for Top-20
        if (/(top-20|first-?cruise-?questions)/.test(href) || /top\s*20.*first.*cruise.*questions/.test(title)){
          primary = '/assets/articles/thumbs/top-20-questions/cover.webp';
        }
        // Friendly specifics
        if(!primary && (/freedom-of-your-own-wake/.test(href) || /freedom of your own wake/.test(title))){
          primary = '/assets/articles/thumbs/freedom-of-your-own-wake.webp';
        }
        if(!primary && (/why-i-started-solo-cruising/.test(href) || /why i started solo cruising/.test(title))){
          primary = '/assets/articles/thumbs/why-i-started-solo-cruising.webp';
        }
        if(!primary && (/\/travel(\.html)?$/.test(href) || /\btravel\b/.test(title))){
          primary = '/assets/articles/travel/cover.jpg';
        }

        // Heuristic fallback
        if(!primary){
          const slugify = s => (s||'').toLowerCase().replace(/https?:\/\/[^/]+/,'').replace(/[#?].*$/,'').split('/').filter(Boolean).pop()||'';
          const guess = slugify(href) || slugify(title);
          if(guess) primary = `/assets/articles/${guess}/cover.jpg`;
        }

        const alts = [];
        if(primary){
          const base = primary.replace(/\.(jpg|jpeg|png|webp)$/i,'');
          alts.push(`${base}.jpeg`, `${base}.JPG`, `${base}.webp`, `${base}.png`);
        }
        setImageWithFallback(el, primary || '/assets/index_hero.webp', alts);
      });

      if(fallback) fallback.style.display = 'none';

      // Announce to screen readers
      const status = document.getElementById('a11y-status');
      if(status) {
        status.textContent = `${view.length} recent articles loaded`;
      }
    })();
  })();
  </script>
<!-- Navigation dropdown functionality -->
    <!-- Navigation dropdown functionality (New Clean Implementation) -->
  <script>
  (function() {
    'use strict';
    var dropdowns = document.querySelectorAll('.nav-dropdown');
    function toggleDropdown(dropdown) {
      var isOpen = dropdown.classList.contains('open');
      closeAllDropdowns();
      if (!isOpen) {
        dropdown.classList.add('open');
        var btn = dropdown.querySelector('button');
        if (btn) btn.setAttribute('aria-expanded', 'true');
      }
    }
    function closeAllDropdowns() {
      dropdowns.forEach(function(dd) {
        dd.classList.remove('open');
        var btn = dd.querySelector('button');
        if (btn) btn.setAttribute('aria-expanded', 'false');
      });
    }
    dropdowns.forEach(function(dropdown) {
      var btn = dropdown.querySelector('button');
      if (btn) {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          toggleDropdown(dropdown);
        });
        btn.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') { closeAllDropdowns(); btn.focus(); }
          if (e.key === 'ArrowDown') {
            e.preventDefault();
            dropdown.classList.add('open');
            btn.setAttribute('aria-expanded', 'true');
            var firstLink = dropdown.querySelector('.dropdown-menu a');
            if (firstLink) firstLink.focus();
          }
        });
      }
      var menu = dropdown.querySelector('.dropdown-menu');
      if (menu) {
        menu.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') { closeAllDropdowns(); if (btn) btn.focus(); }
        });
      }
    });
    document.addEventListener('click', function(e) {
      var isInsideDropdown = false;
      dropdowns.forEach(function(dd) { if (dd.contains(e.target)) isInsideDropdown = true; });
      if (!isInsideDropdown) closeAllDropdowns();
    });
  })();
  </script>

  <!-- Nearby Ports Script -->
  <script>window.currentPortId = 'ketchikan';</script>
  <script src="/assets/js/nearby-ports.js?v=3.010.306"></script>

  <!-- Whimsical Distance Units Script -->
  <script src="/assets/js/whimsical-port-units.js"></script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- Port Map Initialization (Mobile-Optimized) -->
  <script>
  (function() {
    'use strict';

    // Wait for Leaflet to load
    function initMap() {
      if (typeof L === 'undefined') {
        setTimeout(initMap, 100);
        return;
      }

      const mapEl = document.getElementById('port-map');
      if (!mapEl) return;

      // Detect mobile
      const isMobile = window.innerWidth < 768;
      const isSmallMobile = window.innerWidth < 480;

      // Initialize map centered on Ketchikan
      const map = L.map('port-map', {
        center: [55.3700, -131.5500],
        zoom: isSmallMobile ? 10 : 11,
        scrollWheelZoom: !isMobile, // Disable scroll zoom on mobile
        tap: true,
        touchZoom: true
      });

      // Add OpenStreetMap tiles
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        maxZoom: 18
      }).addTo(map);

      // === MOBILE ENHANCEMENTS ===

      // Add fullscreen button on mobile/tablet
      if (window.innerWidth < 1024) {
        const fsBtn = document.createElement('button');
        fsBtn.className = 'port-map-fullscreen-btn';
        fsBtn.innerHTML = '⛶';
        fsBtn.setAttribute('aria-label', 'Toggle fullscreen map');
        fsBtn.setAttribute('type', 'button');

        fsBtn.addEventListener('click', function() {
          mapEl.classList.toggle('fullscreen');
          map.invalidateSize(); // Recalculate map size
          fsBtn.innerHTML = mapEl.classList.contains('fullscreen') ? '✕' : '⛶';
          fsBtn.setAttribute('aria-label',
            mapEl.classList.contains('fullscreen') ? 'Exit fullscreen' : 'Toggle fullscreen map'
          );
          // Prevent body scroll when fullscreen
          document.body.style.overflow = mapEl.classList.contains('fullscreen') ? 'hidden' : '';
        });

        mapEl.appendChild(fsBtn);

        // Close fullscreen on Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && mapEl.classList.contains('fullscreen')) {
            fsBtn.click();
          }
        });
      }

      // Pan map to keep popup in view on mobile
      map.on('popupopen', function(e) {
        if (isMobile) {
          const px = map.project(e.popup._latlng);
          px.y -= e.popup._container.clientHeight / 2;
          map.panTo(map.unproject(px), { animate: true, duration: 0.3 });
        }
      });

      // Load POI data
      Promise.all([
        fetch('/assets/data/maps/poi-index.json').then(r => r.json()),
        fetch('/assets/data/maps/ketchikan.map.json').then(r => r.json())
      ]).then(([poiIndex, manifest]) => {
        const labelOverrides = manifest.label_overrides || {};
        const approxMarkers = manifest.approximate_markers || [];

        manifest.poi_ids.forEach(poiId => {
          const poi = poiIndex[poiId];
          if (!poi || !poi.lat || !poi.lon) return;

          const label = labelOverrides[poiId] || poi.name;
          const isApprox = approxMarkers.includes(poiId);

          // Color markers by type
          let markerColor = '#3388ff'; // default blue
          if (poi.type === 'port') markerColor = '#e74c3c';
          else if (poi.type === 'dining') markerColor = '#f39c12';
          else if (poi.type === 'nature') markerColor = '#27ae60';
          else if (poi.type === 'museum') markerColor = '#9b59b6';
          else if (poi.type === 'attraction') markerColor = '#e91e63';
          else if (poi.type === 'landmark') markerColor = '#00bcd4';

          const marker = L.circleMarker([poi.lat, poi.lon], {
            radius: poi.type === 'port' ? (isMobile ? 12 : 10) : (isMobile ? 9 : 7),
            fillColor: markerColor,
            color: '#fff',
            weight: 2,
            opacity: 1,
            fillOpacity: 0.8
          }).addTo(map);

          let popupContent = `<strong>${label}</strong>`;
          if (poi.notes) popupContent += `<br><span style="font-size:0.85em;line-height:1.4;">${poi.notes}</span>`;
          if (isApprox) popupContent += `<br><em style="font-size:0.8em;color:#999;">Location approximate</em>`;

          marker.bindPopup(popupContent, {
            maxWidth: isMobile ? 260 : 300,
            closeButton: true
          });
        });

        // Add port pin with special marker
        if (manifest.port_pin) {
          L.marker([manifest.port_pin.lat, manifest.port_pin.lon])
            .addTo(map)
            .bindPopup(`<strong>${manifest.port_pin.label}</strong><br>Walk directly into downtown Ketchikan`, {
              maxWidth: isMobile ? 260 : 300
            });
        }
      }).catch(err => {
        console.log('Could not load map data:', err);
        mapEl.innerHTML = '<p class="port-map-error">Map data unavailable. Please refresh the page.</p>';
      });

      // Handle window resize
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
          map.invalidateSize();
        }, 100);
      });
    }

    initMap();
  })();
  </script>

</body>
</html>
