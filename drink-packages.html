<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=5" />
<meta name="version" content="3.011.006" />
<title>Royal Caribbean Drink Package Calculator 2025 | Is It Worth It?</title>
<meta name="description" content="Free Royal Caribbean drink calculator with break-even chart, sea/port weighting, and transparent price assumptions. Compare Soda, Refreshment, and Deluxe vs. √†-la-carte." />
<link rel="canonical" href="https://cruisinginthewake.com/planning/drink-packages.html" />

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:title" content="Royal Caribbean Drink Package Calculator" />
<meta property="og:description" content="Break-even chart + sea/port day weighting. Find out if a package saves money." />
<meta property="og:url" content="https://cruisinginthewake.com/planning/drink-packages.html" />
<meta property="og:image" content="https://cruisinginthewake.com/assets/social/drink-calculator-2025.jpg" />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="RCL Drink Package Calculator" />
<meta name="twitter:description" content="See your cheapest option with gratuity included and break-even math." />

<!-- JSON-LD (Breadcrumbs) -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {"@type":"ListItem","position":1,"name":"Planning","item":"https://cruisinginthewake.com/planning/"},
    {"@type":"ListItem","position":2,"name":"Royal Caribbean Drink Package Calculator","item":"https://cruisinginthewake.com/planning/drink-packages.html"}
  ]
}
</script>

<!-- JSON-LD (FAQ) ‚Äî these Q&As are visible below -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {"@type":"Question","name":"Is the Royal Caribbean drink package worth it?","acceptedAnswer":{"@type":"Answer","text":"It can be worth it if you typically average ~5‚Äì6 alcoholic drinks per day. Use the calculator to compare √†-la-carte to Soda, Refreshment, and Deluxe, with gratuity included."}},
    {"@type":"Question","name":"Does the drink package include gratuity?","acceptedAnswer":{"@type":"Answer","text":"Yes. Package prices include the 18% service charge. √Ä-la-carte drinks add 18% at checkout."}},
    {"@type":"Question","name":"How do I enter sale prices from Cruise Planner?","acceptedAnswer":{"@type":"Answer","text":"Click ‚ÄúEdit price‚Ä¶‚Äù on any package to type your sale rate; results update instantly."}}
  ]
}
</script>

<!-- JSON-LD (WebPage) -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebPage",
  "name":"Royal Caribbean Drink Package Calculator 2025 | Is It Worth It?",
  "url":"https://cruisinginthewake.com/planning/drink-packages.html",
  "description":"Free Royal Caribbean drink calculator with break-even chart, sea/port day weighting, and transparent price assumptions.",
  "inLanguage":"en-US",
  "isPartOf": {"@type":"WebSite","name":"In the Wake","url":"https://cruisinginthewake.com/"}
}
</script>

<style>
:root{
  --bg:#f8fbfc; --card:#fff; --bd:#e5e7eb; --muted:#6b7280; --chip:#e7f6ea; --chipText:#0a7b3e;
  --good:#10b981; --warn:#f59e0b; --bad:#ef4444; --ink:#0f172a;
}
  /* Add this to your existing <style> block */
@media print {
  body {
    font-size: 12pt;
    background: var(--card); /* Use white background */
  }

  /* Hide everything that ISN'T the main results */
  header.navbar,
  .qs,
  .banner,
  .rail,
  .card:not(.inputs), /* Hides 'How to use' card */
  .controls-inline .btn { /* Hides the Print/Reset buttons */
    display: none;
  }

  /* Expand the main results card to full width */
  main.container {
    max-width: 100%;
    margin: 0;
    padding: 0;
  }
  .grid {
    grid-template-columns: 1fr;
  }

  /* Remove shadows/borders for printing */
  .card {
    border: none;
    box-shadow: none;
  }
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#111;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
a{color:#0369a1}
.container{max-width:1200px;margin:0 auto;padding:0 16px}
header.navbar{position:sticky;top:0;background:#0f172a;color:#fff;border-bottom:3px solid #d4af37;z-index:40}
header .inner{display:flex;align-items:center;gap:16px;padding:10px 12px}
header .brand img{height:32px}
header nav a{color:#dbeafe;text-decoration:none;margin:0 8px;font-weight:600}
.sr-only{position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden}
.banner{background:var(--chip);color:#111;border:1px solid #cfe8d7;border-radius:10px;padding:10px 14px;margin:18px 0;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.chip{background:#bfe8c8;color:var(--chipText);border-radius:999px;padding:3px 10px;font-weight:800}
.grid{display:grid;grid-template-columns:1.4fr .8fr;gap:24px}
.card{background:var(--card);border:1px solid var(--bd);border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,.03)}
.card .hd{padding:12px 16px;border-bottom:1px dashed var(--bd);font-weight:800}
.card .bd{padding:12px 16px}
.row{display:grid;grid-template-columns:1fr 120px;align-items:center;padding:10px 0;border-bottom:1px dashed var(--bd);gap:10px}
.row:last-child{border-bottom:0}
.inputs input[type="number"], .inputs input[type="text"]{width:110px;padding:6px 8px;border:1px solid var(--bd);border-radius:8px;font:inherit}
.inputs .pill{background:#ecfeff;border:1px solid #bae6fd;border-radius:999px;padding:2px 8px;margin-left:8px;font-weight:700;color:#0f172a}
.inputs .included .pill{background:#eef2ff;border:1px solid #e5e7eb;color:#334155}
.qs{background:#fde68a20;border:1px solid #f59e0b50;border-radius:12px;padding:14px 16px;margin:16px 0}
.qs .qs-hd{font-weight:800;color:#7c2d12}
.qs .qs-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.qs .qs-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;background:#ecfeff;border:1px solid #bae6fd;border-radius:12px;padding:10px;cursor:pointer;font-weight:700;color:#0f172a;text-align:center;font:inherit}
.qs .qs-btn small{font-weight:600;color:#475569}
.health{display:none;background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;border-radius:10px;padding:10px 14px;margin:12px 0;font-size:.95rem}
.health.show{display:block}
.packages{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-top:18px;overflow-x:auto;padding-inline:6px;scroll-snap-type:x proximity}
.pkg{border-radius:14px;overflow:hidden;position:relative;scroll-snap-align:start}
.pkg .phd{background:#0b2940;color:#fff;padding:12px 14px;font-weight:800;display:flex;gap:8px;align-items:center;justify-content:space-between}
.pkg.winner{outline:3px solid #34d399;box-shadow:0 0 0 6px rgba(52,211,153,.15)}
.pkg.winner .phd{background:linear-gradient(135deg, #059669 0%, #10b981 100%)}
.pkg.winner::before{content:'üèÜ Best Value';position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:#fbbf24;color:#78350f;padding:4px 12px;border-radius:999px;font-size:.8rem;font-weight:800;box-shadow:0 4px 12px rgba(251,191,36,.5)}
.pkg .pbd{padding:14px}
.pkg .muted{color:var(--muted);font-size:.9rem}
.pkg .save{font-weight:700;margin-top:6px;color:#059669}
.help{all:unset;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;background:#0ea5e9;color:#fff;font-weight:800;line-height:1}
.tooltip{position:relative}
.tooltip [role="tooltip"]{position:absolute;inset:auto auto 100% 0;transform:translateY(-8px);background:#0f172a;color:#fff;padding:8px 10px;border-radius:8px;min-width:220px;box-shadow:0 6px 18px rgba(0,0,0,.2);font-size:.9rem;display:none;z-index:100}
.tooltip:focus-within [role="tooltip"], .tooltip:hover [role="tooltip"]{display:block}
#breakeven-wrap{margin-top:18px}
#breakeven-chart{width:100%;height:280px;border:1px dashed var(--bd);border-radius:10px}
.controls-inline{display:flex;gap:10px;flex-wrap:wrap}
.badge{background:#fbbf24;color:#78350f;padding:4px 10px;border-radius:999px;font-weight:800}
.btn{cursor:pointer;padding:8px 12px;border:1px solid var(--bd);border-radius:8px;background:#0f172a;color:#fff;font-weight:700}
.btn.ghost{background:#fff;color:#0f172a}
.small{font-size:.9rem;color:var(--muted)}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:8px;border-bottom:1px solid var(--bd);text-align:left}

@media (max-width:960px){
  .grid{grid-template-columns:1fr}
  .qs .qs-grid{grid-template-columns:repeat(2,1fr)}
  .row{grid-template-columns:1fr 110px}
}
@media (max-width:640px){
  .qs .qs-grid{grid-template-columns:1fr}
}

/* dark mode */
@media (prefers-color-scheme: dark){
  :root{--bg:#1a202c;--card:#2d3748;--bd:#4a5568;--muted:#a0aec0}
  body{color:#e2e8f0}
  .card{box-shadow:0 1px 4px rgba(0,0,0,.2)}
  .health{background:#92400e;border-color:#c05621;color:#feebc8}
  .tooltip [role="tooltip"]{background:#2d3748;color:#e2e8f0}
}
</style>

<!-- libs -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
<a href="#main" class="sr-only">Skip to main content</a>

<header class="navbar">
  <div class="inner container">
    <a class="brand" href="/"><img src="/assets/logo_wake.png" alt="In the Wake" width="256" height="64" loading="eager"></a>
    <nav aria-label="Primary" id="itw-primary-nav">
      <a class="itw-nav__link" href="/">Home</a>
      <a class="itw-nav__link" href="/planning/">Planning</a>
      <a class="itw-nav__link" href="/about/">About</a>
    </nav>
    <button class="itw-menu-btn btn ghost" aria-expanded="false" aria-controls="itw-primary-nav" style="margin-left:auto">Menu</button>
    <div class="small">v3.011.006</div>
  </div>
</header>

<main class="container" id="main">
  <!-- Fallback banner -->
  <p id="fallback-banner" class="health" role="status" hidden>‚ö†Ô∏è We couldn't load live prices; using defaults.</p>

  <!-- Quick Start -->
  <section class="qs" aria-labelledby="qs-title">
    <div class="qs-hd" id="qs-title">üöÄ Quick Start: Load a Preset</div>
    <p class="small">Try a common pattern:</p>
    <div class="qs-grid">
      <button class="qs-btn" type="button" onclick="loadPreset('light')"><span>üå§Ô∏è Light Drinker</span><small>2‚Äì3 drinks/day</small></button>
      <button class="qs-btn" type="button" onclick="loadPreset('moderate')"><span>üçπ Moderate</span><small>5‚Äì6 drinks/day</small></button>
      <button class="qs-btn" type="button" onclick="loadPreset('heavy')"><span>üéâ Party Mode</span><small>8‚Äì10 drinks/day</small></button>
      <button class="qs-btn" type="button" onclick="loadPreset('coffee')"><span>‚òï Coffee Lover</span><small>4 coffees, no alcohol</small></button>
    </div>
  </section>

  <!-- Banner -->
  <div class="banner" role="status" aria-live="polite">
    <span id="best-chip" class="chip">Best value: √†-la-carte</span>
    <span id="best-text">Your daily picks are cheapest without a package.</span>
    <button id="jump-winner" class="btn ghost" type="button">Jump to Best Value</button>
  </div>

  <!-- Health -->
  <p id="health-note" class="health" role="status" aria-live="assertive"></p>

  <!-- How to use (visible, matches FAQ HowTo if you want to add LD later) -->
  <section class="card" aria-label="How to use">
    <div class="hd">How to use this calculator</div>
    <div class="bd">
      <ol>
        <li>Enter your cruise length and typical daily drinks.</li>
        <li>Optionally tune sea/port weighting and edit package prices or caps.</li>
        <li>See which option is cheapest per day and for the whole trip.</li>
      </ol>
    </div>
  </section>

  <div class="grid">
    <!-- Inputs -->
    <section class="card inputs" aria-labelledby="calc-title">
      <h2 id="calc-title" class="hd">
        <span id="totals">$0.00/day ‚Ä¢ $0.00 trip</span>
        <small class="small">‚Äì includes 18% gratuity</small>
        <div id="range-note" class="small" style="margin-top:6px;font-weight:700;"></div>
      </h2>
      <div class="bd">
        <div class="row">
          <label for="input-days">Cruise days</label>
          <input id="input-days" type="text" inputmode="numeric" value="7" data-input="days" aria-label="Cruise length in days">
        </div>
        <!-- Sea/Port -->
        <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:8px">
          <legend style="font-weight:800;padding:0 6px">Sea/Port variability</legend>
          <div class="row">
            <label for="input-seadays">Number of sea days</label>
            <input id="input-seadays" type="text" inputmode="numeric" value="3" data-input="seadays" aria-label="Number of sea days">
          </div>
          <div class="row" style="grid-template-columns:1fr 1fr">
            <label><input type="checkbox" id="sea-toggle" checked data-input="seaapply"> Apply weighting</label>
            <div class="controls-inline">
              <label for="sea-weight" class="small">Weight ¬±%</label>
              <input id="sea-weight" type="range" min="0" max="40" value="20" data-input="seaweight" aria-label="Sea day weighting percent">
              <span id="sea-weight-val" class="small">20%</span>
            </div>
          </div>
        </fieldset>

        <!-- Group -->
        <fieldset style="border:1px solid var(--bd);padding:12px;border-radius:10px;margin-top:12px">
          <legend style="font-weight:800;padding:0 6px">Group in stateroom</legend>
          <div class="row">
            <label for="input-adults">Adults (21+)</label>
            <input id="input-adults" type="text" inputmode="numeric" value="1" data-input="adults" aria-label="Number of adults">
          </div>
          <div class="row">
            <label for="input-minors">Minors (under 21)</label>
            <input id="input-minors" type="text" inputmode="numeric" value="0" data-input="minors" aria-label="Number of minors">
          </div>
        </fieldset>

        <!-- Drinks -->
        <div class="row"><label>Soda per day <small class="pill" data-price-pill="soda"></small></label><input id="input-soda" type="text" inputmode="decimal" value="0" data-input="soda"></div>
        <div class="row"><label>Premium coffee per day <small class="pill" data-price-pill="coffee"></small></label><input id="input-coffee" type="text" inputmode="decimal" value="0" data-input="coffee"></div>
        <div class="row"><label>Specialty tea per day <small class="pill" data-price-pill="teaprem"></small></label><input id="input-teaprem" type="text" inputmode="decimal" value="0" data-input="teaprem"></div>
        <div class="row"><label>Fresh juice/smoothie per day <small class="pill" data-price-pill="freshjuice"></small></label><input id="input-freshjuice" type="text" inputmode="decimal" value="0" data-input="freshjuice"></div>
        <div class="row"><label>Mocktail per day <small class="pill" data-price-pill="mocktail"></small></label><input id="input-mocktail" type="text" inputmode="decimal" value="0" data-input="mocktail"></div>
        <div class="row"><label>Energy drink per day <small class="pill" data-price-pill="energy"></small></label><input id="input-energy" type="text" inputmode="decimal" value="0" data-input="energy"></div>
        <div class="row"><label>Milkshake per day <small class="pill" data-price-pill="milkshake"></small></label><input id="input-milkshake" type="text" inputmode="decimal" value="0" data-input="milkshake"></div>
        <div class="row"><label>Bottled water per day <small class="pill" data-price-pill="bottledwater"></small></label><input id="input-bottledwater" type="text" inputmode="decimal" value="0" data-input="bottledwater"></div>
        <div class="row"><label>Beer per day <small class="pill" data-price-pill="beer"></small></label><input id="input-beer" type="text" inputmode="decimal" value="0" data-input="beer"></div>
        <div class="row"><label>Wine per day <small class="pill" data-price-pill="wine"></small></label><input id="input-wine" type="text" inputmode="decimal" value="0" data-input="wine"></div>
        <div class="row"><label>Cocktail per day <small class="pill" data-price-pill="cocktail"></small></label><input id="input-cocktail" type="text" inputmode="decimal" value="0" data-input="cocktail"></div>
        <div class="row"><label>Spirits/shot per day <small class="pill" data-price-pill="spirits"></small></label><input id="input-spirits" type="text" inputmode="decimal" value="0" data-input="spirits"></div>

        <div id="breakeven-wrap">
          <canvas id="breakeven-chart" width="900" height="280" aria-label="Break-even comparison chart"></canvas>
        </div>

        <div class="controls-inline" style="margin-top:12px">
          <button class="btn" type="button" onclick="exportToPDF()<button class="btn" type="button" onclick="printResults()">Print / Save Results</button>>Export PDF</button>
          <button class="btn" type="button" onclick="resetInputs()" style="background:var(--bad)">Reset All</button>
        </div>
      </div>
    </section>

    <!-- Sidebar -->
    <aside class="rail" aria-label="Sidebar">
      <section class="card">
        <div class="hd">Packages</div>
        <div class="bd">
          <section class="packages" id="packages">
            <!-- Soda -->
            <article class="pkg card" data-card="soda" id="pkg-soda">
              <header class="phd">
                <span>Classic Soda</span>
                <span class="tooltip">
                  <button class="help" aria-describedby="tt-soda" aria-label="Soda package help" type="button">?</button>
                  <span id="tt-soda" role="tooltip">Unlimited fountain soda + Coca-Cola Freestyle. One drink at a time.</span>
                </span>
              </header>
              <div class="pbd">
                <p class="muted"><strong data-pkg-price="soda">$13.99/day</strong> <span class="small">range $12.99‚Äì$15</span></p>
                <p class="small">Included value (your picks): <strong data-inc="soda">$0.00/day</strong></p>
                <p class="save small" data-saves="soda" hidden></p>
                <div class="controls-inline" style="margin-top:6px">
                  <button class="btn ghost" type="button" onclick="togglePriceEdit('soda')">üìù Edit price‚Ä¶</button>
                  <form class="controls-inline small" id="edit-soda" hidden onsubmit="return false;">
                    <label>$/day</label>
                    <input type="number" step="0.01" min="0" value="13.99" id="edit-soda-val" style="width:90px">
                    <button class="btn" type="button" onclick="savePackagePrice('soda')">Save</button>
                    <button class="btn ghost" type="button" onclick="togglePriceEdit('soda',true)">Cancel</button>
                  </form>
                </div>
              </div>
            </article>
            <!-- Refresh -->
            <article class="pkg card" data-card="refresh" id="pkg-refresh">
              <header class="phd">
                <span>Refreshment</span>
                <span class="tooltip">
                  <button class="help" aria-describedby="tt-refresh" aria-label="Refreshment help" type="button">?</button>
                  <span id="tt-refresh" role="tooltip">Covers non-alcoholic specials: premium coffee, tea, fresh juice, mocktails, energy, milkshakes, bottled water, soda.</span>
                </span>
              </header>
              <div class="pbd">
                <p class="muted"><strong data-pkg-price="refresh">$34.00/day</strong> <span class="small">range $29‚Äì$38</span></p>
                <p class="small">Included value: <strong data-inc="refresh">$0.00/day</strong></p>
                <p class="save small" data-saves="refresh" hidden></p>
                <div class="controls-inline" style="margin-top:6px">
                  <button class="btn ghost" type="button" onclick="togglePriceEdit('refresh')">üìù Edit price‚Ä¶</button>
                  <form class="controls-inline small" id="edit-refresh" hidden onsubmit="return false;">
                    <label>$/day</label>
                    <input type="number" step="0.01" min="0" value="34.00" id="edit-refresh-val" style="width:90px">
                    <button class="btn" type="button" onclick="savePackagePrice('refresh')">Save</button>
                    <button class="btn ghost" type="button" onclick="togglePriceEdit('refresh',true)">Cancel</button>
                  </form>
                </div>
              </div>
            </article>
            <!-- Deluxe -->
            <article class="pkg card" data-card="deluxe" id="pkg-deluxe">
              <header class="phd">
                <span>Deluxe (Alcoholic)</span>
                <span class="tooltip">
                  <button class="help" aria-describedby="tt-deluxe" aria-label="Deluxe help" type="button">?</button>
                  <span id="tt-deluxe" role="tooltip">Covers alcoholic drinks up to the price cap + all non-alcoholic items. Over-cap drinks add the difference.</span>
                </span>
              </header>
              <div class="pbd">
                <p class="muted"><strong data-pkg-price="deluxe">$85.00/day</strong> <span class="small">range $55‚Äì$115</span></p>
                <p class="small">Price cap: <strong id="cap-badge">$14.00</strong> <button class="btn ghost" type="button" onclick="toggleCapEdit()">Edit cap‚Ä¶</button></p>
                <form class="controls-inline small" id="edit-cap" hidden onsubmit="return false;">
                  <label>Cap $</label><input type="number" step="0.01" min="0" value="14.00" id="edit-cap-val" style="width:90px">
                  <button class="btn" type="button" onclick="saveCap()">Save</button>
                  <button class="btn ghost" type="button" onclick="toggleCapEdit(true)">Cancel</button>
                </form>
                <p class="small">Included value: <strong data-inc="deluxe">$0.00/day</strong></p>
                <p class="small">Over-cap add-on (est.): <strong id="overcap-est">$0.00/day</strong></p>
                <p class="save small" data-saves="deluxe" hidden></p>
                <div class="controls-inline" style="margin-top:6px">
                  <button class="btn ghost" type="button" onclick="togglePriceEdit('deluxe')">üìù Edit price‚Ä¶</button>
                  <form class="controls-inline small" id="edit-deluxe" hidden onsubmit="return false;">
                    <label>$/day</label>
                    <input type="number" step="0.01" min="0" value="85.00" id="edit-deluxe-val" style="width:90px">
                    <button class="btn" type="button" onclick="savePackagePrice('deluxe')">Save</button>
                    <button class="btn ghost" type="button" onclick="togglePriceEdit('deluxe',true)">Cancel</button>
                  </form>
                </div>
              </div>
            </article>
          </section>
        </div>
      </section>

      <section class="card">
        <div class="hd">Group breakdown</div>
        <div class="bd">
          <p id="policy-warning" class="health show" role="alert" hidden>‚ö†Ô∏è Policy: If one adult buys Deluxe, all adults must. Minors typically get ~50% off non-alcoholic.</p>
          <section id="group-breakdown" hidden>
            <table class="table">
              <thead><tr><th>Person</th><th>Package</th><th>Daily</th><th>Trip</th></tr></thead>
              <tbody id="group-table-body"></tbody>
            </table>
          </section>
        </div>
      </section>

      <section class="card">
        <div class="hd">FAQ (quick)</div>
        <div class="bd small">
          <p><strong>Is it worth it?</strong> Often if you average ~5‚Äì6 alcoholic drinks/day. Use the chart to compare.</p>
          <p><strong>Includes gratuity?</strong> Yes, packages include 18%. √Ä-la-carte adds 18% per drink.</p>
          <p><strong>Sale prices?</strong> Click ‚ÄúEdit price‚Ä¶‚Äù on any package to enter your rate.</p>
        </div>
      </section>
    </aside>
  </div>

  <p id="a11y-status" class="sr-only" aria-live="polite"></p>
</main>

<script>
/* -------------------- Data layer with fallback -------------------- */
const FALLBACK_DATASET = {
  version: "3.011.006",
  rules: { gratuity: 0.18, deluxeCap: 14.00, minorDiscount: 0.5 },
  packages: { soda: 13.99, refresh: 34.00, deluxe: 85.00 },
  prices: {
    soda: 2.00, coffee: 4.50, teaprem: 3.50, freshjuice: 6.00, mocktail: 6.50,
    energy: 5.50, milkshake: 6.95, bottledwater: 2.95, beer: 8.50, wine: 11.00,
    cocktail: 13.00, spirits: 10.00
  },
  sets: {
    refresh: ["soda","coffee","teaprem","freshjuice","mocktail","energy","milkshake","bottledwater"],
    soda: ["soda"],
    alcoholic: ["beer","wine","cocktail","spirits"]
  }
};
(function loadDataset(){
  const url = '/assets/data/lines/royal-caribbean.json?v=3.011.006';
  fetch(url, {cache:'default'})
    .then(r => r.ok ? r.json() : Promise.reject(new Error('HTTP '+r.status)))
    .then(j => { window.itwDataset = j; document.dispatchEvent(new Event('itw:dataset-ready')); })
    .catch(() => {
      window.itwDataset = FALLBACK_DATASET;
      const b = document.getElementById('fallback-banner'); if (b) b.hidden = false;
      document.dispatchEvent(new Event('itw:dataset-ready'));
    });
})();

/* -------------------- Utilities -------------------- */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
function money(n){ return (n||0).toLocaleString(undefined,{style:'currency',currency:'USD'}); }
function parseNum(s){
  if (typeof s !== 'string') return Number(s) || 0;
  let t = s.trim().replace(/\s+/g,'');
  if (t.includes(',') && !t.includes('.')) t = t.replace(',', '.');
  t = t.replace(/,/g,''); // strip thousands if mixed
  const n = Number(t);
  return Number.isFinite(n) ? n : 0;
}
function parseQty(v){
  if (typeof v !== 'string') return Number(v)||0;
  const s = v.trim();
  const m = s.match(/^(\d+[.,]?\d*)\s*[-‚Äì]\s*(\d+[.,]?\d*)$/);
  if (m) return { min: parseNum(m[1]), max: parseNum(m[2]) };
  return parseNum(s);
}
function sum(arr){ return arr.reduce((a,b)=>a+b,0); }
function announce(msg){ const live = $('#a11y-status'); if (live){ live.textContent = msg; }}

/* -------------------- Reads & state -------------------- */
function readPicks(){
  const p = {};
  $$('[data-input]').forEach(inp=>{
    if (inp.type === 'checkbox') p[inp.dataset.input] = inp.checked;
    else p[inp.dataset.input] = parseQty(inp.value);
  });
  p.days = Math.max(1, (typeof p.days === 'object'? p.days.max: p.days) || 1);
  p.seadays = Math.min(p.days, Math.max(0, (typeof p.seadays==='object'? p.seadays.max: p.seadays) || 0));
  p.seaapply = p.seaapply !== false;
  p.seaweight = Math.max(0, Math.min(40, (typeof p.seaweight==='object'? p.seaweight.max: p.seaweight) || 20));
  p.adults = Math.max(1, (typeof p.adults==='object'? p.adults.max: p.adults) || 1);
  p.minors = Math.max(0, (typeof p.minors==='object'? p.minors.max: p.minors) || 0);
  // drinks: allow numbers or {min,max}
  return p;
}
function picksList(p){
  const keys = ["soda","coffee","teaprem","freshjuice","mocktail","energy","milkshake","bottledwater","beer","wine","cocktail","spirits"];
  return keys.map(k => [k, p[k] || 0]);
}
function listToScalar(list, mode="mean"){
  return list.map(([k,v])=>{
    if (typeof v === 'object') {
      if (mode==="min") return [k, v.min||0];
      if (mode==="max") return [k, v.max||0];
      return [k, ((v.min||0)+(v.max||0))/2];
    }
    return [k, v||0];
  });
}
function applySeaPortWeight(list, days, seaDays, weightPct){
  if (!$('#sea-toggle').checked) return list;
  const w = (weightPct||20)/100;
  const seaF = 1+w, portF = 1-w;
  return list.map(([id,qty])=>{
    const adj = ((qty*seaF*seaDays) + (qty*portF*(days-seaDays))) / days;
    return [id, adj];
  });
}

/* -------------------- Math -------------------- */
function includedValue(list, priceMap, setArr, grat){
  // sum of included items √†-la-carte (with gratuity), limited to list quantities
  return sum(list.filter(([id])=>setArr.includes(id)).map(([id,qty]) => qty * priceMap[id] * (1+grat)));
}
function deluxeIncludedAndOvercap(list, priceMap, sets, cap, grat){
  let included = 0, overcap = 0;
  list.forEach(([id,qty])=>{
    const unit = priceMap[id]||0;
    if (sets.alcoholic.includes(id)) {
      if (unit <= cap) {
        included += qty * unit * (1+grat);
      } else {
        // included up to cap, plus overage as add-on
        included += qty * cap * (1+grat);
        overcap += qty * (unit - cap) * (1+grat);
      }
    } else if (sets.refresh.includes(id) || sets.soda.includes(id)) {
      included += qty * unit * (1+grat);
    }
  });
  return {included, overcap};
}
function alcPerDay(list, priceMap, grat){
  return sum(list.map(([id,qty]) => qty * (priceMap[id]||0) * (1+grat)));
}

/* -------------------- UI wiring -------------------- */
let chart;
function paintChart(values){
  const ctx = $('#breakeven-chart').getContext('2d');
  const labels = ['√Ä-la-carte','Soda','Refreshment','Deluxe'];
  const datasets = [
    {label:'Daily cost', data:[values.alc.mean, values.soda.mean, values.refresh.mean, values.deluxe.mean], backgroundColor:'#60a5fa'}
  ];
  if (values.hasRange) {
    // overlay outlines (max)
    datasets.push({label:'(max)', data:[values.alc.max, values.soda.max, values.refresh.max, values.deluxe.max], borderColor:'rgba(0,0,0,.35)', borderWidth:2, backgroundColor:'transparent' });
    datasets.push({label:'(min)', data:[values.alc.min, values.soda.min, values.refresh.min, values.deluxe.min], borderColor:'rgba(0,0,0,.2)', borderDash:[6,4], borderWidth:2, backgroundColor:'transparent' });
    $('#range-note').textContent = 'Range bars show min/max based on your ranges.';
  } else {
    $('#range-note').textContent = '';
  }
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type:'bar',
    data:{ labels, datasets },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      scales:{ y:{ beginAtZero:true, ticks:{ callback:(v)=>'$'+v } } },
      plugins:{ legend:{ position:'bottom' } }
    }
  });
}
function highlightWinner(key){
  ['soda','refresh','deluxe'].forEach(k => $('#pkg-'+k).classList.toggle('winner', k===key));
  $('#best-chip').textContent = `Best value: ${key==='alc'?'√†-la-carte':key.charAt(0).toUpperCase()+key.slice(1)}`;
  $('#best-text').textContent = (key==='alc')
    ? 'Your daily picks are cheapest without a package.'
    : `Your daily picks are cheapest with the ${key==='deluxe'?'Deluxe':key==='refresh'?'Refreshment':'Soda'} package.`;
  announce('Best value updated: ' + (key==='alc'?'√†-la-carte':key));
}
function togglePriceEdit(which, cancel=false){
  const form = $('#edit-'+which);
  if (!form) return;
  form.hidden = cancel ? true : !form.hidden;
  if (!form.hidden) form.querySelector('input').focus();
}
function savePackagePrice(which){
  const ds = window.itwDataset;
  const el = $('#edit-'+which+'-val');
  const v = parseNum(el.value);
  if (v>0) {
    ds.packages[which] = v;
    document.querySelector(`[data-pkg-price="${which}"]`).textContent = money(v) + '/day';
    togglePriceEdit(which,true);
    announce(`Updated ${which} to ${money(v)} per day`);
    recompute();
  }
}
function toggleCapEdit(cancel=false){
  const f = $('#edit-cap');
  f.hidden = cancel ? true : !f.hidden;
  if (!f.hidden) f.querySelector('input').focus();
}
function saveCap(){
  const ds = window.itwDataset;
  const v = parseNum($('#edit-cap-val').value);
  if (v>=0) {
    ds.rules.deluxeCap = v;
    $('#cap-badge').textContent = v.toFixed(2);
    toggleCapEdit(true);
    announce(`Updated deluxe cap to $${v.toFixed(2)}`);
    recompute();
  }
}
function resetInputs(){
  $$('[data-input]').forEach(el=>{
    if (el.type==='checkbox') el.checked = (el.id==='sea-toggle');
    else {
      const def = (el.dataset.input==='days')?7:
                  (el.dataset.input==='seadays')?3:
                  (el.dataset.input==='adults')?1:
                  (el.dataset.input==='minors')?0:
                  (el.dataset.input==='seaweight')?20:0;
      el.value = def;
    }
  });
  // reset edits
  const ds = window.itwDataset;
  ds.packages = {...FALLBACK_DATASET.packages};
  ds.rules.deluxeCap = FALLBACK_DATASET.rules.deluxeCap;
  $('[data-pkg-price="soda"]').textContent = money(ds.packages.soda)+'/day';
  $('[data-pkg-price="refresh"]').textContent = money(ds.packages.refresh)+'/day';
  $('[data-pkg-price="deluxe"]').textContent = money(ds.packages.deluxe)+'/day';
  $('#cap-badge').textContent = ds.rules.deluxeCap.toFixed(2);
  announce('All inputs reset');
  recompute();
}
function exportToPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  html2canvas(document.querySelector('main'), {scale:1}).then(canvas=>{
    const img = canvas.toDataURL('image/png');
    const pageWidth = doc.internal.pageSize.getWidth();
    const h = canvas.height * (pageWidth / canvas.width);
    doc.addImage(img, 'PNG', 5, 5, pageWidth-10, h);
    doc.save('drink-calculator.pdf');
  });
}
$('#jump-winner').addEventListener('click', ()=>{
  const winner = document.querySelector('.pkg.winner') || document.querySelector('.packages');
  if (winner){ winner.scrollIntoView({behavior:'smooth',block:'start'}); }
});

/* -------------------- Compute -------------------- */
function recompute(){
  const ds = window.itwDataset; if (!ds) return;
  // price pills
  Object.entries(ds.prices).forEach(([k,v])=>{
    const pill = document.querySelector(`[data-price-pill="${k}"]`);
    if (pill) pill.textContent = `avg ${money(v)}`;
  });

  const grat = Number(ds.rules?.gratuity ?? 0.18);
  const cap  = Number(ds.rules?.deluxeCap ?? 14.00);
  const sets = ds.sets;

  const p = readPicks();
  const baseList = picksList(p);
  const meanList = applySeaPortWeight(listToScalar(baseList,'mean'), p.days, p.seadays, p.seaweight);
  const minList  = applySeaPortWeight(listToScalar(baseList,'min'),  p.days, p.seadays, p.seaweight);
  const maxList  = applySeaPortWeight(listToScalar(baseList,'max'),  p.days, p.seadays, p.seaweight);

  const hasRange = baseList.some(([k,v])=>typeof v==='object');

  // ALC
  const alcMean = alcPerDay(meanList, ds.prices, grat);
  const alcMin  = alcPerDay(minList,  ds.prices, grat);
  const alcMax  = alcPerDay(maxList,  ds.prices, grat);

  // Included values
  const incS_mean = includedValue(meanList, ds.prices, sets.soda, grat);
  const incR_mean = includedValue(meanList, ds.prices, sets.refresh, grat);
  const del_mean  = deluxeIncludedAndOvercap(meanList, ds.prices, sets, cap, grat);

  const incS_min = includedValue(minList, ds.prices, sets.soda, grat);
  const incR_min = includedValue(minList, ds.prices, sets.refresh, grat);
  const del_min  = deluxeIncludedAndOvercap(minList, ds.prices, sets, cap, grat);

  const incS_max = includedValue(maxList, ds.prices, sets.soda, grat);
  const incR_max = includedValue(maxList, ds.prices, sets.refresh, grat);
  const del_max  = deluxeIncludedAndOvercap(maxList, ds.prices, sets, cap, grat);

  const soda   = { mean: ds.packages.soda,    min: ds.packages.soda,    max: ds.packages.soda };
  const refresh= { mean: ds.packages.refresh, min: ds.packages.refresh, max: ds.packages.refresh };
  const deluxe = { mean: ds.packages.deluxe + del_mean.overcap, min: ds.packages.deluxe + del_min.overcap, max: ds.packages.deluxe + del_max.overcap };

  // Nets vs included value
  const netS = { mean: soda.mean   - incS_mean, min: soda.min   - incS_min,   max: soda.max   - incS_max };
  const netR = { mean: refresh.mean- incR_mean, min: refresh.min- incR_min,   max: refresh.max- incR_max };
  const netD = { mean: deluxe.mean - del_mean.included, min: deluxe.min - del_min.included, max: deluxe.max - del_max.included };

  // Winner by mean (or alc if all larger)
  const candidates = [
    {key:'alc', val: alcMean},
    {key:'soda', val: netS.mean},
    {key:'refresh', val: netR.mean},
    {key:'deluxe', val: netD.mean}
  ];
  const minVal = Math.min(...candidates.map(c=>c.val));
  const win = candidates.find(c=>c.val===minVal)?.key || 'alc';
  highlightWinner(win);

  // Fill included/overcap text
  $('[data-inc="soda"]').textContent = money(incS_mean)+'/day';
  $('[data-inc="refresh"]').textContent = money(incR_mean)+'/day';
  $('[data-inc="deluxe"]').textContent = money(del_mean.included)+'/day';
  $('#overcap-est').textContent = money(del_mean.overcap)+'/day';

  // Totals
  const perDay = (win==='alc') ? alcMean : (win==='soda' ? netS.mean : (win==='refresh' ? netR.mean : netD.mean));
  const alcoholQty = sum(meanList.filter(([id])=>sets.alcoholic.includes(id)).map(([id,qty])=>qty));
  const deluxeRequired = (alcoholQty>0 && p.adults>1);
  const policyEl = $('#policy-warning');
  policyEl.hidden = !deluxeRequired;

  const kidDisc = ds.rules.minorDiscount ?? 0.5;
  let groupMult = 0;
  let adultStrategy = win;
  if (deluxeRequired) adultStrategy = 'deluxe';

  // Group table
  const body = $('#group-table-body');
  const sec  = $('#group-breakdown');
  body.innerHTML='';

  function strategyCostForKey(key){
    if (key==='alc') return alcMean;
    if (key==='soda') return netS.mean;
    if (key==='refresh') return netR.mean;
    if (key==='deluxe') return netD.mean;
    return alcMean;
  }

  for(let i=1;i<=p.adults;i++){
    const k = adultStrategy;
    const d = strategyCostForKey(k);
    body.innerHTML += `<tr><td>Adult ${i}</td><td>${k==='alc'?'√Ä-la-carte':k.charAt(0).toUpperCase()+k.slice(1)}</td><td>${money(d)}</td><td>${money(d*p.days)}</td></tr>`;
    groupMult += 1;
  }
  for(let i=1;i<=p.minors;i++){
    const k = (adultStrategy==='deluxe' || win==='deluxe') ? 'refresh' : win; // minors non-alc
    const d = strategyCostForKey(k) * kidDisc;
    body.innerHTML += `<tr><td>Minor ${i}</td><td>${k==='alc'?'√Ä-la-carte':'Refreshment (disc.)'}</td><td>${money(d)}</td><td>${money(d*p.days)}</td></tr>`;
    groupMult += kidDisc;
  }
  sec.hidden = !(p.adults>1 || p.minors>0);

  const trip = strategyCostForKey(adultStrategy) * p.days * groupMult;
  $('#totals').textContent = `${money(strategyCostForKey(adultStrategy))}/day ‚Ä¢ ${money(trip)} trip`;

  // Chart
  paintChart({
    alc:{mean:alcMean,min:alcMin,max:alcMax},
    soda:{mean:netS.mean,min:netS.min,max:netS.max},
    refresh:{mean:netR.mean,min:netR.min,max:netR.max},
    deluxe:{mean:netD.mean,min:netD.min,max:netD.max},
    hasRange
  });
}

/* -------------------- Wiring -------------------- */
document.addEventListener('itw:dataset-ready', ()=>{
  // set price pills and headers from dataset
  $('[data-pkg-price="soda"]').textContent = money(itwDataset.packages.soda)+'/day';
  $('[data-pkg-price="refresh"]').textContent = money(itwDataset.packages.refresh)+'/day';
  $('[data-pkg-price="deluxe"]').textContent = money(itwDataset.packages.deluxe)+'/day';
  $('#cap-badge').textContent = (itwDataset.rules.deluxeCap||14).toFixed(2);

  // inputs -> recompute
  $$('input').forEach(el=>{
    el.addEventListener('input', (e)=>{
      if (el.id==='sea-weight') $('#sea-weight-val').textContent = el.value + '%';
      recompute();
    });
    el.addEventListener('change', recompute);
  });

  // tooltips esc to close (basic)
  document.addEventListener('keydown', (e)=>{
    if (e.key==='Escape'){
      $$('.tooltip [role="tooltip"]').forEach(tt=>tt.style.display='none');
    }
  });

  // Presets
  window.loadPreset = function(name){
    const set = {
      light:   { beer:'1', wine:'1', soda:'1' },
      moderate:{ beer:'2', wine:'1', cocktail:'2', coffee:'1' },
      heavy:   { beer:'3', cocktail:'3', spirits:'2', bottledwater:'2' },
      coffee:  { coffee:'4', soda:'0', beer:'0', wine:'0', cocktail:'0', spirits:'0' }
    }[name] || {};
    Object.entries(set).forEach(([k,v])=>{
      const el = document.querySelector(`[data-input="${k}"]`);
      if (el) el.value = v;
    });
    announce('Preset loaded: ' + name);
    recompute();
  };

  recompute();
});
</script>
</body>
</html>
