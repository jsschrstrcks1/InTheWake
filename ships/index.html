<!-- ships/index.html — v3.004d (standards-compliant) -->
<!doctype html>
<html lang="en">
<head>
  <!-- Analytics -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="9661a449-3ba9-49ea-88e8-4493363578d2"></script>

  <!-- Standards v3.004d: absolute URL + origin normalizer -->
  <script>
  (function(){
    const ORIGIN=(location.origin||(location.protocol+'//'+location.host)).replace(/\/$/,'');
    window._abs=function(path){ path=String(path||''); if(!path.startsWith('/')) path='/'+path; return ORIGIN+path; };
    document.addEventListener('DOMContentLoaded', function(){
      const sel=[
        'a[href^="https://www.cruisinginthewake.com/"]',
        'img[src^="https://www.cruisinginthewake.com/"]',
        'link[href^="https://www.cruisinginthewake.com/"]',
        'script[src^="https://www.cruisinginthewake.com/"]'
      ].join(',');
      document.querySelectorAll(sel).forEach(el=>{
        const attr=el.hasAttribute('href')?'href':'src';
        try{
          const u=new URL(el.getAttribute(attr));
          el.setAttribute(attr, ORIGIN+u.pathname+u.search+u.hash);
        }catch(_){}
      });
    },{once:true});
  })();
  </script>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Browse Ships — Line → Class → Ship | In the Wake (v3.004d)</title>
  <meta name="version" content="v3.004d"/>
  <meta name="description" content="Explore ships by cruise line and class. Select a line, pick a class, then open any ship’s detail page."/>
  <meta name="referrer" content="no-referrer"/>
  <meta name="robots" content="index, follow"/>
  <link rel="canonical" href="https://www.cruisinginthewake.com/ships/index.html"/>
  <meta property="og:url" content="https://www.cruisinginthewake.com/ships/index.html"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="In the Wake"/>
  <meta property="og:title" content="Browse Ships — In the Wake"/>
  <meta property="og:description" content="Explore ships by cruise line and class."/>
  <meta property="og:image" content="https://www.cruisinginthewake.com/assets/ships/radiance-of-the-seas1.jpg?v=3.004d"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <link rel="stylesheet" href="/assets/styles.css?v=3.004d"/>

  <style>
    .hidden{display:none!important}
    .cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.9rem;}
    .card.clickable{cursor:pointer;transition:transform .06s ease-in-out;}
    .card.clickable:hover{transform:translateY(-1px);}
    .card .thumb{width:100%;aspect-ratio:16/9;background:#eef5f7;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center;}
    .card .thumb img{width:100%;height:100%;object-fit:cover;display:block;}
    .pill.badge{margin-left:.35rem;}
    .crumbs{display:flex;flex-wrap:wrap;gap:.35rem;align-items:center;margin:.25rem 0 1rem;justify-content:center;}
    .crumbs .sep{opacity:.6;}
    .crumbs a,.crumbs button{color:#064;text-decoration:underline;background:none;border:none;padding:0;cursor:pointer;}
    .center{text-align:center}
    .tiny-quiet{font-size:.9rem;color:#456;}
    body::before{content:"";position:fixed;inset:0;background:url("/assets/watermark.png") center right/420px auto no-repeat;opacity:.06;pointer-events:none;z-index:0;}
    body>*{position:relative;z-index:1;}
  </style>

  <link rel="preload" as="image" href="/assets/compass_rose.svg"/>
  <script src="/assets/js/site-cache.js" defer></script>
  <script>
  if('serviceWorker' in navigator){
    window.addEventListener('load',()=>navigator.serviceWorker.register('/sw.js').catch(()=>{}));
  }
  </script>
  <script src="/assets/js/share-bar.js" defer></script>
</head>

<body class="page no-hero-filter">
  <a class="skip-link" href="#content">Skip to main content</a>

  <header class="site-header hero-header">
    <div class="navbar">
      <div class="brand">
        <img src="/assets/logo_wake.png" width="256" height="64" alt="In the Wake wordmark"/>
        <span class="version-badge">v3.004d</span>
      </div>
      <nav class="pill-nav pills" aria-label="Primary">
        <a href="/">Home</a>
        <a href="/ships/" aria-current="page">Ships</a>
        <a href="/restaurants.html">Restaurants &amp; Menus</a>
        <a href="/ports.html">Ports</a>
        <a href="/disability-at-sea.html">Disability at Sea</a>
        <a href="/drink-packages.html">Drink Packages</a>
        <a href="/packing-lists.html">Packing Lists</a>
        <a href="/planning.html">Planning</a>
        <a href="/solo.html">Solo</a>
        <a href="/travel.html">Travel</a>
      </nav>
    </div>
    <div class="hero" role="img" aria-label="Ships hub hero image">
      <div class="latlon-grid" aria-hidden="true"></div>
      <img class="hero-compass" src="/assets/compass_rose.svg" alt="" aria-hidden="true"/>
      <div class="hero-title">
        <img class="logo" src="/assets/logo_wake.png" alt="In the Wake"/>
        <div class="tagline">A Cruise Traveler’s Logbook</div>
      </div>
      <div class="hero-credit">
        <a class="pill long" href="https://instagram.com/flickersofmajesty" target="_blank" rel="noopener">Photo © Flickers of Majesty</a>
      </div>
    </div>
  </header>

  <main class="wrap" id="content">
    <section class="card" aria-labelledby="title">
      <h1 id="title">Browse Ships</h1>
      <nav class="crumbs" aria-label="Breadcrumb">
        <span id="crumb-line-wrap" class="hidden"><button id="crumb-line" type="button"></button> <span class="sep">›</span></span>
        <span id="crumb-class-wrap" class="hidden"><button id="crumb-class" type="button"></button> <span class="sep">›</span></span>
        <strong id="crumb-here">Choose a cruise line</strong>
      </nav>
    </section>

    <section class="card"><h2>Cruise Lines</h2><div id="linesGrid" class="cards-grid"></div><p id="linesEmpty" class="tiny-quiet hidden">No cruise lines found.</p></section>
    <section id="classesSection" class="card hidden"><h2>Classes</h2><div id="classesGrid" class="cards-grid"></div><p id="classesEmpty" class="tiny-quiet hidden">No classes found for this line.</p></section>
    <section id="shipsSection" class="card hidden"><h2>Ships</h2><div id="shipsGrid" class="cards-grid"></div><p id="shipsEmpty" class="tiny-quiet hidden">No ships found.</p></section>
    <section class="card"><h2>Data</h2><p id="meta" class="tiny">Data source: fleets_index.json</p></section>
  </main>

  <footer class="wrap center">© <span id="yr"></span> In the Wake — A Cruise Traveler’s Logbook</footer>
  <script>document.getElementById('yr').textContent=new Date().getFullYear();</script>

  <!-- ships-browse logic v3.004d -->
  <script>
  (async function(){
    const abs=(p)=> (typeof window._abs==='function'? _abs(p): p);
    const PRIMARY=abs('/data/fleets_index.json');
    const FALLBACKS=[abs('/data/fleet_index.json'),abs('/assets/data/fleet_index.json'),abs('/ships/assets/data/fleet/fleet_index.json')];

    async function loadFleetJSON(){
      async function tryFetch(url){
        try{const r=await fetch(url,{cache:'no-store'});if(r.ok)return await r.json();}catch{}return null;
      }
      let data=await tryFetch(PRIMARY);
      if(!data){
        for(const alt of FALLBACKS){data=await tryFetch(alt);if(data)break;}
      }
      if(!data) throw new Error('Fleet data unavailable.');
      return data;
    }

    const el={
      linesGrid:document.getElementById('linesGrid'),
      linesEmpty:document.getElementById('linesEmpty'),
      classesSec:document.getElementById('classesSection'),
      classesGrid:document.getElementById('classesGrid'),
      classesEmpty:document.getElementById('classesEmpty'),
      shipsSec:document.getElementById('shipsSection'),
      shipsGrid:document.getElementById('shipsGrid'),
      shipsEmpty:document.getElementById('shipsEmpty'),
      meta:document.getElementById('meta'),
      crumbLineWrap:document.getElementById('crumb-line-wrap'),
      crumbLine:document.getElementById('crumb-line'),
      crumbClassWrap:document.getElementById('crumb-class-wrap'),
      crumbClass:document.getElementById('crumb-class'),
      crumbHere:document.getElementById('crumb-here')
    };

    const STATE={line:null,classId:null};
    const norm=s=>String(s||'').toLowerCase().trim();
    const esc=s=>String(s).replace(/[&<>"']/g,m=>({'&':'&lt;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    const titleCase=s=>String(s||'').replace(/(^|[-_ ])([a-z])/g,(_,sp,ch)=>(sp?sp:'')+ch.toUpperCase());

    function normalizeFromCruiseLines(json){
      const out = [];
      const lines = json.cruise_lines || {};
      if (Array.isArray(lines)) {
        for (const L of lines) {
          const ships = L.ships || [];
          for (const s of ships) {
            out.push({
              name: s.name || '',
              slug: s.slug || '',
              line: L.slug || L.line_slug || '',
              class: norm(s.class || s.ship_class || ''),
              gt: parseInt(s.gt) || null,
              guests: parseInt(s.capacity) || null,
              year: parseInt(s.year_built_or_entered) || null,
              detail_url: s.url || `/ships/${L.slug || L.line_slug}/${s.slug}.html`
            });
          }
        }
      } else if (typeof lines === 'object') {
        for (const [lineId, ships] of Object.entries(lines)) {
          if (!Array.isArray(ships)) continue;
          for (const s of ships) {
            out.push({
              name: s.name || '',
              slug: s.slug || '',
              line: lineId,
              class: norm(s.class || s.ship_class || ''),
              gt: parseInt(s.gt) || null,
              guests: parseInt(s.capacity) || null,
              year: parseInt(s.year_built_or_entered) || null,
              detail_url: s.url || `/ships/${lineId}/${s.slug}.html`
            });
          }
        }
      }
      return out.filter(x => x.name && x.line);
    }

    function groupByLineAndClass(list){
      const byLine={};
      for(const s of list){
        const L=s.line||'unknown';const K=s.class||'unknown';
        if(!byLine[L])byLine[L]={};if(!byLine[L][K])byLine[L][K]=[];
        byLine[L][K].push(s);
      }
      return byLine;
    }

    function lineDisplay(id){
      const map={'royal-caribbean':'Royal Caribbean International','rcl':'Royal Caribbean International'};
      return map[id]||titleCase(id.replace(/-/g,' '));
    }
    function classDisplay(id){return titleCase(id.replace(/-?class$/,'').replace(/-/g,' '))+' Class';}

    function lineCard(lineId,classes){
      const count=Object.values(classes).reduce((n,arr)=>n+(arr?arr.length:0),0);
      const logo=/(royal|rcl)/.test(lineId)?'/assets/lines/rcl.png':'/assets/logo_wake.png';
      return `<div class="card clickable"><button type="button" class="card-btn" data-line="${esc(lineId)}">
        <div class="thumb"><img src="${abs(logo)}" alt="${esc(lineDisplay(lineId))} logo" loading="lazy"/></div>
        <div class="body"><h3>${esc(lineDisplay(lineId))} <span class="pill badge">${count} ships</span></h3></div></button></div>`;
    }

    const WORLD_API={
      renderLines(byLine){
        const ids=Object.keys(byLine).sort();
        el.linesGrid.innerHTML=ids.map(id=>lineCard(id,byLine[id])).join('');
        el.linesEmpty.classList.toggle('hidden',!!ids.length);
        el.linesGrid.querySelectorAll('[data-line]').forEach(b=>b.onclick=()=>WORLD_API.selectLine(b.dataset.line));
      },
      renderClasses(lineId,classes){
        el.classesSec.classList.remove('hidden');
        const ids=Object.keys(classes).sort();
        el.classesGrid.innerHTML=ids.map(id=>`<div class="card clickable"><button type="button" class="card-btn" data-class="${esc(id)}"><div class="thumb"><img src="/assets/logo_wake.png" alt="${esc(classDisplay(id))}" loading="lazy"/></div><div class="body"><h3>${esc(classDisplay(id))}</h3></div></button></div>`).join('');
        el.classesEmpty.classList.toggle('hidden',!!ids.length);
        el.classesGrid.querySelectorAll('[data-class]').forEach(b=>b.onclick=()=>WORLD_API.selectClass(b.dataset.class));
      },
      renderShips(lineId,classId,list){
        el.shipsSec.classList.remove('hidden');
        el.shipsGrid.innerHTML=list.map(s=>`<article class="card"><div class="thumb"><img src="/assets/ships/thumbs/placeholder.jpg" alt="${esc(s.name)}"/></div><div class="body"><h3>${esc(s.name)}</h3></div></article>`).join('');
        el.shipsEmpty.classList.toggle('hidden',!!list.length);
      },
      selectLine(lineId){
        STATE.line=lineId;STATE.classId=null;
        el.crumbLine.textContent=lineDisplay(lineId);
        el.crumbLineWrap.classList.remove('hidden');
        el.crumbClassWrap.classList.add('hidden');
        el.crumbHere.textContent='Choose a class';
        WORLD_API.renderClasses(lineId,WORLD.byLine[lineId]||{});
        el.shipsSec.classList.add('hidden');el.shipsGrid.innerHTML='';
      },
      selectClass(classId){
        STATE.classId=classId;
        el.crumbClass.textContent=classDisplay(classId);
        el.crumbClassWrap.classList.remove('hidden');
        el.crumbHere.textContent='Choose a ship';
        WORLD_API.renderShips(STATE.line,classId,(WORLD.byLine[STATE.line]||{})[classId]);
      }
    };

    const raw=await loadFleetJSON();
    const ships=normalizeFromCruiseLines(raw);
    const WORLD={byLine:groupByLineAndClass(ships)};
    const when=raw.generated||raw.updated||(raw.meta&&raw.meta.updated);
    const ver=raw.version||(raw.meta&&raw.meta.version);
    el.meta.textContent=`Data: ${ver?('v'+ver):''}${ver&&when?' • ':''}${when?String(when).slice(0,10):''}`;
    WORLD_API.renderLines(WORLD.byLine);
  })();
  </script>

  <script>
  (function(){
    const IO=('IntersectionObserver'in window)?new IntersectionObserver(ents=>{
      ents.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');IO.unobserve(e.target);}});
    },{rootMargin:'80px 0px'}):null;
    document.querySelectorAll('.card').forEach(c=>{if(IO)IO.observe(c);else c.classList.add('visible');});
  })();
  </script>
</body>
</html>
